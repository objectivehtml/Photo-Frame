/*! photoframe 25-11-2013 */
function localStorageDB(a,b){function c(){delete C[z],B=null}function d(){var a=0;for(var b in B.tables)B.tables.hasOwnProperty(b)&&a++;return a}function e(a){return B.tables[a]?!0:!1}function f(a){e(a)||t("The table '"+a+"' does not exist.")}function g(a,b){B.tables[a]={fields:b,auto_increment:1},B.data[a]={}}function h(a){delete B.tables[a],delete B.data[a]}function i(a){B.tables[a].auto_increment=1,B.data[a]={}}function j(a){var b=0;for(var c in B.data[a])B.data[a].hasOwnProperty(c)&&b++;return b}function k(a,b){return b.ID=B.tables[a].auto_increment,B.data[a][B.tables[a].auto_increment]=b,B.tables[a].auto_increment++,b.ID}function l(a,b){for(var c=null,d=[],e=null,f=0;f<b.length;f++)c=b[f],e=B.data[a][c],d.push(u(e));return d}function m(a,b,c){var d=[],e=!1,f=null;for(var g in B.data[a])if(B.data[a].hasOwnProperty(g)){f=B.data[a][g],e=!0;for(var h in b)if(b.hasOwnProperty(h))if("string"==typeof b[h]){if(f[h].toString().toLowerCase()!=b[h].toString().toLowerCase()){e=!1;break}}else if(f[h]!=b[h]){e=!1;break}if(e&&d.push(g),d.length==c)break}return d}function n(a,b,c){var d=[],e=null;for(var f in B.data[a])if(B.data[a].hasOwnProperty(f)&&(e=B.data[a][f],1==b(u(e))&&d.push(f),d.length==c))break;return d}function o(a,b){var c=[];for(var d in B.data[a])if(B.data[a].hasOwnProperty(d)&&(c.push(d),c.length==b))break;return c}function p(a,b){for(var c=0;c<b.length;c++)B.data[a].hasOwnProperty(b[c])&&delete B.data[a][b[c]];return b.length}function q(a,b,c){for(var d="",e=0,f=0;f<b.length;f++){d=b[f];var g=c(u(B.data[a][d]));if(g){delete g.ID;var h=B.data[a][d];for(var i in g)g.hasOwnProperty(i)&&(h[i]=g[i]);B.data[a][d]=w(a,h),e++}}return e}function r(){C[z]=JSON.stringify(B)}function s(){return JSON.stringify(B)}function t(a){throw new Error(a)}function u(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function v(a){return a.match(/[^a-z_0-9]/gi)?!1:!0}function w(a,b){for(var c="",d={},e=0;e<B.tables[a].fields.length;e++)c=B.tables[a].fields[e],b[c]&&(d[c]=b[c]);return d}function x(a,b){for(var c="",d={},e=0;e<B.tables[a].fields.length;e++)c=B.tables[a].fields[e],d[c]=b[c]?b[c]:null;return d}var y="db_",z=y+a,A=!1,B=null;try{var C=b==sessionStorage?sessionStorage:localStorage}catch(D){var C=b}return B=C[z],B&&(B=JSON.parse(B))&&B.tables&&B.data||(v(a)?(B={tables:{},data:{}},r(),A=!0):t("The name '"+a+"' contains invalid characters.")),{commit:function(){r()},isNew:function(){return A},drop:function(){c()},serialize:function(){return s()},tableExists:function(a){return e(a)},tableCount:function(){return d()},createTable:function(a,b){var c=!1;if(v(a))if(this.tableExists(a))t("The table name '"+a+"' already exists.");else{for(var d=!0,e=0;e<b.length;e++)if(!v(b[e])){d=!1;break}if(d){for(var f={},e=0;e<b.length;e++)f[b[e]]=!0;delete f.ID,b=["ID"];for(var h in f)f.hasOwnProperty(h)&&b.push(h);g(a,b),c=!0}else t("One or more field names in the table definition contains invalid characters.")}else t("The database name '"+a+"' contains invalid characters.");return c},dropTable:function(a){f(a),h(a)},truncate:function(a){f(a),i(a)},rowCount:function(a){return f(a),j(a)},insert:function(a,b){return f(a),k(a,x(a,b))},insertOrUpdate:function(a,b,c){f(a);var d=[];if(b?"object"==typeof b?d=m(a,w(a,b)):"function"==typeof b&&(d=n(a,b)):d=o(a),0==d.length)return k(a,x(a,c));for(var e=[],g=0;g<d.length;g++)q(a,d,function(a){return e.push(a.ID),c});return e},update:function(a,b,c){f(a);var d=[];return b?"object"==typeof b?d=m(a,w(a,b)):"function"==typeof b&&(d=n(a,b)):d=o(a),q(a,d,c)},query:function(a,b,c){f(a);var d=[];return b?"object"==typeof b?d=m(a,w(a,b),c):"function"==typeof b&&(d=n(a,b,c)):d=o(a,c),l(a,d,c)},deleteRows:function(a,b){f(a);var c=[];return b?"object"==typeof b?c=m(a,w(a,b)):"function"==typeof b&&(c=n(a,b)):c=o(a),p(a,c)}}}function localStorageDB(a,b){function c(){delete C[z],B=null}function d(){var a=0;for(var b in B.tables)B.tables.hasOwnProperty(b)&&a++;return a}function e(a){return B.tables[a]?!0:!1}function f(a){e(a)||t("The table '"+a+"' does not exist.")}function g(a,b){B.tables[a]={fields:b,auto_increment:1},B.data[a]={}}function h(a){delete B.tables[a],delete B.data[a]}function i(a){B.tables[a].auto_increment=1,B.data[a]={}}function j(a){var b=0;for(var c in B.data[a])B.data[a].hasOwnProperty(c)&&b++;return b}function k(a,b){return b.ID=B.tables[a].auto_increment,B.data[a][B.tables[a].auto_increment]=b,B.tables[a].auto_increment++,b.ID}function l(a,b){for(var c=null,d=[],e=null,f=0;f<b.length;f++)c=b[f],e=B.data[a][c],d.push(u(e));return d}function m(a,b,c){var d=[],e=!1,f=null;for(var g in B.data[a])if(B.data[a].hasOwnProperty(g)){f=B.data[a][g],e=!0;for(var h in b)if(b.hasOwnProperty(h))if("string"==typeof b[h]){if(f[h].toString().toLowerCase()!=b[h].toString().toLowerCase()){e=!1;break}}else if(f[h]!=b[h]){e=!1;break}if(e&&d.push(g),d.length==c)break}return d}function n(a,b,c){var d=[],e=null;for(var f in B.data[a])if(B.data[a].hasOwnProperty(f)&&(e=B.data[a][f],1==b(u(e))&&d.push(f),d.length==c))break;return d}function o(a,b){var c=[];for(var d in B.data[a])if(B.data[a].hasOwnProperty(d)&&(c.push(d),c.length==b))break;return c}function p(a,b){for(var c=0;c<b.length;c++)B.data[a].hasOwnProperty(b[c])&&delete B.data[a][b[c]];return b.length}function q(a,b,c){for(var d="",e=0,f=0;f<b.length;f++){d=b[f];var g=c(u(B.data[a][d]));if(g){delete g.ID;var h=B.data[a][d];for(var i in g)g.hasOwnProperty(i)&&(h[i]=g[i]);B.data[a][d]=w(a,h),e++}}return e}function r(){C[z]=JSON.stringify(B)}function s(){return JSON.stringify(B)}function t(a){throw new Error(a)}function u(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function v(a){return a.match(/[^a-z_0-9]/gi)?!1:!0}function w(a,b){for(var c="",d={},e=0;e<B.tables[a].fields.length;e++)c=B.tables[a].fields[e],b[c]&&(d[c]=b[c]);return d}function x(a,b){for(var c="",d={},e=0;e<B.tables[a].fields.length;e++)c=B.tables[a].fields[e],d[c]=b[c]?b[c]:null;return d}var y="db_",z=y+a,A=!1,B=null;try{var C=b==sessionStorage?sessionStorage:localStorage}catch(D){var C=b}return B=C[z],B&&(B=JSON.parse(B))&&B.tables&&B.data||(v(a)?(B={tables:{},data:{}},r(),A=!0):t("The name '"+a+"' contains invalid characters.")),{commit:function(){r()},isNew:function(){return A},drop:function(){c()},serialize:function(){return s()},tableExists:function(a){return e(a)},tableCount:function(){return d()},createTable:function(a,b){var c=!1;if(v(a))if(this.tableExists(a))t("The table name '"+a+"' already exists.");else{for(var d=!0,e=0;e<b.length;e++)if(!v(b[e])){d=!1;break}if(d){for(var f={},e=0;e<b.length;e++)f[b[e]]=!0;delete f.ID,b=["ID"];for(var h in f)f.hasOwnProperty(h)&&b.push(h);g(a,b),c=!0}else t("One or more field names in the table definition contains invalid characters.")}else t("The database name '"+a+"' contains invalid characters.");return c},dropTable:function(a){f(a),h(a)},truncate:function(a){f(a),i(a)},rowCount:function(a){return f(a),j(a)},insert:function(a,b){return f(a),k(a,x(a,b))},insertOrUpdate:function(a,b,c){f(a);var d=[];if(b?"object"==typeof b?d=m(a,w(a,b)):"function"==typeof b&&(d=n(a,b)):d=o(a),0==d.length)return k(a,x(a,c));for(var e=[],g=0;g<d.length;g++)q(a,d,function(a){return e.push(a.ID),c});return e},update:function(a,b,c){f(a);var d=[];return b?"object"==typeof b?d=m(a,w(a,b)):"function"==typeof b&&(d=n(a,b)):d=o(a),q(a,d,c)},query:function(a,b,c){f(a);var d=[];return b?"object"==typeof b?d=m(a,w(a,b),c):"function"==typeof b&&(d=n(a,b,c)):d=o(a,c),l(a,d,c)},deleteRows:function(a,b){f(a);var c=[];return b?"object"==typeof b?c=m(a,w(a,b)):"function"==typeof b&&(c=n(a,b)):c=o(a),p(a,c)}}}var InterfaceBuilder=function(){var a=this;a.matrix=function(a){$(a).each(function(){var a=$(this),b=a.find("tbody"),c=a.find("thead tr"),d=a.data("name"),e=[];c.find("th").each(function(a){a>0&&e.push($(this).data("col"))}),a.find(".ib-add-row").live("click",function(a){var f=$("<tr />"),g=b.find("tr").length;f.append('<td><div class="ib-drag-handle"></div></td>');for(var h=1;h<c.find("th").length-1;h++)f.append('<td><input type="text" name="'+d+"["+g+"]["+e[h-1]+']" value="" class="ib-cell" /></td>');f.append('<td><a href="#'+g+'" class="ib-delete-row">Delete</a></td>'),b.append(f),a.preventDefault()}),a.find(".ib-delete-row").live("click",function(){return $(this).parent().parent().remove(),b.find("tr").each(function(a){var b=$(this).find("td"),c=b.length;b.each(function(b){if(b>0&&c>b+1){var d=$(this).find("input"),e=d.attr("name").replace(/(\[\d\]\[)/g,"["+a+"][");d.attr("name",e)}})}),!1})})},a.matrix(".ib-matrix")},Base=function(){};Base.extend=function(a,b){var c=Base.prototype.extend;Base._prototyping=!0;var d=new this;c.call(d,a),d.base=function(){},delete Base._prototyping;var e=d.constructor,f=d.constructor=function(){if(!Base._prototyping)if(this._constructing||this.constructor==f)this._constructing=!0,e.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||c).call(arguments[0],d)};return f.ancestor=this,f.extend=this.extend,f.forEach=this.forEach,f.implement=this.implement,f.prototype=d,f.toString=this.toString,f.valueOf=function(a){return"object"==a?f:e.valueOf()},c.call(f,b),"function"==typeof f.init&&f.init(),f},Base.prototype={extend:function(a,b){if(arguments.length>1){var c=this[a];if(c&&"function"==typeof b&&(!c.valueOf||c.valueOf()!=b.valueOf())&&/\bbase\b/.test(b)){var d=b.valueOf();b=function(){var a=this.base||Base.prototype.base;this.base=c;var b=d.apply(this,arguments);return this.base=a,b},b.valueOf=function(a){return"object"==a?b:d},b.toString=Base.toString}this[a]=b}else if(a){var e=Base.prototype.extend;Base._prototyping||"function"==typeof this||(e=this.extend||e);for(var f={toSource:null},g=["constructor","toString","valueOf"],h=Base._prototyping?0:1;i=g[h++];)a[i]!=f[i]&&e.call(this,i,a[i]);for(var i in a)f[i]||e.call(this,i,a[i])}return this}},Base=Base.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(a,b,c){for(var d in a)void 0===this.prototype[d]&&b.call(c,a[d],d,a)},implement:function(){for(var a=0;a<arguments.length;a++)"function"==typeof arguments[a]?arguments[a](this.prototype):this.prototype.extend(arguments[a]);return this},toString:function(){return String(this.valueOf())}}),function(a){PhotoFrame.Buttons.Crop=PhotoFrame.Button.extend({buttons:[],description:!1,name:!1,enabled:!0,renderAfterRemovingLayer:!1,windowSettings:{title:!1},constructor:function(a){var b=this;this.name=PhotoFrame.Lang.crop,this.description=PhotoFrame.Lang.crop_desc,this.windowSettings.title=PhotoFrame.Lang.crop,this.buttons=[{text:PhotoFrame.Lang.crop,css:"photo-frame-tool-window-save",onclick:function(){var a=b.getCrop(!0);(a.x||a.y||a.x2||a.y2)&&b.setCrop(a.x,a.y,a.x2,a.y2)}}],b.base(a)},setCrop:function(a,b,c,d){this.buttonBar.factory.cropPhoto.jcrop.setSelect([a,b,c,d])},apply:function(){if(this.enabled){var a=this.getCrop(!0),b=a.x,c=a.y,d=a.x2,e=a.y2;!this.resizeToggleLayer&&(b||d||c||e)&&this.addManipulation(!0,{x:b,x2:d,y:c,y2:e})}},getCrop:function(a){return a?{x:parseInt(this.window.ui.x.val()),y:parseInt(this.window.ui.y.val()),x2:parseInt(this.window.ui.x2.val()),y2:parseInt(this.window.ui.y2.val())}:this.buttonBar.factory.cropPhoto.cropDimensions()},startCrop:function(){var a=this.getCrop();if(a.x||a.y||a.x2||a.y2)this.addManipulation(!0,{x:a.x,y:a.y,x2:a.x2,y2:a.y2});else{var b=this.getManipulation();b&&!b.visible&&this.disable()}this.refresh()},toggleLayer:function(a){var b=this.getManipulation();a?this.showCrop(b):this.hideCrop(),this.addManipulation(a,b.data)},hideCrop:function(){this.release(),this.disable()},showCrop:function(a){this.enable(),this.setCrop(a.data.x,a.data.y,a.data.x2,a.data.y2)},disable:function(a){this.enabled=!1,a||this.buttonBar.factory.cropPhoto.jcrop.disable(),this.window.ui.content.find("input").attr("disabled",!0)},enable:function(a){this.enabled=!0,a||this.buttonBar.factory.cropPhoto.jcrop.enable(),this.window.ui.content.find("input").attr("disabled",!1)},release:function(){this.buttonBar.factory.cropPhoto.releaseCrop()},removeLayer:function(){this.resizeToggleLayer=!1,this.removeManipulation(),this.release(),this.enable()},reset:function(){this.window.ui.x.val(""),this.window.ui.y.val(""),this.window.ui.x2.val(""),this.window.ui.y2.val("")},showWindow:function(){this.refresh(),this.base()},buildWindow:function(){this.base({buttons:this.buttons});var b=this,c=a(['<div class="photo-frame-grid">','<label for="x">'+PhotoFrame.Lang.x+"</label>",'<input type="text" name="x" value="" id="x" class="photo-frame-small" />',"</div>",'<div class="photo-frame-grid">','<label for="y">'+PhotoFrame.Lang.y+"</label>",'<input type="text" name="y" value="" id="y" class="photo-frame-small" />',"</div>",'<div class="photo-frame-grid">','<label for="x2">'+PhotoFrame.Lang.x2+"</label>",'<input type="text" name="x2" value="" id="x2" class="photo-frame-small" />',"</div>",'<div class="photo-frame-grid">','<label for="y">'+PhotoFrame.Lang.y2+"</label>",'<input type="text" name="y" value="" id="y2" class="photo-frame-small" />',"</div>"].join(""));this.window.ui.content.html(c),this.window.ui.content.find("input").keypress(function(a){13==a.keyCode&&(b.apply(),a.preventDefault())}),this.window.ui.x=this.window.ui.content.find("#x"),this.window.ui.y=this.window.ui.content.find("#y"),this.window.ui.x2=this.window.ui.content.find("#x2"),this.window.ui.y2=this.window.ui.content.find("#y2");var d,e;this.resizeToggleLayer=!1,this.bind("startCropBegin",function(){e=!1}),this.bind("startCropEnd",function(){e=!0}),this.bind("jcropOnChange",function(){if(!this.resizeToggleLayer){var a=b.getManipulation();a&&a.visible&&b.enable(!0),b.buttonBar.factory.cropPhoto.released=!1,b.refresh()}}),this.bind("jcropOnRelease",function(){e&&b.getManipulation().visible&&(b.resizeToggleLayer||b.removeManipulation(),b.resizeToggleLayer=!1)}),this.bind("jcropOnSelect",function(){b.buttonBar.factory.cropPhoto.released=!1,b.refresh(!0),b.apply()}),this.bind("startRendering",function(){d=b.getManipulation().visible?!0:!1,d?b.showManipulation():b.hideManipulation()}),this.bind("stopRendering",function(){b.getManipulation()&&b.getManipulation().visible&&(b.buttonBar.factory.cancel||b.toggleLayer(d))}),this.bind("resizeInitCrop",function(){if(b.cropPhoto().totalManipulations()>0){var a=b.getManipulation();b.initCrop(a&&!a.visible?!0:!1)}}),this.bind("resizeRemoveLayer",function(){b.initCrop(!0)}),this.bind("rotateReInitCrop",function(){b.initCrop()}),this.bind("startCropEnd",function(){"true"==b.buttonBar.factory.settings.photo_frame_disable_regular_crop&&b.disable()})},isActive:function(){return"true"===this.getSetting("disable_regular_crop")?!1:!0},toggleLayerCallback:function(a){var b=a.visible&&this.getManipulation().visible?!0:!1;a.visible||(this.resizeToggleLayer=this.getManipulation().data,this.toggleLayer(b))},initCrop:function(b){if(this.cropPhoto().jcrop){var c=this.getManipulation(),d=this.cropPhoto().released,e=this.cropPhoto().jcrop.tellSelect(),f=this.cropPhoto().ui.cropPhoto.find("img");this.cropPhoto().ui.cropPhoto.remove(),this.cropPhoto().destroyJcrop(),this.cropPhoto().ui.cropPhoto=a('<div class="'+this.buttonBar.factory.classes.cropPhoto+'"></div>'),this.buttonBar.factory.ui.crop.append(this.cropPhoto().ui.cropPhoto),this.cropPhoto().ui.cropPhoto.append(f),this.cropPhoto().initJcrop(),c.visible||this.cropPhoto().releaseCrop(),!c.data||d||b||(this.cropPhoto().releaseCrop(),this.cropPhoto().jcrop.setSelect([e.x,e.y,e.x2,e.y2])),this.buttonBar.factory.ui.crop.center(),this.buttonBar.factory.trigger("initCrop")}},refresh:function(a){var b=this.getCrop(a);this.isActive()||this.window.close(),b.x||b.y||b.x2||b.y2?(this.window.ui.x.val(b.x),this.window.ui.y.val(b.y),this.window.ui.x2.val(b.x2),this.window.ui.y2.val(b.y2)):this.reset()}})}(jQuery),function(a){PhotoFrame.Buttons.Layers=PhotoFrame.Button.extend({buttons:[],classes:{layer:"photo-frame-layer",layerIcon:"photo-frame-layer-icon",layerEmpty:"photo-frame-layer-empty",layerTitle:"photo-frame-layer-title",layerActions:"photo-frame-layer-actions",visible:"photo-frame-toggle-visible",toggleButton:"photo-frame-toggle-layer-button",trash:"photo-frame-trash"},description:!1,icon:"layers",icons:{eye:"eye",eyeClose:"eye-off",trash:"trash"},name:!1,windowSettings:{css:"photo-frame-layers",title:!1},constructor:function(b){var c=this;this.buttons=[{text:PhotoFrame.Lang.hide_all,css:this.classes.toggleButton,onclick:function(b){var d=a(b.target);d.html()==PhotoFrame.Lang.hide_all?(d.html(PhotoFrame.Lang.show_all),c.hideAll()):(d.html(PhotoFrame.Lang.hide_all),c.showAll()),b.preventDefault()}},{text:PhotoFrame.Lang.rerender,css:"photo-frame-tool-window-save",onclick:function(){c.cropPhoto()&&!c.cropPhoto().isRendering()&&(c.render(function(){c.buttonBar.factory.trigger("layerWindowReRender")}),c.refresh())}}],this.name=PhotoFrame.Lang.layers,this.description=PhotoFrame.Lang.layers_desc,this.windowSettings.title=PhotoFrame.Lang.layers,this.base(b)},totalHidden:function(){var b=0;return a.each(this.cropPhoto().getManipulations(),function(a,c){c.visible||b++}),b},allHidden:function(){return this.cropPhoto().totalManipulations()==this.totalHidden()?!0:!1},hideAll:function(){this.toggleLayers(!1)},showAll:function(){this.toggleLayers(!0)},toggleLayers:function(a){if(this.cropPhoto()&&!this.cropPhoto().isRendering()){var b=this.cropPhoto().getManipulations();for(var c in this.buttonBar.buttons){var d=this.buttonBar.buttons[c];b[d.getPackageName()]&&d.toggleLayer(a,!1)}}this.refresh(),this.render()},toggleDisplayButton:function(){this.allHidden()?this.window.buttons[0].ui.button.html(PhotoFrame.Lang.show_all):this.window.buttons[0].ui.button.html(PhotoFrame.Lang.hide_all)},buildWindow:function(){var b=this;this.base({buttons:this.buttons}),this.buttonBar.factory.bind("startCropEnd",function(){b.refresh(),b.toggleDisplayButton()}),this.buttonBar.factory.bind("removeManipulation",function(){b.refresh()}),this.buttonBar.factory.bind("showManipulation",function(){b.refresh()}),this.buttonBar.factory.bind("hideManipulation",function(){b.refresh()}),this.buttonBar.factory.bind("startRendering",function(){b.toggleDisplayButton()}),this.buttonBar.factory.bind("addManipulation",function(c,d,e){var f=a(b.window.ui.content).get(0);b.refresh(),e||"crop"==d||(f.scrollTop=f.scrollHeight)})},toggleLayer:function(a,b){b.visible=b.visible?!1:!0,this.buttonBar.factory.trigger(a+"ToggleLayer",b),this.refresh()},removeLayer:function(a,b){this.buttonBar.factory.trigger(a+"RemoveLayer",b),delete this.buttonBar.factory.cropPhoto.manipulations[a],this.refresh()},refresh:function(b){var c=0,d=this,e={},b=b?b:this.cropPhoto();this.window.ui.content.html("");for(var f in this.buttonBar.buttons){var g=this.buttonBar.buttons[f];e[g.getPackageName()]=g}if(a.each(b.manipulations,function(f,g){var g=b.manipulations[f],h=e[f];if(h){var i=h.getPackageName(),j=a('<a href="#" class="'+d.classes.visible+'"><i class="icon-'+(g.visible?d.icons.eye:d.icons.eyeClose)+'"></i></a>'),k=a('<a href="#" class="'+d.classes.trash+'"><i class="icon-'+d.icons.trash+'"></i></a>'),l=a(['<div class="'+d.classes.layer+" "+d.buttonBar.factory.classes.clearfix+'">','<div class="'+d.classes.layerIcon+'"><a href="#"><i class="icon-'+(h.icon?h.icon:i)+'"></i></a></div>','<div class="'+d.classes.layerTitle+'">'+h.window.title+"</div>",'<div class="'+d.classes.layerActions+'"></div>',"</div>"].join(""));l.find("."+d.classes.layerActions).append(j),l.find("."+d.classes.layerActions).append(k),l.find("."+d.classes.layerIcon+" > a").click(function(a){h.window.toggle(),a.preventDefault()}),j.click(function(a){d.cropPhoto()&&!d.cropPhoto().isRendering()&&(d.toggleLayer(f,g,j),h.toggleLayer(g.visible),a.preventDefault())}),k.click(function(a){d.removeLayer(f,g,k),h.renderAfterRemovingLayer?d.render(function(){h.removeLayer()}):h.removeLayer(),a.preventDefault()}),d.window.ui.buttons.show(),d.window.ui.content.append(l),c++}}),!c){var h=a(['<div class="'+d.classes.layer+" "+d.buttonBar.factory.classes.clearfix+'">','<div class="'+d.classes.layerEmpty+'">'+PhotoFrame.Lang.no_layers+"</div>",'<div class="'+d.classes.layerActions+'"></div>',"</div>"].join(""));d.window.ui.buttons.hide(),d.window.ui.content.append(h)}},startCrop:function(){this.window.buttons[0].ui.button;this.refresh()}})}(jQuery),function(a){PhotoFrame.Buttons.Resize=PhotoFrame.Button.extend({buttons:[],description:"The resize the image.",name:"Resize",windowSettings:{title:"Resize"},constructor:function(a){var b=this;this.buttons=[{text:PhotoFrame.Lang.resize,css:"photo-frame-tool-window-save",onclick:function(){b.apply()}}],this.base(a)},getWidth:function(){return parseInt(this.window.ui.width.val())},getHeight:function(){return parseInt(this.window.ui.height.val())},getMaintainAspect:function(){return"checked"===this.window.ui.aspect.attr("checked")?!0:!1},reset:function(){this.cropPhoto()&&(this.window.ui.width.val(this.cropPhoto().width()),this.window.ui.height.val(this.cropPhoto().height()),this.window.ui.aspect.attr("checked",!0))},enable:function(){this.window.ui.width.attr("disabled",!1),this.window.ui.height.attr("disabled",!1),this.window.ui.aspect.attr("disabled",!1)},disable:function(){this.window.ui.width.attr("disabled",!0),this.window.ui.height.attr("disabled",!0),this.window.ui.aspect.attr("disabled",!0)},removeLayer:function(){this.reset(),this.buttonBar.factory.trigger("resizeRemoveLayer")},startCrop:function(){var a=this.getManipulation();a?(this.window.ui.width.val(a.data.width),this.window.ui.height.val(a.data.height),a.data.aspect===!0||"true"===a.data.aspect?this.window.ui.aspect.attr("checked",!0):this.window.ui.aspect.attr("checked",!1),this.base()):this.reset()},apply:function(){var a=this;this.addManipulation(!0,{aspect:this.getMaintainAspect(),width:this.getWidth(),height:this.getHeight()}),this.buttonBar.factory.trigger("resize",this,this.getWidth(),this.getHeight()),this.render(function(){a.buttonBar.factory.trigger("resizeRenderCallback",a,a.getWidth(),a.getHeight())})},initCrop:function(a){this.buttonBar.factory.trigger("resizeReInitCrop",this,a)},toggleLayer:function(a,b){this.base(a,b)},buildWindow:function(){this.base({buttons:this.buttons});var b=this,c=a(['<div class="photo-frame-inline photo-frame-margin-bottom">','<label for="photo-frame-width" class="photo-frame-small photo-frame-margin-right">'+PhotoFrame.Lang.width+"</label>",'<input type="text" name="photo-frame-width" value="" id="photo-frame-width" class="photo-frame-small" />',"</div>",'<div class="photo-frame-inline">','<label for="photo-frame-height" class="photo-frame-small photo-frame-margin-right">'+PhotoFrame.Lang.height+"</label>",'<input type="text" name="photo-frame-height" value="" id="photo-frame-height" class="photo-frame-small" />',"</div>",'<div class="photo-frame-margin-top">','<label><input type="checkbox" name="photo-frame-maintain-ratio" id="photo-frame-maintain-ratio" /> '+PhotoFrame.Lang.maintain_ratio+"</label>","</div>"].join(""));this.window.ui.content.html(c),this.window.ui.width=this.window.ui.content.find("#photo-frame-width"),this.window.ui.height=this.window.ui.content.find("#photo-frame-height"),this.window.ui.aspect=this.window.ui.content.find("#photo-frame-maintain-ratio"),this.window.ui.content.find("input").keypress(function(a){13==a.keyCode&&(b.apply(),a.preventDefault())}),this.buttonBar.factory.bind("render",function(){b.getManipulation()&&b.initCrop(),b.reset()}),this.window.ui.content.find('input[type="text"]').keyup(function(c){if(b.getMaintainAspect()&&b.cropPhoto()){var d,e,f=a(this).val(),g=a(c.target).attr("id");"photo-frame-height"==g?(d=b.cropPhoto().width()/b.cropPhoto().height(),e="#photo-frame-width",f*=d):(d=b.cropPhoto().height()/b.cropPhoto().width(),e="#photo-frame-height",f*=d),b.window.ui.content.find(e).val(b.cropPhoto().round(f,1))}})}})}(jQuery),function(a){PhotoFrame.Buttons.Rotate=PhotoFrame.Button.extend({buttons:[],description:!1,name:!1,windowSettings:{title:!1},constructor:function(a){var b=this;this.name=PhotoFrame.Lang.rotate,this.description=PhotoFrame.Lang.rotate_desc,this.windowSettings.title=PhotoFrame.Lang.rotate,this.buttons=[{text:PhotoFrame.Lang.rotate,css:"photo-frame-tool-window-save",onclick:function(){b.apply()}}],this.base(a)},apply:function(){var a=this;this.addManipulation(!0,{degree:this.getDegree()}),this.buttonBar.factory.trigger("rotate",this,this.getDegree()),this.render(function(){a.buttonBar.factory.trigger("rotateReInitCrop",a,a.getDegree())})},startCrop:function(){var a=this.getManipulation();a.data&&a.data.degree&&(this.window.ui.input.val(a.data.degree),this.base())},getDegree:function(){return parseInt(""==this.window.ui.input.val()?0:this.window.ui.input.val())},reset:function(){this.window.ui.input.val("")},toggleLayer:function(a,b){this.base(a,b)},enable:function(){this.window.ui.input.attr("disabled",!1)},disable:function(){this.window.ui.input.attr("disabled",!0)},buildWindow:function(){this.base({buttons:this.buttons}),this.window.ui.input=a('<input type="text" name="photo-frame-rotate" value="" id="photo-frame-rotate" class="photo-frame-small" />');var b=this,c=a(['<div class="photo-frame-inline">','<label for="photo-frame-rotate photo-frame-margin-right">'+PhotoFrame.Lang.degrees+"</label>","</div>"].join(""));c.append(this.window.ui.input),this.window.ui.content.html(c),this.window.ui.content.find("input").keypress(function(a){13==a.keyCode&&(b.apply(),a.preventDefault())}),this.bind("stopRendering",function(){b.buttonBar.factory.trigger("rotateReInitCrop",b,b.getDegree())})}})}(jQuery),function(a){function b(b,c){var d=document.createElementNS("http://www.w3.org/2000/svg",b||"svg");return c&&a.each(c,function(a,b){d.setAttributeNS(null,a,b)}),a(d)}a.fn.activity=function(b){return this.each(function(){var e=a(this),f=e.data("activity");if(f&&(clearInterval(f.data("interval")),f.remove(),e.removeData("activity")),b!==!1){b=a.extend({color:e.css("color")},a.fn.activity.defaults,b),f=c(e,b).css("position","absolute").prependTo(b.outside?"body":e);var g=e.outerHeight()-f.height(),h=e.outerWidth()-f.width(),i={top:"top"==b.valign?b.padding:"bottom"==b.valign?g-b.padding:Math.floor(g/2),left:"left"==b.align?b.padding:"right"==b.align?h-b.padding:Math.floor(h/2)},j=e.offset();b.outside?f.css({top:j.top+"px",left:j.left+"px"}):(i.top-=f.offset().top-j.top,i.left-=f.offset().left-j.left),f.css({marginTop:i.top+"px",marginLeft:i.left+"px"}),d(f,b.segments,Math.round(10/b.speed)/10),e.data("activity",f)}}),this},a.fn.activity.defaults={segments:12,space:3,length:7,width:4,speed:1.2,align:"center",valign:"center",padding:4},a.fn.activity.getOpacity=function(a,b){var c=a.steps||a.segments-1,d=void 0!==a.opacity?a.opacity:1/c;return 1-Math.min(b,c)*(1-d)/c};var c=function(){return a("<div>").addClass("busy")},d=function(){};if(document.createElementNS&&document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect)if(c=function(c,d){for(var e=2*d.width+d.space,f=e+d.length+Math.ceil(d.width/2)+1,g=b().width(2*f).height(2*f),h=b("g",{"stroke-width":d.width,"stroke-linecap":"round",stroke:d.color}).appendTo(b("g",{transform:"translate("+f+","+f+")"}).appendTo(g)),i=0;i<d.segments;i++)h.append(b("line",{x1:0,y1:e,x2:0,y2:e+d.length,transform:"rotate("+360/d.segments*i+", 0, 0)",opacity:a.fn.activity.getOpacity(d,i)}));return a("<div>").append(g).width(2*f).height(2*f)},void 0!==document.createElement("div").style.WebkitAnimationName){var e={};d=function(a,b,c){if(!e[b]){for(var d="spin"+b,f="@-webkit-keyframes "+d+" {",g=0;b>g;g++){var h=Math.round(1e5/b*g)/1e3,i=Math.round(1e5/b*(g+1)-1)/1e3,j="% { -webkit-transform:rotate("+Math.round(360/b*g)+"deg); }\n";f+=h+j+i+j}f+="100% { -webkit-transform:rotate(100deg); }\n}",document.styleSheets[0].insertRule(f,0),e[b]=d}a.css("-webkit-animation",e[b]+" "+c+"s linear infinite")}}else d=function(a,b,c){var d=0,e=a.find("g g").get(0);a.data("interval",setInterval(function(){e.setAttributeNS(null,"transform","rotate("+ ++d%b*(360/b)+")")},1e3*c/b))};else{var f=a("div").appendTo("body").html('<v:shape id="vml_flag1" adj="1" />');if(f=f.find(":first").css("behavior","url(#default#VML)"),f[0]?"object"==typeof f[0].adj:!0){var g=document.createStyleSheet();a.each(["group","shape","stroke"],function(){g.addRule(this,"behavior:url(#default#VML);")}),c=function(b,c){for(var d=2*c.width+c.space,e=d+c.length+Math.ceil(c.width/2)+1,f=2*e,g=-Math.ceil(f/2),h=a("<group>",{coordsize:f+" "+f,coordorigin:g+" "+g}).css({top:g,left:g,width:f,height:f}),i=0;i<c.segments;i++)h.append(a("<shape>",{path:"m "+d+",0  l "+(d+c.length)+",0"}).css({width:f,height:f,rotation:360/c.segments*i+"deg"}).append(a("<stroke>",{color:c.color,weight:c.width+"px",endcap:"round",opacity:a.fn.activity.getOpacity(c,i)})));return a("<group>",{coordsize:f+" "+f}).css({width:f,height:f,overflow:"hidden"}).append(h)},d=function(a,b,c){var d=0,e=a.get(0);a.data("interval",setInterval(function(){e.style.rotation=++d%b*(360/b)},1e3*c/b))}}a(f).parent().remove()}}(jQuery),function(a){function b(b){var c;return b&&b.constructor==Array&&3==b.length?b:(c=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(b))?[parseInt(c[1]),parseInt(c[2]),parseInt(c[3])]:(c=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(b))?[2.55*parseFloat(c[1]),2.55*parseFloat(c[2]),2.55*parseFloat(c[3])]:(c=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(b))?[parseInt(c[1],16),parseInt(c[2],16),parseInt(c[3],16)]:(c=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(b))?[parseInt(c[1]+c[1],16),parseInt(c[2]+c[2],16),parseInt(c[3]+c[3],16)]:d[a.trim(b).toLowerCase()]}function c(c,d){var e;do{if(e=a.curCSS(c,d),""!=e&&"transparent"!=e||a.nodeName(c,"body"))break;d="backgroundColor"}while(c=c.parentNode);return b(e)}a.each(["backgroundColor","borderBottomColor","borderLeftColor","borderRightColor","borderTopColor","color","outlineColor"],function(d,e){a.fx.step[e]=function(a){0==a.state&&(a.start=c(a.elem,e),a.end=b(a.end)),a.elem.style[e]="rgb("+[Math.max(Math.min(parseInt(a.pos*(a.end[0]-a.start[0])+a.start[0]),255),0),Math.max(Math.min(parseInt(a.pos*(a.end[1]-a.start[1])+a.start[1]),255),0),Math.max(Math.min(parseInt(a.pos*(a.end[2]-a.start[2])+a.start[2]),255),0)].join(",")+")"}});var d={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0]}}(jQuery),function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery","load-image","canvas-to-blob","./jquery.fileupload"],a):a(window.jQuery,window.loadImage)}(function(a,b){"use strict";a.widget("blueimpFP.fileupload",a.blueimp.fileupload,{options:{process:[],add:function(b,c){a(this).fileupload("process",c).done(function(){c.submit()})}},processActions:{load:function(c,d){var e=this,f=c.files[c.index],g=a.Deferred();return window.HTMLCanvasElement&&window.HTMLCanvasElement.prototype.toBlob&&("number"!==a.type(d.maxFileSize)||f.size<d.maxFileSize)&&(!d.fileTypes||d.fileTypes.test(f.type))?b(f,function(a){c.canvas=a,g.resolveWith(e,[c])},{canvas:!0}):g.rejectWith(e,[c]),g.promise()},resize:function(a,c){if(a.canvas){var d=b.scale(a.canvas,c);(d.width!==a.canvas.width||d.height!==a.canvas.height)&&(a.canvas=d,a.processed=!0)
}return a},save:function(b){if(!b.canvas||!b.processed)return b;var c=this,d=b.files[b.index],e=d.name,f=a.Deferred(),g=function(a){a.name||(d.type===a.type?a.name=d.name:d.name&&(a.name=d.name.replace(/\..+$/,"."+a.type.substr(6)))),b.files[b.index]=a,f.resolveWith(c,[b])};return b.canvas.mozGetAsFile?g(b.canvas.mozGetAsFile(/^image\/(jpeg|png)$/.test(d.type)&&e||(e&&e.replace(/\..+$/,"")||"blob")+".png",d.type)):b.canvas.toBlob(g,d.type),f.promise()}},_processFile:function(b,c,d){var e=this,f=a.Deferred().resolveWith(e,[{files:b,index:c}]),g=f.promise();return e._processing+=1,a.each(d.process,function(a,b){g=g.pipe(function(a){return e.processActions[b.action].call(this,a,b)})}),g.always(function(){e._processing-=1,0===e._processing&&e.element.removeClass("fileupload-processing")}),1===e._processing&&e.element.addClass("fileupload-processing"),g},process:function(b){var c=this,d=a.extend({},this.options,b);return d.process&&d.process.length&&this._isXHRUpload(d)&&a.each(b.files,function(e){c._processingQueue=c._processingQueue.pipe(function(){var f=a.Deferred();return c._processFile(b.files,e,d).always(function(){f.resolveWith(c)}),f.promise()})}),this._processingQueue},_create:function(){a.blueimp.fileupload.prototype._create.call(this),this._processing=0,this._processingQueue=a.Deferred().resolveWith(this).promise()}})}),function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery","tmpl","load-image","./jquery.fileupload-fp"],a):a(window.jQuery,window.tmpl,window.loadImage)}(function(a,b,c){"use strict";var d=(a.blueimpFP||a.blueimp).fileupload;a.widget("blueimpUI.fileupload",d,{options:{autoUpload:!1,maxNumberOfFiles:void 0,maxFileSize:void 0,minFileSize:void 0,acceptFileTypes:/.+$/i,previewSourceFileTypes:/^image\/(gif|jpeg|png)$/,previewSourceMaxFileSize:5e6,previewMaxWidth:80,previewMaxHeight:80,previewAsCanvas:!0,uploadTemplateId:"template-upload",downloadTemplateId:"template-download",filesContainer:void 0,prependFiles:!1,dataType:"json",add:function(b,c){var d=a(this).data("fileupload"),e=d.options,f=c.files;a(this).fileupload("process",c).done(function(){d._adjustMaxNumberOfFiles(-f.length),c.maxNumberOfFilesAdjusted=!0,c.files.valid=c.isValidated=d._validate(f),c.context=d._renderUpload(f).data("data",c),e.filesContainer[e.prependFiles?"prepend":"append"](c.context),d._renderPreviews(f,c.context),d._forceReflow(c.context),d._transition(c.context).done(function(){d._trigger("added",b,c)!==!1&&(e.autoUpload||c.autoUpload)&&c.autoUpload!==!1&&c.isValidated&&c.submit()})})},send:function(b,c){var d=a(this).data("fileupload");return c.isValidated||(c.maxNumberOfFilesAdjusted||(d._adjustMaxNumberOfFiles(-c.files.length),c.maxNumberOfFilesAdjusted=!0),d._validate(c.files))?(c.context&&c.dataType&&"iframe"===c.dataType.substr(0,6)&&c.context.find(".progress").addClass(!a.support.transition&&"progress-animated").attr("aria-valuenow",100).find(".bar").css("width","100%"),d._trigger("sent",b,c)):!1},done:function(b,c){var d,e=a(this).data("fileupload");c.context?c.context.each(function(f){var g=a.isArray(c.result)&&c.result[f]||{error:"emptyResult"};g.error&&e._adjustMaxNumberOfFiles(1),e._transition(a(this)).done(function(){var f=a(this);d=e._renderDownload([g]).replaceAll(f),e._forceReflow(d),e._transition(d).done(function(){c.context=a(this),e._trigger("completed",b,c)})})}):(a.isArray(c.result)&&(a.each(c.result,function(a,b){c.maxNumberOfFilesAdjusted&&b.error?e._adjustMaxNumberOfFiles(1):c.maxNumberOfFilesAdjusted||b.error||e._adjustMaxNumberOfFiles(-1)}),c.maxNumberOfFilesAdjusted=!0),d=e._renderDownload(c.result).appendTo(e.options.filesContainer),e._forceReflow(d),e._transition(d).done(function(){c.context=a(this),e._trigger("completed",b,c)}))},fail:function(b,c){var d,e=a(this).data("fileupload");c.maxNumberOfFilesAdjusted&&e._adjustMaxNumberOfFiles(c.files.length),c.context?c.context.each(function(f){if("abort"!==c.errorThrown){var g=c.files[f];g.error=g.error||c.errorThrown||!0,e._transition(a(this)).done(function(){var f=a(this);d=e._renderDownload([g]).replaceAll(f),e._forceReflow(d),e._transition(d).done(function(){c.context=a(this),e._trigger("failed",b,c)})})}else e._transition(a(this)).done(function(){a(this).remove(),e._trigger("failed",b,c)})}):"abort"!==c.errorThrown?(c.context=e._renderUpload(c.files).appendTo(e.options.filesContainer).data("data",c),e._forceReflow(c.context),e._transition(c.context).done(function(){c.context=a(this),e._trigger("failed",b,c)})):e._trigger("failed",b,c)},progress:function(a,b){if(b.context){var c=parseInt(b.loaded/b.total*100,10);b.context.find(".progress").attr("aria-valuenow",c).find(".bar").css("width",c+"%")}},progressall:function(b,c){var d=a(this),e=parseInt(c.loaded/c.total*100,10),f=d.find(".fileupload-progress"),g=f.find(".progress-extended");g.length&&g.html(d.data("fileupload")._renderExtendedProgress(c)),f.find(".progress").attr("aria-valuenow",e).find(".bar").css("width",e+"%")},start:function(b){var c=a(this).data("fileupload");c._transition(a(this).find(".fileupload-progress")).done(function(){c._trigger("started",b)})},stop:function(b){var c=a(this).data("fileupload");c._transition(a(this).find(".fileupload-progress")).done(function(){a(this).find(".progress").attr("aria-valuenow","0").find(".bar").css("width","0%"),a(this).find(".progress-extended").html("&nbsp;"),c._trigger("stopped",b)})},destroy:function(b,c){var d=a(this).data("fileupload");c.url&&(a.ajax(c),d._adjustMaxNumberOfFiles(1)),d._transition(c.context).done(function(){a(this).remove(),d._trigger("destroyed",b,c)})}},_enableDragToDesktop:function(){var b=a(this),c=b.prop("href"),d=b.prop("download"),e="application/octet-stream";b.bind("dragstart",function(a){try{a.originalEvent.dataTransfer.setData("DownloadURL",[e,d,c].join(":"))}catch(b){}})},_adjustMaxNumberOfFiles:function(a){"number"==typeof this.options.maxNumberOfFiles&&(this.options.maxNumberOfFiles+=a,this.options.maxNumberOfFiles<1?this._disableFileInputButton():this._enableFileInputButton())},_formatFileSize:function(a){return"number"!=typeof a?"":a>=1e9?(a/1e9).toFixed(2)+" GB":a>=1e6?(a/1e6).toFixed(2)+" MB":(a/1e3).toFixed(2)+" KB"},_formatBitrate:function(a){return"number"!=typeof a?"":a>=1e9?(a/1e9).toFixed(2)+" Gbit/s":a>=1e6?(a/1e6).toFixed(2)+" Mbit/s":a>=1e3?(a/1e3).toFixed(2)+" kbit/s":a+" bit/s"},_formatTime:function(a){var b=new Date(1e3*a),c=parseInt(a/86400,10);return c=c?c+"d ":"",c+("0"+b.getUTCHours()).slice(-2)+":"+("0"+b.getUTCMinutes()).slice(-2)+":"+("0"+b.getUTCSeconds()).slice(-2)},_formatPercentage:function(a){return(100*a).toFixed(2)+" %"},_renderExtendedProgress:function(a){return this._formatBitrate(a.bitrate)+" | "+this._formatTime(8*(a.total-a.loaded)/a.bitrate)+" | "+this._formatPercentage(a.loaded/a.total)+" | "+this._formatFileSize(a.loaded)+" / "+this._formatFileSize(a.total)},_hasError:function(a){return a.error?a.error:this.options.maxNumberOfFiles<0?"maxNumberOfFiles":this.options.acceptFileTypes.test(a.type)||this.options.acceptFileTypes.test(a.name)?this.options.maxFileSize&&a.size>this.options.maxFileSize?"maxFileSize":"number"==typeof a.size&&a.size<this.options.minFileSize?"minFileSize":null:"acceptFileTypes"},_validate:function(b){var c=this,d=!!b.length;return a.each(b,function(a,b){b.error=c._hasError(b),b.error&&(d=!1)}),d},_renderTemplate:function(b,c){if(!b)return a();var d=b({files:c,formatFileSize:this._formatFileSize,options:this.options});return d instanceof a?d:a(this.options.templatesContainer).html(d).children()},_renderPreview:function(b,d){var e=this,f=this.options,g=a.Deferred();return(c&&c(b,function(b){d.append(b),e._forceReflow(d),e._transition(d).done(function(){g.resolveWith(d)}),a.contains(document.body,d[0])||g.resolveWith(d)},{maxWidth:f.previewMaxWidth,maxHeight:f.previewMaxHeight,canvas:f.previewAsCanvas})||g.resolveWith(d))&&g},_renderPreviews:function(b,c){var d=this,e=this.options;return c.find(".preview span").each(function(c,f){var g=b[c];e.previewSourceFileTypes.test(g.type)&&("number"!==a.type(e.previewSourceMaxFileSize)||g.size<e.previewSourceMaxFileSize)&&(d._processingQueue=d._processingQueue.pipe(function(){var b=a.Deferred();return d._renderPreview(g,a(f)).done(function(){b.resolveWith(d)}),b.promise()}))}),this._processingQueue},_renderUpload:function(a){return this._renderTemplate(this.options.uploadTemplate,a)},_renderDownload:function(a){return this._renderTemplate(this.options.downloadTemplate,a).find("a[download]").each(this._enableDragToDesktop).end()},_startHandler:function(b){b.preventDefault();var c=a(this),d=c.closest(".template-upload"),e=d.data("data");e&&e.submit&&!e.jqXHR&&e.submit()&&c.prop("disabled",!0)},_cancelHandler:function(b){b.preventDefault();var c=a(this).closest(".template-upload"),d=c.data("data")||{};d.jqXHR?d.jqXHR.abort():(d.errorThrown="abort",b.data.fileupload._trigger("fail",b,d))},_deleteHandler:function(b){b.preventDefault();var c=a(this);b.data.fileupload._trigger("destroy",b,{context:c.closest(".template-download"),url:c.attr("data-url"),type:c.attr("data-type")||"DELETE",dataType:b.data.fileupload.options.dataType})},_forceReflow:function(b){return a.support.transition&&b.length&&b[0].offsetWidth},_transition:function(b){var c=a.Deferred();return a.support.transition&&b.hasClass("fade")?b.bind(a.support.transition.end,function(d){d.target===b[0]&&(b.unbind(a.support.transition.end),c.resolveWith(b))}).toggleClass("in"):(b.toggleClass("in"),c.resolveWith(b)),c},_initButtonBarEventHandlers:function(){var b=this.element.find(".fileupload-buttonbar"),c=this.options.filesContainer,d=this.options.namespace;b.find(".start").bind("click."+d,function(a){a.preventDefault(),c.find(".start button").click()}),b.find(".cancel").bind("click."+d,function(a){a.preventDefault(),c.find(".cancel button").click()}),b.find(".delete").bind("click."+d,function(a){a.preventDefault(),c.find(".delete input:checked").siblings("button").click(),b.find(".toggle").prop("checked",!1)}),b.find(".toggle").bind("change."+d,function(){c.find(".delete input").prop("checked",a(this).is(":checked"))})},_destroyButtonBarEventHandlers:function(){this.element.find(".fileupload-buttonbar button").unbind("click."+this.options.namespace),this.element.find(".fileupload-buttonbar .toggle").unbind("change."+this.options.namespace)},_initEventHandlers:function(){d.prototype._initEventHandlers.call(this);var a={fileupload:this};this.options.filesContainer.delegate(".start button","click."+this.options.namespace,a,this._startHandler).delegate(".cancel button","click."+this.options.namespace,a,this._cancelHandler).delegate(".delete button","click."+this.options.namespace,a,this._deleteHandler),this._initButtonBarEventHandlers()},_destroyEventHandlers:function(){var a=this.options;this._destroyButtonBarEventHandlers(),a.filesContainer.undelegate(".start button","click."+a.namespace).undelegate(".cancel button","click."+a.namespace).undelegate(".delete button","click."+a.namespace),d.prototype._destroyEventHandlers.call(this)},_enableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",!1).parent().removeClass("disabled")},_disableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",!0).parent().addClass("disabled")},_initTemplates:function(){var a=this.options;a.templatesContainer=document.createElement(a.filesContainer.prop("nodeName")),b&&(a.uploadTemplateId&&(a.uploadTemplate=b(a.uploadTemplateId)),a.downloadTemplateId&&(a.downloadTemplate=b(a.downloadTemplateId)))},_initFilesContainer:function(){var b=this.options;void 0===b.filesContainer?b.filesContainer=this.element.find(".files"):b.filesContainer instanceof a||(b.filesContainer=a(b.filesContainer))},_stringToRegExp:function(a){var b=a.split("/"),c=b.pop();return b.shift(),new RegExp(b.join("/"),c)},_initRegExpOptions:function(){var b=this.options;"string"===a.type(b.acceptFileTypes)&&(b.acceptFileTypes=this._stringToRegExp(b.acceptFileTypes)),"string"===a.type(b.previewSourceFileTypes)&&(b.previewSourceFileTypes=this._stringToRegExp(b.previewSourceFileTypes))},_initSpecialOptions:function(){d.prototype._initSpecialOptions.call(this),this._initFilesContainer(),this._initTemplates(),this._initRegExpOptions()},_create:function(){d.prototype._create.call(this),this._refreshOptionsList.push("filesContainer","uploadTemplateId","downloadTemplateId"),a.blueimpFP||(this._processingQueue=a.Deferred().resolveWith(this).promise(),this.process=function(){return this._processingQueue})},enable:function(){var a=!1;this.options.disabled&&(a=!0),d.prototype.enable.call(this),a&&(this.element.find("input, button").prop("disabled",!1),this._enableFileInputButton())},disable:function(){this.options.disabled||(this.element.find("input, button").prop("disabled",!0),this._disableFileInputButton()),d.prototype.disable.call(this)}})}),function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):a(window.jQuery)}(function(a){"use strict";a.support.xhrFileUpload=!(!window.XMLHttpRequestUpload||!window.FileReader),a.support.xhrFormDataFileUpload=!!window.FormData,a.widget("blueimp.fileupload",{options:{namespace:void 0,dropZone:a(document),pasteZone:a(document),fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,formData:function(a){return a.serializeArray()},add:function(a,b){b.submit()},processData:!1,contentType:!1,cache:!1},_refreshOptionsList:["namespace","fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_BitrateTimer:function(){this.timestamp=+new Date,this.loaded=0,this.bitrate=0,this.getBitrate=function(a,b,c){var d=a-this.timestamp;return(!this.bitrate||!c||d>c)&&(this.bitrate=(b-this.loaded)*(1e3/d)*8,this.loaded=b,this.timestamp=a),this.bitrate}},_isXHRUpload:function(b){return!b.forceIframeTransport&&(!b.multipart&&a.support.xhrFileUpload||a.support.xhrFormDataFileUpload)},_getFormData:function(b){var c;return"function"==typeof b.formData?b.formData(b.form):a.isArray(b.formData)?b.formData:b.formData?(c=[],a.each(b.formData,function(a,b){c.push({name:a,value:b})}),c):[]},_getTotal:function(b){var c=0;return a.each(b,function(a,b){c+=b.size||1}),c},_onProgress:function(a,b){if(a.lengthComputable){var c,d,e=+new Date;if(b._time&&b.progressInterval&&e-b._time<b.progressInterval&&a.loaded!==a.total)return;b._time=e,c=b.total||this._getTotal(b.files),d=parseInt(a.loaded/a.total*(b.chunkSize||c),10)+(b.uploadedBytes||0),this._loaded+=d-(b.loaded||b.uploadedBytes||0),b.lengthComputable=!0,b.loaded=d,b.total=c,b.bitrate=b._bitrateTimer.getBitrate(e,d,b.bitrateInterval),this._trigger("progress",a,b),this._trigger("progressall",a,{lengthComputable:!0,loaded:this._loaded,total:this._total,bitrate:this._bitrateTimer.getBitrate(e,this._loaded,b.bitrateInterval)})}},_initProgressListener:function(b){var c=this,d=b.xhr?b.xhr():a.ajaxSettings.xhr();d.upload&&(a(d.upload).bind("progress",function(a){var d=a.originalEvent;a.lengthComputable=d.lengthComputable,a.loaded=d.loaded,a.total=d.total,c._onProgress(a,b)}),b.xhr=function(){return d})},_initXHRData:function(b){var c,d=b.files[0],e=b.multipart||!a.support.xhrFileUpload,f=b.paramName[0];(!e||b.blob)&&(b.headers=a.extend(b.headers,{"X-File-Name":d.name,"X-File-Type":d.type,"X-File-Size":d.size}),b.blob?e||(b.contentType="application/octet-stream",b.data=b.blob):(b.contentType=d.type,b.data=d)),e&&a.support.xhrFormDataFileUpload&&(b.postMessage?(c=this._getFormData(b),b.blob?c.push({name:f,value:b.blob}):a.each(b.files,function(a,d){c.push({name:b.paramName[a]||f,value:d})})):(b.formData instanceof FormData?c=b.formData:(c=new FormData,a.each(this._getFormData(b),function(a,b){c.append(b.name,b.value)})),b.blob?c.append(f,b.blob,d.name):a.each(b.files,function(a,d){d instanceof Blob&&c.append(b.paramName[a]||f,d,d.name)})),b.data=c),b.blob=null},_initIframeSettings:function(b){b.dataType="iframe "+(b.dataType||""),b.formData=this._getFormData(b),b.redirect&&a("<a></a>").prop("href",b.url).prop("host")!==location.host&&b.formData.push({name:b.redirectParamName||"redirect",value:b.redirect})},_initDataSettings:function(a){this._isXHRUpload(a)?(this._chunkedUpload(a,!0)||(a.data||this._initXHRData(a),this._initProgressListener(a)),a.postMessage&&(a.dataType="postmessage "+(a.dataType||""))):this._initIframeSettings(a,"iframe")},_getParamName:function(b){var c=a(b.fileInput),d=b.paramName;return d?a.isArray(d)||(d=[d]):(d=[],c.each(function(){for(var b=a(this),c=b.prop("name")||"files[]",e=(b.prop("files")||[1]).length;e;)d.push(c),e-=1}),d.length||(d=[c.prop("name")||"files[]"])),d},_initFormSettings:function(b){b.form&&b.form.length||(b.form=a(b.fileInput.prop("form")),b.form.length||(b.form=a(this.options.fileInput.prop("form")))),b.paramName=this._getParamName(b),b.url||(b.url=b.form.prop("action")||location.href),b.type=(b.type||b.form.prop("method")||"").toUpperCase(),"POST"!==b.type&&"PUT"!==b.type&&(b.type="POST"),b.formAcceptCharset||(b.formAcceptCharset=b.form.attr("accept-charset"))},_getAJAXSettings:function(b){var c=a.extend({},this.options,b);return this._initFormSettings(c),this._initDataSettings(c),c},_enhancePromise:function(a){return a.success=a.done,a.error=a.fail,a.complete=a.always,a},_getXHRPromise:function(b,c,d){var e=a.Deferred(),f=e.promise();return c=c||this.options.context||f,b===!0?e.resolveWith(c,d):b===!1&&e.rejectWith(c,d),f.abort=e.promise,this._enhancePromise(f)},_chunkedUpload:function(b,c){var d,e,f,g,h=this,i=b.files[0],j=i.size,k=b.uploadedBytes=b.uploadedBytes||0,l=b.maxChunkSize||j,m=i.webkitSlice||i.mozSlice||i.slice;return this._isXHRUpload(b)&&m&&(k||j>l)&&!b.data?c?!0:k>=j?(i.error="uploadedBytes",this._getXHRPromise(!1,b.context,[null,"error",i.error])):(e=Math.ceil((j-k)/l),d=function(c){return c?d(c-=1).pipe(function(){var d=a.extend({},b);return d.blob=m.call(i,k+c*l,k+(c+1)*l),d.chunkIndex=c,d.chunksNumber=e,d.chunkSize=d.blob.size,h._initXHRData(d),h._initProgressListener(d),f=(a.ajax(d)||h._getXHRPromise(!1,d.context)).done(function(){d.loaded||h._onProgress(a.Event("progress",{lengthComputable:!0,loaded:d.chunkSize,total:d.chunkSize}),d),b.uploadedBytes=d.uploadedBytes+=d.chunkSize})}):h._getXHRPromise(!0,b.context)},g=d(e),g.abort=function(){return f.abort()},this._enhancePromise(g)):!1},_beforeSend:function(a,b){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer),this._active+=1,this._loaded+=b.uploadedBytes||0,this._total+=this._getTotal(b.files)},_onDone:function(b,c,d,e){this._isXHRUpload(e)||this._onProgress(a.Event("progress",{lengthComputable:!0,loaded:1,total:1}),e),e.result=b,e.textStatus=c,e.jqXHR=d,this._trigger("done",null,e)},_onFail:function(a,b,c,d){d.jqXHR=a,d.textStatus=b,d.errorThrown=c,this._trigger("fail",null,d),d.recalculateProgress&&(this._loaded-=d.loaded||d.uploadedBytes||0,this._total-=d.total||this._getTotal(d.files))},_onAlways:function(a,b,c,d){this._active-=1,d.textStatus=b,c&&c.always?(d.jqXHR=c,d.result=a):(d.jqXHR=a,d.errorThrown=c),this._trigger("always",null,d),0===this._active&&(this._trigger("stop"),this._loaded=this._total=0,this._bitrateTimer=null)},_onSend:function(b,c){var d,e,f,g=this,h=g._getAJAXSettings(c),i=function(c,e){return g._sending+=1,h._bitrateTimer=new g._BitrateTimer,d=d||(c!==!1&&g._trigger("send",b,h)!==!1&&(g._chunkedUpload(h)||a.ajax(h))||g._getXHRPromise(!1,h.context,e)).done(function(a,b,c){g._onDone(a,b,c,h)}).fail(function(a,b,c){g._onFail(a,b,c,h)}).always(function(a,b,c){if(g._sending-=1,g._onAlways(a,b,c,h),h.limitConcurrentUploads&&h.limitConcurrentUploads>g._sending)for(var d,e=g._slots.shift();e;){if(d=e.state?"pending"===e.state():!e.isRejected()){e.resolve();break}e=g._slots.shift()}})};return this._beforeSend(b,h),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(e=a.Deferred(),this._slots.push(e),f=e.pipe(i)):f=this._sequence=this._sequence.pipe(i,i),f.abort=function(){var a=[void 0,"abort","abort"];return d?d.abort():(e&&e.rejectWith(f,a),i(!1,a))},this._enhancePromise(f)):i()},_onAdd:function(b,c){var d,e,f,g,h=this,i=!0,j=a.extend({},this.options,c),k=j.limitMultiFileUploads,l=this._getParamName(j);if((j.singleFileUploads||k)&&this._isXHRUpload(j))if(!j.singleFileUploads&&k)for(f=[],d=[],g=0;g<c.files.length;g+=k)f.push(c.files.slice(g,g+k)),e=l.slice(g,g+k),e.length||(e=l),d.push(e);else d=l;else f=[c.files],d=[l];return c.originalFiles=c.files,a.each(f||c.files,function(e,g){var j=a.extend({},c);return j.files=f?g:[g],j.paramName=d[e],j.submit=function(){return j.jqXHR=this.jqXHR=h._trigger("submit",b,this)!==!1&&h._onSend(b,this),this.jqXHR},i=h._trigger("add",b,j)}),i},_replaceFileInput:function(b){var c=b.clone(!0);a("<form></form>").append(c)[0].reset(),b.after(c).detach(),a.cleanData(b.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(a,d){return d===b[0]?c[0]:d}),b[0]===this.element[0]&&(this.element=c)},_handleFileTreeEntry:function(b,c){var d,e=this,f=a.Deferred(),g=function(){f.reject()};return c=c||"",b.isFile?b.file(function(a){a.relativePath=c,f.resolve(a)},g):b.isDirectory?(d=b.createReader(),d.readEntries(function(a){e._handleFileTreeEntries(a,c+b.name+"/").done(function(a){f.resolve(a)}).fail(g)},g)):g(),f.promise()},_handleFileTreeEntries:function(b,c){var d=this;return a.when.apply(a,a.map(b,function(a){return d._handleFileTreeEntry(a,c)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(b){b=b||{};var c=b.items;return c&&c.length&&(c[0].webkitGetAsEntry||c[0].getAsEntry)?this._handleFileTreeEntries(a.map(c,function(a){return a.webkitGetAsEntry?a.webkitGetAsEntry():a.getAsEntry()})):a.Deferred().resolve(a.makeArray(b.files)).promise()},_getSingleFileInputFiles:function(b){b=a(b);var c,d,e=b.prop("webkitEntries")||b.prop("entries");if(e&&e.length)return this._handleFileTreeEntries(e);if(c=a.makeArray(b.prop("files")),!c.length){if(d=b.prop("value"),!d)return a.Deferred().resolve([]).promise();c=[{name:d.replace(/^.*\\/,"")}]}return a.Deferred().resolve(c).promise()},_getFileInputFiles:function(b){return b instanceof a&&1!==b.length?a.when.apply(a,a.map(b,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(b)},_onChange:function(b){var c=b.data.fileupload,d={fileInput:a(b.target),form:a(b.target.form)};c._getFileInputFiles(d.fileInput).always(function(a){d.files=a,c.options.replaceFileInput&&c._replaceFileInput(d.fileInput),c._trigger("change",b,d)!==!1&&c._onAdd(b,d)})},_onPaste:function(b){var c=b.data.fileupload,d=b.originalEvent.clipboardData,e=d&&d.items||[],f={files:[]};return a.each(e,function(a,b){var c=b.getAsFile&&b.getAsFile();c&&f.files.push(c)}),c._trigger("paste",b,f)===!1||c._onAdd(b,f)===!1?!1:void 0},_onDrop:function(a){a.preventDefault();var b=a.data.fileupload,c=a.dataTransfer=a.originalEvent.dataTransfer,d={};b._getDroppedFiles(c).always(function(c){d.files=c,b._trigger("drop",a,d)!==!1&&b._onAdd(a,d)})},_onDragOver:function(a){var b=a.data.fileupload,c=a.dataTransfer=a.originalEvent.dataTransfer;return b._trigger("dragover",a)===!1?!1:(c&&(c.dropEffect="copy"),a.preventDefault(),void 0)},_initEventHandlers:function(){var a=this.options.namespace;this._isXHRUpload(this.options)&&(this.options.dropZone.bind("dragover."+a,{fileupload:this},this._onDragOver).bind("drop."+a,{fileupload:this},this._onDrop),this.options.pasteZone.bind("paste."+a,{fileupload:this},this._onPaste)),this.options.fileInput.bind("change."+a,{fileupload:this},this._onChange)},_destroyEventHandlers:function(){var a=this.options.namespace;this.options.dropZone.unbind("dragover."+a,this._onDragOver).unbind("drop."+a,this._onDrop),this.options.pasteZone.unbind("paste."+a,this._onPaste),this.options.fileInput.unbind("change."+a,this._onChange)},_setOption:function(b,c){var d=-1!==a.inArray(b,this._refreshOptionsList);d&&this._destroyEventHandlers(),a.Widget.prototype._setOption.call(this,b,c),d&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var b=this.options;void 0===b.fileInput?b.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):b.fileInput instanceof a||(b.fileInput=a(b.fileInput)),b.dropZone instanceof a||(b.dropZone=a(b.dropZone)),b.pasteZone instanceof a||(b.pasteZone=a(b.pasteZone))},_create:function(){var b=this.options;a.extend(b,a(this.element[0].cloneNode(!1)).data()),b.namespace=b.namespace||this.widgetName,this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=this._loaded=this._total=0,this._initEventHandlers()},destroy:function(){this._destroyEventHandlers(),a.Widget.prototype.destroy.call(this)},enable:function(){var b=!1;this.options.disabled&&(b=!0),a.Widget.prototype.enable.call(this),b&&this._initEventHandlers()},disable:function(){this.options.disabled||this._destroyEventHandlers(),a.Widget.prototype.disable.call(this)},add:function(b){var c=this;b&&!this.options.disabled&&(b.fileInput&&!b.files?this._getFileInputFiles(b.fileInput).always(function(a){b.files=a,c._onAdd(null,b)}):(b.files=a.makeArray(b.files),this._onAdd(null,b)))},send:function(b){if(b&&!this.options.disabled){if(b.fileInput&&!b.files){var c,d,e=this,f=a.Deferred(),g=f.promise();return g.abort=function(){return d=!0,c?c.abort():(f.reject(null,"abort","abort"),g)},this._getFileInputFiles(b.fileInput).always(function(a){d||(b.files=a,c=e._onSend(null,b).then(function(a,b,c){f.resolve(a,b,c)},function(a,b,c){f.reject(a,b,c)}))}),this._enhancePromise(g)}if(b.files=a.makeArray(b.files),b.files.length)return this._onSend(null,b)}return this._getXHRPromise(!1,b&&b.context)}})}),function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):a(window.jQuery)}(function(a){"use strict";var b=0;a.ajaxTransport("iframe",function(c){if(c.async&&("POST"===c.type||"GET"===c.type)){var d,e;return{send:function(f,g){d=a('<form style="display:none;"></form>'),d.attr("accept-charset",c.formAcceptCharset),e=a('<iframe src="javascript:false;" name="iframe-transport-'+(b+=1)+'"></iframe>').bind("load",function(){var b,f=a.isArray(c.paramName)?c.paramName:[c.paramName];e.unbind("load").bind("load",function(){var b;try{if(b=e.contents(),!b.length||!b[0].firstChild)throw new Error}catch(c){b=void 0}g(200,"success",{iframe:b}),a('<iframe src="javascript:false;"></iframe>').appendTo(d),d.remove()}),d.prop("target",e.prop("name")).prop("action",c.url).prop("method",c.type),c.formData&&a.each(c.formData,function(b,c){a('<input type="hidden"/>').prop("name",c.name).val(c.value).appendTo(d)}),c.fileInput&&c.fileInput.length&&"POST"===c.type&&(b=c.fileInput.clone(),c.fileInput.after(function(a){return b[a]}),c.paramName&&c.fileInput.each(function(b){a(this).prop("name",f[b]||c.paramName)}),d.append(c.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data")),d.submit(),b&&b.length&&c.fileInput.each(function(c,d){var e=a(b[c]);a(d).prop("name",e.prop("name")),e.replaceWith(d)})}),d.append(e).appendTo(document.body)},abort:function(){e&&e.unbind("load").prop("src","javascript".concat(":false;")),d&&d.remove()}}}}),a.ajaxSetup({converters:{"iframe text":function(b){return a(b[0].body).text()},"iframe json":function(b){return a.parseJSON(a(b[0].body).text())},"iframe html":function(b){return a(b[0].body).html()},"iframe script":function(b){return a.globalEval(a(b[0].body).text())}}})}),function(a){a.Jcrop=function(b,c){function d(a){return Math.round(a)+"px"}function e(a){return J.baseClass+"-"+a}function f(){return a.fx.step.hasOwnProperty("backgroundColor")}function g(b){var c=a(b).offset();return[c.left,c.top]}function h(a){return[a.pageX-I[0],a.pageY-I[1]]}function i(b){"object"!=typeof b&&(b={}),J=a.extend(J,b),a.each(["onChange","onSelect","onRelease","onDblClick"],function(a,b){"function"!=typeof J[b]&&(J[b]=function(){})})}function j(a,b,c){if(I=g(R),ob.setCursor("move"===a?a:a+"-resize"),"move"===a)return ob.activateHandlers(l(b),q,c);var d=lb.getFixed(),e=m(a),f=lb.getCorner(m(e));lb.setPressed(lb.getCorner(e)),lb.setCurrent(f),ob.activateHandlers(k(a,d),q,c)}function k(a,b){return function(c){if(J.aspectRatio)switch(a){case"e":c[1]=b.y+1;break;case"w":c[1]=b.y+1;break;case"n":c[0]=b.x+1;break;case"s":c[0]=b.x+1}else switch(a){case"e":c[1]=b.y2;break;case"w":c[1]=b.y2;break;case"n":c[0]=b.x2;break;case"s":c[0]=b.x2}lb.setCurrent(c),nb.update()}}function l(a){var b=a;return pb.watchKeys(),function(a){lb.moveOffset([a[0]-b[0],a[1]-b[1]]),b=a,nb.update()}}function m(a){switch(a){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function n(a){return function(b){return J.disabled?!1:"move"!==a||J.allowMove?(I=g(R),db=!0,j(a,h(b)),b.stopPropagation(),b.preventDefault(),!1):!1}}function o(a,b,c){var d=a.width(),e=a.height();d>b&&b>0&&(d=b,e=b/a.width()*a.height()),e>c&&c>0&&(e=c,d=c/a.height()*a.width()),bb=a.width()/d,cb=a.height()/e,a.width(d).height(e)}function p(a){return{x:a.x*bb,y:a.y*cb,x2:a.x2*bb,y2:a.y2*cb,w:a.w*bb,h:a.h*cb}}function q(){var a=lb.getFixed();a.w>J.minSelect[0]&&a.h>J.minSelect[1]?(nb.enableHandles(),nb.done()):nb.release(),ob.setCursor(J.allowSelect?"crosshair":"default")}function r(a){if(J.disabled)return!1;if(!J.allowSelect)return!1;db=!0,I=g(R),nb.disableHandles(),ob.setCursor("crosshair");var b=h(a);return lb.setPressed(b),nb.update(),ob.activateHandlers(s,q,"touch"===a.type.substring(0,5)),pb.watchKeys(),a.stopPropagation(),a.preventDefault(),!1}function s(a){lb.setCurrent(a),nb.update()}function t(){var b=a("<div></div>").addClass(e("tracker"));return L&&b.css({opacity:0,backgroundColor:"white"}),b}function u(a){U.removeClass().addClass(e("holder")).addClass(a)}function v(a,b){function c(){window.setTimeout(s,l)}var d=a[0]/bb,e=a[1]/cb,f=a[2]/bb,g=a[3]/cb;if(!eb){var h=lb.flipCoords(d,e,f,g),i=lb.getFixed(),j=[i.x,i.y,i.x2,i.y2],k=j,l=J.animationDelay,m=h[0]-j[0],n=h[1]-j[1],o=h[2]-j[2],p=h[3]-j[3],q=0,r=J.swingSpeed;d=k[0],e=k[1],f=k[2],g=k[3],nb.animMode(!0);var s=function(){return function(){q+=(100-q)/r,k[0]=Math.round(d+q/100*m),k[1]=Math.round(e+q/100*n),k[2]=Math.round(f+q/100*o),k[3]=Math.round(g+q/100*p),q>=99.8&&(q=100),100>q?(x(k),c()):(nb.done(),nb.animMode(!1),"function"==typeof b&&b.call(qb))}}();c()}}function w(a){x([a[0]/bb,a[1]/cb,a[2]/bb,a[3]/cb]),J.onSelect.call(qb,p(lb.getFixed())),nb.enableHandles()}function x(a){lb.setPressed([a[0],a[1]]),lb.setCurrent([a[2],a[3]]),nb.update()}function y(){return p(lb.getFixed())}function z(){return lb.getFixed()}function A(a){i(a),H()}function B(){J.disabled=!0,nb.disableHandles(),nb.setCursor("default"),ob.setCursor("default")}function C(){J.disabled=!1,H()}function D(){nb.done(),ob.activateHandlers(null,null)}function E(){U.remove(),O.show(),O.css("visibility","visible"),a(b).removeData("Jcrop")}function F(a,b){nb.release(),B();var c=new Image;c.onload=function(){var d=c.width,e=c.height,f=J.boxWidth,g=J.boxHeight;R.width(d).height(e),R.attr("src",a),V.attr("src",a),o(R,f,g),S=R.width(),T=R.height(),V.width(S).height(T),hb.width(S+2*gb).height(T+2*gb),U.width(S).height(T),mb.resize(S,T),C(),"function"==typeof b&&b.call(qb)},c.src=a}function G(a,b,c){var d=b||J.bgColor;J.bgFade&&f()&&J.fadeTime&&!c?a.animate({backgroundColor:d},{queue:!1,duration:J.fadeTime}):a.css("backgroundColor",d)}function H(a){J.allowResize?a?nb.enableOnly():nb.enableHandles():nb.disableHandles(),ob.setCursor(J.allowSelect?"crosshair":"default"),nb.setCursor(J.allowMove?"move":"default"),J.hasOwnProperty("trueSize")&&(bb=J.trueSize[0]/S,cb=J.trueSize[1]/T),J.hasOwnProperty("setSelect")&&(w(J.setSelect),nb.done(),delete J.setSelect),mb.refresh(),J.bgColor!=ib&&(G(J.shade?mb.getShades():U,J.shade?J.shadeColor||J.bgColor:J.bgColor),ib=J.bgColor),jb!=J.bgOpacity&&(jb=J.bgOpacity,J.shade?mb.refresh():nb.setBgOpacity(jb)),Z=J.maxSize[0]||0,$=J.maxSize[1]||0,_=J.minSize[0]||0,ab=J.minSize[1]||0,J.hasOwnProperty("outerImage")&&(R.attr("src",J.outerImage),delete J.outerImage),nb.refresh()
}var I,J=a.extend({},a.Jcrop.defaults),K=navigator.userAgent.toLowerCase(),L=/msie/.test(K),M=/msie [1-6]\./.test(K);"object"!=typeof b&&(b=a(b)[0]),"object"!=typeof c&&(c={}),i(c);var N={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},O=a(b),P=!0;if("IMG"==b.tagName){if(0!=O[0].width&&0!=O[0].height)O.width(O[0].width),O.height(O[0].height);else{var Q=new Image;Q.src=O[0].src,O.width(Q.width),O.height(Q.height)}var R=O.clone().removeAttr("id").css(N).show();R.width(O.width()),R.height(O.height()),O.after(R).hide()}else R=O.css(N).show(),P=!1,null===J.shade&&(J.shade=!0);o(R,J.boxWidth,J.boxHeight);var S=R.width(),T=R.height(),U=a("<div />").width(S).height(T).addClass(e("holder")).css({position:"relative",backgroundColor:J.bgColor}).insertAfter(O).append(R);J.addClass&&U.addClass(J.addClass);var V=a("<div />"),W=a("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),X=a("<div />").width("100%").height("100%").css("zIndex",320),Y=a("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var a=lb.getFixed();J.onDblClick.call(qb,a)}).insertBefore(R).append(W,X);P&&(V=a("<img />").attr("src",R.attr("src")).css(N).width(S).height(T),W.append(V)),M&&Y.css({overflowY:"hidden"});var Z,$,_,ab,bb,cb,db,eb,fb,gb=J.boundary,hb=t().width(S+2*gb).height(T+2*gb).css({position:"absolute",top:d(-gb),left:d(-gb),zIndex:290}).mousedown(r),ib=J.bgColor,jb=J.bgOpacity;I=g(R);var kb=function(){function a(){var a,b={},c=["touchstart","touchmove","touchend"],d=document.createElement("div");try{for(a=0;a<c.length;a++){var e=c[a];e="on"+e;var f=e in d;f||(d.setAttribute(e,"return;"),f="function"==typeof d[e]),b[c[a]]=f}return b.touchstart&&b.touchend&&b.touchmove}catch(g){return!1}}function b(){return J.touchSupport===!0||J.touchSupport===!1?J.touchSupport:a()}return{createDragger:function(a){return function(b){return J.disabled?!1:"move"!==a||J.allowMove?(I=g(R),db=!0,j(a,h(kb.cfilter(b)),!0),b.stopPropagation(),b.preventDefault(),!1):!1}},newSelection:function(a){return r(kb.cfilter(a))},cfilter:function(a){return a.pageX=a.originalEvent.changedTouches[0].pageX,a.pageY=a.originalEvent.changedTouches[0].pageY,a},isSupported:a,support:b()}}(),lb=function(){function a(a){a=g(a),o=m=a[0],p=n=a[1]}function b(a){a=g(a),k=a[0]-o,l=a[1]-p,o=a[0],p=a[1]}function c(){return[k,l]}function d(a){var b=a[0],c=a[1];0>m+b&&(b-=b+m),0>n+c&&(c-=c+n),p+c>T&&(c+=T-(p+c)),o+b>S&&(b+=S-(o+b)),m+=b,o+=b,n+=c,p+=c}function e(a){var b=f();switch(a){case"ne":return[b.x2,b.y];case"nw":return[b.x,b.y];case"se":return[b.x2,b.y2];case"sw":return[b.x,b.y2]}}function f(){if(!J.aspectRatio)return i();var a,b,c,d,e=J.aspectRatio,f=J.minSize[0]/bb,g=J.maxSize[0]/bb,k=J.maxSize[1]/cb,l=o-m,q=p-n,r=Math.abs(l),s=Math.abs(q),t=r/s;return 0===g&&(g=10*S),0===k&&(k=10*T),e>t?(b=p,c=s*e,a=0>l?m-c:c+m,0>a?(a=0,d=Math.abs((a-m)/e),b=0>q?n-d:d+n):a>S&&(a=S,d=Math.abs((a-m)/e),b=0>q?n-d:d+n)):(a=o,d=r/e,b=0>q?n-d:n+d,0>b?(b=0,c=Math.abs((b-n)*e),a=0>l?m-c:c+m):b>T&&(b=T,c=Math.abs(b-n)*e,a=0>l?m-c:c+m)),a>m?(f>a-m?a=m+f:a-m>g&&(a=m+g),b=b>n?n+(a-m)/e:n-(a-m)/e):m>a&&(f>m-a?a=m-f:m-a>g&&(a=m-g),b=b>n?n+(m-a)/e:n-(m-a)/e),0>a?(m-=a,a=0):a>S&&(m-=a-S,a=S),0>b?(n-=b,b=0):b>T&&(n-=b-T,b=T),j(h(m,n,a,b))}function g(a){return a[0]<0&&(a[0]=0),a[1]<0&&(a[1]=0),a[0]>S&&(a[0]=S),a[1]>T&&(a[1]=T),[Math.round(a[0]),Math.round(a[1])]}function h(a,b,c,d){var e=a,f=c,g=b,h=d;return a>c&&(e=c,f=a),b>d&&(g=d,h=b),[e,g,f,h]}function i(){var a,b=o-m,c=p-n;return Z&&Math.abs(b)>Z&&(o=b>0?m+Z:m-Z),$&&Math.abs(c)>$&&(p=c>0?n+$:n-$),ab/cb&&Math.abs(c)<ab/cb&&(p=c>0?n+ab/cb:n-ab/cb),_/bb&&Math.abs(b)<_/bb&&(o=b>0?m+_/bb:m-_/bb),0>m&&(o-=m,m-=m),0>n&&(p-=n,n-=n),0>o&&(m-=o,o-=o),0>p&&(n-=p,p-=p),o>S&&(a=o-S,m-=a,o-=a),p>T&&(a=p-T,n-=a,p-=a),m>S&&(a=m-T,p-=a,n-=a),n>T&&(a=n-T,p-=a,n-=a),j(h(m,n,o,p))}function j(a){return{x:a[0],y:a[1],x2:a[2],y2:a[3],w:a[2]-a[0],h:a[3]-a[1]}}var k,l,m=0,n=0,o=0,p=0;return{flipCoords:h,setPressed:a,setCurrent:b,getOffset:c,moveOffset:d,getCorner:e,getFixed:f}}(),mb=function(){function b(a,b){o.left.css({height:d(b)}),o.right.css({height:d(b)})}function c(){return e(lb.getFixed())}function e(a){o.top.css({left:d(a.x),width:d(a.w),height:d(a.y)}),o.bottom.css({top:d(a.y2),left:d(a.x),width:d(a.w),height:d(T-a.y2)}),o.right.css({left:d(a.x2),width:d(S-a.x2)}),o.left.css({width:d(a.x)})}function f(){return a("<div />").css({position:"absolute",backgroundColor:J.shadeColor||J.bgColor}).appendTo(n)}function g(){m||(m=!0,n.insertBefore(R),c(),nb.setBgOpacity(1,0,1),V.hide(),h(J.shadeColor||J.bgColor,1),nb.isAwake()?j(J.bgOpacity,1):j(1,1))}function h(a,b){G(l(),a,b)}function i(){m&&(n.remove(),V.show(),m=!1,nb.isAwake()?nb.setBgOpacity(J.bgOpacity,1,1):(nb.setBgOpacity(1,1,1),nb.disableHandles()),G(U,0,1))}function j(a,b){m&&(J.bgFade&&!b?n.animate({opacity:1-a},{queue:!1,duration:J.fadeTime}):n.css({opacity:1-a}))}function k(){J.shade?g():i(),nb.isAwake()&&j(J.bgOpacity)}function l(){return n.children()}var m=!1,n=a("<div />").css({position:"absolute",zIndex:240,opacity:0}),o={top:f(),left:f().height(T),right:f().height(T),bottom:f()};return{update:c,updateRaw:e,getShades:l,setBgColor:h,enable:g,disable:i,resize:b,refresh:k,opacity:j}}(),nb=function(){function b(b){var c=a("<div />").css({position:"absolute",opacity:J.borderOpacity}).addClass(e(b));return W.append(c),c}function c(b,c){var d=a("<div />").mousedown(n(b)).css({cursor:b+"-resize",position:"absolute",zIndex:c}).addClass("ord-"+b);return kb.support&&d.bind("touchstart.jcrop",kb.createDragger(b)),X.append(d),d}function f(a){var b=J.handleSize,d=c(a,B++).css({opacity:J.handleOpacity}).addClass(e("handle"));return b&&d.width(b).height(b),d}function g(a){return c(a,B++).addClass("jcrop-dragbar")}function h(a){var b;for(b=0;b<a.length;b++)E[a[b]]=g(a[b])}function i(a){var c,d;for(d=0;d<a.length;d++){switch(a[d]){case"n":c="hline";break;case"s":c="hline bottom";break;case"e":c="vline right";break;case"w":c="vline"}C[a[d]]=b(c)}}function j(a){var b;for(b=0;b<a.length;b++)D[a[b]]=f(a[b])}function k(a,b){J.shade||V.css({top:d(-b),left:d(-a)}),Y.css({top:d(b),left:d(a)})}function l(a,b){Y.width(Math.round(a)).height(Math.round(b))}function m(){var a=lb.getFixed();lb.setPressed([a.x,a.y]),lb.setCurrent([a.x2,a.y2]),o()}function o(a){return A?q(a):void 0}function q(a){var b=lb.getFixed();l(b.w,b.h),k(b.x,b.y),J.shade&&mb.updateRaw(b),A||s(),a?J.onSelect.call(qb,p(b)):J.onChange.call(qb,p(b))}function r(a,b,c){(A||b)&&(J.bgFade&&!c?R.animate({opacity:a},{queue:!1,duration:J.fadeTime}):R.css("opacity",a))}function s(){Y.show(),J.shade?mb.opacity(jb):r(jb,!0),A=!0}function u(){x(),Y.hide(),J.shade?mb.opacity(1):r(1),A=!1,J.onRelease.call(qb)}function v(){F&&X.show()}function w(){return F=!0,J.allowResize?(X.show(),!0):void 0}function x(){F=!1,X.hide()}function y(a){a?(eb=!0,x()):(eb=!1,w())}function z(){y(!1),m()}var A,B=370,C={},D={},E={},F=!1;J.dragEdges&&a.isArray(J.createDragbars)&&h(J.createDragbars),a.isArray(J.createHandles)&&j(J.createHandles),J.drawBorders&&a.isArray(J.createBorders)&&i(J.createBorders),a(document).bind("touchstart.jcrop-ios",function(b){a(b.currentTarget).hasClass("jcrop-tracker")&&b.stopPropagation()});var G=t().mousedown(n("move")).css({cursor:"move",position:"absolute",zIndex:360});return kb.support&&G.bind("touchstart.jcrop",kb.createDragger("move")),W.append(G),x(),{updateVisible:o,update:q,release:u,refresh:m,isAwake:function(){return A},setCursor:function(a){G.css("cursor",a)},enableHandles:w,enableOnly:function(){F=!0},showHandles:v,disableHandles:x,animMode:y,setBgOpacity:r,done:z}}(),ob=function(){function b(b){hb.css({zIndex:450}),b?a(document).bind("touchmove.jcrop",g).bind("touchend.jcrop",i):m&&a(document).bind("mousemove.jcrop",d).bind("mouseup.jcrop",e)}function c(){hb.css({zIndex:290}),a(document).unbind(".jcrop")}function d(a){return k(h(a)),!1}function e(a){return a.preventDefault(),a.stopPropagation(),db&&(db=!1,l(h(a)),nb.isAwake()&&J.onSelect.call(qb,p(lb.getFixed())),c(),k=function(){},l=function(){}),!1}function f(a,c,d){return db=!0,k=a,l=c,b(d),!1}function g(a){return k(h(kb.cfilter(a))),!1}function i(a){return e(kb.cfilter(a))}function j(a){hb.css("cursor",a)}var k=function(){},l=function(){},m=J.trackDocument;return m||hb.mousemove(d).mouseup(e).mouseout(e),R.before(hb),{activateHandlers:f,setCursor:j}}(),pb=function(){function b(){J.keySupport&&(f.show(),f.focus())}function c(){f.hide()}function d(a,b,c){J.allowMove&&(lb.moveOffset([b,c]),nb.updateVisible(!0)),a.preventDefault(),a.stopPropagation()}function e(a){if(a.ctrlKey||a.metaKey)return!0;fb=a.shiftKey?!0:!1;var b=fb?10:1;switch(a.keyCode){case 37:d(a,-b,0);break;case 39:d(a,b,0);break;case 38:d(a,0,-b);break;case 40:d(a,0,b);break;case 27:J.allowSelect&&nb.release();break;case 9:return!0}return!1}var f=a('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),g=a("<div />").css({position:"absolute",overflow:"hidden"}).append(f);return J.keySupport&&(f.keydown(e).blur(c),M||!J.fixedSupport?(f.css({position:"absolute",left:"-20px"}),g.append(f).insertBefore(R)):f.insertBefore(R)),{watchKeys:b}}();kb.support&&hb.bind("touchstart.jcrop",kb.newSelection),X.hide(),H(!0);var qb={setImage:F,animateTo:v,setSelect:w,setOptions:A,tellSelect:y,tellScaled:z,setClass:u,disable:B,enable:C,cancel:D,release:nb.release,destroy:E,focus:pb.watchKeys,getBounds:function(){return[S*bb,T*cb]},getWidgetSize:function(){return[S,T]},getScaleFactor:function(){return[bb,cb]},getOptions:function(){return J},ui:{holder:U,selection:Y}};return L&&U.bind("selectstart",function(){return!1}),O.data("Jcrop",qb),qb},a.fn.Jcrop=function(b,c){var d;return this.each(function(){if(a(this).data("Jcrop")){if("api"===b)return a(this).data("Jcrop");a(this).data("Jcrop").setOptions(b)}else"IMG"==this.tagName?a.Jcrop.Loader(this,function(){a(this).css({display:"block",visibility:"hidden"}),d=a.Jcrop(this,b),a.isFunction(c)&&c.call(d)}):(a(this).css({display:"block",visibility:"hidden"}),d=a.Jcrop(this,b),a.isFunction(c)&&c.call(d))}),this},a.Jcrop.Loader=function(b,c,d){function e(){g.complete?(f.unbind(".jcloader"),a.isFunction(c)&&c.call(g)):window.setTimeout(e,50)}var f=a(b),g=f[0];f.bind("load.jcloader",e).bind("error.jcloader",function(){f.unbind(".jcloader"),a.isFunction(d)&&d.call(g)}),g.complete&&a.isFunction(c)&&(f.unbind(".jcloader"),c.call(g))},a.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}}(jQuery),function(a){"use strict";var b=function(a,c,d){var e,f,g=document.createElement("img"),h=new Date;return g.onerror=c,g.onload=function(){!f||d&&d.noRevoke||b.revokeObjectURL(f),c(b.scale(g,d))},window.Blob&&a instanceof Blob||window.File&&a instanceof File?(e=f=b.createObjectURL(a),g._type=a.type):e=a,e+="?_"+h.getTime(),e?(g.src=e,g):b.readFile(a,function(a){g.src=a})},c=window.createObjectURL&&window||window.URL&&URL.revokeObjectURL&&URL||window.webkitURL&&webkitURL;b.detectSubsampling=function(a){var b,c,d=a.width,e=a.height;return d*e>1048576?(b=document.createElement("canvas"),b.width=b.height=1,c=b.getContext("2d"),c.drawImage(a,-d+1,0),0===c.getImageData(0,0,1,1).data[3]):!1},b.detectVerticalSquash=function(a,b){var c,d,e,f,g,h=document.createElement("canvas"),i=h.getContext("2d");for(h.width=1,h.height=b,i.drawImage(a,0,0),c=i.getImageData(0,0,1,b).data,d=0,e=b,f=b;f>d;)g=c[4*(f-1)+3],0===g?e=f:d=f,f=e+d>>1;return f/b},b.renderImageToCanvas=function(a,c,d,e){var f,g,h,i,j,k,l=a.width,m=a.height,n=c.getContext("2d"),o=1024,p=document.createElement("canvas");for(n.save(),b.detectSubsampling(a)&&(l/=2,m/=2),f=b.detectVerticalSquash(a,m),p.width=p.height=o,g=p.getContext("2d"),h=0;m>h;){for(i=h+o>m?m-h:o,j=0;l>j;)k=j+o>l?l-j:o,g.clearRect(0,0,o,o),g.drawImage(a,-j,-h),n.drawImage(p,0,0,k,i,Math.floor(j*d/l),Math.floor(h*e/m/f),Math.ceil(k*d/l),Math.ceil(i*e/m/f)),j+=o;h+=o}n.restore(),p=g=null},b.scale=function(a,c){c=c||{};var d=document.createElement("canvas"),e=a.width,f=a.height,g=Math.max((c.minWidth||e)/e,(c.minHeight||f)/f);return g>1&&(e=parseInt(e*g,10),f=parseInt(f*g,10)),g=Math.min((c.maxWidth||e)/e,(c.maxHeight||f)/f),1>g&&(e=parseInt(e*g,10),f=parseInt(f*g,10)),a.getContext||c.canvas&&d.getContext?(d.width=e,d.height=f,"image/jpeg"===a._type?b.renderImageToCanvas(a,d,e,f):d.getContext("2d").drawImage(a,0,0,e,f),d):a},b.createObjectURL=function(a){return c?c.createObjectURL(a):!1},b.revokeObjectURL=function(a){return c?c.revokeObjectURL(a):!1},b.readFile=function(a,b){if(window.FileReader&&FileReader.prototype.readAsDataURL){var c=new FileReader;return c.onload=function(a){b(a.target.result)},c.readAsDataURL(a),c}return!1},a.loadImage=b}(this),function(a,b){function c(b,c){var e=b.nodeName.toLowerCase();if("area"===e){var f,g=b.parentNode,h=g.name;return b.href&&h&&"map"===g.nodeName.toLowerCase()?(f=a("img[usemap=#"+h+"]")[0],!!f&&d(f)):!1}return(/input|select|textarea|button|object/.test(e)?!b.disabled:"a"==e?b.href||c:c)&&d(b)}function d(b){return!a(b).parents().andSelf().filter(function(){return"hidden"===a.curCSS(this,"visibility")||a.expr.filters.hidden(this)}).length}a.ui=a.ui||{},a.ui.version||(a.extend(a.ui,{version:"1.8.24",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}}),a.fn.extend({propAttr:a.fn.prop||a.fn.attr,_focus:a.fn.focus,focus:function(b,c){return"number"==typeof b?this.each(function(){var d=this;setTimeout(function(){a(d).focus(),c&&c.call(d)},b)}):this._focus.apply(this,arguments)},scrollParent:function(){var b;return b=a.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(a.curCSS(this,"position",1))&&/(auto|scroll)/.test(a.curCSS(this,"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,"overflow-x",1))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(a.curCSS(this,"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,"overflow-x",1))}).eq(0),/fixed/.test(this.css("position"))||!b.length?a(document):b},zIndex:function(c){if(c!==b)return this.css("zIndex",c);if(this.length)for(var d,e,f=a(this[0]);f.length&&f[0]!==document;){if(d=f.css("position"),("absolute"===d||"relative"===d||"fixed"===d)&&(e=parseInt(f.css("zIndex"),10),!isNaN(e)&&0!==e))return e;f=f.parent()}return 0},disableSelection:function(){return this.bind((a.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(a){a.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),a("<a>").outerWidth(1).jquery||a.each(["Width","Height"],function(c,d){function e(b,c,d,e){return a.each(f,function(){c-=parseFloat(a.curCSS(b,"padding"+this,!0))||0,d&&(c-=parseFloat(a.curCSS(b,"border"+this+"Width",!0))||0),e&&(c-=parseFloat(a.curCSS(b,"margin"+this,!0))||0)}),c}var f="Width"===d?["Left","Right"]:["Top","Bottom"],g=d.toLowerCase(),h={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};a.fn["inner"+d]=function(c){return c===b?h["inner"+d].call(this):this.each(function(){a(this).css(g,e(this,c)+"px")})},a.fn["outer"+d]=function(b,c){return"number"!=typeof b?h["outer"+d].call(this,b):this.each(function(){a(this).css(g,e(this,b,!0,c)+"px")})}}),a.extend(a.expr[":"],{data:a.expr.createPseudo?a.expr.createPseudo(function(b){return function(c){return!!a.data(c,b)}}):function(b,c,d){return!!a.data(b,d[3])},focusable:function(b){return c(b,!isNaN(a.attr(b,"tabindex")))},tabbable:function(b){var d=a.attr(b,"tabindex"),e=isNaN(d);return(e||d>=0)&&c(b,!e)}}),a(function(){var b=document.body,c=b.appendChild(c=document.createElement("div"));c.offsetHeight,a.extend(c.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),a.support.minHeight=100===c.offsetHeight,a.support.selectstart="onselectstart"in c,b.removeChild(c).style.display="none"}),a.curCSS||(a.curCSS=a.css),a.extend(a.ui,{plugin:{add:function(b,c,d){var e=a.ui[b].prototype;for(var f in d)e.plugins[f]=e.plugins[f]||[],e.plugins[f].push([c,d[f]])},call:function(a,b,c){var d=a.plugins[b];if(d&&a.element[0].parentNode)for(var e=0;e<d.length;e++)a.options[d[e][0]]&&d[e][1].apply(a.element,c)}},contains:function(a,b){return document.compareDocumentPosition?16&a.compareDocumentPosition(b):a!==b&&a.contains(b)},hasScroll:function(b,c){if("hidden"===a(b).css("overflow"))return!1;var d=c&&"left"===c?"scrollLeft":"scrollTop",e=!1;return b[d]>0?!0:(b[d]=1,e=b[d]>0,b[d]=0,e)},isOverAxis:function(a,b,c){return a>b&&b+c>a},isOver:function(b,c,d,e,f,g){return a.ui.isOverAxis(b,d,f)&&a.ui.isOverAxis(c,e,g)}}))}(jQuery),function(a,b){if(a.cleanData){var c=a.cleanData;a.cleanData=function(b){for(var d,e=0;null!=(d=b[e]);e++)try{a(d).triggerHandler("remove")}catch(f){}c(b)}}else{var d=a.fn.remove;a.fn.remove=function(b,c){return this.each(function(){return c||(!b||a.filter(b,[this]).length)&&a("*",this).add([this]).each(function(){try{a(this).triggerHandler("remove")}catch(b){}}),d.call(a(this),b,c)})}}a.widget=function(b,c,d){var e,f=b.split(".")[0];b=b.split(".")[1],e=f+"-"+b,d||(d=c,c=a.Widget),a.expr[":"][e]=function(c){return!!a.data(c,b)},a[f]=a[f]||{},a[f][b]=function(a,b){arguments.length&&this._createWidget(a,b)};var g=new c;g.options=a.extend(!0,{},g.options),a[f][b].prototype=a.extend(!0,g,{namespace:f,widgetName:b,widgetEventPrefix:a[f][b].prototype.widgetEventPrefix||b,widgetBaseClass:e},d),a.widget.bridge(b,a[f][b])},a.widget.bridge=function(c,d){a.fn[c]=function(e){var f="string"==typeof e,g=Array.prototype.slice.call(arguments,1),h=this;return e=!f&&g.length?a.extend.apply(null,[!0,e].concat(g)):e,f&&"_"===e.charAt(0)?h:(f?this.each(function(){var d=a.data(this,c),f=d&&a.isFunction(d[e])?d[e].apply(d,g):d;return f!==d&&f!==b?(h=f,!1):void 0}):this.each(function(){var b=a.data(this,c);b?b.option(e||{})._init():a.data(this,c,new d(e,this))}),h)}},a.Widget=function(a,b){arguments.length&&this._createWidget(a,b)},a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(b,c){a.data(c,this.widgetName,this),this.element=a(c),this.options=a.extend(!0,{},this.options,this._getCreateOptions(),b);var d=this;this.element.bind("remove."+this.widgetName,function(){d.destroy()}),this._create(),this._trigger("create"),this._init()},_getCreateOptions:function(){return a.metadata&&a.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName),this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled ui-state-disabled")},widget:function(){return this.element},option:function(c,d){var e=c;if(0===arguments.length)return a.extend({},this.options);if("string"==typeof c){if(d===b)return this.options[c];e={},e[c]=d}return this._setOptions(e),this},_setOptions:function(b){var c=this;return a.each(b,function(a,b){c._setOption(a,b)}),this},_setOption:function(a,b){return this.options[a]=b,"disabled"===a&&this.widget()[b?"addClass":"removeClass"](this.widgetBaseClass+"-disabled ui-state-disabled").attr("aria-disabled",b),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(b,c,d){var e,f,g=this.options[b];if(d=d||{},c=a.Event(c),c.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase(),c.target=this.element[0],f=c.originalEvent)for(e in f)e in c||(c[e]=f[e]);return this.element.trigger(c,d),!(a.isFunction(g)&&g.call(this.element[0],c,d)===!1||c.isDefaultPrevented())}}}(jQuery),function(a){var b=!1;a(document).mouseup(function(){b=!1}),a.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var b=this;this.element.bind("mousedown."+this.widgetName,function(a){return b._mouseDown(a)}).bind("click."+this.widgetName,function(c){return!0===a.data(c.target,b.widgetName+".preventClickEvent")?(a.removeData(c.target,b.widgetName+".preventClickEvent"),c.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(c){if(!b){this._mouseStarted&&this._mouseUp(c),this._mouseDownEvent=c;var d=this,e=1==c.which,f="string"==typeof this.options.cancel&&c.target.nodeName?a(c.target).closest(this.options.cancel).length:!1;return e&&!f&&this._mouseCapture(c)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){d.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(c)&&this._mouseDelayMet(c)&&(this._mouseStarted=this._mouseStart(c)!==!1,!this._mouseStarted)?(c.preventDefault(),!0):(!0===a.data(c.target,this.widgetName+".preventClickEvent")&&a.removeData(c.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(a){return d._mouseMove(a)},this._mouseUpDelegate=function(a){return d._mouseUp(a)},a(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),c.preventDefault(),b=!0,!0)):!0}},_mouseMove:function(b){return!a.browser.msie||document.documentMode>=9||b.button?this._mouseStarted?(this._mouseDrag(b),b.preventDefault()):(this._mouseDistanceMet(b)&&this._mouseDelayMet(b)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,b)!==!1,this._mouseStarted?this._mouseDrag(b):this._mouseUp(b)),!this._mouseStarted):this._mouseUp(b)},_mouseUp:function(b){return a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,b.target==this._mouseDownEvent.target&&a.data(b.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(b)),!1},_mouseDistanceMet:function(a){return Math.max(Math.abs(this._mouseDownEvent.pageX-a.pageX),Math.abs(this._mouseDownEvent.pageY-a.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(a){a.widget("ui.sortable",a.ui.mouse,{version:"1.9.2",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3},_create:function(){var a=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===a.axis||/left|right/.test(this.items[0].item.css("float"))||/inline|table-cell/.test(this.items[0].item.css("display")):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var a=this.items.length-1;a>=0;a--)this.items[a].item.removeData(this.widgetName+"-item");return this},_setOption:function(b,c){"disabled"===b?(this.options[b]=c,this.widget().toggleClass("ui-sortable-disabled",!!c)):a.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(b,c){var d=this;if(this.reverting)return!1;if(this.options.disabled||"static"==this.options.type)return!1;this._refreshItems(b);{var e=null;a(b.target).parents().each(function(){return a.data(this,d.widgetName+"-item")==d?(e=a(this),!1):void 0})}if(a.data(b.target,d.widgetName+"-item")==d&&(e=a(b.target)),!e)return!1;if(this.options.handle&&!c){var f=!1;if(a(this.options.handle,e).find("*").andSelf().each(function(){this==b.target&&(f=!0)}),!f)return!1}return this.currentItem=e,this._removeCurrentsFromItems(),!0},_mouseStart:function(b,c,d){var e=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(b),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},a.extend(this.offset,{click:{left:b.pageX-this.offset.left,top:b.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(b),this.originalPageX=b.pageX,this.originalPageY=b.pageY,e.cursorAt&&this._adjustOffsetFromHelper(e.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!=this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),e.containment&&this._setContainment(),e.cursor&&(a("body").css("cursor")&&(this._storedCursor=a("body").css("cursor")),a("body").css("cursor",e.cursor)),e.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",e.opacity)),e.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",e.zIndex)),this.scrollParent[0]!=document&&"HTML"!=this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",b,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!d)for(var f=this.containers.length-1;f>=0;f--)this.containers[f]._trigger("activate",b,this._uiHash(this));return a.ui.ddmanager&&(a.ui.ddmanager.current=this),a.ui.ddmanager&&!e.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(b),!0},_mouseDrag:function(b){if(this.position=this._generatePosition(b),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll){var c=this.options,d=!1;this.scrollParent[0]!=document&&"HTML"!=this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-b.pageY<c.scrollSensitivity?this.scrollParent[0].scrollTop=d=this.scrollParent[0].scrollTop+c.scrollSpeed:b.pageY-this.overflowOffset.top<c.scrollSensitivity&&(this.scrollParent[0].scrollTop=d=this.scrollParent[0].scrollTop-c.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-b.pageX<c.scrollSensitivity?this.scrollParent[0].scrollLeft=d=this.scrollParent[0].scrollLeft+c.scrollSpeed:b.pageX-this.overflowOffset.left<c.scrollSensitivity&&(this.scrollParent[0].scrollLeft=d=this.scrollParent[0].scrollLeft-c.scrollSpeed)):(b.pageY-a(document).scrollTop()<c.scrollSensitivity?d=a(document).scrollTop(a(document).scrollTop()-c.scrollSpeed):a(window).height()-(b.pageY-a(document).scrollTop())<c.scrollSensitivity&&(d=a(document).scrollTop(a(document).scrollTop()+c.scrollSpeed)),b.pageX-a(document).scrollLeft()<c.scrollSensitivity?d=a(document).scrollLeft(a(document).scrollLeft()-c.scrollSpeed):a(window).width()-(b.pageX-a(document).scrollLeft())<c.scrollSensitivity&&(d=a(document).scrollLeft(a(document).scrollLeft()+c.scrollSpeed))),d!==!1&&a.ui.ddmanager&&!c.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b)}this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"==this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"==this.options.axis||(this.helper[0].style.top=this.position.top+"px");for(var e=this.items.length-1;e>=0;e--){var f=this.items[e],g=f.item[0],h=this._intersectsWithPointer(f);if(h&&f.instance===this.currentContainer&&g!=this.currentItem[0]&&this.placeholder[1==h?"next":"prev"]()[0]!=g&&!a.contains(this.placeholder[0],g)&&("semi-dynamic"==this.options.type?!a.contains(this.element[0],g):!0)){if(this.direction=1==h?"down":"up","pointer"!=this.options.tolerance&&!this._intersectsWithSides(f))break;this._rearrange(b,f),this._trigger("change",b,this._uiHash());break}}return this._contactContainers(b),a.ui.ddmanager&&a.ui.ddmanager.drag(this,b),this._trigger("sort",b,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(b,c){if(b){if(a.ui.ddmanager&&!this.options.dropBehaviour&&a.ui.ddmanager.drop(this,b),this.options.revert){var d=this,e=this.placeholder.offset();this.reverting=!0,a(this.helper).animate({left:e.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:e.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){d._clear(b)})}else this._clear(b,c);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"==this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var b=this.containers.length-1;b>=0;b--)this.containers[b]._trigger("deactivate",null,this._uiHash(this)),this.containers[b].containerCache.over&&(this.containers[b]._trigger("out",null,this._uiHash(this)),this.containers[b].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!=this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),a.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?a(this.domPosition.prev).after(this.currentItem):a(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(b){var c=this._getItemsAsjQuery(b&&b.connected),d=[];return b=b||{},a(c).each(function(){var c=(a(b.item||this).attr(b.attribute||"id")||"").match(b.expression||/(.+)[-=_](.+)/);c&&d.push((b.key||c[1]+"[]")+"="+(b.key&&b.expression?c[1]:c[2]))}),!d.length&&b.key&&d.push(b.key+"="),d.join("&")},toArray:function(b){var c=this._getItemsAsjQuery(b&&b.connected),d=[];return b=b||{},c.each(function(){d.push(a(b.item||this).attr(b.attribute||"id")||"")}),d},_intersectsWith:function(a){var b=this.positionAbs.left,c=b+this.helperProportions.width,d=this.positionAbs.top,e=d+this.helperProportions.height,f=a.left,g=f+a.width,h=a.top,i=h+a.height,j=this.offset.click.top,k=this.offset.click.left,l=d+j>h&&i>d+j&&b+k>f&&g>b+k;return"pointer"==this.options.tolerance||this.options.forcePointerForContainers||"pointer"!=this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>a[this.floating?"width":"height"]?l:f<b+this.helperProportions.width/2&&c-this.helperProportions.width/2<g&&h<d+this.helperProportions.height/2&&e-this.helperProportions.height/2<i},_intersectsWithPointer:function(b){var c="x"===this.options.axis||a.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,b.top,b.height),d="y"===this.options.axis||a.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,b.left,b.width),e=c&&d,f=this._getDragVerticalDirection(),g=this._getDragHorizontalDirection();return e?this.floating?g&&"right"==g||"down"==f?2:1:f&&("down"==f?2:1):!1
},_intersectsWithSides:function(b){var c=a.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,b.top+b.height/2,b.height),d=a.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,b.left+b.width/2,b.width),e=this._getDragVerticalDirection(),f=this._getDragHorizontalDirection();return this.floating&&f?"right"==f&&d||"left"==f&&!d:e&&("down"==e&&c||"up"==e&&!c)},_getDragVerticalDirection:function(){var a=this.positionAbs.top-this.lastPositionAbs.top;return 0!=a&&(a>0?"down":"up")},_getDragHorizontalDirection:function(){var a=this.positionAbs.left-this.lastPositionAbs.left;return 0!=a&&(a>0?"right":"left")},refresh:function(a){return this._refreshItems(a),this.refreshPositions(),this},_connectWith:function(){var a=this.options;return a.connectWith.constructor==String?[a.connectWith]:a.connectWith},_getItemsAsjQuery:function(b){var c=[],d=[],e=this._connectWith();if(e&&b)for(var f=e.length-1;f>=0;f--)for(var g=a(e[f]),h=g.length-1;h>=0;h--){var i=a.data(g[h],this.widgetName);i&&i!=this&&!i.options.disabled&&d.push([a.isFunction(i.options.items)?i.options.items.call(i.element):a(i.options.items,i.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),i])}d.push([a.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):a(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(var f=d.length-1;f>=0;f--)d[f][0].each(function(){c.push(this)});return a(c)},_removeCurrentsFromItems:function(){var b=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=a.grep(this.items,function(a){for(var c=0;c<b.length;c++)if(b[c]==a.item[0])return!1;return!0})},_refreshItems:function(b){this.items=[],this.containers=[this];var c=this.items,d=[[a.isFunction(this.options.items)?this.options.items.call(this.element[0],b,{item:this.currentItem}):a(this.options.items,this.element),this]],e=this._connectWith();if(e&&this.ready)for(var f=e.length-1;f>=0;f--)for(var g=a(e[f]),h=g.length-1;h>=0;h--){var i=a.data(g[h],this.widgetName);i&&i!=this&&!i.options.disabled&&(d.push([a.isFunction(i.options.items)?i.options.items.call(i.element[0],b,{item:this.currentItem}):a(i.options.items,i.element),i]),this.containers.push(i))}for(var f=d.length-1;f>=0;f--)for(var j=d[f][1],k=d[f][0],h=0,l=k.length;l>h;h++){var m=a(k[h]);m.data(this.widgetName+"-item",j),c.push({item:m,instance:j,width:0,height:0,left:0,top:0})}},refreshPositions:function(b){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());for(var c=this.items.length-1;c>=0;c--){var d=this.items[c];if(d.instance==this.currentContainer||!this.currentContainer||d.item[0]==this.currentItem[0]){var e=this.options.toleranceElement?a(this.options.toleranceElement,d.item):d.item;b||(d.width=e.outerWidth(),d.height=e.outerHeight());var f=e.offset();d.left=f.left,d.top=f.top}}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(var c=this.containers.length-1;c>=0;c--){var f=this.containers[c].element.offset();this.containers[c].containerCache.left=f.left,this.containers[c].containerCache.top=f.top,this.containers[c].containerCache.width=this.containers[c].element.outerWidth(),this.containers[c].containerCache.height=this.containers[c].element.outerHeight()}return this},_createPlaceholder:function(b){b=b||this;var c=b.options;if(!c.placeholder||c.placeholder.constructor==String){var d=c.placeholder;c.placeholder={element:function(){var c=a(document.createElement(b.currentItem[0].nodeName)).addClass(d||b.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];return d||(c.style.visibility="hidden"),c},update:function(a,e){(!d||c.forcePlaceholderSize)&&(e.height()||e.height(b.currentItem.innerHeight()-parseInt(b.currentItem.css("paddingTop")||0,10)-parseInt(b.currentItem.css("paddingBottom")||0,10)),e.width()||e.width(b.currentItem.innerWidth()-parseInt(b.currentItem.css("paddingLeft")||0,10)-parseInt(b.currentItem.css("paddingRight")||0,10)))}}}b.placeholder=a(c.placeholder.element.call(b.element,b.currentItem)),b.currentItem.after(b.placeholder),c.placeholder.update(b,b.placeholder)},_contactContainers:function(b){for(var c=null,d=null,e=this.containers.length-1;e>=0;e--)if(!a.contains(this.currentItem[0],this.containers[e].element[0]))if(this._intersectsWith(this.containers[e].containerCache)){if(c&&a.contains(this.containers[e].element[0],c.element[0]))continue;c=this.containers[e],d=e}else this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",b,this._uiHash(this)),this.containers[e].containerCache.over=0);if(c)if(1===this.containers.length)this.containers[d]._trigger("over",b,this._uiHash(this)),this.containers[d].containerCache.over=1;else{for(var f=1e4,g=null,h=this.containers[d].floating?"left":"top",i=this.containers[d].floating?"width":"height",j=this.positionAbs[h]+this.offset.click[h],k=this.items.length-1;k>=0;k--)if(a.contains(this.containers[d].element[0],this.items[k].item[0])&&this.items[k].item[0]!=this.currentItem[0]){var l=this.items[k].item.offset()[h],m=!1;Math.abs(l-j)>Math.abs(l+this.items[k][i]-j)&&(m=!0,l+=this.items[k][i]),Math.abs(l-j)<f&&(f=Math.abs(l-j),g=this.items[k],this.direction=m?"up":"down")}if(!g&&!this.options.dropOnEmpty)return;this.currentContainer=this.containers[d],g?this._rearrange(b,g,null,!0):this._rearrange(b,null,this.containers[d].element,!0),this._trigger("change",b,this._uiHash()),this.containers[d]._trigger("change",b,this._uiHash(this)),this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[d]._trigger("over",b,this._uiHash(this)),this.containers[d].containerCache.over=1}},_createHelper:function(b){var c=this.options,d=a.isFunction(c.helper)?a(c.helper.apply(this.element[0],[b,this.currentItem])):"clone"==c.helper?this.currentItem.clone():this.currentItem;return d.parents("body").length||a("parent"!=c.appendTo?c.appendTo:this.currentItem[0].parentNode)[0].appendChild(d[0]),d[0]==this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(""==d[0].style.width||c.forceHelperSize)&&d.width(this.currentItem.width()),(""==d[0].style.height||c.forceHelperSize)&&d.height(this.currentItem.height()),d},_adjustOffsetFromHelper:function(b){"string"==typeof b&&(b=b.split(" ")),a.isArray(b)&&(b={left:+b[0],top:+b[1]||0}),"left"in b&&(this.offset.click.left=b.left+this.margins.left),"right"in b&&(this.offset.click.left=this.helperProportions.width-b.right+this.margins.left),"top"in b&&(this.offset.click.top=b.top+this.margins.top),"bottom"in b&&(this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var b=this.offsetParent.offset();return"absolute"==this.cssPosition&&this.scrollParent[0]!=document&&a.contains(this.scrollParent[0],this.offsetParent[0])&&(b.left+=this.scrollParent.scrollLeft(),b.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&"html"==this.offsetParent[0].tagName.toLowerCase()&&a.ui.ie)&&(b={top:0,left:0}),{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"==this.cssPosition){var a=this.currentItem.position();return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b=this.options;if("parent"==b.containment&&(b.containment=this.helper[0].parentNode),("document"==b.containment||"window"==b.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,a("document"==b.containment?document:window).width()-this.helperProportions.width-this.margins.left,(a("document"==b.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),!/^(document|window|parent)$/.test(b.containment)){var c=a(b.containment)[0],d=a(b.containment).offset(),e="hidden"!=a(c).css("overflow");this.containment=[d.left+(parseInt(a(c).css("borderLeftWidth"),10)||0)+(parseInt(a(c).css("paddingLeft"),10)||0)-this.margins.left,d.top+(parseInt(a(c).css("borderTopWidth"),10)||0)+(parseInt(a(c).css("paddingTop"),10)||0)-this.margins.top,d.left+(e?Math.max(c.scrollWidth,c.offsetWidth):c.offsetWidth)-(parseInt(a(c).css("borderLeftWidth"),10)||0)-(parseInt(a(c).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,d.top+(e?Math.max(c.scrollHeight,c.offsetHeight):c.offsetHeight)-(parseInt(a(c).css("borderTopWidth"),10)||0)-(parseInt(a(c).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(b,c){c||(c=this.position);var d="absolute"==b?1:-1,e=(this.options,"absolute"!=this.cssPosition||this.scrollParent[0]!=document&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent),f=/(html|body)/i.test(e[0].tagName);return{top:c.top+this.offset.relative.top*d+this.offset.parent.top*d-("fixed"==this.cssPosition?-this.scrollParent.scrollTop():f?0:e.scrollTop())*d,left:c.left+this.offset.relative.left*d+this.offset.parent.left*d-("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():f?0:e.scrollLeft())*d}},_generatePosition:function(b){var c=this.options,d="absolute"!=this.cssPosition||this.scrollParent[0]!=document&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,e=/(html|body)/i.test(d[0].tagName);"relative"!=this.cssPosition||this.scrollParent[0]!=document&&this.scrollParent[0]!=this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset());var f=b.pageX,g=b.pageY;if(this.originalPosition&&(this.containment&&(b.pageX-this.offset.click.left<this.containment[0]&&(f=this.containment[0]+this.offset.click.left),b.pageY-this.offset.click.top<this.containment[1]&&(g=this.containment[1]+this.offset.click.top),b.pageX-this.offset.click.left>this.containment[2]&&(f=this.containment[2]+this.offset.click.left),b.pageY-this.offset.click.top>this.containment[3]&&(g=this.containment[3]+this.offset.click.top)),c.grid)){var h=this.originalPageY+Math.round((g-this.originalPageY)/c.grid[1])*c.grid[1];g=this.containment?h-this.offset.click.top<this.containment[1]||h-this.offset.click.top>this.containment[3]?h-this.offset.click.top<this.containment[1]?h+c.grid[1]:h-c.grid[1]:h:h;var i=this.originalPageX+Math.round((f-this.originalPageX)/c.grid[0])*c.grid[0];f=this.containment?i-this.offset.click.left<this.containment[0]||i-this.offset.click.left>this.containment[2]?i-this.offset.click.left<this.containment[0]?i+c.grid[0]:i-c.grid[0]:i:i}return{top:g-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"==this.cssPosition?-this.scrollParent.scrollTop():e?0:d.scrollTop()),left:f-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():e?0:d.scrollLeft())}},_rearrange:function(a,b,c,d){c?c[0].appendChild(this.placeholder[0]):b.item[0].parentNode.insertBefore(this.placeholder[0],"down"==this.direction?b.item[0]:b.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var e=this.counter;this._delay(function(){e==this.counter&&this.refreshPositions(!d)})},_clear:function(b,c){this.reverting=!1;var d=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]==this.currentItem[0]){for(var e in this._storedCSS)("auto"==this._storedCSS[e]||"static"==this._storedCSS[e])&&(this._storedCSS[e]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();this.fromOutside&&!c&&d.push(function(a){this._trigger("receive",a,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev==this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent==this.currentItem.parent()[0]||c||d.push(function(a){this._trigger("update",a,this._uiHash())}),this!==this.currentContainer&&(c||(d.push(function(a){this._trigger("remove",a,this._uiHash())}),d.push(function(a){return function(b){a._trigger("receive",b,this._uiHash(this))}}.call(this,this.currentContainer)),d.push(function(a){return function(b){a._trigger("update",b,this._uiHash(this))}}.call(this,this.currentContainer))));for(var e=this.containers.length-1;e>=0;e--)c||d.push(function(a){return function(b){a._trigger("deactivate",b,this._uiHash(this))}}.call(this,this.containers[e])),this.containers[e].containerCache.over&&(d.push(function(a){return function(b){a._trigger("out",b,this._uiHash(this))}}.call(this,this.containers[e])),this.containers[e].containerCache.over=0);if(this._storedCursor&&a("body").css("cursor",this._storedCursor),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"==this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!c){this._trigger("beforeStop",b,this._uiHash());for(var e=0;e<d.length;e++)d[e].call(this,b);this._trigger("stop",b,this._uiHash())}return this.fromOutside=!1,!1}if(c||this._trigger("beforeStop",b,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!=this.currentItem[0]&&this.helper.remove(),this.helper=null,!c){for(var e=0;e<d.length;e++)d[e].call(this,b);this._trigger("stop",b,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){a.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(b){var c=b||this;return{helper:c.helper,placeholder:c.placeholder||a([]),position:c.position,originalPosition:c.originalPosition,offset:c.positionAbs,item:c.currentItem,sender:b?b.element:null}}})}(jQuery),function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a,b){if(a.cleanData){var c=a.cleanData;a.cleanData=function(b){for(var d,e=0;null!=(d=b[e]);e++)try{a(d).triggerHandler("remove")}catch(f){}c(b)}}else{var d=a.fn.remove;a.fn.remove=function(b,c){return this.each(function(){return c||(!b||a.filter(b,[this]).length)&&a("*",this).add([this]).each(function(){try{a(this).triggerHandler("remove")}catch(b){}}),d.call(a(this),b,c)})}}a.widget=function(b,c,d){var e,f=b.split(".")[0];b=b.split(".")[1],e=f+"-"+b,d||(d=c,c=a.Widget),a.expr[":"][e]=function(c){return!!a.data(c,b)},a[f]=a[f]||{},a[f][b]=function(a,b){arguments.length&&this._createWidget(a,b)};var g=new c;g.options=a.extend(!0,{},g.options),a[f][b].prototype=a.extend(!0,g,{namespace:f,widgetName:b,widgetEventPrefix:a[f][b].prototype.widgetEventPrefix||b,widgetBaseClass:e},d),a.widget.bridge(b,a[f][b])},a.widget.bridge=function(c,d){a.fn[c]=function(e){var f="string"==typeof e,g=Array.prototype.slice.call(arguments,1),h=this;return e=!f&&g.length?a.extend.apply(null,[!0,e].concat(g)):e,f&&"_"===e.charAt(0)?h:(f?this.each(function(){var d=a.data(this,c),f=d&&a.isFunction(d[e])?d[e].apply(d,g):d;return f!==d&&f!==b?(h=f,!1):void 0}):this.each(function(){var b=a.data(this,c);b?b.option(e||{})._init():a.data(this,c,new d(e,this))}),h)}},a.Widget=function(a,b){arguments.length&&this._createWidget(a,b)},a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(b,c){a.data(c,this.widgetName,this),this.element=a(c),this.options=a.extend(!0,{},this.options,this._getCreateOptions(),b);var d=this;this.element.bind("remove."+this.widgetName,function(){d.destroy()}),this._create(),this._trigger("create"),this._init()},_getCreateOptions:function(){return a.metadata&&a.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName),this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled ui-state-disabled")},widget:function(){return this.element},option:function(c,d){var e=c;if(0===arguments.length)return a.extend({},this.options);if("string"==typeof c){if(d===b)return this.options[c];e={},e[c]=d}return this._setOptions(e),this},_setOptions:function(b){var c=this;return a.each(b,function(a,b){c._setOption(a,b)}),this},_setOption:function(a,b){return this.options[a]=b,"disabled"===a&&this.widget()[b?"addClass":"removeClass"](this.widgetBaseClass+"-disabled ui-state-disabled").attr("aria-disabled",b),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(b,c,d){var e,f,g=this.options[b];if(d=d||{},c=a.Event(c),c.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase(),c.target=this.element[0],f=c.originalEvent)for(e in f)e in c||(c[e]=f[e]);return this.element.trigger(c,d),!(a.isFunction(g)&&g.call(this.element[0],c,d)===!1||c.isDefaultPrevented())}}}),this.JSON||(this.JSON={}),function(){function f(a){return 10>a?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)d=rep[c],"string"==typeof d&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}();var InterfaceBuilder=function(){var a=this;a.matrix=function(a){$(a).each(function(){var a=$(this),b=a.find("tbody"),c=a.find("thead tr"),d=a.data("name"),e=[];c.find("th").each(function(a){a>0&&e.push($(this).data("col"))}),a.find(".ib-add-row").live("click",function(a){var f=$("<tr />"),g=b.find("tr").length;f.append('<td><div class="ib-drag-handle"></div></td>');for(var h=1;h<c.find("th").length-1;h++)f.append('<td><input type="text" name="'+d+"["+g+"]["+e[h-1]+']" value="" class="ib-cell" /></td>');f.append('<td><a href="#'+g+'" class="ib-delete-row">Delete</a></td>'),b.append(f),a.preventDefault()}),a.find(".ib-delete-row").live("click",function(){return $(this).parent().parent().remove(),b.find("tr").each(function(a){var b=$(this).find("td"),c=b.length;b.each(function(b){if(b>0&&c>b+1){var d=$(this).find("input"),e=d.attr("name").replace(/(\[\d\]\[)/g,"["+a+"][");d.attr("name",e)}})}),!1})})},a.matrix(".ib-matrix")},Base=function(){};Base.extend=function(a,b){var c=Base.prototype.extend;Base._prototyping=!0;var d=new this;c.call(d,a),d.base=function(){},delete Base._prototyping;var e=d.constructor,f=d.constructor=function(){if(!Base._prototyping)if(this._constructing||this.constructor==f)this._constructing=!0,e.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||c).call(arguments[0],d)};return f.ancestor=this,f.extend=this.extend,f.forEach=this.forEach,f.implement=this.implement,f.prototype=d,f.toString=this.toString,f.valueOf=function(a){return"object"==a?f:e.valueOf()},c.call(f,b),"function"==typeof f.init&&f.init(),f},Base.prototype={extend:function(a,b){if(arguments.length>1){var c=this[a];if(c&&"function"==typeof b&&(!c.valueOf||c.valueOf()!=b.valueOf())&&/\bbase\b/.test(b)){var d=b.valueOf();b=function(){var a=this.base||Base.prototype.base;this.base=c;var b=d.apply(this,arguments);return this.base=a,b},b.valueOf=function(a){return"object"==a?b:d},b.toString=Base.toString}this[a]=b}else if(a){var e=Base.prototype.extend;Base._prototyping||"function"==typeof this||(e=this.extend||e);for(var f={toSource:null},g=["constructor","toString","valueOf"],h=Base._prototyping?0:1;i=g[h++];)a[i]!=f[i]&&e.call(this,i,a[i]);for(var i in a)f[i]||e.call(this,i,a[i])}return this}},Base=Base.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(a,b,c){for(var d in a)void 0===this.prototype[d]&&b.call(c,a[d],d,a)},implement:function(){for(var a=0;a<arguments.length;a++)"function"==typeof arguments[a]?arguments[a](this.prototype):this.prototype.extend(arguments[a]);return this},toString:function(){return String(this.valueOf())}}),function(a){PhotoFrame.Buttons.Crop=PhotoFrame.Button.extend({buttons:[],description:!1,name:!1,enabled:!0,renderAfterRemovingLayer:!1,windowSettings:{title:!1},constructor:function(a){var b=this;this.name=PhotoFrame.Lang.crop,this.description=PhotoFrame.Lang.crop_desc,this.windowSettings.title=PhotoFrame.Lang.crop,this.buttons=[{text:PhotoFrame.Lang.crop,css:"photo-frame-tool-window-save",onclick:function(){var a=b.getCrop(!0);(a.x||a.y||a.x2||a.y2)&&b.setCrop(a.x,a.y,a.x2,a.y2)}}],b.base(a)},setCrop:function(a,b,c,d){this.buttonBar.factory.cropPhoto.jcrop.setSelect([a,b,c,d])},apply:function(){if(this.enabled){var a=this.getCrop(!0),b=a.x,c=a.y,d=a.x2,e=a.y2;!this.resizeToggleLayer&&(b||d||c||e)&&this.addManipulation(!0,{x:b,x2:d,y:c,y2:e})}},getCrop:function(a){return a?{x:parseInt(this.window.ui.x.val()),y:parseInt(this.window.ui.y.val()),x2:parseInt(this.window.ui.x2.val()),y2:parseInt(this.window.ui.y2.val())}:this.buttonBar.factory.cropPhoto.cropDimensions()},startCrop:function(){var a=this.getCrop();if(a.x||a.y||a.x2||a.y2)this.addManipulation(!0,{x:a.x,y:a.y,x2:a.x2,y2:a.y2});else{var b=this.getManipulation();b&&!b.visible&&this.disable()}this.refresh()},toggleLayer:function(a){var b=this.getManipulation();a?this.showCrop(b):this.hideCrop(),this.addManipulation(a,b.data)},hideCrop:function(){this.release(),this.disable()},showCrop:function(a){this.enable(),this.setCrop(a.data.x,a.data.y,a.data.x2,a.data.y2)},disable:function(a){this.enabled=!1,a||this.buttonBar.factory.cropPhoto.jcrop.disable(),this.window.ui.content.find("input").attr("disabled",!0)},enable:function(a){this.enabled=!0,a||this.buttonBar.factory.cropPhoto.jcrop.enable(),this.window.ui.content.find("input").attr("disabled",!1)},release:function(){this.buttonBar.factory.cropPhoto.releaseCrop()},removeLayer:function(){this.resizeToggleLayer=!1,this.removeManipulation(),this.release(),this.enable()},reset:function(){this.window.ui.x.val(""),this.window.ui.y.val(""),this.window.ui.x2.val(""),this.window.ui.y2.val("")},showWindow:function(){this.refresh(),this.base()},buildWindow:function(){this.base({buttons:this.buttons});var b=this,c=a(['<div class="photo-frame-grid">','<label for="x">'+PhotoFrame.Lang.x+"</label>",'<input type="text" name="x" value="" id="x" class="photo-frame-small" />',"</div>",'<div class="photo-frame-grid">','<label for="y">'+PhotoFrame.Lang.y+"</label>",'<input type="text" name="y" value="" id="y" class="photo-frame-small" />',"</div>",'<div class="photo-frame-grid">','<label for="x2">'+PhotoFrame.Lang.x2+"</label>",'<input type="text" name="x2" value="" id="x2" class="photo-frame-small" />',"</div>",'<div class="photo-frame-grid">','<label for="y">'+PhotoFrame.Lang.y2+"</label>",'<input type="text" name="y" value="" id="y2" class="photo-frame-small" />',"</div>"].join(""));this.window.ui.content.html(c),this.window.ui.content.find("input").keypress(function(a){13==a.keyCode&&(b.apply(),a.preventDefault())}),this.window.ui.x=this.window.ui.content.find("#x"),this.window.ui.y=this.window.ui.content.find("#y"),this.window.ui.x2=this.window.ui.content.find("#x2"),this.window.ui.y2=this.window.ui.content.find("#y2");var d,e;this.resizeToggleLayer=!1,this.bind("startCropBegin",function(){e=!1}),this.bind("startCropEnd",function(){e=!0}),this.bind("jcropOnChange",function(){if(!this.resizeToggleLayer){var a=b.getManipulation();a&&a.visible&&b.enable(!0),b.buttonBar.factory.cropPhoto.released=!1,b.refresh()}}),this.bind("jcropOnRelease",function(){e&&b.getManipulation().visible&&(b.resizeToggleLayer||b.removeManipulation(),b.resizeToggleLayer=!1)}),this.bind("jcropOnSelect",function(){b.buttonBar.factory.cropPhoto.released=!1,b.refresh(!0),b.apply()}),this.bind("startRendering",function(){d=b.getManipulation().visible?!0:!1,d?b.showManipulation():b.hideManipulation()}),this.bind("stopRendering",function(){b.getManipulation()&&b.getManipulation().visible&&(b.buttonBar.factory.cancel||b.toggleLayer(d))}),this.bind("resizeInitCrop",function(){if(b.cropPhoto().totalManipulations()>0){var a=b.getManipulation();b.initCrop(a&&!a.visible?!0:!1)}}),this.bind("resizeRemoveLayer",function(){b.initCrop(!0)}),this.bind("rotateReInitCrop",function(){b.initCrop()}),this.bind("startCropEnd",function(){"true"==b.buttonBar.factory.settings.photo_frame_disable_regular_crop&&b.disable()})},isActive:function(){return"true"===this.getSetting("disable_regular_crop")?!1:!0},toggleLayerCallback:function(a){var b=a.visible&&this.getManipulation().visible?!0:!1;a.visible||(this.resizeToggleLayer=this.getManipulation().data,this.toggleLayer(b))},initCrop:function(b){if(this.cropPhoto().jcrop){var c=this.getManipulation(),d=this.cropPhoto().released,e=this.cropPhoto().jcrop.tellSelect(),f=this.cropPhoto().ui.cropPhoto.find("img");this.cropPhoto().ui.cropPhoto.remove(),this.cropPhoto().destroyJcrop(),this.cropPhoto().ui.cropPhoto=a('<div class="'+this.buttonBar.factory.classes.cropPhoto+'"></div>'),this.buttonBar.factory.ui.crop.append(this.cropPhoto().ui.cropPhoto),this.cropPhoto().ui.cropPhoto.append(f),this.cropPhoto().initJcrop(),c.visible||this.cropPhoto().releaseCrop(),!c.data||d||b||(this.cropPhoto().releaseCrop(),this.cropPhoto().jcrop.setSelect([e.x,e.y,e.x2,e.y2])),this.buttonBar.factory.ui.crop.center(),this.buttonBar.factory.trigger("initCrop")}},refresh:function(a){var b=this.getCrop(a);this.isActive()||this.window.close(),b.x||b.y||b.x2||b.y2?(this.window.ui.x.val(b.x),this.window.ui.y.val(b.y),this.window.ui.x2.val(b.x2),this.window.ui.y2.val(b.y2)):this.reset()}})}(jQuery),function(a){PhotoFrame.Buttons.Layers=PhotoFrame.Button.extend({buttons:[],classes:{layer:"photo-frame-layer",layerIcon:"photo-frame-layer-icon",layerEmpty:"photo-frame-layer-empty",layerTitle:"photo-frame-layer-title",layerActions:"photo-frame-layer-actions",visible:"photo-frame-toggle-visible",toggleButton:"photo-frame-toggle-layer-button",trash:"photo-frame-trash"},description:!1,icon:"layers",icons:{eye:"eye",eyeClose:"eye-off",trash:"trash"},name:!1,windowSettings:{css:"photo-frame-layers",title:!1},constructor:function(b){var c=this;this.buttons=[{text:PhotoFrame.Lang.hide_all,css:this.classes.toggleButton,onclick:function(b){var d=a(b.target);d.html()==PhotoFrame.Lang.hide_all?(d.html(PhotoFrame.Lang.show_all),c.hideAll()):(d.html(PhotoFrame.Lang.hide_all),c.showAll()),b.preventDefault()}},{text:PhotoFrame.Lang.rerender,css:"photo-frame-tool-window-save",onclick:function(){c.cropPhoto()&&!c.cropPhoto().isRendering()&&(c.render(function(){c.buttonBar.factory.trigger("layerWindowReRender")}),c.refresh())}}],this.name=PhotoFrame.Lang.layers,this.description=PhotoFrame.Lang.layers_desc,this.windowSettings.title=PhotoFrame.Lang.layers,this.base(b)},totalHidden:function(){var b=0;return a.each(this.cropPhoto().getManipulations(),function(a,c){c.visible||b++}),b},allHidden:function(){return this.cropPhoto().totalManipulations()==this.totalHidden()?!0:!1},hideAll:function(){this.toggleLayers(!1)},showAll:function(){this.toggleLayers(!0)},toggleLayers:function(a){if(this.cropPhoto()&&!this.cropPhoto().isRendering()){var b=this.cropPhoto().getManipulations();for(var c in this.buttonBar.buttons){var d=this.buttonBar.buttons[c];b[d.getPackageName()]&&d.toggleLayer(a,!1)}}this.refresh(),this.render()},toggleDisplayButton:function(){this.allHidden()?this.window.buttons[0].ui.button.html(PhotoFrame.Lang.show_all):this.window.buttons[0].ui.button.html(PhotoFrame.Lang.hide_all)},buildWindow:function(){var b=this;this.base({buttons:this.buttons}),this.buttonBar.factory.bind("startCropEnd",function(){b.refresh(),b.toggleDisplayButton()}),this.buttonBar.factory.bind("removeManipulation",function(){b.refresh()}),this.buttonBar.factory.bind("showManipulation",function(){b.refresh()}),this.buttonBar.factory.bind("hideManipulation",function(){b.refresh()}),this.buttonBar.factory.bind("startRendering",function(){b.toggleDisplayButton()}),this.buttonBar.factory.bind("addManipulation",function(c,d,e){var f=a(b.window.ui.content).get(0);b.refresh(),e||"crop"==d||(f.scrollTop=f.scrollHeight)})},toggleLayer:function(a,b){b.visible=b.visible?!1:!0,this.buttonBar.factory.trigger(a+"ToggleLayer",b),this.refresh()},removeLayer:function(a,b){this.buttonBar.factory.trigger(a+"RemoveLayer",b),delete this.buttonBar.factory.cropPhoto.manipulations[a],this.refresh()},refresh:function(b){var c=0,d=this,e={},b=b?b:this.cropPhoto();this.window.ui.content.html("");for(var f in this.buttonBar.buttons){var g=this.buttonBar.buttons[f];e[g.getPackageName()]=g}if(a.each(b.manipulations,function(f,g){var g=b.manipulations[f],h=e[f];if(h){var i=h.getPackageName(),j=a('<a href="#" class="'+d.classes.visible+'"><i class="icon-'+(g.visible?d.icons.eye:d.icons.eyeClose)+'"></i></a>'),k=a('<a href="#" class="'+d.classes.trash+'"><i class="icon-'+d.icons.trash+'"></i></a>'),l=a(['<div class="'+d.classes.layer+" "+d.buttonBar.factory.classes.clearfix+'">','<div class="'+d.classes.layerIcon+'"><a href="#"><i class="icon-'+(h.icon?h.icon:i)+'"></i></a></div>','<div class="'+d.classes.layerTitle+'">'+h.window.title+"</div>",'<div class="'+d.classes.layerActions+'"></div>',"</div>"].join(""));
l.find("."+d.classes.layerActions).append(j),l.find("."+d.classes.layerActions).append(k),l.find("."+d.classes.layerIcon+" > a").click(function(a){h.window.toggle(),a.preventDefault()}),j.click(function(a){d.cropPhoto()&&!d.cropPhoto().isRendering()&&(d.toggleLayer(f,g,j),h.toggleLayer(g.visible),a.preventDefault())}),k.click(function(a){d.removeLayer(f,g,k),h.renderAfterRemovingLayer?d.render(function(){h.removeLayer()}):h.removeLayer(),a.preventDefault()}),d.window.ui.buttons.show(),d.window.ui.content.append(l),c++}}),!c){var h=a(['<div class="'+d.classes.layer+" "+d.buttonBar.factory.classes.clearfix+'">','<div class="'+d.classes.layerEmpty+'">'+PhotoFrame.Lang.no_layers+"</div>",'<div class="'+d.classes.layerActions+'"></div>',"</div>"].join(""));d.window.ui.buttons.hide(),d.window.ui.content.append(h)}},startCrop:function(){this.window.buttons[0].ui.button;this.refresh()}})}(jQuery),function(a){PhotoFrame.Buttons.Resize=PhotoFrame.Button.extend({buttons:[],description:"The resize the image.",name:"Resize",windowSettings:{title:"Resize"},constructor:function(a){var b=this;this.buttons=[{text:PhotoFrame.Lang.resize,css:"photo-frame-tool-window-save",onclick:function(){b.apply()}}],this.base(a)},getWidth:function(){return parseInt(this.window.ui.width.val())},getHeight:function(){return parseInt(this.window.ui.height.val())},getMaintainAspect:function(){return"checked"===this.window.ui.aspect.attr("checked")?!0:!1},reset:function(){this.cropPhoto()&&(this.window.ui.width.val(this.cropPhoto().width()),this.window.ui.height.val(this.cropPhoto().height()),this.window.ui.aspect.attr("checked",!0))},enable:function(){this.window.ui.width.attr("disabled",!1),this.window.ui.height.attr("disabled",!1),this.window.ui.aspect.attr("disabled",!1)},disable:function(){this.window.ui.width.attr("disabled",!0),this.window.ui.height.attr("disabled",!0),this.window.ui.aspect.attr("disabled",!0)},removeLayer:function(){this.reset(),this.buttonBar.factory.trigger("resizeRemoveLayer")},startCrop:function(){var a=this.getManipulation();a?(this.window.ui.width.val(a.data.width),this.window.ui.height.val(a.data.height),a.data.aspect===!0||"true"===a.data.aspect?this.window.ui.aspect.attr("checked",!0):this.window.ui.aspect.attr("checked",!1),this.base()):this.reset()},apply:function(){var a=this;this.addManipulation(!0,{aspect:this.getMaintainAspect(),width:this.getWidth(),height:this.getHeight()}),this.buttonBar.factory.trigger("resize",this,this.getWidth(),this.getHeight()),this.render(function(){a.buttonBar.factory.trigger("resizeRenderCallback",a,a.getWidth(),a.getHeight())})},initCrop:function(a){this.buttonBar.factory.trigger("resizeReInitCrop",this,a)},toggleLayer:function(a,b){this.base(a,b)},buildWindow:function(){this.base({buttons:this.buttons});var b=this,c=a(['<div class="photo-frame-inline photo-frame-margin-bottom">','<label for="photo-frame-width" class="photo-frame-small photo-frame-margin-right">'+PhotoFrame.Lang.width+"</label>",'<input type="text" name="photo-frame-width" value="" id="photo-frame-width" class="photo-frame-small" />',"</div>",'<div class="photo-frame-inline">','<label for="photo-frame-height" class="photo-frame-small photo-frame-margin-right">'+PhotoFrame.Lang.height+"</label>",'<input type="text" name="photo-frame-height" value="" id="photo-frame-height" class="photo-frame-small" />',"</div>",'<div class="photo-frame-margin-top">','<label><input type="checkbox" name="photo-frame-maintain-ratio" id="photo-frame-maintain-ratio" /> '+PhotoFrame.Lang.maintain_ratio+"</label>","</div>"].join(""));this.window.ui.content.html(c),this.window.ui.width=this.window.ui.content.find("#photo-frame-width"),this.window.ui.height=this.window.ui.content.find("#photo-frame-height"),this.window.ui.aspect=this.window.ui.content.find("#photo-frame-maintain-ratio"),this.window.ui.content.find("input").keypress(function(a){13==a.keyCode&&(b.apply(),a.preventDefault())}),this.buttonBar.factory.bind("render",function(){b.getManipulation()&&b.initCrop(),b.reset()}),this.window.ui.content.find('input[type="text"]').keyup(function(c){if(b.getMaintainAspect()&&b.cropPhoto()){var d,e,f=a(this).val(),g=a(c.target).attr("id");"photo-frame-height"==g?(d=b.cropPhoto().width()/b.cropPhoto().height(),e="#photo-frame-width",f*=d):(d=b.cropPhoto().height()/b.cropPhoto().width(),e="#photo-frame-height",f*=d),b.window.ui.content.find(e).val(b.cropPhoto().round(f,1))}})}})}(jQuery),function(a){PhotoFrame.Buttons.Rotate=PhotoFrame.Button.extend({buttons:[],description:!1,name:!1,windowSettings:{title:!1},constructor:function(a){var b=this;this.name=PhotoFrame.Lang.rotate,this.description=PhotoFrame.Lang.rotate_desc,this.windowSettings.title=PhotoFrame.Lang.rotate,this.buttons=[{text:PhotoFrame.Lang.rotate,css:"photo-frame-tool-window-save",onclick:function(){b.apply()}}],this.base(a)},apply:function(){var a=this;this.addManipulation(!0,{degree:this.getDegree()}),this.buttonBar.factory.trigger("rotate",this,this.getDegree()),this.render(function(){a.buttonBar.factory.trigger("rotateReInitCrop",a,a.getDegree())})},startCrop:function(){var a=this.getManipulation();a.data&&a.data.degree&&(this.window.ui.input.val(a.data.degree),this.base())},getDegree:function(){return parseInt(""==this.window.ui.input.val()?0:this.window.ui.input.val())},reset:function(){this.window.ui.input.val("")},toggleLayer:function(a,b){this.base(a,b)},enable:function(){this.window.ui.input.attr("disabled",!1)},disable:function(){this.window.ui.input.attr("disabled",!0)},buildWindow:function(){this.base({buttons:this.buttons}),this.window.ui.input=a('<input type="text" name="photo-frame-rotate" value="" id="photo-frame-rotate" class="photo-frame-small" />');var b=this,c=a(['<div class="photo-frame-inline">','<label for="photo-frame-rotate photo-frame-margin-right">'+PhotoFrame.Lang.degrees+"</label>","</div>"].join(""));c.append(this.window.ui.input),this.window.ui.content.html(c),this.window.ui.content.find("input").keypress(function(a){13==a.keyCode&&(b.apply(),a.preventDefault())}),this.bind("stopRendering",function(){b.buttonBar.factory.trigger("rotateReInitCrop",b,b.getDegree())})}})}(jQuery),function(a){function b(b,c){var d=document.createElementNS("http://www.w3.org/2000/svg",b||"svg");return c&&a.each(c,function(a,b){d.setAttributeNS(null,a,b)}),a(d)}a.fn.activity=function(b){return this.each(function(){var e=a(this),f=e.data("activity");if(f&&(clearInterval(f.data("interval")),f.remove(),e.removeData("activity")),b!==!1){b=a.extend({color:e.css("color")},a.fn.activity.defaults,b),f=c(e,b).css("position","absolute").prependTo(b.outside?"body":e);var g=e.outerHeight()-f.height(),h=e.outerWidth()-f.width(),i={top:"top"==b.valign?b.padding:"bottom"==b.valign?g-b.padding:Math.floor(g/2),left:"left"==b.align?b.padding:"right"==b.align?h-b.padding:Math.floor(h/2)},j=e.offset();b.outside?f.css({top:j.top+"px",left:j.left+"px"}):(i.top-=f.offset().top-j.top,i.left-=f.offset().left-j.left),f.css({marginTop:i.top+"px",marginLeft:i.left+"px"}),d(f,b.segments,Math.round(10/b.speed)/10),e.data("activity",f)}}),this},a.fn.activity.defaults={segments:12,space:3,length:7,width:4,speed:1.2,align:"center",valign:"center",padding:4},a.fn.activity.getOpacity=function(a,b){var c=a.steps||a.segments-1,d=void 0!==a.opacity?a.opacity:1/c;return 1-Math.min(b,c)*(1-d)/c};var c=function(){return a("<div>").addClass("busy")},d=function(){};if(document.createElementNS&&document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect)if(c=function(c,d){for(var e=2*d.width+d.space,f=e+d.length+Math.ceil(d.width/2)+1,g=b().width(2*f).height(2*f),h=b("g",{"stroke-width":d.width,"stroke-linecap":"round",stroke:d.color}).appendTo(b("g",{transform:"translate("+f+","+f+")"}).appendTo(g)),i=0;i<d.segments;i++)h.append(b("line",{x1:0,y1:e,x2:0,y2:e+d.length,transform:"rotate("+360/d.segments*i+", 0, 0)",opacity:a.fn.activity.getOpacity(d,i)}));return a("<div>").append(g).width(2*f).height(2*f)},void 0!==document.createElement("div").style.WebkitAnimationName){var e={};d=function(a,b,c){if(!e[b]){for(var d="spin"+b,f="@-webkit-keyframes "+d+" {",g=0;b>g;g++){var h=Math.round(1e5/b*g)/1e3,i=Math.round(1e5/b*(g+1)-1)/1e3,j="% { -webkit-transform:rotate("+Math.round(360/b*g)+"deg); }\n";f+=h+j+i+j}f+="100% { -webkit-transform:rotate(100deg); }\n}",document.styleSheets[0].insertRule(f,0),e[b]=d}a.css("-webkit-animation",e[b]+" "+c+"s linear infinite")}}else d=function(a,b,c){var d=0,e=a.find("g g").get(0);a.data("interval",setInterval(function(){e.setAttributeNS(null,"transform","rotate("+ ++d%b*(360/b)+")")},1e3*c/b))};else{var f=a("div").appendTo("body").html('<v:shape id="vml_flag1" adj="1" />');if(f=f.find(":first").css("behavior","url(#default#VML)"),f[0]?"object"==typeof f[0].adj:!0){var g=document.createStyleSheet();a.each(["group","shape","stroke"],function(){g.addRule(this,"behavior:url(#default#VML);")}),c=function(b,c){for(var d=2*c.width+c.space,e=d+c.length+Math.ceil(c.width/2)+1,f=2*e,g=-Math.ceil(f/2),h=a("<group>",{coordsize:f+" "+f,coordorigin:g+" "+g}).css({top:g,left:g,width:f,height:f}),i=0;i<c.segments;i++)h.append(a("<shape>",{path:"m "+d+",0  l "+(d+c.length)+",0"}).css({width:f,height:f,rotation:360/c.segments*i+"deg"}).append(a("<stroke>",{color:c.color,weight:c.width+"px",endcap:"round",opacity:a.fn.activity.getOpacity(c,i)})));return a("<group>",{coordsize:f+" "+f}).css({width:f,height:f,overflow:"hidden"}).append(h)},d=function(a,b,c){var d=0,e=a.get(0);a.data("interval",setInterval(function(){e.style.rotation=++d%b*(360/b)},1e3*c/b))}}a(f).parent().remove()}}(jQuery),function(a){function b(b){var c;return b&&b.constructor==Array&&3==b.length?b:(c=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(b))?[parseInt(c[1]),parseInt(c[2]),parseInt(c[3])]:(c=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(b))?[2.55*parseFloat(c[1]),2.55*parseFloat(c[2]),2.55*parseFloat(c[3])]:(c=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(b))?[parseInt(c[1],16),parseInt(c[2],16),parseInt(c[3],16)]:(c=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(b))?[parseInt(c[1]+c[1],16),parseInt(c[2]+c[2],16),parseInt(c[3]+c[3],16)]:d[a.trim(b).toLowerCase()]}function c(c,d){var e;do{if(e=a.curCSS(c,d),""!=e&&"transparent"!=e||a.nodeName(c,"body"))break;d="backgroundColor"}while(c=c.parentNode);return b(e)}a.each(["backgroundColor","borderBottomColor","borderLeftColor","borderRightColor","borderTopColor","color","outlineColor"],function(d,e){a.fx.step[e]=function(a){0==a.state&&(a.start=c(a.elem,e),a.end=b(a.end)),a.elem.style[e]="rgb("+[Math.max(Math.min(parseInt(a.pos*(a.end[0]-a.start[0])+a.start[0]),255),0),Math.max(Math.min(parseInt(a.pos*(a.end[1]-a.start[1])+a.start[1]),255),0),Math.max(Math.min(parseInt(a.pos*(a.end[2]-a.start[2])+a.start[2]),255),0)].join(",")+")"}});var d={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0]}}(jQuery),function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery","load-image","canvas-to-blob","./jquery.fileupload"],a):a(window.jQuery,window.loadImage)}(function(a,b){"use strict";a.widget("blueimpFP.fileupload",a.blueimp.fileupload,{options:{process:[],add:function(b,c){a(this).fileupload("process",c).done(function(){c.submit()})}},processActions:{load:function(c,d){var e=this,f=c.files[c.index],g=a.Deferred();return window.HTMLCanvasElement&&window.HTMLCanvasElement.prototype.toBlob&&("number"!==a.type(d.maxFileSize)||f.size<d.maxFileSize)&&(!d.fileTypes||d.fileTypes.test(f.type))?b(f,function(a){c.canvas=a,g.resolveWith(e,[c])},{canvas:!0}):g.rejectWith(e,[c]),g.promise()},resize:function(a,c){if(a.canvas){var d=b.scale(a.canvas,c);(d.width!==a.canvas.width||d.height!==a.canvas.height)&&(a.canvas=d,a.processed=!0)}return a},save:function(b){if(!b.canvas||!b.processed)return b;var c=this,d=b.files[b.index],e=d.name,f=a.Deferred(),g=function(a){a.name||(d.type===a.type?a.name=d.name:d.name&&(a.name=d.name.replace(/\..+$/,"."+a.type.substr(6)))),b.files[b.index]=a,f.resolveWith(c,[b])};return b.canvas.mozGetAsFile?g(b.canvas.mozGetAsFile(/^image\/(jpeg|png)$/.test(d.type)&&e||(e&&e.replace(/\..+$/,"")||"blob")+".png",d.type)):b.canvas.toBlob(g,d.type),f.promise()}},_processFile:function(b,c,d){var e=this,f=a.Deferred().resolveWith(e,[{files:b,index:c}]),g=f.promise();return e._processing+=1,a.each(d.process,function(a,b){g=g.pipe(function(a){return e.processActions[b.action].call(this,a,b)})}),g.always(function(){e._processing-=1,0===e._processing&&e.element.removeClass("fileupload-processing")}),1===e._processing&&e.element.addClass("fileupload-processing"),g},process:function(b){var c=this,d=a.extend({},this.options,b);return d.process&&d.process.length&&this._isXHRUpload(d)&&a.each(b.files,function(e){c._processingQueue=c._processingQueue.pipe(function(){var f=a.Deferred();return c._processFile(b.files,e,d).always(function(){f.resolveWith(c)}),f.promise()})}),this._processingQueue},_create:function(){a.blueimp.fileupload.prototype._create.call(this),this._processing=0,this._processingQueue=a.Deferred().resolveWith(this).promise()}})}),function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery","tmpl","load-image","./jquery.fileupload-fp"],a):a(window.jQuery,window.tmpl,window.loadImage)}(function(a,b,c){"use strict";var d=(a.blueimpFP||a.blueimp).fileupload;a.widget("blueimpUI.fileupload",d,{options:{autoUpload:!1,maxNumberOfFiles:void 0,maxFileSize:void 0,minFileSize:void 0,acceptFileTypes:/.+$/i,previewSourceFileTypes:/^image\/(gif|jpeg|png)$/,previewSourceMaxFileSize:5e6,previewMaxWidth:80,previewMaxHeight:80,previewAsCanvas:!0,uploadTemplateId:"template-upload",downloadTemplateId:"template-download",filesContainer:void 0,prependFiles:!1,dataType:"json",add:function(b,c){var d=a(this).data("fileupload"),e=d.options,f=c.files;a(this).fileupload("process",c).done(function(){d._adjustMaxNumberOfFiles(-f.length),c.maxNumberOfFilesAdjusted=!0,c.files.valid=c.isValidated=d._validate(f),c.context=d._renderUpload(f).data("data",c),e.filesContainer[e.prependFiles?"prepend":"append"](c.context),d._renderPreviews(f,c.context),d._forceReflow(c.context),d._transition(c.context).done(function(){d._trigger("added",b,c)!==!1&&(e.autoUpload||c.autoUpload)&&c.autoUpload!==!1&&c.isValidated&&c.submit()})})},send:function(b,c){var d=a(this).data("fileupload");return c.isValidated||(c.maxNumberOfFilesAdjusted||(d._adjustMaxNumberOfFiles(-c.files.length),c.maxNumberOfFilesAdjusted=!0),d._validate(c.files))?(c.context&&c.dataType&&"iframe"===c.dataType.substr(0,6)&&c.context.find(".progress").addClass(!a.support.transition&&"progress-animated").attr("aria-valuenow",100).find(".bar").css("width","100%"),d._trigger("sent",b,c)):!1},done:function(b,c){var d,e=a(this).data("fileupload");c.context?c.context.each(function(f){var g=a.isArray(c.result)&&c.result[f]||{error:"emptyResult"};g.error&&e._adjustMaxNumberOfFiles(1),e._transition(a(this)).done(function(){var f=a(this);d=e._renderDownload([g]).replaceAll(f),e._forceReflow(d),e._transition(d).done(function(){c.context=a(this),e._trigger("completed",b,c)})})}):(a.isArray(c.result)&&(a.each(c.result,function(a,b){c.maxNumberOfFilesAdjusted&&b.error?e._adjustMaxNumberOfFiles(1):c.maxNumberOfFilesAdjusted||b.error||e._adjustMaxNumberOfFiles(-1)}),c.maxNumberOfFilesAdjusted=!0),d=e._renderDownload(c.result).appendTo(e.options.filesContainer),e._forceReflow(d),e._transition(d).done(function(){c.context=a(this),e._trigger("completed",b,c)}))},fail:function(b,c){var d,e=a(this).data("fileupload");c.maxNumberOfFilesAdjusted&&e._adjustMaxNumberOfFiles(c.files.length),c.context?c.context.each(function(f){if("abort"!==c.errorThrown){var g=c.files[f];g.error=g.error||c.errorThrown||!0,e._transition(a(this)).done(function(){var f=a(this);d=e._renderDownload([g]).replaceAll(f),e._forceReflow(d),e._transition(d).done(function(){c.context=a(this),e._trigger("failed",b,c)})})}else e._transition(a(this)).done(function(){a(this).remove(),e._trigger("failed",b,c)})}):"abort"!==c.errorThrown?(c.context=e._renderUpload(c.files).appendTo(e.options.filesContainer).data("data",c),e._forceReflow(c.context),e._transition(c.context).done(function(){c.context=a(this),e._trigger("failed",b,c)})):e._trigger("failed",b,c)},progress:function(a,b){if(b.context){var c=parseInt(b.loaded/b.total*100,10);b.context.find(".progress").attr("aria-valuenow",c).find(".bar").css("width",c+"%")}},progressall:function(b,c){var d=a(this),e=parseInt(c.loaded/c.total*100,10),f=d.find(".fileupload-progress"),g=f.find(".progress-extended");g.length&&g.html(d.data("fileupload")._renderExtendedProgress(c)),f.find(".progress").attr("aria-valuenow",e).find(".bar").css("width",e+"%")},start:function(b){var c=a(this).data("fileupload");c._transition(a(this).find(".fileupload-progress")).done(function(){c._trigger("started",b)})},stop:function(b){var c=a(this).data("fileupload");c._transition(a(this).find(".fileupload-progress")).done(function(){a(this).find(".progress").attr("aria-valuenow","0").find(".bar").css("width","0%"),a(this).find(".progress-extended").html("&nbsp;"),c._trigger("stopped",b)})},destroy:function(b,c){var d=a(this).data("fileupload");c.url&&(a.ajax(c),d._adjustMaxNumberOfFiles(1)),d._transition(c.context).done(function(){a(this).remove(),d._trigger("destroyed",b,c)})}},_enableDragToDesktop:function(){var b=a(this),c=b.prop("href"),d=b.prop("download"),e="application/octet-stream";b.bind("dragstart",function(a){try{a.originalEvent.dataTransfer.setData("DownloadURL",[e,d,c].join(":"))}catch(b){}})},_adjustMaxNumberOfFiles:function(a){"number"==typeof this.options.maxNumberOfFiles&&(this.options.maxNumberOfFiles+=a,this.options.maxNumberOfFiles<1?this._disableFileInputButton():this._enableFileInputButton())},_formatFileSize:function(a){return"number"!=typeof a?"":a>=1e9?(a/1e9).toFixed(2)+" GB":a>=1e6?(a/1e6).toFixed(2)+" MB":(a/1e3).toFixed(2)+" KB"},_formatBitrate:function(a){return"number"!=typeof a?"":a>=1e9?(a/1e9).toFixed(2)+" Gbit/s":a>=1e6?(a/1e6).toFixed(2)+" Mbit/s":a>=1e3?(a/1e3).toFixed(2)+" kbit/s":a+" bit/s"},_formatTime:function(a){var b=new Date(1e3*a),c=parseInt(a/86400,10);return c=c?c+"d ":"",c+("0"+b.getUTCHours()).slice(-2)+":"+("0"+b.getUTCMinutes()).slice(-2)+":"+("0"+b.getUTCSeconds()).slice(-2)},_formatPercentage:function(a){return(100*a).toFixed(2)+" %"},_renderExtendedProgress:function(a){return this._formatBitrate(a.bitrate)+" | "+this._formatTime(8*(a.total-a.loaded)/a.bitrate)+" | "+this._formatPercentage(a.loaded/a.total)+" | "+this._formatFileSize(a.loaded)+" / "+this._formatFileSize(a.total)},_hasError:function(a){return a.error?a.error:this.options.maxNumberOfFiles<0?"maxNumberOfFiles":this.options.acceptFileTypes.test(a.type)||this.options.acceptFileTypes.test(a.name)?this.options.maxFileSize&&a.size>this.options.maxFileSize?"maxFileSize":"number"==typeof a.size&&a.size<this.options.minFileSize?"minFileSize":null:"acceptFileTypes"},_validate:function(b){var c=this,d=!!b.length;return a.each(b,function(a,b){b.error=c._hasError(b),b.error&&(d=!1)}),d},_renderTemplate:function(b,c){if(!b)return a();var d=b({files:c,formatFileSize:this._formatFileSize,options:this.options});return d instanceof a?d:a(this.options.templatesContainer).html(d).children()},_renderPreview:function(b,d){var e=this,f=this.options,g=a.Deferred();return(c&&c(b,function(b){d.append(b),e._forceReflow(d),e._transition(d).done(function(){g.resolveWith(d)}),a.contains(document.body,d[0])||g.resolveWith(d)},{maxWidth:f.previewMaxWidth,maxHeight:f.previewMaxHeight,canvas:f.previewAsCanvas})||g.resolveWith(d))&&g},_renderPreviews:function(b,c){var d=this,e=this.options;return c.find(".preview span").each(function(c,f){var g=b[c];e.previewSourceFileTypes.test(g.type)&&("number"!==a.type(e.previewSourceMaxFileSize)||g.size<e.previewSourceMaxFileSize)&&(d._processingQueue=d._processingQueue.pipe(function(){var b=a.Deferred();return d._renderPreview(g,a(f)).done(function(){b.resolveWith(d)}),b.promise()}))}),this._processingQueue},_renderUpload:function(a){return this._renderTemplate(this.options.uploadTemplate,a)},_renderDownload:function(a){return this._renderTemplate(this.options.downloadTemplate,a).find("a[download]").each(this._enableDragToDesktop).end()},_startHandler:function(b){b.preventDefault();var c=a(this),d=c.closest(".template-upload"),e=d.data("data");e&&e.submit&&!e.jqXHR&&e.submit()&&c.prop("disabled",!0)},_cancelHandler:function(b){b.preventDefault();var c=a(this).closest(".template-upload"),d=c.data("data")||{};d.jqXHR?d.jqXHR.abort():(d.errorThrown="abort",b.data.fileupload._trigger("fail",b,d))},_deleteHandler:function(b){b.preventDefault();var c=a(this);b.data.fileupload._trigger("destroy",b,{context:c.closest(".template-download"),url:c.attr("data-url"),type:c.attr("data-type")||"DELETE",dataType:b.data.fileupload.options.dataType})},_forceReflow:function(b){return a.support.transition&&b.length&&b[0].offsetWidth},_transition:function(b){var c=a.Deferred();return a.support.transition&&b.hasClass("fade")?b.bind(a.support.transition.end,function(d){d.target===b[0]&&(b.unbind(a.support.transition.end),c.resolveWith(b))}).toggleClass("in"):(b.toggleClass("in"),c.resolveWith(b)),c},_initButtonBarEventHandlers:function(){var b=this.element.find(".fileupload-buttonbar"),c=this.options.filesContainer,d=this.options.namespace;b.find(".start").bind("click."+d,function(a){a.preventDefault(),c.find(".start button").click()}),b.find(".cancel").bind("click."+d,function(a){a.preventDefault(),c.find(".cancel button").click()}),b.find(".delete").bind("click."+d,function(a){a.preventDefault(),c.find(".delete input:checked").siblings("button").click(),b.find(".toggle").prop("checked",!1)}),b.find(".toggle").bind("change."+d,function(){c.find(".delete input").prop("checked",a(this).is(":checked"))})},_destroyButtonBarEventHandlers:function(){this.element.find(".fileupload-buttonbar button").unbind("click."+this.options.namespace),this.element.find(".fileupload-buttonbar .toggle").unbind("change."+this.options.namespace)},_initEventHandlers:function(){d.prototype._initEventHandlers.call(this);var a={fileupload:this};this.options.filesContainer.delegate(".start button","click."+this.options.namespace,a,this._startHandler).delegate(".cancel button","click."+this.options.namespace,a,this._cancelHandler).delegate(".delete button","click."+this.options.namespace,a,this._deleteHandler),this._initButtonBarEventHandlers()},_destroyEventHandlers:function(){var a=this.options;this._destroyButtonBarEventHandlers(),a.filesContainer.undelegate(".start button","click."+a.namespace).undelegate(".cancel button","click."+a.namespace).undelegate(".delete button","click."+a.namespace),d.prototype._destroyEventHandlers.call(this)},_enableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",!1).parent().removeClass("disabled")},_disableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",!0).parent().addClass("disabled")},_initTemplates:function(){var a=this.options;a.templatesContainer=document.createElement(a.filesContainer.prop("nodeName")),b&&(a.uploadTemplateId&&(a.uploadTemplate=b(a.uploadTemplateId)),a.downloadTemplateId&&(a.downloadTemplate=b(a.downloadTemplateId)))},_initFilesContainer:function(){var b=this.options;void 0===b.filesContainer?b.filesContainer=this.element.find(".files"):b.filesContainer instanceof a||(b.filesContainer=a(b.filesContainer))},_stringToRegExp:function(a){var b=a.split("/"),c=b.pop();return b.shift(),new RegExp(b.join("/"),c)},_initRegExpOptions:function(){var b=this.options;"string"===a.type(b.acceptFileTypes)&&(b.acceptFileTypes=this._stringToRegExp(b.acceptFileTypes)),"string"===a.type(b.previewSourceFileTypes)&&(b.previewSourceFileTypes=this._stringToRegExp(b.previewSourceFileTypes))},_initSpecialOptions:function(){d.prototype._initSpecialOptions.call(this),this._initFilesContainer(),this._initTemplates(),this._initRegExpOptions()},_create:function(){d.prototype._create.call(this),this._refreshOptionsList.push("filesContainer","uploadTemplateId","downloadTemplateId"),a.blueimpFP||(this._processingQueue=a.Deferred().resolveWith(this).promise(),this.process=function(){return this._processingQueue})},enable:function(){var a=!1;this.options.disabled&&(a=!0),d.prototype.enable.call(this),a&&(this.element.find("input, button").prop("disabled",!1),this._enableFileInputButton())},disable:function(){this.options.disabled||(this.element.find("input, button").prop("disabled",!0),this._disableFileInputButton()),d.prototype.disable.call(this)}})}),function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):a(window.jQuery)}(function(a){"use strict";a.support.xhrFileUpload=!(!window.XMLHttpRequestUpload||!window.FileReader),a.support.xhrFormDataFileUpload=!!window.FormData,a.widget("blueimp.fileupload",{options:{namespace:void 0,dropZone:a(document),pasteZone:a(document),fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,formData:function(a){return a.serializeArray()},add:function(a,b){b.submit()},processData:!1,contentType:!1,cache:!1},_refreshOptionsList:["namespace","fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_BitrateTimer:function(){this.timestamp=+new Date,this.loaded=0,this.bitrate=0,this.getBitrate=function(a,b,c){var d=a-this.timestamp;return(!this.bitrate||!c||d>c)&&(this.bitrate=(b-this.loaded)*(1e3/d)*8,this.loaded=b,this.timestamp=a),this.bitrate}},_isXHRUpload:function(b){return!b.forceIframeTransport&&(!b.multipart&&a.support.xhrFileUpload||a.support.xhrFormDataFileUpload)},_getFormData:function(b){var c;return"function"==typeof b.formData?b.formData(b.form):a.isArray(b.formData)?b.formData:b.formData?(c=[],a.each(b.formData,function(a,b){c.push({name:a,value:b})}),c):[]},_getTotal:function(b){var c=0;return a.each(b,function(a,b){c+=b.size||1}),c},_onProgress:function(a,b){if(a.lengthComputable){var c,d,e=+new Date;if(b._time&&b.progressInterval&&e-b._time<b.progressInterval&&a.loaded!==a.total)return;b._time=e,c=b.total||this._getTotal(b.files),d=parseInt(a.loaded/a.total*(b.chunkSize||c),10)+(b.uploadedBytes||0),this._loaded+=d-(b.loaded||b.uploadedBytes||0),b.lengthComputable=!0,b.loaded=d,b.total=c,b.bitrate=b._bitrateTimer.getBitrate(e,d,b.bitrateInterval),this._trigger("progress",a,b),this._trigger("progressall",a,{lengthComputable:!0,loaded:this._loaded,total:this._total,bitrate:this._bitrateTimer.getBitrate(e,this._loaded,b.bitrateInterval)})}},_initProgressListener:function(b){var c=this,d=b.xhr?b.xhr():a.ajaxSettings.xhr();d.upload&&(a(d.upload).bind("progress",function(a){var d=a.originalEvent;a.lengthComputable=d.lengthComputable,a.loaded=d.loaded,a.total=d.total,c._onProgress(a,b)}),b.xhr=function(){return d})},_initXHRData:function(b){var c,d=b.files[0],e=b.multipart||!a.support.xhrFileUpload,f=b.paramName[0];(!e||b.blob)&&(b.headers=a.extend(b.headers,{"X-File-Name":d.name,"X-File-Type":d.type,"X-File-Size":d.size}),b.blob?e||(b.contentType="application/octet-stream",b.data=b.blob):(b.contentType=d.type,b.data=d)),e&&a.support.xhrFormDataFileUpload&&(b.postMessage?(c=this._getFormData(b),b.blob?c.push({name:f,value:b.blob}):a.each(b.files,function(a,d){c.push({name:b.paramName[a]||f,value:d})})):(b.formData instanceof FormData?c=b.formData:(c=new FormData,a.each(this._getFormData(b),function(a,b){c.append(b.name,b.value)})),b.blob?c.append(f,b.blob,d.name):a.each(b.files,function(a,d){d instanceof Blob&&c.append(b.paramName[a]||f,d,d.name)})),b.data=c),b.blob=null},_initIframeSettings:function(b){b.dataType="iframe "+(b.dataType||""),b.formData=this._getFormData(b),b.redirect&&a("<a></a>").prop("href",b.url).prop("host")!==location.host&&b.formData.push({name:b.redirectParamName||"redirect",value:b.redirect})},_initDataSettings:function(a){this._isXHRUpload(a)?(this._chunkedUpload(a,!0)||(a.data||this._initXHRData(a),this._initProgressListener(a)),a.postMessage&&(a.dataType="postmessage "+(a.dataType||""))):this._initIframeSettings(a,"iframe")},_getParamName:function(b){var c=a(b.fileInput),d=b.paramName;return d?a.isArray(d)||(d=[d]):(d=[],c.each(function(){for(var b=a(this),c=b.prop("name")||"files[]",e=(b.prop("files")||[1]).length;e;)d.push(c),e-=1}),d.length||(d=[c.prop("name")||"files[]"])),d},_initFormSettings:function(b){b.form&&b.form.length||(b.form=a(b.fileInput.prop("form")),b.form.length||(b.form=a(this.options.fileInput.prop("form")))),b.paramName=this._getParamName(b),b.url||(b.url=b.form.prop("action")||location.href),b.type=(b.type||b.form.prop("method")||"").toUpperCase(),"POST"!==b.type&&"PUT"!==b.type&&(b.type="POST"),b.formAcceptCharset||(b.formAcceptCharset=b.form.attr("accept-charset"))},_getAJAXSettings:function(b){var c=a.extend({},this.options,b);return this._initFormSettings(c),this._initDataSettings(c),c},_enhancePromise:function(a){return a.success=a.done,a.error=a.fail,a.complete=a.always,a},_getXHRPromise:function(b,c,d){var e=a.Deferred(),f=e.promise();return c=c||this.options.context||f,b===!0?e.resolveWith(c,d):b===!1&&e.rejectWith(c,d),f.abort=e.promise,this._enhancePromise(f)},_chunkedUpload:function(b,c){var d,e,f,g,h=this,i=b.files[0],j=i.size,k=b.uploadedBytes=b.uploadedBytes||0,l=b.maxChunkSize||j,m=i.webkitSlice||i.mozSlice||i.slice;return this._isXHRUpload(b)&&m&&(k||j>l)&&!b.data?c?!0:k>=j?(i.error="uploadedBytes",this._getXHRPromise(!1,b.context,[null,"error",i.error])):(e=Math.ceil((j-k)/l),d=function(c){return c?d(c-=1).pipe(function(){var d=a.extend({},b);return d.blob=m.call(i,k+c*l,k+(c+1)*l),d.chunkIndex=c,d.chunksNumber=e,d.chunkSize=d.blob.size,h._initXHRData(d),h._initProgressListener(d),f=(a.ajax(d)||h._getXHRPromise(!1,d.context)).done(function(){d.loaded||h._onProgress(a.Event("progress",{lengthComputable:!0,loaded:d.chunkSize,total:d.chunkSize}),d),b.uploadedBytes=d.uploadedBytes+=d.chunkSize})}):h._getXHRPromise(!0,b.context)},g=d(e),g.abort=function(){return f.abort()},this._enhancePromise(g)):!1},_beforeSend:function(a,b){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer),this._active+=1,this._loaded+=b.uploadedBytes||0,this._total+=this._getTotal(b.files)},_onDone:function(b,c,d,e){this._isXHRUpload(e)||this._onProgress(a.Event("progress",{lengthComputable:!0,loaded:1,total:1}),e),e.result=b,e.textStatus=c,e.jqXHR=d,this._trigger("done",null,e)},_onFail:function(a,b,c,d){d.jqXHR=a,d.textStatus=b,d.errorThrown=c,this._trigger("fail",null,d),d.recalculateProgress&&(this._loaded-=d.loaded||d.uploadedBytes||0,this._total-=d.total||this._getTotal(d.files))},_onAlways:function(a,b,c,d){this._active-=1,d.textStatus=b,c&&c.always?(d.jqXHR=c,d.result=a):(d.jqXHR=a,d.errorThrown=c),this._trigger("always",null,d),0===this._active&&(this._trigger("stop"),this._loaded=this._total=0,this._bitrateTimer=null)
},_onSend:function(b,c){var d,e,f,g=this,h=g._getAJAXSettings(c),i=function(c,e){return g._sending+=1,h._bitrateTimer=new g._BitrateTimer,d=d||(c!==!1&&g._trigger("send",b,h)!==!1&&(g._chunkedUpload(h)||a.ajax(h))||g._getXHRPromise(!1,h.context,e)).done(function(a,b,c){g._onDone(a,b,c,h)}).fail(function(a,b,c){g._onFail(a,b,c,h)}).always(function(a,b,c){if(g._sending-=1,g._onAlways(a,b,c,h),h.limitConcurrentUploads&&h.limitConcurrentUploads>g._sending)for(var d,e=g._slots.shift();e;){if(d=e.state?"pending"===e.state():!e.isRejected()){e.resolve();break}e=g._slots.shift()}})};return this._beforeSend(b,h),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(e=a.Deferred(),this._slots.push(e),f=e.pipe(i)):f=this._sequence=this._sequence.pipe(i,i),f.abort=function(){var a=[void 0,"abort","abort"];return d?d.abort():(e&&e.rejectWith(f,a),i(!1,a))},this._enhancePromise(f)):i()},_onAdd:function(b,c){var d,e,f,g,h=this,i=!0,j=a.extend({},this.options,c),k=j.limitMultiFileUploads,l=this._getParamName(j);if((j.singleFileUploads||k)&&this._isXHRUpload(j))if(!j.singleFileUploads&&k)for(f=[],d=[],g=0;g<c.files.length;g+=k)f.push(c.files.slice(g,g+k)),e=l.slice(g,g+k),e.length||(e=l),d.push(e);else d=l;else f=[c.files],d=[l];return c.originalFiles=c.files,a.each(f||c.files,function(e,g){var j=a.extend({},c);return j.files=f?g:[g],j.paramName=d[e],j.submit=function(){return j.jqXHR=this.jqXHR=h._trigger("submit",b,this)!==!1&&h._onSend(b,this),this.jqXHR},i=h._trigger("add",b,j)}),i},_replaceFileInput:function(b){var c=b.clone(!0);a("<form></form>").append(c)[0].reset(),b.after(c).detach(),a.cleanData(b.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(a,d){return d===b[0]?c[0]:d}),b[0]===this.element[0]&&(this.element=c)},_handleFileTreeEntry:function(b,c){var d,e=this,f=a.Deferred(),g=function(){f.reject()};return c=c||"",b.isFile?b.file(function(a){a.relativePath=c,f.resolve(a)},g):b.isDirectory?(d=b.createReader(),d.readEntries(function(a){e._handleFileTreeEntries(a,c+b.name+"/").done(function(a){f.resolve(a)}).fail(g)},g)):g(),f.promise()},_handleFileTreeEntries:function(b,c){var d=this;return a.when.apply(a,a.map(b,function(a){return d._handleFileTreeEntry(a,c)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(b){b=b||{};var c=b.items;return c&&c.length&&(c[0].webkitGetAsEntry||c[0].getAsEntry)?this._handleFileTreeEntries(a.map(c,function(a){return a.webkitGetAsEntry?a.webkitGetAsEntry():a.getAsEntry()})):a.Deferred().resolve(a.makeArray(b.files)).promise()},_getSingleFileInputFiles:function(b){b=a(b);var c,d,e=b.prop("webkitEntries")||b.prop("entries");if(e&&e.length)return this._handleFileTreeEntries(e);if(c=a.makeArray(b.prop("files")),!c.length){if(d=b.prop("value"),!d)return a.Deferred().resolve([]).promise();c=[{name:d.replace(/^.*\\/,"")}]}return a.Deferred().resolve(c).promise()},_getFileInputFiles:function(b){return b instanceof a&&1!==b.length?a.when.apply(a,a.map(b,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(b)},_onChange:function(b){var c=b.data.fileupload,d={fileInput:a(b.target),form:a(b.target.form)};c._getFileInputFiles(d.fileInput).always(function(a){d.files=a,c.options.replaceFileInput&&c._replaceFileInput(d.fileInput),c._trigger("change",b,d)!==!1&&c._onAdd(b,d)})},_onPaste:function(b){var c=b.data.fileupload,d=b.originalEvent.clipboardData,e=d&&d.items||[],f={files:[]};return a.each(e,function(a,b){var c=b.getAsFile&&b.getAsFile();c&&f.files.push(c)}),c._trigger("paste",b,f)===!1||c._onAdd(b,f)===!1?!1:void 0},_onDrop:function(a){a.preventDefault();var b=a.data.fileupload,c=a.dataTransfer=a.originalEvent.dataTransfer,d={};b._getDroppedFiles(c).always(function(c){d.files=c,b._trigger("drop",a,d)!==!1&&b._onAdd(a,d)})},_onDragOver:function(a){var b=a.data.fileupload,c=a.dataTransfer=a.originalEvent.dataTransfer;return b._trigger("dragover",a)===!1?!1:(c&&(c.dropEffect="copy"),a.preventDefault(),void 0)},_initEventHandlers:function(){var a=this.options.namespace;this._isXHRUpload(this.options)&&(this.options.dropZone.bind("dragover."+a,{fileupload:this},this._onDragOver).bind("drop."+a,{fileupload:this},this._onDrop),this.options.pasteZone.bind("paste."+a,{fileupload:this},this._onPaste)),this.options.fileInput.bind("change."+a,{fileupload:this},this._onChange)},_destroyEventHandlers:function(){var a=this.options.namespace;this.options.dropZone.unbind("dragover."+a,this._onDragOver).unbind("drop."+a,this._onDrop),this.options.pasteZone.unbind("paste."+a,this._onPaste),this.options.fileInput.unbind("change."+a,this._onChange)},_setOption:function(b,c){var d=-1!==a.inArray(b,this._refreshOptionsList);d&&this._destroyEventHandlers(),a.Widget.prototype._setOption.call(this,b,c),d&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var b=this.options;void 0===b.fileInput?b.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):b.fileInput instanceof a||(b.fileInput=a(b.fileInput)),b.dropZone instanceof a||(b.dropZone=a(b.dropZone)),b.pasteZone instanceof a||(b.pasteZone=a(b.pasteZone))},_create:function(){var b=this.options;a.extend(b,a(this.element[0].cloneNode(!1)).data()),b.namespace=b.namespace||this.widgetName,this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=this._loaded=this._total=0,this._initEventHandlers()},destroy:function(){this._destroyEventHandlers(),a.Widget.prototype.destroy.call(this)},enable:function(){var b=!1;this.options.disabled&&(b=!0),a.Widget.prototype.enable.call(this),b&&this._initEventHandlers()},disable:function(){this.options.disabled||this._destroyEventHandlers(),a.Widget.prototype.disable.call(this)},add:function(b){var c=this;b&&!this.options.disabled&&(b.fileInput&&!b.files?this._getFileInputFiles(b.fileInput).always(function(a){b.files=a,c._onAdd(null,b)}):(b.files=a.makeArray(b.files),this._onAdd(null,b)))},send:function(b){if(b&&!this.options.disabled){if(b.fileInput&&!b.files){var c,d,e=this,f=a.Deferred(),g=f.promise();return g.abort=function(){return d=!0,c?c.abort():(f.reject(null,"abort","abort"),g)},this._getFileInputFiles(b.fileInput).always(function(a){d||(b.files=a,c=e._onSend(null,b).then(function(a,b,c){f.resolve(a,b,c)},function(a,b,c){f.reject(a,b,c)}))}),this._enhancePromise(g)}if(b.files=a.makeArray(b.files),b.files.length)return this._onSend(null,b)}return this._getXHRPromise(!1,b&&b.context)}})}),function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):a(window.jQuery)}(function(a){"use strict";var b=0;a.ajaxTransport("iframe",function(c){if(c.async&&("POST"===c.type||"GET"===c.type)){var d,e;return{send:function(f,g){d=a('<form style="display:none;"></form>'),d.attr("accept-charset",c.formAcceptCharset),e=a('<iframe src="javascript:false;" name="iframe-transport-'+(b+=1)+'"></iframe>').bind("load",function(){var b,f=a.isArray(c.paramName)?c.paramName:[c.paramName];e.unbind("load").bind("load",function(){var b;try{if(b=e.contents(),!b.length||!b[0].firstChild)throw new Error}catch(c){b=void 0}g(200,"success",{iframe:b}),a('<iframe src="javascript:false;"></iframe>').appendTo(d),d.remove()}),d.prop("target",e.prop("name")).prop("action",c.url).prop("method",c.type),c.formData&&a.each(c.formData,function(b,c){a('<input type="hidden"/>').prop("name",c.name).val(c.value).appendTo(d)}),c.fileInput&&c.fileInput.length&&"POST"===c.type&&(b=c.fileInput.clone(),c.fileInput.after(function(a){return b[a]}),c.paramName&&c.fileInput.each(function(b){a(this).prop("name",f[b]||c.paramName)}),d.append(c.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data")),d.submit(),b&&b.length&&c.fileInput.each(function(c,d){var e=a(b[c]);a(d).prop("name",e.prop("name")),e.replaceWith(d)})}),d.append(e).appendTo(document.body)},abort:function(){e&&e.unbind("load").prop("src","javascript".concat(":false;")),d&&d.remove()}}}}),a.ajaxSetup({converters:{"iframe text":function(b){return a(b[0].body).text()},"iframe json":function(b){return a.parseJSON(a(b[0].body).text())},"iframe html":function(b){return a(b[0].body).html()},"iframe script":function(b){return a.globalEval(a(b[0].body).text())}}})}),function(a){a.Jcrop=function(b,c){function d(a){return Math.round(a)+"px"}function e(a){return J.baseClass+"-"+a}function f(){return a.fx.step.hasOwnProperty("backgroundColor")}function g(b){var c=a(b).offset();return[c.left,c.top]}function h(a){return[a.pageX-I[0],a.pageY-I[1]]}function i(b){"object"!=typeof b&&(b={}),J=a.extend(J,b),a.each(["onChange","onSelect","onRelease","onDblClick"],function(a,b){"function"!=typeof J[b]&&(J[b]=function(){})})}function j(a,b,c){if(I=g(R),ob.setCursor("move"===a?a:a+"-resize"),"move"===a)return ob.activateHandlers(l(b),q,c);var d=lb.getFixed(),e=m(a),f=lb.getCorner(m(e));lb.setPressed(lb.getCorner(e)),lb.setCurrent(f),ob.activateHandlers(k(a,d),q,c)}function k(a,b){return function(c){if(J.aspectRatio)switch(a){case"e":c[1]=b.y+1;break;case"w":c[1]=b.y+1;break;case"n":c[0]=b.x+1;break;case"s":c[0]=b.x+1}else switch(a){case"e":c[1]=b.y2;break;case"w":c[1]=b.y2;break;case"n":c[0]=b.x2;break;case"s":c[0]=b.x2}lb.setCurrent(c),nb.update()}}function l(a){var b=a;return pb.watchKeys(),function(a){lb.moveOffset([a[0]-b[0],a[1]-b[1]]),b=a,nb.update()}}function m(a){switch(a){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function n(a){return function(b){return J.disabled?!1:"move"!==a||J.allowMove?(I=g(R),db=!0,j(a,h(b)),b.stopPropagation(),b.preventDefault(),!1):!1}}function o(a,b,c){var d=a.width(),e=a.height();d>b&&b>0&&(d=b,e=b/a.width()*a.height()),e>c&&c>0&&(e=c,d=c/a.height()*a.width()),bb=a.width()/d,cb=a.height()/e,a.width(d).height(e)}function p(a){return{x:a.x*bb,y:a.y*cb,x2:a.x2*bb,y2:a.y2*cb,w:a.w*bb,h:a.h*cb}}function q(){var a=lb.getFixed();a.w>J.minSelect[0]&&a.h>J.minSelect[1]?(nb.enableHandles(),nb.done()):nb.release(),ob.setCursor(J.allowSelect?"crosshair":"default")}function r(a){if(J.disabled)return!1;if(!J.allowSelect)return!1;db=!0,I=g(R),nb.disableHandles(),ob.setCursor("crosshair");var b=h(a);return lb.setPressed(b),nb.update(),ob.activateHandlers(s,q,"touch"===a.type.substring(0,5)),pb.watchKeys(),a.stopPropagation(),a.preventDefault(),!1}function s(a){lb.setCurrent(a),nb.update()}function t(){var b=a("<div></div>").addClass(e("tracker"));return L&&b.css({opacity:0,backgroundColor:"white"}),b}function u(a){U.removeClass().addClass(e("holder")).addClass(a)}function v(a,b){function c(){window.setTimeout(s,l)}var d=a[0]/bb,e=a[1]/cb,f=a[2]/bb,g=a[3]/cb;if(!eb){var h=lb.flipCoords(d,e,f,g),i=lb.getFixed(),j=[i.x,i.y,i.x2,i.y2],k=j,l=J.animationDelay,m=h[0]-j[0],n=h[1]-j[1],o=h[2]-j[2],p=h[3]-j[3],q=0,r=J.swingSpeed;d=k[0],e=k[1],f=k[2],g=k[3],nb.animMode(!0);var s=function(){return function(){q+=(100-q)/r,k[0]=Math.round(d+q/100*m),k[1]=Math.round(e+q/100*n),k[2]=Math.round(f+q/100*o),k[3]=Math.round(g+q/100*p),q>=99.8&&(q=100),100>q?(x(k),c()):(nb.done(),nb.animMode(!1),"function"==typeof b&&b.call(qb))}}();c()}}function w(a){x([a[0]/bb,a[1]/cb,a[2]/bb,a[3]/cb]),J.onSelect.call(qb,p(lb.getFixed())),nb.enableHandles()}function x(a){lb.setPressed([a[0],a[1]]),lb.setCurrent([a[2],a[3]]),nb.update()}function y(){return p(lb.getFixed())}function z(){return lb.getFixed()}function A(a){i(a),H()}function B(){J.disabled=!0,nb.disableHandles(),nb.setCursor("default"),ob.setCursor("default")}function C(){J.disabled=!1,H()}function D(){nb.done(),ob.activateHandlers(null,null)}function E(){U.remove(),O.show(),O.css("visibility","visible"),a(b).removeData("Jcrop")}function F(a,b){nb.release(),B();var c=new Image;c.onload=function(){var d=c.width,e=c.height,f=J.boxWidth,g=J.boxHeight;R.width(d).height(e),R.attr("src",a),V.attr("src",a),o(R,f,g),S=R.width(),T=R.height(),V.width(S).height(T),hb.width(S+2*gb).height(T+2*gb),U.width(S).height(T),mb.resize(S,T),C(),"function"==typeof b&&b.call(qb)},c.src=a}function G(a,b,c){var d=b||J.bgColor;J.bgFade&&f()&&J.fadeTime&&!c?a.animate({backgroundColor:d},{queue:!1,duration:J.fadeTime}):a.css("backgroundColor",d)}function H(a){J.allowResize?a?nb.enableOnly():nb.enableHandles():nb.disableHandles(),ob.setCursor(J.allowSelect?"crosshair":"default"),nb.setCursor(J.allowMove?"move":"default"),J.hasOwnProperty("trueSize")&&(bb=J.trueSize[0]/S,cb=J.trueSize[1]/T),J.hasOwnProperty("setSelect")&&(w(J.setSelect),nb.done(),delete J.setSelect),mb.refresh(),J.bgColor!=ib&&(G(J.shade?mb.getShades():U,J.shade?J.shadeColor||J.bgColor:J.bgColor),ib=J.bgColor),jb!=J.bgOpacity&&(jb=J.bgOpacity,J.shade?mb.refresh():nb.setBgOpacity(jb)),Z=J.maxSize[0]||0,$=J.maxSize[1]||0,_=J.minSize[0]||0,ab=J.minSize[1]||0,J.hasOwnProperty("outerImage")&&(R.attr("src",J.outerImage),delete J.outerImage),nb.refresh()}var I,J=a.extend({},a.Jcrop.defaults),K=navigator.userAgent.toLowerCase(),L=/msie/.test(K),M=/msie [1-6]\./.test(K);"object"!=typeof b&&(b=a(b)[0]),"object"!=typeof c&&(c={}),i(c);var N={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},O=a(b),P=!0;if("IMG"==b.tagName){if(0!=O[0].width&&0!=O[0].height)O.width(O[0].width),O.height(O[0].height);else{var Q=new Image;Q.src=O[0].src,O.width(Q.width),O.height(Q.height)}var R=O.clone().removeAttr("id").css(N).show();R.width(O.width()),R.height(O.height()),O.after(R).hide()}else R=O.css(N).show(),P=!1,null===J.shade&&(J.shade=!0);o(R,J.boxWidth,J.boxHeight);var S=R.width(),T=R.height(),U=a("<div />").width(S).height(T).addClass(e("holder")).css({position:"relative",backgroundColor:J.bgColor}).insertAfter(O).append(R);J.addClass&&U.addClass(J.addClass);var V=a("<div />"),W=a("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),X=a("<div />").width("100%").height("100%").css("zIndex",320),Y=a("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var a=lb.getFixed();J.onDblClick.call(qb,a)}).insertBefore(R).append(W,X);P&&(V=a("<img />").attr("src",R.attr("src")).css(N).width(S).height(T),W.append(V)),M&&Y.css({overflowY:"hidden"});var Z,$,_,ab,bb,cb,db,eb,fb,gb=J.boundary,hb=t().width(S+2*gb).height(T+2*gb).css({position:"absolute",top:d(-gb),left:d(-gb),zIndex:290}).mousedown(r),ib=J.bgColor,jb=J.bgOpacity;I=g(R);var kb=function(){function a(){var a,b={},c=["touchstart","touchmove","touchend"],d=document.createElement("div");try{for(a=0;a<c.length;a++){var e=c[a];e="on"+e;var f=e in d;f||(d.setAttribute(e,"return;"),f="function"==typeof d[e]),b[c[a]]=f}return b.touchstart&&b.touchend&&b.touchmove}catch(g){return!1}}function b(){return J.touchSupport===!0||J.touchSupport===!1?J.touchSupport:a()}return{createDragger:function(a){return function(b){return J.disabled?!1:"move"!==a||J.allowMove?(I=g(R),db=!0,j(a,h(kb.cfilter(b)),!0),b.stopPropagation(),b.preventDefault(),!1):!1}},newSelection:function(a){return r(kb.cfilter(a))},cfilter:function(a){return a.pageX=a.originalEvent.changedTouches[0].pageX,a.pageY=a.originalEvent.changedTouches[0].pageY,a},isSupported:a,support:b()}}(),lb=function(){function a(a){a=g(a),o=m=a[0],p=n=a[1]}function b(a){a=g(a),k=a[0]-o,l=a[1]-p,o=a[0],p=a[1]}function c(){return[k,l]}function d(a){var b=a[0],c=a[1];0>m+b&&(b-=b+m),0>n+c&&(c-=c+n),p+c>T&&(c+=T-(p+c)),o+b>S&&(b+=S-(o+b)),m+=b,o+=b,n+=c,p+=c}function e(a){var b=f();switch(a){case"ne":return[b.x2,b.y];case"nw":return[b.x,b.y];case"se":return[b.x2,b.y2];case"sw":return[b.x,b.y2]}}function f(){if(!J.aspectRatio)return i();var a,b,c,d,e=J.aspectRatio,f=J.minSize[0]/bb,g=J.maxSize[0]/bb,k=J.maxSize[1]/cb,l=o-m,q=p-n,r=Math.abs(l),s=Math.abs(q),t=r/s;return 0===g&&(g=10*S),0===k&&(k=10*T),e>t?(b=p,c=s*e,a=0>l?m-c:c+m,0>a?(a=0,d=Math.abs((a-m)/e),b=0>q?n-d:d+n):a>S&&(a=S,d=Math.abs((a-m)/e),b=0>q?n-d:d+n)):(a=o,d=r/e,b=0>q?n-d:n+d,0>b?(b=0,c=Math.abs((b-n)*e),a=0>l?m-c:c+m):b>T&&(b=T,c=Math.abs(b-n)*e,a=0>l?m-c:c+m)),a>m?(f>a-m?a=m+f:a-m>g&&(a=m+g),b=b>n?n+(a-m)/e:n-(a-m)/e):m>a&&(f>m-a?a=m-f:m-a>g&&(a=m-g),b=b>n?n+(m-a)/e:n-(m-a)/e),0>a?(m-=a,a=0):a>S&&(m-=a-S,a=S),0>b?(n-=b,b=0):b>T&&(n-=b-T,b=T),j(h(m,n,a,b))}function g(a){return a[0]<0&&(a[0]=0),a[1]<0&&(a[1]=0),a[0]>S&&(a[0]=S),a[1]>T&&(a[1]=T),[Math.round(a[0]),Math.round(a[1])]}function h(a,b,c,d){var e=a,f=c,g=b,h=d;return a>c&&(e=c,f=a),b>d&&(g=d,h=b),[e,g,f,h]}function i(){var a,b=o-m,c=p-n;return Z&&Math.abs(b)>Z&&(o=b>0?m+Z:m-Z),$&&Math.abs(c)>$&&(p=c>0?n+$:n-$),ab/cb&&Math.abs(c)<ab/cb&&(p=c>0?n+ab/cb:n-ab/cb),_/bb&&Math.abs(b)<_/bb&&(o=b>0?m+_/bb:m-_/bb),0>m&&(o-=m,m-=m),0>n&&(p-=n,n-=n),0>o&&(m-=o,o-=o),0>p&&(n-=p,p-=p),o>S&&(a=o-S,m-=a,o-=a),p>T&&(a=p-T,n-=a,p-=a),m>S&&(a=m-T,p-=a,n-=a),n>T&&(a=n-T,p-=a,n-=a),j(h(m,n,o,p))}function j(a){return{x:a[0],y:a[1],x2:a[2],y2:a[3],w:a[2]-a[0],h:a[3]-a[1]}}var k,l,m=0,n=0,o=0,p=0;return{flipCoords:h,setPressed:a,setCurrent:b,getOffset:c,moveOffset:d,getCorner:e,getFixed:f}}(),mb=function(){function b(a,b){o.left.css({height:d(b)}),o.right.css({height:d(b)})}function c(){return e(lb.getFixed())}function e(a){o.top.css({left:d(a.x),width:d(a.w),height:d(a.y)}),o.bottom.css({top:d(a.y2),left:d(a.x),width:d(a.w),height:d(T-a.y2)}),o.right.css({left:d(a.x2),width:d(S-a.x2)}),o.left.css({width:d(a.x)})}function f(){return a("<div />").css({position:"absolute",backgroundColor:J.shadeColor||J.bgColor}).appendTo(n)}function g(){m||(m=!0,n.insertBefore(R),c(),nb.setBgOpacity(1,0,1),V.hide(),h(J.shadeColor||J.bgColor,1),nb.isAwake()?j(J.bgOpacity,1):j(1,1))}function h(a,b){G(l(),a,b)}function i(){m&&(n.remove(),V.show(),m=!1,nb.isAwake()?nb.setBgOpacity(J.bgOpacity,1,1):(nb.setBgOpacity(1,1,1),nb.disableHandles()),G(U,0,1))}function j(a,b){m&&(J.bgFade&&!b?n.animate({opacity:1-a},{queue:!1,duration:J.fadeTime}):n.css({opacity:1-a}))}function k(){J.shade?g():i(),nb.isAwake()&&j(J.bgOpacity)}function l(){return n.children()}var m=!1,n=a("<div />").css({position:"absolute",zIndex:240,opacity:0}),o={top:f(),left:f().height(T),right:f().height(T),bottom:f()};return{update:c,updateRaw:e,getShades:l,setBgColor:h,enable:g,disable:i,resize:b,refresh:k,opacity:j}}(),nb=function(){function b(b){var c=a("<div />").css({position:"absolute",opacity:J.borderOpacity}).addClass(e(b));return W.append(c),c}function c(b,c){var d=a("<div />").mousedown(n(b)).css({cursor:b+"-resize",position:"absolute",zIndex:c}).addClass("ord-"+b);return kb.support&&d.bind("touchstart.jcrop",kb.createDragger(b)),X.append(d),d}function f(a){var b=J.handleSize,d=c(a,B++).css({opacity:J.handleOpacity}).addClass(e("handle"));return b&&d.width(b).height(b),d}function g(a){return c(a,B++).addClass("jcrop-dragbar")}function h(a){var b;for(b=0;b<a.length;b++)E[a[b]]=g(a[b])}function i(a){var c,d;for(d=0;d<a.length;d++){switch(a[d]){case"n":c="hline";break;case"s":c="hline bottom";break;case"e":c="vline right";break;case"w":c="vline"}C[a[d]]=b(c)}}function j(a){var b;for(b=0;b<a.length;b++)D[a[b]]=f(a[b])}function k(a,b){J.shade||V.css({top:d(-b),left:d(-a)}),Y.css({top:d(b),left:d(a)})}function l(a,b){Y.width(Math.round(a)).height(Math.round(b))}function m(){var a=lb.getFixed();lb.setPressed([a.x,a.y]),lb.setCurrent([a.x2,a.y2]),o()}function o(a){return A?q(a):void 0}function q(a){var b=lb.getFixed();l(b.w,b.h),k(b.x,b.y),J.shade&&mb.updateRaw(b),A||s(),a?J.onSelect.call(qb,p(b)):J.onChange.call(qb,p(b))}function r(a,b,c){(A||b)&&(J.bgFade&&!c?R.animate({opacity:a},{queue:!1,duration:J.fadeTime}):R.css("opacity",a))}function s(){Y.show(),J.shade?mb.opacity(jb):r(jb,!0),A=!0}function u(){x(),Y.hide(),J.shade?mb.opacity(1):r(1),A=!1,J.onRelease.call(qb)}function v(){F&&X.show()}function w(){return F=!0,J.allowResize?(X.show(),!0):void 0}function x(){F=!1,X.hide()}function y(a){a?(eb=!0,x()):(eb=!1,w())}function z(){y(!1),m()}var A,B=370,C={},D={},E={},F=!1;J.dragEdges&&a.isArray(J.createDragbars)&&h(J.createDragbars),a.isArray(J.createHandles)&&j(J.createHandles),J.drawBorders&&a.isArray(J.createBorders)&&i(J.createBorders),a(document).bind("touchstart.jcrop-ios",function(b){a(b.currentTarget).hasClass("jcrop-tracker")&&b.stopPropagation()});var G=t().mousedown(n("move")).css({cursor:"move",position:"absolute",zIndex:360});return kb.support&&G.bind("touchstart.jcrop",kb.createDragger("move")),W.append(G),x(),{updateVisible:o,update:q,release:u,refresh:m,isAwake:function(){return A},setCursor:function(a){G.css("cursor",a)},enableHandles:w,enableOnly:function(){F=!0},showHandles:v,disableHandles:x,animMode:y,setBgOpacity:r,done:z}}(),ob=function(){function b(b){hb.css({zIndex:450}),b?a(document).bind("touchmove.jcrop",g).bind("touchend.jcrop",i):m&&a(document).bind("mousemove.jcrop",d).bind("mouseup.jcrop",e)}function c(){hb.css({zIndex:290}),a(document).unbind(".jcrop")}function d(a){return k(h(a)),!1}function e(a){return a.preventDefault(),a.stopPropagation(),db&&(db=!1,l(h(a)),nb.isAwake()&&J.onSelect.call(qb,p(lb.getFixed())),c(),k=function(){},l=function(){}),!1}function f(a,c,d){return db=!0,k=a,l=c,b(d),!1}function g(a){return k(h(kb.cfilter(a))),!1}function i(a){return e(kb.cfilter(a))}function j(a){hb.css("cursor",a)}var k=function(){},l=function(){},m=J.trackDocument;return m||hb.mousemove(d).mouseup(e).mouseout(e),R.before(hb),{activateHandlers:f,setCursor:j}}(),pb=function(){function b(){J.keySupport&&(f.show(),f.focus())}function c(){f.hide()}function d(a,b,c){J.allowMove&&(lb.moveOffset([b,c]),nb.updateVisible(!0)),a.preventDefault(),a.stopPropagation()}function e(a){if(a.ctrlKey||a.metaKey)return!0;fb=a.shiftKey?!0:!1;var b=fb?10:1;switch(a.keyCode){case 37:d(a,-b,0);break;case 39:d(a,b,0);break;case 38:d(a,0,-b);break;case 40:d(a,0,b);break;case 27:J.allowSelect&&nb.release();break;case 9:return!0}return!1}var f=a('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),g=a("<div />").css({position:"absolute",overflow:"hidden"}).append(f);return J.keySupport&&(f.keydown(e).blur(c),M||!J.fixedSupport?(f.css({position:"absolute",left:"-20px"}),g.append(f).insertBefore(R)):f.insertBefore(R)),{watchKeys:b}}();kb.support&&hb.bind("touchstart.jcrop",kb.newSelection),X.hide(),H(!0);var qb={setImage:F,animateTo:v,setSelect:w,setOptions:A,tellSelect:y,tellScaled:z,setClass:u,disable:B,enable:C,cancel:D,release:nb.release,destroy:E,focus:pb.watchKeys,getBounds:function(){return[S*bb,T*cb]},getWidgetSize:function(){return[S,T]},getScaleFactor:function(){return[bb,cb]},getOptions:function(){return J},ui:{holder:U,selection:Y}};return L&&U.bind("selectstart",function(){return!1}),O.data("Jcrop",qb),qb},a.fn.Jcrop=function(b,c){var d;return this.each(function(){if(a(this).data("Jcrop")){if("api"===b)return a(this).data("Jcrop");a(this).data("Jcrop").setOptions(b)}else"IMG"==this.tagName?a.Jcrop.Loader(this,function(){a(this).css({display:"block",visibility:"hidden"}),d=a.Jcrop(this,b),a.isFunction(c)&&c.call(d)}):(a(this).css({display:"block",visibility:"hidden"}),d=a.Jcrop(this,b),a.isFunction(c)&&c.call(d))}),this},a.Jcrop.Loader=function(b,c,d){function e(){g.complete?(f.unbind(".jcloader"),a.isFunction(c)&&c.call(g)):window.setTimeout(e,50)}var f=a(b),g=f[0];f.bind("load.jcloader",e).bind("error.jcloader",function(){f.unbind(".jcloader"),a.isFunction(d)&&d.call(g)}),g.complete&&a.isFunction(c)&&(f.unbind(".jcloader"),c.call(g))},a.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}}(jQuery),function(a){"use strict";var b=function(a,c,d){var e,f,g=document.createElement("img"),h=new Date;return g.onerror=c,g.onload=function(){!f||d&&d.noRevoke||b.revokeObjectURL(f),c(b.scale(g,d))},window.Blob&&a instanceof Blob||window.File&&a instanceof File?(e=f=b.createObjectURL(a),g._type=a.type):e=a,e+="?_"+h.getTime(),e?(g.src=e,g):b.readFile(a,function(a){g.src=a})},c=window.createObjectURL&&window||window.URL&&URL.revokeObjectURL&&URL||window.webkitURL&&webkitURL;b.detectSubsampling=function(a){var b,c,d=a.width,e=a.height;return d*e>1048576?(b=document.createElement("canvas"),b.width=b.height=1,c=b.getContext("2d"),c.drawImage(a,-d+1,0),0===c.getImageData(0,0,1,1).data[3]):!1},b.detectVerticalSquash=function(a,b){var c,d,e,f,g,h=document.createElement("canvas"),i=h.getContext("2d");for(h.width=1,h.height=b,i.drawImage(a,0,0),c=i.getImageData(0,0,1,b).data,d=0,e=b,f=b;f>d;)g=c[4*(f-1)+3],0===g?e=f:d=f,f=e+d>>1;return f/b},b.renderImageToCanvas=function(a,c,d,e){var f,g,h,i,j,k,l=a.width,m=a.height,n=c.getContext("2d"),o=1024,p=document.createElement("canvas");for(n.save(),b.detectSubsampling(a)&&(l/=2,m/=2),f=b.detectVerticalSquash(a,m),p.width=p.height=o,g=p.getContext("2d"),h=0;m>h;){for(i=h+o>m?m-h:o,j=0;l>j;)k=j+o>l?l-j:o,g.clearRect(0,0,o,o),g.drawImage(a,-j,-h),n.drawImage(p,0,0,k,i,Math.floor(j*d/l),Math.floor(h*e/m/f),Math.ceil(k*d/l),Math.ceil(i*e/m/f)),j+=o;h+=o}n.restore(),p=g=null},b.scale=function(a,c){c=c||{};var d=document.createElement("canvas"),e=a.width,f=a.height,g=Math.max((c.minWidth||e)/e,(c.minHeight||f)/f);return g>1&&(e=parseInt(e*g,10),f=parseInt(f*g,10)),g=Math.min((c.maxWidth||e)/e,(c.maxHeight||f)/f),1>g&&(e=parseInt(e*g,10),f=parseInt(f*g,10)),a.getContext||c.canvas&&d.getContext?(d.width=e,d.height=f,"image/jpeg"===a._type?b.renderImageToCanvas(a,d,e,f):d.getContext("2d").drawImage(a,0,0,e,f),d):a},b.createObjectURL=function(a){return c?c.createObjectURL(a):!1},b.revokeObjectURL=function(a){return c?c.revokeObjectURL(a):!1},b.readFile=function(a,b){if(window.FileReader&&FileReader.prototype.readAsDataURL){var c=new FileReader;return c.onload=function(a){b(a.target.result)},c.readAsDataURL(a),c}return!1},a.loadImage=b}(this),function(a,b){function c(b,c){var e=b.nodeName.toLowerCase();if("area"===e){var f,g=b.parentNode,h=g.name;return b.href&&h&&"map"===g.nodeName.toLowerCase()?(f=a("img[usemap=#"+h+"]")[0],!!f&&d(f)):!1}return(/input|select|textarea|button|object/.test(e)?!b.disabled:"a"==e?b.href||c:c)&&d(b)}function d(b){return!a(b).parents().andSelf().filter(function(){return"hidden"===a.curCSS(this,"visibility")||a.expr.filters.hidden(this)}).length}a.ui=a.ui||{},a.ui.version||(a.extend(a.ui,{version:"1.8.24",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}}),a.fn.extend({propAttr:a.fn.prop||a.fn.attr,_focus:a.fn.focus,focus:function(b,c){return"number"==typeof b?this.each(function(){var d=this;setTimeout(function(){a(d).focus(),c&&c.call(d)},b)}):this._focus.apply(this,arguments)},scrollParent:function(){var b;return b=a.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(a.curCSS(this,"position",1))&&/(auto|scroll)/.test(a.curCSS(this,"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,"overflow-x",1))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(a.curCSS(this,"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,"overflow-x",1))}).eq(0),/fixed/.test(this.css("position"))||!b.length?a(document):b},zIndex:function(c){if(c!==b)return this.css("zIndex",c);if(this.length)for(var d,e,f=a(this[0]);f.length&&f[0]!==document;){if(d=f.css("position"),("absolute"===d||"relative"===d||"fixed"===d)&&(e=parseInt(f.css("zIndex"),10),!isNaN(e)&&0!==e))return e;f=f.parent()}return 0},disableSelection:function(){return this.bind((a.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(a){a.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),a("<a>").outerWidth(1).jquery||a.each(["Width","Height"],function(c,d){function e(b,c,d,e){return a.each(f,function(){c-=parseFloat(a.curCSS(b,"padding"+this,!0))||0,d&&(c-=parseFloat(a.curCSS(b,"border"+this+"Width",!0))||0),e&&(c-=parseFloat(a.curCSS(b,"margin"+this,!0))||0)}),c}var f="Width"===d?["Left","Right"]:["Top","Bottom"],g=d.toLowerCase(),h={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};a.fn["inner"+d]=function(c){return c===b?h["inner"+d].call(this):this.each(function(){a(this).css(g,e(this,c)+"px")})},a.fn["outer"+d]=function(b,c){return"number"!=typeof b?h["outer"+d].call(this,b):this.each(function(){a(this).css(g,e(this,b,!0,c)+"px")})}}),a.extend(a.expr[":"],{data:a.expr.createPseudo?a.expr.createPseudo(function(b){return function(c){return!!a.data(c,b)}}):function(b,c,d){return!!a.data(b,d[3])},focusable:function(b){return c(b,!isNaN(a.attr(b,"tabindex")))},tabbable:function(b){var d=a.attr(b,"tabindex"),e=isNaN(d);return(e||d>=0)&&c(b,!e)}}),a(function(){var b=document.body,c=b.appendChild(c=document.createElement("div"));c.offsetHeight,a.extend(c.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),a.support.minHeight=100===c.offsetHeight,a.support.selectstart="onselectstart"in c,b.removeChild(c).style.display="none"}),a.curCSS||(a.curCSS=a.css),a.extend(a.ui,{plugin:{add:function(b,c,d){var e=a.ui[b].prototype;for(var f in d)e.plugins[f]=e.plugins[f]||[],e.plugins[f].push([c,d[f]])},call:function(a,b,c){var d=a.plugins[b];if(d&&a.element[0].parentNode)for(var e=0;e<d.length;e++)a.options[d[e][0]]&&d[e][1].apply(a.element,c)}},contains:function(a,b){return document.compareDocumentPosition?16&a.compareDocumentPosition(b):a!==b&&a.contains(b)},hasScroll:function(b,c){if("hidden"===a(b).css("overflow"))return!1;var d=c&&"left"===c?"scrollLeft":"scrollTop",e=!1;return b[d]>0?!0:(b[d]=1,e=b[d]>0,b[d]=0,e)},isOverAxis:function(a,b,c){return a>b&&b+c>a},isOver:function(b,c,d,e,f,g){return a.ui.isOverAxis(b,d,f)&&a.ui.isOverAxis(c,e,g)}}))}(jQuery),function(a,b){if(a.cleanData){var c=a.cleanData;a.cleanData=function(b){for(var d,e=0;null!=(d=b[e]);e++)try{a(d).triggerHandler("remove")}catch(f){}c(b)}}else{var d=a.fn.remove;a.fn.remove=function(b,c){return this.each(function(){return c||(!b||a.filter(b,[this]).length)&&a("*",this).add([this]).each(function(){try{a(this).triggerHandler("remove")}catch(b){}}),d.call(a(this),b,c)})}}a.widget=function(b,c,d){var e,f=b.split(".")[0];b=b.split(".")[1],e=f+"-"+b,d||(d=c,c=a.Widget),a.expr[":"][e]=function(c){return!!a.data(c,b)},a[f]=a[f]||{},a[f][b]=function(a,b){arguments.length&&this._createWidget(a,b)};var g=new c;g.options=a.extend(!0,{},g.options),a[f][b].prototype=a.extend(!0,g,{namespace:f,widgetName:b,widgetEventPrefix:a[f][b].prototype.widgetEventPrefix||b,widgetBaseClass:e},d),a.widget.bridge(b,a[f][b])},a.widget.bridge=function(c,d){a.fn[c]=function(e){var f="string"==typeof e,g=Array.prototype.slice.call(arguments,1),h=this;return e=!f&&g.length?a.extend.apply(null,[!0,e].concat(g)):e,f&&"_"===e.charAt(0)?h:(f?this.each(function(){var d=a.data(this,c),f=d&&a.isFunction(d[e])?d[e].apply(d,g):d;return f!==d&&f!==b?(h=f,!1):void 0}):this.each(function(){var b=a.data(this,c);b?b.option(e||{})._init():a.data(this,c,new d(e,this))}),h)}},a.Widget=function(a,b){arguments.length&&this._createWidget(a,b)},a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(b,c){a.data(c,this.widgetName,this),this.element=a(c),this.options=a.extend(!0,{},this.options,this._getCreateOptions(),b);
var d=this;this.element.bind("remove."+this.widgetName,function(){d.destroy()}),this._create(),this._trigger("create"),this._init()},_getCreateOptions:function(){return a.metadata&&a.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName),this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled ui-state-disabled")},widget:function(){return this.element},option:function(c,d){var e=c;if(0===arguments.length)return a.extend({},this.options);if("string"==typeof c){if(d===b)return this.options[c];e={},e[c]=d}return this._setOptions(e),this},_setOptions:function(b){var c=this;return a.each(b,function(a,b){c._setOption(a,b)}),this},_setOption:function(a,b){return this.options[a]=b,"disabled"===a&&this.widget()[b?"addClass":"removeClass"](this.widgetBaseClass+"-disabled ui-state-disabled").attr("aria-disabled",b),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(b,c,d){var e,f,g=this.options[b];if(d=d||{},c=a.Event(c),c.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase(),c.target=this.element[0],f=c.originalEvent)for(e in f)e in c||(c[e]=f[e]);return this.element.trigger(c,d),!(a.isFunction(g)&&g.call(this.element[0],c,d)===!1||c.isDefaultPrevented())}}}(jQuery),function(a){var b=!1;a(document).mouseup(function(){b=!1}),a.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var b=this;this.element.bind("mousedown."+this.widgetName,function(a){return b._mouseDown(a)}).bind("click."+this.widgetName,function(c){return!0===a.data(c.target,b.widgetName+".preventClickEvent")?(a.removeData(c.target,b.widgetName+".preventClickEvent"),c.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(c){if(!b){this._mouseStarted&&this._mouseUp(c),this._mouseDownEvent=c;var d=this,e=1==c.which,f="string"==typeof this.options.cancel&&c.target.nodeName?a(c.target).closest(this.options.cancel).length:!1;return e&&!f&&this._mouseCapture(c)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){d.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(c)&&this._mouseDelayMet(c)&&(this._mouseStarted=this._mouseStart(c)!==!1,!this._mouseStarted)?(c.preventDefault(),!0):(!0===a.data(c.target,this.widgetName+".preventClickEvent")&&a.removeData(c.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(a){return d._mouseMove(a)},this._mouseUpDelegate=function(a){return d._mouseUp(a)},a(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),c.preventDefault(),b=!0,!0)):!0}},_mouseMove:function(b){return!a.browser.msie||document.documentMode>=9||b.button?this._mouseStarted?(this._mouseDrag(b),b.preventDefault()):(this._mouseDistanceMet(b)&&this._mouseDelayMet(b)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,b)!==!1,this._mouseStarted?this._mouseDrag(b):this._mouseUp(b)),!this._mouseStarted):this._mouseUp(b)},_mouseUp:function(b){return a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,b.target==this._mouseDownEvent.target&&a.data(b.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(b)),!1},_mouseDistanceMet:function(a){return Math.max(Math.abs(this._mouseDownEvent.pageX-a.pageX),Math.abs(this._mouseDownEvent.pageY-a.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(a){a.widget("ui.sortable",a.ui.mouse,{version:"1.9.2",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3},_create:function(){var a=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===a.axis||/left|right/.test(this.items[0].item.css("float"))||/inline|table-cell/.test(this.items[0].item.css("display")):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var a=this.items.length-1;a>=0;a--)this.items[a].item.removeData(this.widgetName+"-item");return this},_setOption:function(b,c){"disabled"===b?(this.options[b]=c,this.widget().toggleClass("ui-sortable-disabled",!!c)):a.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(b,c){var d=this;if(this.reverting)return!1;if(this.options.disabled||"static"==this.options.type)return!1;this._refreshItems(b);{var e=null;a(b.target).parents().each(function(){return a.data(this,d.widgetName+"-item")==d?(e=a(this),!1):void 0})}if(a.data(b.target,d.widgetName+"-item")==d&&(e=a(b.target)),!e)return!1;if(this.options.handle&&!c){var f=!1;if(a(this.options.handle,e).find("*").andSelf().each(function(){this==b.target&&(f=!0)}),!f)return!1}return this.currentItem=e,this._removeCurrentsFromItems(),!0},_mouseStart:function(b,c,d){var e=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(b),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},a.extend(this.offset,{click:{left:b.pageX-this.offset.left,top:b.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(b),this.originalPageX=b.pageX,this.originalPageY=b.pageY,e.cursorAt&&this._adjustOffsetFromHelper(e.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!=this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),e.containment&&this._setContainment(),e.cursor&&(a("body").css("cursor")&&(this._storedCursor=a("body").css("cursor")),a("body").css("cursor",e.cursor)),e.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",e.opacity)),e.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",e.zIndex)),this.scrollParent[0]!=document&&"HTML"!=this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",b,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!d)for(var f=this.containers.length-1;f>=0;f--)this.containers[f]._trigger("activate",b,this._uiHash(this));return a.ui.ddmanager&&(a.ui.ddmanager.current=this),a.ui.ddmanager&&!e.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(b),!0},_mouseDrag:function(b){if(this.position=this._generatePosition(b),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll){var c=this.options,d=!1;this.scrollParent[0]!=document&&"HTML"!=this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-b.pageY<c.scrollSensitivity?this.scrollParent[0].scrollTop=d=this.scrollParent[0].scrollTop+c.scrollSpeed:b.pageY-this.overflowOffset.top<c.scrollSensitivity&&(this.scrollParent[0].scrollTop=d=this.scrollParent[0].scrollTop-c.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-b.pageX<c.scrollSensitivity?this.scrollParent[0].scrollLeft=d=this.scrollParent[0].scrollLeft+c.scrollSpeed:b.pageX-this.overflowOffset.left<c.scrollSensitivity&&(this.scrollParent[0].scrollLeft=d=this.scrollParent[0].scrollLeft-c.scrollSpeed)):(b.pageY-a(document).scrollTop()<c.scrollSensitivity?d=a(document).scrollTop(a(document).scrollTop()-c.scrollSpeed):a(window).height()-(b.pageY-a(document).scrollTop())<c.scrollSensitivity&&(d=a(document).scrollTop(a(document).scrollTop()+c.scrollSpeed)),b.pageX-a(document).scrollLeft()<c.scrollSensitivity?d=a(document).scrollLeft(a(document).scrollLeft()-c.scrollSpeed):a(window).width()-(b.pageX-a(document).scrollLeft())<c.scrollSensitivity&&(d=a(document).scrollLeft(a(document).scrollLeft()+c.scrollSpeed))),d!==!1&&a.ui.ddmanager&&!c.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b)}this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"==this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"==this.options.axis||(this.helper[0].style.top=this.position.top+"px");for(var e=this.items.length-1;e>=0;e--){var f=this.items[e],g=f.item[0],h=this._intersectsWithPointer(f);if(h&&f.instance===this.currentContainer&&g!=this.currentItem[0]&&this.placeholder[1==h?"next":"prev"]()[0]!=g&&!a.contains(this.placeholder[0],g)&&("semi-dynamic"==this.options.type?!a.contains(this.element[0],g):!0)){if(this.direction=1==h?"down":"up","pointer"!=this.options.tolerance&&!this._intersectsWithSides(f))break;this._rearrange(b,f),this._trigger("change",b,this._uiHash());break}}return this._contactContainers(b),a.ui.ddmanager&&a.ui.ddmanager.drag(this,b),this._trigger("sort",b,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(b,c){if(b){if(a.ui.ddmanager&&!this.options.dropBehaviour&&a.ui.ddmanager.drop(this,b),this.options.revert){var d=this,e=this.placeholder.offset();this.reverting=!0,a(this.helper).animate({left:e.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:e.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){d._clear(b)})}else this._clear(b,c);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"==this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var b=this.containers.length-1;b>=0;b--)this.containers[b]._trigger("deactivate",null,this._uiHash(this)),this.containers[b].containerCache.over&&(this.containers[b]._trigger("out",null,this._uiHash(this)),this.containers[b].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!=this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),a.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?a(this.domPosition.prev).after(this.currentItem):a(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(b){var c=this._getItemsAsjQuery(b&&b.connected),d=[];return b=b||{},a(c).each(function(){var c=(a(b.item||this).attr(b.attribute||"id")||"").match(b.expression||/(.+)[-=_](.+)/);c&&d.push((b.key||c[1]+"[]")+"="+(b.key&&b.expression?c[1]:c[2]))}),!d.length&&b.key&&d.push(b.key+"="),d.join("&")},toArray:function(b){var c=this._getItemsAsjQuery(b&&b.connected),d=[];return b=b||{},c.each(function(){d.push(a(b.item||this).attr(b.attribute||"id")||"")}),d},_intersectsWith:function(a){var b=this.positionAbs.left,c=b+this.helperProportions.width,d=this.positionAbs.top,e=d+this.helperProportions.height,f=a.left,g=f+a.width,h=a.top,i=h+a.height,j=this.offset.click.top,k=this.offset.click.left,l=d+j>h&&i>d+j&&b+k>f&&g>b+k;return"pointer"==this.options.tolerance||this.options.forcePointerForContainers||"pointer"!=this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>a[this.floating?"width":"height"]?l:f<b+this.helperProportions.width/2&&c-this.helperProportions.width/2<g&&h<d+this.helperProportions.height/2&&e-this.helperProportions.height/2<i},_intersectsWithPointer:function(b){var c="x"===this.options.axis||a.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,b.top,b.height),d="y"===this.options.axis||a.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,b.left,b.width),e=c&&d,f=this._getDragVerticalDirection(),g=this._getDragHorizontalDirection();return e?this.floating?g&&"right"==g||"down"==f?2:1:f&&("down"==f?2:1):!1},_intersectsWithSides:function(b){var c=a.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,b.top+b.height/2,b.height),d=a.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,b.left+b.width/2,b.width),e=this._getDragVerticalDirection(),f=this._getDragHorizontalDirection();return this.floating&&f?"right"==f&&d||"left"==f&&!d:e&&("down"==e&&c||"up"==e&&!c)},_getDragVerticalDirection:function(){var a=this.positionAbs.top-this.lastPositionAbs.top;return 0!=a&&(a>0?"down":"up")},_getDragHorizontalDirection:function(){var a=this.positionAbs.left-this.lastPositionAbs.left;return 0!=a&&(a>0?"right":"left")},refresh:function(a){return this._refreshItems(a),this.refreshPositions(),this},_connectWith:function(){var a=this.options;return a.connectWith.constructor==String?[a.connectWith]:a.connectWith},_getItemsAsjQuery:function(b){var c=[],d=[],e=this._connectWith();if(e&&b)for(var f=e.length-1;f>=0;f--)for(var g=a(e[f]),h=g.length-1;h>=0;h--){var i=a.data(g[h],this.widgetName);i&&i!=this&&!i.options.disabled&&d.push([a.isFunction(i.options.items)?i.options.items.call(i.element):a(i.options.items,i.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),i])}d.push([a.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):a(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(var f=d.length-1;f>=0;f--)d[f][0].each(function(){c.push(this)});return a(c)},_removeCurrentsFromItems:function(){var b=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=a.grep(this.items,function(a){for(var c=0;c<b.length;c++)if(b[c]==a.item[0])return!1;return!0})},_refreshItems:function(b){this.items=[],this.containers=[this];var c=this.items,d=[[a.isFunction(this.options.items)?this.options.items.call(this.element[0],b,{item:this.currentItem}):a(this.options.items,this.element),this]],e=this._connectWith();if(e&&this.ready)for(var f=e.length-1;f>=0;f--)for(var g=a(e[f]),h=g.length-1;h>=0;h--){var i=a.data(g[h],this.widgetName);i&&i!=this&&!i.options.disabled&&(d.push([a.isFunction(i.options.items)?i.options.items.call(i.element[0],b,{item:this.currentItem}):a(i.options.items,i.element),i]),this.containers.push(i))}for(var f=d.length-1;f>=0;f--)for(var j=d[f][1],k=d[f][0],h=0,l=k.length;l>h;h++){var m=a(k[h]);m.data(this.widgetName+"-item",j),c.push({item:m,instance:j,width:0,height:0,left:0,top:0})}},refreshPositions:function(b){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());for(var c=this.items.length-1;c>=0;c--){var d=this.items[c];if(d.instance==this.currentContainer||!this.currentContainer||d.item[0]==this.currentItem[0]){var e=this.options.toleranceElement?a(this.options.toleranceElement,d.item):d.item;b||(d.width=e.outerWidth(),d.height=e.outerHeight());var f=e.offset();d.left=f.left,d.top=f.top}}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(var c=this.containers.length-1;c>=0;c--){var f=this.containers[c].element.offset();this.containers[c].containerCache.left=f.left,this.containers[c].containerCache.top=f.top,this.containers[c].containerCache.width=this.containers[c].element.outerWidth(),this.containers[c].containerCache.height=this.containers[c].element.outerHeight()}return this},_createPlaceholder:function(b){b=b||this;var c=b.options;if(!c.placeholder||c.placeholder.constructor==String){var d=c.placeholder;c.placeholder={element:function(){var c=a(document.createElement(b.currentItem[0].nodeName)).addClass(d||b.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];return d||(c.style.visibility="hidden"),c},update:function(a,e){(!d||c.forcePlaceholderSize)&&(e.height()||e.height(b.currentItem.innerHeight()-parseInt(b.currentItem.css("paddingTop")||0,10)-parseInt(b.currentItem.css("paddingBottom")||0,10)),e.width()||e.width(b.currentItem.innerWidth()-parseInt(b.currentItem.css("paddingLeft")||0,10)-parseInt(b.currentItem.css("paddingRight")||0,10)))}}}b.placeholder=a(c.placeholder.element.call(b.element,b.currentItem)),b.currentItem.after(b.placeholder),c.placeholder.update(b,b.placeholder)},_contactContainers:function(b){for(var c=null,d=null,e=this.containers.length-1;e>=0;e--)if(!a.contains(this.currentItem[0],this.containers[e].element[0]))if(this._intersectsWith(this.containers[e].containerCache)){if(c&&a.contains(this.containers[e].element[0],c.element[0]))continue;c=this.containers[e],d=e}else this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",b,this._uiHash(this)),this.containers[e].containerCache.over=0);if(c)if(1===this.containers.length)this.containers[d]._trigger("over",b,this._uiHash(this)),this.containers[d].containerCache.over=1;else{for(var f=1e4,g=null,h=this.containers[d].floating?"left":"top",i=this.containers[d].floating?"width":"height",j=this.positionAbs[h]+this.offset.click[h],k=this.items.length-1;k>=0;k--)if(a.contains(this.containers[d].element[0],this.items[k].item[0])&&this.items[k].item[0]!=this.currentItem[0]){var l=this.items[k].item.offset()[h],m=!1;Math.abs(l-j)>Math.abs(l+this.items[k][i]-j)&&(m=!0,l+=this.items[k][i]),Math.abs(l-j)<f&&(f=Math.abs(l-j),g=this.items[k],this.direction=m?"up":"down")}if(!g&&!this.options.dropOnEmpty)return;this.currentContainer=this.containers[d],g?this._rearrange(b,g,null,!0):this._rearrange(b,null,this.containers[d].element,!0),this._trigger("change",b,this._uiHash()),this.containers[d]._trigger("change",b,this._uiHash(this)),this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[d]._trigger("over",b,this._uiHash(this)),this.containers[d].containerCache.over=1}},_createHelper:function(b){var c=this.options,d=a.isFunction(c.helper)?a(c.helper.apply(this.element[0],[b,this.currentItem])):"clone"==c.helper?this.currentItem.clone():this.currentItem;return d.parents("body").length||a("parent"!=c.appendTo?c.appendTo:this.currentItem[0].parentNode)[0].appendChild(d[0]),d[0]==this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(""==d[0].style.width||c.forceHelperSize)&&d.width(this.currentItem.width()),(""==d[0].style.height||c.forceHelperSize)&&d.height(this.currentItem.height()),d},_adjustOffsetFromHelper:function(b){"string"==typeof b&&(b=b.split(" ")),a.isArray(b)&&(b={left:+b[0],top:+b[1]||0}),"left"in b&&(this.offset.click.left=b.left+this.margins.left),"right"in b&&(this.offset.click.left=this.helperProportions.width-b.right+this.margins.left),"top"in b&&(this.offset.click.top=b.top+this.margins.top),"bottom"in b&&(this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var b=this.offsetParent.offset();return"absolute"==this.cssPosition&&this.scrollParent[0]!=document&&a.contains(this.scrollParent[0],this.offsetParent[0])&&(b.left+=this.scrollParent.scrollLeft(),b.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&"html"==this.offsetParent[0].tagName.toLowerCase()&&a.ui.ie)&&(b={top:0,left:0}),{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"==this.cssPosition){var a=this.currentItem.position();return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b=this.options;if("parent"==b.containment&&(b.containment=this.helper[0].parentNode),("document"==b.containment||"window"==b.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,a("document"==b.containment?document:window).width()-this.helperProportions.width-this.margins.left,(a("document"==b.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),!/^(document|window|parent)$/.test(b.containment)){var c=a(b.containment)[0],d=a(b.containment).offset(),e="hidden"!=a(c).css("overflow");this.containment=[d.left+(parseInt(a(c).css("borderLeftWidth"),10)||0)+(parseInt(a(c).css("paddingLeft"),10)||0)-this.margins.left,d.top+(parseInt(a(c).css("borderTopWidth"),10)||0)+(parseInt(a(c).css("paddingTop"),10)||0)-this.margins.top,d.left+(e?Math.max(c.scrollWidth,c.offsetWidth):c.offsetWidth)-(parseInt(a(c).css("borderLeftWidth"),10)||0)-(parseInt(a(c).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,d.top+(e?Math.max(c.scrollHeight,c.offsetHeight):c.offsetHeight)-(parseInt(a(c).css("borderTopWidth"),10)||0)-(parseInt(a(c).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(b,c){c||(c=this.position);var d="absolute"==b?1:-1,e=(this.options,"absolute"!=this.cssPosition||this.scrollParent[0]!=document&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent),f=/(html|body)/i.test(e[0].tagName);return{top:c.top+this.offset.relative.top*d+this.offset.parent.top*d-("fixed"==this.cssPosition?-this.scrollParent.scrollTop():f?0:e.scrollTop())*d,left:c.left+this.offset.relative.left*d+this.offset.parent.left*d-("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():f?0:e.scrollLeft())*d}},_generatePosition:function(b){var c=this.options,d="absolute"!=this.cssPosition||this.scrollParent[0]!=document&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,e=/(html|body)/i.test(d[0].tagName);"relative"!=this.cssPosition||this.scrollParent[0]!=document&&this.scrollParent[0]!=this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset());var f=b.pageX,g=b.pageY;if(this.originalPosition&&(this.containment&&(b.pageX-this.offset.click.left<this.containment[0]&&(f=this.containment[0]+this.offset.click.left),b.pageY-this.offset.click.top<this.containment[1]&&(g=this.containment[1]+this.offset.click.top),b.pageX-this.offset.click.left>this.containment[2]&&(f=this.containment[2]+this.offset.click.left),b.pageY-this.offset.click.top>this.containment[3]&&(g=this.containment[3]+this.offset.click.top)),c.grid)){var h=this.originalPageY+Math.round((g-this.originalPageY)/c.grid[1])*c.grid[1];g=this.containment?h-this.offset.click.top<this.containment[1]||h-this.offset.click.top>this.containment[3]?h-this.offset.click.top<this.containment[1]?h+c.grid[1]:h-c.grid[1]:h:h;var i=this.originalPageX+Math.round((f-this.originalPageX)/c.grid[0])*c.grid[0];f=this.containment?i-this.offset.click.left<this.containment[0]||i-this.offset.click.left>this.containment[2]?i-this.offset.click.left<this.containment[0]?i+c.grid[0]:i-c.grid[0]:i:i}return{top:g-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"==this.cssPosition?-this.scrollParent.scrollTop():e?0:d.scrollTop()),left:f-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():e?0:d.scrollLeft())}},_rearrange:function(a,b,c,d){c?c[0].appendChild(this.placeholder[0]):b.item[0].parentNode.insertBefore(this.placeholder[0],"down"==this.direction?b.item[0]:b.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var e=this.counter;this._delay(function(){e==this.counter&&this.refreshPositions(!d)})},_clear:function(b,c){this.reverting=!1;var d=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]==this.currentItem[0]){for(var e in this._storedCSS)("auto"==this._storedCSS[e]||"static"==this._storedCSS[e])&&(this._storedCSS[e]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();this.fromOutside&&!c&&d.push(function(a){this._trigger("receive",a,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev==this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent==this.currentItem.parent()[0]||c||d.push(function(a){this._trigger("update",a,this._uiHash())}),this!==this.currentContainer&&(c||(d.push(function(a){this._trigger("remove",a,this._uiHash())}),d.push(function(a){return function(b){a._trigger("receive",b,this._uiHash(this))}}.call(this,this.currentContainer)),d.push(function(a){return function(b){a._trigger("update",b,this._uiHash(this))}}.call(this,this.currentContainer))));for(var e=this.containers.length-1;e>=0;e--)c||d.push(function(a){return function(b){a._trigger("deactivate",b,this._uiHash(this))}}.call(this,this.containers[e])),this.containers[e].containerCache.over&&(d.push(function(a){return function(b){a._trigger("out",b,this._uiHash(this))}}.call(this,this.containers[e])),this.containers[e].containerCache.over=0);if(this._storedCursor&&a("body").css("cursor",this._storedCursor),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"==this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!c){this._trigger("beforeStop",b,this._uiHash());for(var e=0;e<d.length;e++)d[e].call(this,b);this._trigger("stop",b,this._uiHash())}return this.fromOutside=!1,!1}if(c||this._trigger("beforeStop",b,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!=this.currentItem[0]&&this.helper.remove(),this.helper=null,!c){for(var e=0;e<d.length;e++)d[e].call(this,b);this._trigger("stop",b,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){a.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(b){var c=b||this;return{helper:c.helper,placeholder:c.placeholder||a([]),position:c.position,originalPosition:c.originalPosition,offset:c.positionAbs,item:c.currentItem,sender:b?b.element:null}}})}(jQuery),function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a,b){if(a.cleanData){var c=a.cleanData;a.cleanData=function(b){for(var d,e=0;null!=(d=b[e]);e++)try{a(d).triggerHandler("remove")}catch(f){}c(b)}}else{var d=a.fn.remove;a.fn.remove=function(b,c){return this.each(function(){return c||(!b||a.filter(b,[this]).length)&&a("*",this).add([this]).each(function(){try{a(this).triggerHandler("remove")}catch(b){}}),d.call(a(this),b,c)})}}a.widget=function(b,c,d){var e,f=b.split(".")[0];b=b.split(".")[1],e=f+"-"+b,d||(d=c,c=a.Widget),a.expr[":"][e]=function(c){return!!a.data(c,b)},a[f]=a[f]||{},a[f][b]=function(a,b){arguments.length&&this._createWidget(a,b)};var g=new c;g.options=a.extend(!0,{},g.options),a[f][b].prototype=a.extend(!0,g,{namespace:f,widgetName:b,widgetEventPrefix:a[f][b].prototype.widgetEventPrefix||b,widgetBaseClass:e},d),a.widget.bridge(b,a[f][b])},a.widget.bridge=function(c,d){a.fn[c]=function(e){var f="string"==typeof e,g=Array.prototype.slice.call(arguments,1),h=this;return e=!f&&g.length?a.extend.apply(null,[!0,e].concat(g)):e,f&&"_"===e.charAt(0)?h:(f?this.each(function(){var d=a.data(this,c),f=d&&a.isFunction(d[e])?d[e].apply(d,g):d;return f!==d&&f!==b?(h=f,!1):void 0}):this.each(function(){var b=a.data(this,c);b?b.option(e||{})._init():a.data(this,c,new d(e,this))}),h)}},a.Widget=function(a,b){arguments.length&&this._createWidget(a,b)},a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(b,c){a.data(c,this.widgetName,this),this.element=a(c),this.options=a.extend(!0,{},this.options,this._getCreateOptions(),b);var d=this;this.element.bind("remove."+this.widgetName,function(){d.destroy()}),this._create(),this._trigger("create"),this._init()},_getCreateOptions:function(){return a.metadata&&a.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName),this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled ui-state-disabled")},widget:function(){return this.element},option:function(c,d){var e=c;if(0===arguments.length)return a.extend({},this.options);if("string"==typeof c){if(d===b)return this.options[c];e={},e[c]=d}return this._setOptions(e),this},_setOptions:function(b){var c=this;return a.each(b,function(a,b){c._setOption(a,b)}),this},_setOption:function(a,b){return this.options[a]=b,"disabled"===a&&this.widget()[b?"addClass":"removeClass"](this.widgetBaseClass+"-disabled ui-state-disabled").attr("aria-disabled",b),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(b,c,d){var e,f,g=this.options[b];if(d=d||{},c=a.Event(c),c.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase(),c.target=this.element[0],f=c.originalEvent)for(e in f)e in c||(c[e]=f[e]);return this.element.trigger(c,d),!(a.isFunction(g)&&g.call(this.element[0],c,d)===!1||c.isDefaultPrevented())}}}),this.JSON||(this.JSON={}),function(){function f(a){return 10>a?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)d=rep[c],"string"==typeof d&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()
});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}();var PhotoFrame={};!function(a){PhotoFrame.Model={},PhotoFrame.instances=[],PhotoFrame.matrix=[],PhotoFrame.Buttons=[],PhotoFrame.Class=Base.extend({buildDate:"2013-09-05",version:"1.2.0",constructor:function(b,c){if("object"!=typeof b)var b={};if("object"!=typeof c)var c={};this.setOptions(a.extend(!0,{},b,c))},callback:function(a){if("function"==typeof a){for(var b=[],c=1;c<=arguments.length;c++)arguments[c]&&b.push(arguments[c]);a.apply(this,b)}},log:function(a){window.console&&console.log&&console.log(a)},getOption:function(a){return this[a]?this[a]:!1},getOptions:function(){return this},setOption:function(a,b){this[a]=b},setOptions:function(a){for(key in a)this.setOption(key,a[key])},removeIndex:function(a,b){for(var c=0;c<a.length;c++)if(a[c]==b){a.splice(c,1);break}return a},jsonEncode:function(a){return JSON.parse(a)},jsonDecode:function(a){return JSON.stringify(a)},isRetina:function(){return window.devicePixelRatio>1}}),PhotoFrame.BaseElement=PhotoFrame.Class.extend({callbacks:{},factory:!1,id:!1,parent:!1,ui:{},constructor:function(b,c,d){var e="object"==typeof d?d.callbacks:{};this.ui={},this.factory=b,this.parent=c,this.base(d),this.callbacks=a.extend(!0,{},this.callbacks,e)}}),PhotoFrame.Factory=PhotoFrame.Class.extend({buttons:[],buttonBar:!1,cancel:!1,callbacks:{},classes:{actionBar:"photo-frame-action-bar",activity:"photo-frame-activity",aspect:"aspect",barButton:"photo-frame-bar-button",browse:"photo-frame-browse",button:"photo-frame-button",cancel:"photo-frame-cancel",clearfix:"clearfix",close:"photo-frame-close",crop:"photo-frame-crop",cropPhoto:"photo-frame-crop-photo",editPhoto:"photo-frame-edit",deletePhoto:"photo-frame-delete",dimmer:"photo-frame-dimmer",dragging:"photo-frame-dragging",dropCover:"photo-frame-drop-cover",dropText:"photo-frame-drop-text",dropZone:"photo-frame-drop-zone",errors:"photo-frame-errors",form:"photo-frame-form",floatLeft:"photo-frame-float-left",floatRight:"photo-frame-float-right",helper:"photo-frame-helper",icons:"photo-frame-icons",invalid:"photo-frame-invalid",ie:"photo-frame-ie",indicator:"photo-frame-indicator",infoToggle:"photo-frame-toggle-info",instructions:"photo-frame-instructions",infoPanel:"photo-frame-info-panel",jcropTracker:"jcrop-tracker",jcropHolder:"jcrop-holder",message:"photo-frame-message",meta:"photo-frame-meta",metaToggle:"photo-frame-meta-toggle",metaClose:"photo-frame-close-meta",panel:"photo-frame-panel",photo:"photo-frame-photo",progress:"photo-frame-progress",preview:"photo-frame-preview",rendering:"photo-frame-rendering",renderBg:"photo-frame-render-bg",renderText:"photo-frame-render-text",save:"photo-frame-save",saving:"photo-frame-saving",size:"size",sortable:"photo-frame-sortable",sortablePlaceholder:"photo-frame-sortable-placeholder",toolbar:"photo-frame-toolbar",toolBarToggle:"photo-frame-toolbar-toggle",tools:"photo-frame-tools",upload:"photo-frame-upload",wrapper:"photo-frame-wrapper"},cropSettings:{},fileBrowserResponseInProgress:!1,forceCrop:!0,disableCrop:!1,events:{},icons:{cancel:"icon-cancel",editPhoto:"icon-edit",deletePhoto:"icon-trash",info:"icon-info",cog:"icon-cog",rotate:"icon-rotate",save:"icon-save",tools:"icon-tools",warningSign:"icon-warning-sign"},overflow:!1,photos:[],settings:{},ui:{},windows:[],$wrapper:!1,zIndexCount:1,constructor:function(b,c){var d=this,e=a.extend(!0,{},c.photos);d.events={},d.settings={},d.cropSettings={},d.windows=[],d.index=PhotoFrame.instances.length,d.callbacks=a.extend(!0,{browse:function(){},buildUploadUrl:function(){return!1},init:function(){},responseHandlerSettings:function(){return{}}},c.callbacks),PhotoFrame.instances.push(d),d.$wrapper=a(b),d.sortable(),d.base(c),d.ui={body:a("body"),browse:d.$wrapper.find("."+d.classes.browse),upload:d.$wrapper.find("."+d.classes.upload),form:a("#"+d.classes.upload),dimmer:a("."+d.classes.dimmer),activity:a("."+d.classes.activity),preview:d.$wrapper.find("."+d.classes.preview),helper:d.$wrapper.find("."+d.classes.helper)};var f=['<form id="'+d.classes.upload+'" class="'+d.classes.form+" "+d.classes.wrapper+" "+d.classes.icons+'" action="'+PhotoFrame.Actions.upload_photo+(d.IE()?"&ie=true":"")+"&index="+d.index+'" method="POST" enctype="multipart/form-data" id="'+d.classes.upload+"-"+d.index+'" '+(d.IE()?'target="photo-frame-iframe-'+d.index+'"':"")+">","<h3>"+PhotoFrame.Lang.select_file+"</h3>",'<input type="file" name="files[]" multiple>','<button type="submit" class="'+d.classes.button+'"><span class="icon-upload"></span>'+d.buttonText+"</button>","</form>"].join("");d.ui.form=a(f),d.ui.form.submit(function(){d.IE()&&(d.ui.form.hide(),d.showProgress(0,function(){d.startUpload()}))}),d.ui.body.append(d.ui.form),d.ui.window=a(window);var f=['<div class="'+d.classes.dimmer+" "+d.classes.icons+'">','<a href="#" class="'+d.classes.metaToggle+'"><span class="'+d.icons.info+'"></span></a>','<div class="'+d.classes.infoPanel+'">','<a href="#" class="'+d.classes.close+'"><span class="'+d.icons.cancel+'"></span></a>','<p class="'+d.classes.size+'">W: <span class="width"></span> H: <span class="height"></span></p>','<div class="coords">',"<p>",'<label><b>X</b>: <span class="x"></span></label>','<label><b>Y</b>: <span class="y"></span></label>',"</p>","<p>",'<label><b>X2</b>: <span class="x2"></span></label>','<label><b>Y2</b>: <span class="y2"></span></label>',"</p>","</div>",'<p class="'+d.classes.aspect+'"></p>',"</div>",'<div class="'+d.classes.activity+'">','<span class="'+d.classes.indicator+'"></span> <p>'+PhotoFrame.Lang.uploading+"</p>",'<a class="'+d.classes.button+" "+d.classes.cancel+'"><span class="'+d.icons.cancel+'"></span> Cancel</a>',"</div>",'<div class="'+d.classes.progress+'"></div>','<div class="'+d.classes.errors+'">',"<h3>"+PhotoFrame.Lang.errors+"</h3>","<ul></ul>",'<a class="'+d.classes.button+" "+d.classes.cancel+'"><span class="'+d.icons.cancel+'"></span> Close</a>',"</div>",'<div class="'+d.classes.crop+'">','<div class="'+d.classes.cropPhoto+'"></div>','<div class="'+d.classes.renderBg+'"><div class="'+d.classes.renderText+'">'+PhotoFrame.Lang.rendering+"</div></div>",'<div class="'+d.classes.meta+'">','<a href="#" class="'+d.classes.metaClose+" "+d.classes.floatRight+'"><span class="'+d.icons.cancel+'"></span></a>',"<h3>"+PhotoFrame.Lang.photo_details+"</h3>","<ul>","<li>",'<label for="title">'+PhotoFrame.Lang.title+"</label>",'<input type="text" name="title" value="" id="title" />',"</li>","<!-- <li>",'<label for="keywords">'+PhotoFrame.Lang.keywords+"</label>",'<input type="text" name="keywords" value="" id="keywords" />',"</li> -->","<li>",'<label for="title">'+PhotoFrame.Lang.description+"</label>",'<textarea name="description" id="description"></textarea>',"</li>","</ul>","</div>",'<div class="'+d.classes.toolbar+'">','<div class="'+d.classes.tools+'">','<a href="#" class="'+d.classes.toolBarToggle+'"><i class="'+d.icons.tools+'"></i></a>',"</div>",'<a href="#"  class="'+d.classes.barButton+" "+d.classes.cancel+" "+d.classes.floatLeft+'"><span class="'+d.icons.cancel+'"></span> '+PhotoFrame.Lang.cancel+"</a>",'<a href="#"  class="'+d.classes.barButton+" "+d.classes.save+" "+d.classes.floatRight+'"><span class="'+d.icons.save+'"></span> '+PhotoFrame.Lang.save+"</a>","</div>","</div>","</div>"].join("");d.ui.dimmer=a(f),d.ui.toolbar=d.ui.dimmer.find("."+d.classes.toolbar),d.ui.tools=d.ui.toolbar.find("."+d.classes.tools),d.ui.toolBarToggle=d.ui.toolbar.find("."+d.classes.toolBarToggle),d.ui.infoToggle=d.ui.toolbar.find("."+d.classes.infoToggle),d.ui.toolbar.hide(),d.ui.body.append(d.ui.dimmer),d.infoPanel&&(d.ui.info=d.ui.dimmer.find("."+d.classes.infoPanel),d.ui.info.draggable(),d.ui.info.find("."+d.classes.close).click(function(a){d.ui.info.fadeOut(),a.preventDefault()})),d.ui.progress=d.ui.dimmer.find("."+d.classes.progress),d.ui.save=d.ui.dimmer.find("."+d.classes.save),d.ui.cancel=d.ui.dimmer.find("."+d.classes.cancel),d.ui.errors=d.ui.dimmer.find("."+d.classes.errors),d.ui.errorCancel=d.ui.dimmer.find("."+d.classes.errors+" ."+d.classes.cancel),d.ui.crop=d.ui.dimmer.find("."+d.classes.crop),d.ui.cropPhoto=d.ui.dimmer.find("."+d.classes.cropPhoto),d.ui.meta=d.ui.dimmer.find("."+d.classes.meta),d.ui.metaToggle=d.ui.dimmer.find("."+d.classes.metaToggle),d.ui.metaClose=d.ui.dimmer.find("."+d.classes.metaClose),d.ui.metaTitle=d.ui.meta.find("#title"),d.ui.metaDescription=d.ui.meta.find("#description"),d.ui.metaKeywords=d.ui.meta.find("#keywords"),d.ui.dropZone=d.$wrapper.find("."+d.classes.dropZone),d.buttonBar=new PhotoFrame.ButtonBar(d,d.buttons,{title:PhotoFrame.Lang.tools}),d.buttonBar.ui.window.addClass("photo-frame-button-bar"),a(window).keyup(function(a){27==a.keyCode&&d.ui.cancel.click()}),d.progressBar=new PhotoFrame.ProgressBar(d.ui.progress,{callbacks:{cancel:function(){d.cancel=!0,d.jqXHR&&d.jqXHR.abort(),d.ui.dimmer.fadeOut(),d.resetProgress()}}}),d.ui.errorCancel.click(function(a){d.clearNotices(),d.ui.dimmer.fadeOut("fast"),d.hideMeta(),d.hideProgress(),a.preventDefault()}),d.IE()?(d.ui.iframe=a('<iframe name="photo-frame-iframe-'+d.index+'" id="photo-frame-iframe-'+d.index+'" src="" style="display:none;width:0;height:0"></iframe>'),d.ui.body.append(d.ui.iframe)):d.ui.form.fileupload({started:function(){d.showProgress(0)},progress:function(a,b){d.showProgress(.5*parseInt(b.loaded/b.total*100))},pasteZone:null,singleFileUploads:!1,dropZone:d.ui.dropZone,url:d.getUploadUrl(),add:function(a,b){d.maxPhotos>0&&d.maxPhotos<=d.getTotalPhotos()?d.showErrors([PhotoFrame.Lang.max_photos_error],{max_photos:d.maxPhotos,max_photos_name:1==d.maxPhotos?"photo":"photos"}):b.files.length>0&&(d.ui.dropZone.hide(),d.initialized=!1,d.showProgress(0),d.startUpload(b.files,function(){d.jqXHR=b.submit()}))},fail:function(){d.cancel||d.showErrors([PhotoFrame.Lang.unexpected_error]),d.cancel=!1},done:function(b,c){var e=[];if(("undefined"==typeof c.result[0]||"string"==typeof c.result)&&(e=[PhotoFrame.Lang.unexpected_error]),"object"==typeof c.result&&1==c.result.length)d.showProgress(75,function(){d._uploadResponseHandler(c.result[0])});else{var f=1;"undefined"!=typeof c.result[0].success?d.showProgress(100,function(){a.each(c.result,function(a,b){d._uploadResponseHandler(b,!0,!0,function(){f==c.result.length&&(d.hideProgress(),d.hideDimmer()),f++})})}):(d.hideProgress(),d.showErrors(e),d.log(c.result))}}}),d.photos=[];for(var g in e){var h=e[g];new PhotoFrame.Photo(d,h,{id:h.id,manipulations:h.manipulations,index:g,cropSettings:a.extend({},c.cropSettings,{setSelect:[h.x,h.y,h.x2,h.y2]}),$wrapper:d.$wrapper.find("#"+d.classes.photo+"-"+d.fieldId+"-"+g)})}a(window).resize(function(){"none"!=d.ui.crop.css("display")&&d.ui.crop.center(),"none"!=d.ui.meta.css("display")&&d.ui.meta.center(),d.ui.saving&&d.ui.saving.center(),"none"!=d.ui.errors.css("display")&&d.ui.errors.center()}),d.ui.metaToggle.click(function(a){d.toggleMeta(),a.preventDefault()}),d.ui.metaClose.click(function(a){d.hideMeta(),a.preventDefault()}),d.ui.browse.click(function(){d.callback(d.callbacks.browse)}),d.ui.toolBarToggle.click(function(a){d.toggleTools(),a.preventDefault()}),d.ui.infoToggle.click(function(a){d.toggleMeta(),a.preventDefault()}),d.$wrapper.bind("dragover",function(a){var b=d.$wrapper.find("."+d.classes.dropText),c=b.parent();(0==d.maxPhotos||d.maxPhotos>d.getTotalPhotos())&&(d.ui.dropZone.show(),b.position({of:c,my:"center",at:"center"}),d.$wrapper.addClass(d.classes.dragging)),a.preventDefault()}),d.$wrapper.find("."+d.classes.dropCover).bind("drop dragleave",function(b){a(b.target).hasClass(d.classes.dropTag)||d.$wrapper.removeClass(d.classes.dragging),b.preventDefault()}),d.ui.upload.click(function(a){d.isNewPhoto=!0,d.IE()?(d.ui.dimmer.show(),d.ui.crop.hide(),d.ui.instructions&&d.ui.instructions.hide(),d.ui.form.show().center()):(d.ui.form.css({position:"absolute",left:-1e3}).show(),d.ui.form.find("input").show().click()),a.preventDefault()}),d.bind("startCropBegin",function(){d.hideOverflow()}),d.bind("saveEnd",function(){d.resetOverflow()}),d.bind("cancel",function(){d.resetOverflow()}),d.callback(d.callbacks.init)},getSettings:function(){return this.settings},getSetting:function(a){var b=this.getSettings(),a="photo_frame_"+a;return b[a]?b[a]:void 0},getUploadUrl:function(){var a=PhotoFrame.Actions.upload_photo,b=this.callbacks.buildUploadUrl();return b?b:a},parse:function(b,c,d){if("object"!=typeof c){var e={};e[c]=d,c=e}return a.each(c,function(a,c){b=b.replace("{"+a+"}",c)}),b},showError:function(a,b){var c=this;a=this.parse(a,b),c.hideProgress(function(){c.ui.errors.find("ul").append("<li>"+a+"</li>"),c.ui.errors.show(),c.ui.errors.center(),c.ui.dimmer.fadeIn(),c.progressBar.reset()})},showErrors:function(b,c){var d=this;d.ui.errors.find("ul").html(""),d.ui.errors.hide(),d.ui.activity.hide(),d.ui.crop.hide(),d.ui.form.hide(),d.progressBar.hide(),a.each(b,function(a,b){d.showError(b,c)})},hideDimmer:function(a){this.buttonBar&&this.buttonBar.hide(!1),this.hideInstructions(),this.ui.dimmer.hide(a),this.ui.form.hide(),this.ui.errors.fadeOut(),this.progressBar.reset()},sortable:function(){this.sortable&&(this.ui.list=this.$wrapper.find("."+this.classes.sortable),this.ui.list.sortable({placeholder:this.classes.sortablePlaceholder}),this.ui.list.disableSelection())},clearNotices:function(a){for(var b in this.notices)this.notices[b].clear(a)},notify:function(b,c,d){function e(){var c=a('<div class="'+f.classes.panel+" "+f.classes.icons+'" />');a.each(b,function(b,d){d=a(['<div class="'+f.classes.message+'">','<p><span class="'+f.icons.warningSign+'"></span>'+d+"</p>",'<a href="#" class="'+f.classes.close+'"><span class="'+f.icons.cancel+'"></span></a>',"</div>"].join("")),h.push(d),c.append(d)}),a("body").append(c)}var f=this,g=a("."+f.classes.panel),h=[];c||(c=190),d||(d=300),1==g.length?g.fadeOut(function(){g.remove(),f.notify(b,c,d)}):e();var i=0,j=0;return a.each(h,function(b,e){setTimeout(function(){a(e).animate({right:50},d,function(){setTimeout(function(){a(e).animate({right:-a(e).width()-75},d)},5e3+j),j=c*(b+1)})},i),i=c*(b+1)}),a(".photo-frame-message .photo-frame-close").click(function(){a(this).parent().fadeOut("fast")}),b},getTotalPhotos:function(){var b=0;return a.each(this.photos,function(a,c){c&&b++}),b},hideOverflow:function(){this.overflow=a("body").css("overflow"),a("body").css("overflow","hidden")},resetOverflow:function(){a("body").css("overflow",this.overflow)},_assetResponseHandler:function(a,b,c){var d=this;if("function"==typeof b&&(c=b,b=100),"undefined"==typeof b||b===!1)var b=100;d.showProgress(b,function(){d._uploadResponseHandler(a,!0,!0,function(a){d.hideDimmer(),"function"==typeof c&&c(a)})})},_uploadResponseHandler:function(a,b,c,d){if("function"==typeof existingAssets&&(d=b,existingAssets=!1),"function"==typeof c&&(d=b,c=!1),this.response=a,this.ui.toolbar.hide(),this.response.success){b||this.$wrapper.append('<textarea name="'+this.fieldName+'[][uploaded]" style="display:none">{"field_id": "'+this.fieldId+'", "col_id": "'+this.colId+'", "row_id": "'+this.rowId+'", "path": "'+this.response.file_path+'", "original_path": "'+this.response.original_path+'", "file": "'+this.response.file_name+'"}</textarea>');var e={cropSettings:this.cropSettings,compression:this.compression,size:this.size,forceCrop:this.forceCrop,disableCrop:this.disableCrop,manipulations:{},index:this.photos.length},f=new PhotoFrame.Photo(this,a,e);c||!f.forceCrop||f.disableCrop?f._loadFromResponse(a,function(){f.factory.hideProgress(function(){f.factory.hideDimmer(),"function"==typeof d&&d()})}):f.startCrop()}else this.showErrors(this.response.errors)},IE:function(){return this.$wrapper.children().hasClass(this.classes.ie)},hideInstructions:function(){this.ui.instructions&&(this.ui.instructions.hide(),this.ui.instructions.remove())},_fileBrowserResponseHandler:function(b,c,d){"function"==typeof c&&(d=c,c=!1);var e=this,f={fieldId:e.fieldId,varId:e.varId,colId:e.colId,siteId:e.siteId,file:b,assetId:c?c:!1,gridId:e.gridId?e.gridId:!1};f=a.extend({},f,this.callbacks.responseHandlerSettings()),this.fileBrowserResponseInProgress||(this.fileBrowserResponseInProgress=!0,a.get(PhotoFrame.Actions.photo_response,f,function(a){e.fileBrowserResponseInProgress=!1,"object"!=typeof a?(e.log(a),e.showErrors([PhotoFrame.Lang.unexpected_error])):"function"==typeof d&&d(a)}))},hideMeta:function(){this.ui.metaToggle.removeClass("active"),this.ui.meta.fadeOut("fast")},hideUpload:function(){this.ui.upload.hide(),this.ui.browse.hide(),this.ui.helper.hide()},hideProgress:function(a){this.progressBar.hide(a)},resetMeta:function(){this.ui.metaTitle.val(""),this.ui.metaKeywords.val(""),this.ui.metaDescription.val("")},hash:function(a,b){var c=c||a;s="",b=b?b:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var d=0;c>d;d++)s+=b.charAt(Math.floor(Math.random()*b.length));return s},resetProgress:function(){if("undefined"==typeof a)var a=!0;this.ui.crop.hide(),this.ui.activity.hide(),this.progressBar.reset()},showMeta:function(){this.ui.metaToggle.addClass("active"),this.ui.meta.fadeIn("fast"),this.ui.meta.center(),this.ui.metaTitle.focus()},showUpload:function(){this.ui.upload.show(),this.ui.browse.show(),this.ui.helper.show()},startUpload:function(a,b){var c=this;"function"==typeof a&&(b=a,a=[]),c.IE()?c.ui.form.hide():1==a.length&&(c.ui.errors.hide(),c.ui.crop.hide()),c.ui.crop.hide(),c.ui.dimmer.fadeIn(function(){"function"==typeof b&&b()})},showProgress:function(a,b){this.ui.dimmer.fadeIn(),this.ui.errors.hide(),this.progressBar.show(),this.progressBar.set(a,b),this.hideMeta(),this.hideInfo()},toggleMeta:function(){"none"==this.ui.meta.css("display")?this.showMeta():this.hideMeta()},toggleTools:function(){this.buttonBar&&(this.buttonBar.isVisible()?this.hideTools():this.showTools())},showTools:function(a){this.buttonBar&&this.buttonBar.show(a)},hideTools:function(a){this.buttonBar&&this.buttonBar.hide(a)},hideInfo:function(a){this.ui.info&&this.ui.info.hide(a)},showInfo:function(a){this.ui.info&&this.ui.info.fadeIn(a)},bind:function(a,b){this.events[a]||(this.events[a]=[]),"function"==typeof b&&this.events[a].push(b)},trigger:function(b){for(var c=arguments,d=[],e=1;e<=c.length;e++)"undefined"!=typeof c[e]&&d.push(c[e]);this.events[b]&&a.each(this.events[b],function(a,b){b.apply(this,d)})}}),PhotoFrame.ButtonBar=PhotoFrame.Class.extend({buttons:[],classes:{active:"photo-frame-active",wrapper:"photo-frame-toolbar-tools",list:"photo-frame-toolbar-tools-list",titleBar:"photo-frame-toolbar-tools-title"},factory:!1,title:!1,ui:{list:!1,titleBar:!1,window:!1},constructor:function(a,b,c){this.ui={},this.buttons=[],this.base(c),this.factory=a,this._buildButtonBar(),this.addButtons(b),this.savePosition(),0===this.buttons.length&&this.factory.ui.tools.hide()},addButton:function(b,c){var b=this.loadButton(b,c);if(b&&b.isActive()){var d=a("<li />").append(b.$obj);this.ui.list.append(d)}this.buttons.push(b)},addButtons:function(a,b){for(var c in a){var d=a[c];this.addButton(d,b)}},unclick:function(){},click:function(){},loadButton:function(b,c){if("object"!=typeof c&&(c={}),PhotoFrame.Buttons[b.ucfirst()]){var d=new(PhotoFrame.Buttons[b.ucfirst()])(this,a.extend(!0,{},{name:b},c));return d}this.log('The "'+b.ucfirst()+'" button does not exist.')},isVisible:function(){return"none"!=this.ui.window.css("display")?!0:!1},show:function(a,b){"undefined"==typeof a?a=!0:"function"==typeof a&&(b=a,a=!0),this.buttons.length>0&&(this.factory.ui.toolBarToggle.addClass(this.classes.active),this.ui.window.fadeIn(b),a&&this.setVisibility(!0),this.showWindows()),this.savePosition()},hide:function(a,b){var c=this;"undefined"==typeof a?a=!0:"function"==typeof a&&(b=a,a=!0);for(var d in this.factory.windows)this.factory.windows[d].close(!1);this.ui.list.find("."+this.classes.active).removeClass(this.classes.active),this.ui.window.fadeOut(function(){c.factory.ui.toolBarToggle.removeClass(c.factory.classes.active)}),a&&this.setVisibility(!1),this.savePosition()},showWindows:function(){for(var a in this.factory.windows){var b=this.factory.windows[a];b.visible&&b.open()}},hideWindows:function(){for(var a in this.factory.windows){var b=this.factory.windows[a];b.visible||b.close(!1)}},position:function(){if(this.hasPosition()){var a=this.getPosition();this.ui.window.css({left:a.x,top:a.y,position:"fixed"}),this.savePosition()}},_buildButtonBar:function(){var b=this;this.ui.window=a(['<div class="'+this.classes.wrapper+'">','<div class="'+this.classes.titleBar+'">'+this.title+"</div>",'<ul class="'+this.classes.list+'"></ul>',"</div>"].join("")).css("z-index",1),this.ui.titleBar=this.ui.window.find("."+this.classes.titleBar),this.ui.list=this.ui.window.find("."+this.classes.list),this.factory.ui.dimmer.append(this.ui.window),this.ui.window.draggable({handle:this.ui.titleBar,containment:"parent",scroll:!1,start:function(){b.bringToFront()},stop:function(){b.savePosition()}}),this.ui.titleBar.mousedown(function(){b.bringToFront()}),this.position()}}),PhotoFrame.Button=PhotoFrame.Class.extend({buttonBar:!1,icon:!1,name:!1,description:!1,$obj:!1,packageName:!1,renderAfterRemovingLayer:!0,window:!1,windowSettings:{css:"",title:!1},constructor:function(b,c,d){var e=this;"undefined"==typeof d&&(d=!0),this.ui={},this.buttonBar=b,this.base(c),this.$obj=a('<a href="#" title="'+this.description.replace('"',"")+'"></a>'),this.$obj.append("<i />").find("i").addClass("icon-"+(this.icon?this.icon:this.name.toLowerCase())),this.$obj.click(function(a){e.click(a),a.preventDefault()}),this.packageName||(this.packageName=this.name),d===!0&&this.buildWindow()},getPackageName:function(){return(this.packageName?this.packageName:this.name).toLowerCase()},showManipulation:function(){this.cropPhoto().showManipulation(this.getPackageName())},hideManipulation:function(){this.cropPhoto().hideManipulation(this.getPackageName())},addManipulation:function(a,b){this.cropPhoto().addManipulation(this.getPackageName(),a,b)},cropPhoto:function(){return this.buttonBar.factory.cropPhoto},updateJson:function(){this.cropPhoto().updateJson()},render:function(a){this.cropPhoto().render(a)},removeManipulation:function(){delete this.buttonBar.factory.cropPhoto.manipulations[this.getPackageName()],this.buttonBar.factory.trigger("removeManipulation",this)},bind:function(a,b){this.buttonBar.factory.bind(a,b)},buildWindow:function(b){"object"==typeof b&&(this.windowSettings=a.extend(!0,{},this.windowSettings,b)),this.window=new PhotoFrame.Window(this.buttonBar.factory,this.$obj,this.windowSettings)},click:function(){this.$obj.hasClass(this.buttonBar.classes.active)?(this.buttonBar.unclick(),this.$obj.removeClass(this.buttonBar.classes.active),this.window.close()):(this.buttonBar.click(),this.$obj.addClass(this.buttonBar.classes.active),this.window.open())},hideWindow:function(){this.$obj.removeClass(this.buttonBar.classes.active),this.window.close()},isActive:function(){return!0},showWindow:function(){this.$obj.addClass(this.buttonBar.classes.active),this.window.open(),this.window.position()},getVisibility:function(){return this.getManipulation()?this.getManipulation().visible:!0},getManipulation:function(){return this.cropPhoto()?this.cropPhoto().getManipulation(this.getPackageName()):!1},setManipulation:function(a){var b=this.getManipulation();b.visible=a},removeLayer:function(){this.reset()},startRendering:function(a){this.cropPhoto().startRendering(a)},stopRendering:function(a){this.cropPhoto().stopRendering(a)},startCrop:function(){var a=this.getManipulation();a&&(a.visible?this.enable():this.disable())},toggleLayer:function(a,b){a?this.enable():this.disable(),this.setManipulation(a),("undefined"==typeof b||b===!0)&&this.render()},getData:function(){return{}},getSettings:function(){return this.buttonBar.factory.getSettings()},getSetting:function(a){return this.buttonBar.factory.getSetting(a)},save:function(a,b){(a.length>0||b)&&this.addManipulation(this.getVisibility(),a),this.updateJson()},apply:function(){},enable:function(){},disable:function(){},reset:function(){},startCropCallback:function(){},startCropCallbackFailed:function(){}}),PhotoFrame.Window=PhotoFrame.Class.extend({buttons:[],css:"",callbacks:{drag:function(){},dragstart:function(){},dragend:function(){},close:function(){},open:function(){}},classes:{close:"photo-frame-tool-window-close",title:"photo-frame-tool-window-title",window:"photo-frame-tool-window",content:"photo-frame-tool-window-content",buttons:"photo-frame-tool-window-buttons",button:"photo-frame-tool-window-button",save:"photo-frame-tool-window-save",wrapper:"photo-frame-toolbar-tools"},duration:333,easeIn:"easeInElastic",easeOut:"easeOutElastic",factory:!1,icons:{close:"icon-cancel"},parent:!1,title:!1,ui:{close:!1,content:!1,title:!1,window:!1},width:!1,constructor:function(a,b,c){this.ui={},this.factory=a,this.parent=b,this.base(c),this.title||(this.title="New Window "+this.factory.windows.length),this.buildWindow(),this.visible=this.getVisibility(),a.windows.push(this)},bringToFront:function(){this.factory.zIndexCount++,this.ui.window.css("z-index",this.factory.zIndexCount)},buildButtons:function(){var b=this;a.each(this.buttons,function(c,d){var e=d.css?d.css:"",f=d.text?d.text:"",g=d.icon?'<i class="'+d.icon+'"></i>':"",h=a('<a href="#" class="'+e+" "+b.classes.button+'">'+g+f+"</a>");d.ui={button:h},"function"==typeof d.init&&d.init(d),"function"==typeof d.onclick&&h.click(function(a){return d.onclick(a,d),a.preventDefault(),!1}),b.ui.buttons.append(h)})},buildWindow:function(){var b=this,c=a(['<div class="'+this.classes.wrapper+" "+this.classes.window+'">','<a href="#" class="'+this.classes.close+'"><i class="'+this.icons.close+'"></i></a>','<div class="'+this.classes.title+'">'+(this.title?this.title.ucfirst():"N/A")+"</div>",'<div class="'+this.classes.content+'"></div>','<div class="'+this.classes.buttons+" "+this.factory.classes.clearfix+'"></div>',"</div>"].join(""));this.ui.window=c,this.ui.buttons=c.find("."+this.classes.buttons),this.ui.close=c.find("."+this.classes.close),this.ui.content=c.find("."+this.classes.content),this.ui.title=c.find("."+this.classes.title),this.ui.window.addClass(this.css),this.ui.window.draggable({handle:this.ui.title,containment:"parent",scroll:!1,drag:this.callbacks.drag,start:function(a){b.bringToFront(),b.callback(b.callbacks.dragstart,a)},stop:function(a){b.savePosition(),b.callback(b.callbacks.dragend,a)}}),this.width&&this.ui.window.width(this.width),this.ui.window.mousedown(function(){b.factory.trigger("windowMousedown",b),b.bringToFront()}),this.ui.close.click(function(a){b.close(),a.preventDefault()}),this.buildButtons(),this.factory.ui.dimmer.append(c)},close:function(a,b){var c=this;"undefined"==typeof a?a=!0:"function"==typeof a&&(b=a,a=!0),this.parent.removeClass(this.factory.buttonBar.classes.active),this.ui.window.fadeOut({duration:this.duration},function(){c.callback(c.callbacks.close),c.callback(b)}),a&&this.setVisibility(!1)},open:function(a,b){var c=this;this.factory.trigger("windowOpenBegin",this),"undefined"==typeof a?a=!0:"function"==typeof a&&(b=a,a=!0),this.parent.addClass(this.factory.buttonBar.classes.active),this.ui.window.fadeIn({duration:this.duration}).css("display","inline-block").css("position","fixed"),setTimeout(function(){c.callback(c.callbacks.open),c.callback(b),c.factory.trigger("windowOpenEnd",c)},this.duration),1!=this.ui.window.data("open")&&this.position(),this.bringToFront(),this.ui.window.data("open",1),this.setVisibility(!0),this.savePosition()},position:function(){var b=parseInt(this.ui.window.parent().index())+1,c=this.getPosition(),d=c?parseInt(c.x.replace("px","")):0;if(this.ui.window.position({of:this.parent,my:"left top",at:"right top",collision:"flip"}),d+this.ui.window.width()>a(window).width()&&(c.x=a(window).width()-this.ui.window.width()+"px"),this.hasPosition())this.ui.window.css({left:c.x,top:c.y}).position("collision","fit");else{var e=16;b%2==0&&this.shift("left",e),this.shift("left",e)}this.bringToFront(),this.savePosition()},shift:function(a,b){var c=parseInt(this.ui.window.css(a).replace("px",""));this.ui.window.css(a,c+b)},isOpen:function(){return"none"==this.ui.window.css("display")?!1:!0},toggle:function(){this.isOpen()?this.close():this.open()}}),PhotoFrame.Photo=PhotoFrame.Class.extend({cache:!1,cacheUrl:!1,compression:100,cropSettings:{},description:"",disableCrop:!1,edit:!1,factory:!1,forceCrop:!0,index:!1,initialized:!1,id:!1,jcrop:!1,keywords:"",manipulations:{},originalManipulations:{},originalPath:!1,originalUrl:!1,path:!1,rendering:!1,size:!1,title:"",ui:{actionBar:!1,edit:!1,del:!1,image:!1,photo:!1,rendering:!1,saving:!1},url:!1,useCache:!1,released:!1,$wrapper:!1,constructor:function(a,b,c){var d=this;this.ui={},this.$wrapper=!1,this.cache=a.hash(12),this.base(c),this.factory=a,this.title=b.title,this.description=b.description,this.keywords=b.keywords,this.response=b,this.originalPath=b.original_path,this.originalUrl=b.original_url,this.url=b.url,this.path=b.file_path,this.ui.rendering=this.factory.ui.crop.find("."+this.factory.classes.renderBg),this.ui.renderingTxt=this.factory.ui.crop.find("."+this.factory.classes.renderText),this.manipulations||(this.manipulations={}),this.index||(this.index=this.factory.getTotalPhotos()),this.$wrapper?this._loadFromObj(this.$wrapper):this._bindClickEvents(),a.photos.push(d)},_loadFromResponse:function(b,c){var d=this,e=a(["<li>",'<div class="'+d.factory.classes.photo+'" id="'+d.factory.classes.photo+"-"+d.factory.fieldId+"-"+d.index+'">','<div class="'+d.factory.classes.actionBar+'">',d.factory.disableCrop?"":'<a href="#'+d.index+'" class="'+d.factory.classes.editPhoto+'"><span class="'+d.factory.icons.editPhoto+'"></span></a>','<a href="#'+d.index+'" class="'+d.factory.classes.deletePhoto+'"><span class="'+d.factory.icons.deletePhoto+'"></span></a>',"</div>","</div>","</li>"].join(""));d.load(b.file_url,function(a){var f=e.find("."+d.factory.classes.photo);d.cachePath||(d.cachePath=b.directory.server_path+d.cache+"."+d.extension(b.file_name)),d._sendCropRequest(function(b){f.prepend(a).append(d._generateNewDataField(b.save_data)),d.factory.ui.preview.find("ul").append(e),d._loadFromObj(f,c)})})},_loadFromObj:function(b,c){var d=this;d.edit=d,d.ui.photo=a(b),d.ui.parent=d.ui.photo.parent(),d.ui.actionBar=d.ui.parent.find("."+d.factory.classes.actionBar),d.ui.edit=d.ui.actionBar.find("."+d.factory.classes.editPhoto),d.ui.del=d.ui.actionBar.find("."+d.factory.classes.deletePhoto),d.ui.field=d.ui.photo.find("textarea"),d._bindClickEvents(),"function"==typeof c&&c()},_bindClickEvents:function(){var a=this;a.ui.edit&&a.ui.edit.unbind("click").click(function(b){a.showProgress(0),a.startCrop(),b.preventDefault()}),a.ui.del&&a.ui.del.unbind("click").click(function(b){a.remove(),b.preventDefault()})},extension:function(a){return a.split(".").pop()
},remove:function(){var a=this;a.ui.field.remove(),a.id!==!1&&a.factory.$wrapper.append('<input type="hidden" name="photo_frame_delete_photos['+a.factory.delId+'][]" value="'+a.id+'" />'),a.ui.parent.fadeOut(function(){a.ui.parent.remove(),a.factory.maxPhotos>0&&a.factory.maxPhotos>a.factory.getTotalPhotos()-1||0==a.factory.minPhotos&&0==a.factory.maxPhotos?a.factory.showUpload():a.factory.hideUpload(),a.factory.photos[a.index]=!1})},hideManipulation:function(a){var b=a.toLowerCase(),c=this.manipulations[b]?this.manipulations[b]:!1;this.manipulations[b]&&(this.manipulations[b].visible=!1),this.factory.trigger("hideManipulation",this,b,c)},showManipulation:function(a){var b=a.toLowerCase(),c=this.manipulations[b]?this.manipulations[b]:!1;this.manipulations[b]&&(this.manipulations[b].visible=!0),this.factory.trigger("showManipulation",this,b,c)},addManipulation:function(a,b,c){var d=a.toLowerCase(),e=this.manipulations[d]?this.manipulations[d]:!1;c&&(this.manipulations[d]={visible:b,data:c}),this.factory.trigger("addManipulation",this,d,e)},getManipulation:function(a){return a=a.toLowerCase(),this.manipulations[a]?this.manipulations[a]:!1},getManipulations:function(){return this.manipulations},showMeta:function(){this.factory.showMeta()},hideMeta:function(){this.factory.hideMeta()},hideInstructions:function(){this.factory.hideInstructions()},initJcrop:function(a){var b=this;if(b.factory.ui.toolbar.show(),b.initialized&&b.destroyJcrop(),b.cropSettings.onChange=function(){b.hideInstructions(),b.updateInfo(),this.released=!1,b.factory.trigger("jcropOnChange",this)},b.cropSettings.onRelease=function(){this.released=!0,b.factory.trigger("jcropOnRelease",this)},b.cropSettings.onSelect=function(){this.released=!1,b.factory.trigger("jcropOnSelect",this)},b.cropSettings.setSelect){var c=0;for(var d in b.cropSettings.setSelect)c+=b.cropSettings.setSelect[d];0==c&&delete b.cropSettings.setSelect}b.ui.cropPhoto.Jcrop(b.cropSettings,function(){b.jcrop=this,"function"==typeof a&&a(this)}),b.initialized=!0},destroyJcrop:function(){this.jcrop&&this.jcrop.destroy(),this.jcrop=!1,this.initialized=!1},releaseCrop:function(){this.jcrop.setSelect([0,0,0,0]),this.jcrop.release(),this.released=!0},hideProgress:function(){this.factory.hideProgress()},showProgress:function(){this.factory.showProgress()},clearNotices:function(a){this.factory.clearNotices(a)},getSaveData:function(){return this.ui.field?this.ui.field.val():!1},setSaveData:function(a){this.ui.field&&this.ui.field.val(a).html(a)},updateJson:function(){var a=this.jsonEncode(this.getSaveData());a.manipulations=this.getManipulations(),this.setSaveData(this.jsonDecode(a))},render:function(b){var c=this;!this.isRendering()&&c.ui.cropPhoto?(this.startRendering(),this.useCache=!0,a.post(PhotoFrame.Actions.render,{fieldId:this.factory.fieldId,colId:this.factory.colId,varId:this.factory.varId,gridId:this.factory.gridId,path:this.path,originalPath:this.originalPath,originalUrl:this.originalUrl,cachePath:this.cachePath,cacheUrl:this.cacheUrl,cache:this.cache,manipulations:c.getManipulations(),directory:this.factory.directory,preview:!0},function(a){c.cacheUrl=a.url,c.load(a.url,function(d){c.ui.cropPhoto.html(d),c.stopRendering(),c.callback(b,a),c.factory.trigger("render")})})):c.callback(b)},totalManipulations:function(){var a=0;for(var b in this.manipulations)a++;return a},needsRendered:function(){var a=this.totalManipulations();return!a||1==a&&this.manipulations.crop?!1:a>0?!0:void 0},needsRendering:function(){return this.needsRendered()},isRendering:function(){return this.rendering},startRendering:function(a){this.rendering=!0,this.factory.trigger("startRendering"),this.factory.ui.dimmer.addClass(this.factory.classes.rendering),this.callback(a)},stopRendering:function(a){this.rendering=!1,this.factory.trigger("stopRendering"),this.factory.ui.dimmer.removeClass(this.factory.classes.rendering),this.callback(a)},tellScaled:function(){return this.jcrop?this.jcrop.tellScaled():[0,0,0,0]},updateInfo:function(){var a=this;if(a.factory.ui.info){var b=a.cropDimensions(),c=b.a;a.factory.ui.info.fadeIn(),a.factory.ui.info.find(".size .width").html(Math.ceil(b.w)+"px"),a.factory.ui.info.find(".size .height").html(Math.ceil(b.h)+"px"),a.factory.ui.info.find(".aspect").html("("+c[0]+":"+c[1]+")"),a.factory.ui.info.find(".x").html(Math.ceil(b.x)+"px"),a.factory.ui.info.find(".x2").html(Math.ceil(b.x2)+"px"),a.factory.ui.info.find(".y").html(Math.ceil(b.y)+"px"),a.factory.ui.info.find(".y2").html(Math.ceil(b.y2)+"px");var d=a.validate(!0);a.factory.ui.info.find(".width").removeClass(a.factory.classes.invalid),a.factory.ui.info.find(".height").removeClass(a.factory.classes.invalid),a.factory.ui.info.find(".aspect").removeClass(a.factory.classes.invalid),d.validWidth||a.factory.ui.info.find(".width").addClass(a.factory.classes.invalid),d.validHeight||a.factory.ui.info.find(".height").addClass(a.factory.classes.invalid),d.validRatio||a.factory.ui.info.find(".aspect").addClass(a.factory.classes.invalid)}a.factory.ui.instructions&&"none"!=a.factory.ui.instructions.css("display")&&a.factory.initialized&&a.factory.ui.instructions.fadeOut()},load:function(a,b){"function"==typeof a&&(b=a,a=this.photoUrl()),window.loadImage(a,function(a){"function"==typeof b&&b(a)})},photoUrl:function(){return this.useCache?this.cacheUrl:this.originalUrl},startCrop:function(b){this.factory.cropPhoto=this;var c=this,d={fieldId:this.factory.fieldId?this.factory.fieldId:!1,varId:this.factory.varId?this.factory.varId:!1,colId:this.factory.colId?this.factory.colId:!1,gridId:this.factory.gridId?this.factory.gridId:!1,cache:this.cache,originalUrl:this.originalUrl,originalPath:this.originalPath,exifData:this.response.exif_string?this.response.exif_string:"",manipulations:this.manipulations,directory:this.factory.directory};c.originalManipulations=a.extend(!0,{},c.manipulations),c.factory.buttonBar&&a.each(c.factory.buttonBar.buttons,function(a,b){b.reset()}),c.factory.trigger("startCropBegin",c),c.factory.ui.dimmer.fadeIn("fast"),c.initialized||c.factory.ui.cropPhoto.remove(),c.factory.resetMeta(),a.post(PhotoFrame.Actions.start_crop,d,function(e){e.success?c.factory.showProgress(100,function(){c.useCache=!0,c.cacheUrl=e.cacheUrl,c.cachePath=e.cachePath,e.success?(a.each(c.factory.buttonBar.buttons,function(a,b){b.startCropCallback(c,d,e.data)}),c.factory.trigger("startCropCallback",c,d,e.data)):(a.each(c.factory.buttonBar.buttons,function(a,b){b.startCropCallbackFailed(c,d,e.data)}),c.factory.trigger("startCropCallbackFailed",c,d,e)),c.load(c.photoUrl(),function(d){if(c.factory.hideProgress(),c.ui.cropPhoto=a('<div class="'+c.factory.classes.cropPhoto+'"></div>'),c.factory.ui.cropPhoto=c.ui.cropPhoto,c.factory.trigger("cropPhotoLoaded",c,d),c.ui.instructions=a('<div class="" />').html(PhotoFrame.Lang.instructions),"true"!=c.factory.settings.photo_frame_hide_instructions&&(c.factory.instructions&&c.edit===!1?(c.factory.ui.instructions=a('<div class="'+c.factory.classes.instructions+'" />').html(c.factory.instructions),c.factory.ui.dimmer.append(c.factory.ui.instructions)):c.factory.ui.instructions&&c.factory.ui.instructions.hide()),c.ui.cropPhoto.html(d),c.factory.ui.crop.prepend(c.ui.cropPhoto),c.factory.ui.crop.center(),c.factory.ui.crop.show(),c.hideMeta(),c.factory.buttonBar&&c.factory.buttonBar.getVisibility()&&c.factory.showTools(),c.edit===!1&&c.size!==!1){var e=c.size.split("x");e[0]=parseInt(e[0]),e[1]=parseInt(e[1]);var f=c.ui.cropPhoto.width()/2-e[0]/2,g=f+e[0],h=c.ui.cropPhoto.height()/2-e[1]/2,i=h+e[1];c.cropSettings.setSelect=[f,h,g,i]}if(c.title&&c.factory.ui.metaTitle.val(c.title),c.keywords&&c.factory.ui.metaKeywords.val(c.keywords),c.description&&c.factory.ui.metaDescription.val(c.description),c.initJcrop(b),c.updateInfo(),a(window).resize(),c.factory.buttonBar)for(var f in c.factory.buttons)c.factory.buttonBar.buttons[f].startCrop(c);c.needsRendered()?c.render(function(){c.factory.trigger("startCropEnd",c)}):c.factory.trigger("startCropEnd",c)})}):e.errors?c.factory.showErrors(e.errors):(c.log(e),c.factory.showErrors([PhotoFrame.Lang.unexpected_error]))}),c.factory.ui.save.unbind("click").bind("click",function(a){if(c.factory.showMetaOnSave&&"none"==c.factory.ui.meta.css("display")){var b=c.validate();0==b.length?c.showMeta():c.factory.notify(b)}else c.hideMeta(),c.saveCrop();a.preventDefault()}),c.factory.ui.cancel.unbind("click").click(function(b){c.clearNotices(),c.hideMeta(),c.hideProgress(),c.manipulations=a.extend(!0,{},c.originalManipulations),c.factory.cancel=!0,c.render(),c.factory.hideDimmer(),c.factory.resetProgress(),c.factory.cropPhoto&&c.factory.cropPhoto.destroyJcrop(),c.ui.saving&&c.ui.saving.fadeOut(function(){a(this).remove()}),c.factory.trigger("cancel",c),b.preventDefault()})},save:function(a){var b=this,c=(new Date,b.edit);this.factory.trigger("saveBegin",this),c?b._updatePhoto(a):b._createPhoto(a),b.load(b.cropResponse.url,function(a){b.factory.maxPhotos>0&&b.factory.maxPhotos<=b.factory.getTotalPhotos()&&b.factory.hideUpload(),c||b.factory.ui.preview.find("ul").append(b.ui.parent),b.ui.photo.find("img").remove(),b.ui.photo.append(a),b.ui.saving&&b.ui.saving.remove(),b.hideProgress(),b.hideDimmer(),b.factory.trigger("saveEnd",b)})},hideDimmer:function(){this.factory.hideDimmer()},_createPhoto:function(b){var c=this,d=a(["<li>",'<div class="'+c.factory.classes.photo+'" id="'+c.factory.classes.photo+"-"+c.factory.fieldId+"-"+c.index+'">','<div class="'+c.factory.classes.actionBar+'">','<a href="#'+c.index+'" class="'+c.factory.classes.editPhoto+'"><span class="'+c.factory.icons.editPhoto+'"></span></a>','<a href="#'+c.index+'" class="'+c.factory.classes.deletePhoto+'"><span class="'+c.factory.icons.deletePhoto+'"></span></a>',"</div>","</div>","</li>"].join(""));c.edit=c,c.ui.parent=a(d),c.ui.photo=c.ui.parent.find("."+c.factory.classes.photo),c.ui.actionBar=c.ui.parent.find("."+c.factory.classes.actionBar),c.ui.edit=c.ui.actionBar.find("."+c.factory.classes.editPhoto),c.ui.del=c.ui.actionBar.find("."+c.factory.classes.deletePhoto),c.ui.field=c._generateNewDataField(b),c.ui.photo.append(c.ui.field),c._bindClickEvents()},_generateNewDataField:function(b){return a('<textarea name="'+this.factory.fieldName+'[][new]" id="'+this.factory.classes.editPhoto+"-"+this.factory.fieldId+"-"+this.index+'" style="display:none">'+b+"</textarea>")},_updatePhoto:function(a){this.ui.field.val(a).html(a)},saveCrop:function(){var b=this;this.factory.trigger("saveCropStart",b);var c=b.validate();c.length>0?b.factory.notify(c):(b.clearNotices(),b.ui.saving=a('<div class="'+b.factory.classes.saving+'"><span></span> '+PhotoFrame.Lang.saving+"</div>"),b.factory.ui.dimmer.append(b.ui.saving),b.factory.ui.dimmer.find("."+b.factory.classes.saving+" span").activity(),b.factory.ui.crop.fadeOut(),b.ui.info&&b.ui.info.fadeOut(),b.hideMeta(),b.ui.saving.center(),b.title=b.factory.ui.metaTitle.val(),b.description=b.factory.ui.metaDescription.val(),b.keywords=b.factory.ui.metaKeywords.val(),b._sendCropRequest(function(a){b.cropResponse=a,b.factory.cropPhoto=!1,b.destroyJcrop(),b.save(a.save_data),b.factory.trigger("saveCropStop",b,a)}))},_sendCropRequest:function(b,c){if("function"==typeof b&&(c=b,b=!1),!b)var b=this.response;var d=this,e={x:0,y:0,x2:0,y2:0,w:0,h:0},f=d.released?e:d.tellScaled();f.w&&f.h&&"true"!==this.factory.settings.photo_frame_disable_regular_crop?d.cropSettings.setSelect=[f.x,f.y,f.x2,f.y2]:(f=e,delete d.cropSettings.setSelect),a.post(PhotoFrame.Actions.crop_photo,{fieldId:d.factory.fieldId,varId:d.factory.varId,colId:d.factory.colId,gridId:d.factory.gridId,cache:d.cache,useCache:d.useCache,cacheUrl:d.cacheUrl?d.cacheUrl:b.file_url,cachePath:d.cachePath?d.cachePath:b.file_path,id:d.factory.directory.id,assetId:d.response.asset_id,index:d.factory.index,photo_id:d.id,image:b.file_path,name:b.file_name,manipulations:d.manipulations,directory:d.factory.directory,original:b.original_path,original_file:b.original_file,exifData:b.exif_string,url:b.url,edit:d.edit!==!1?!0:!1,height:f.h,width:f.w,scale:d.scale,rotate:d.rotate,resize:d.resize,resizeMax:d.resizeMax,x:f.x,x2:f.x2,y:f.y,y2:f.y2,title:d.title,description:d.description,keywords:d.keywords,compression:d.compression},function(a){"function"==typeof c&&c(a)})},isCropped:function(a){if(!a)var a=this.cropDimensions();if(!a&&this.jcrop.tellSelect)var a=this.jcrop.tellScalled();return 0==this.factory.ui.dimmer.find(".jcrop-tracker").width()?!1:"undefined"==typeof a||a.x||a.y||a.x2||a.y2?!0:!1},reduce:function(a,b){var c=function d(a,b){return 0==b?a:d(b,a%b)};return c=c(a,b),[a/c,b/c]},cropDimensions:function(a){var b={w:0,h:0,x:0,x2:0,y:0,y2:0};if(!a&&this.jcrop.tellSelect)var a=this.jcrop.tellSelect();else var a=b;var c={w:this.ui.cropPhoto.find("img").width(),h:this.ui.cropPhoto.find("img").height()};if(a.w=0==a.w?c.w:a.w,a.h=0==a.h?c.h:a.h,this.cropSettings.aspectRatio){var d=this.cropSettings.aspectRatioString.split(":");"undefined"==typeof d[0]&&(d[0]=0),"undefined"==typeof d[1]&&(d[1]=0),this.isCropped(a)||(d=[a.w,a.h]),d=this.reduce(d[0],d[1])}else var d=this.reduce(Math.ceil(a.w),Math.ceil(a.h));return this.isCropped(a)||(a=b,a.w=c.w,a.h=c.h,d=this.reduce(c.w,c.h)),a.a=d,a},round:function(a,b){if(!b)var b=100;return Math.round(a*b)/b},aspectRatio:function(a){for(var b=1,c=1,d=1,e=1e5;b!=a&&e-->0;)a>b?c+=1:(d+=1,c=parseInt(a*d,10)),b=c/d;return c+"/"+d},width:function(){return this.ui.cropPhoto?this.ui.cropPhoto.find("img").width():0},height:function(){return this.ui.cropPhoto?this.ui.cropPhoto.find("img").height():0},validate:function(a){var b=this;if(!a)var a=!1;var c=b.cropSettings.aspectRatio?b.cropSettings.aspectRatio:!1,d=b.cropDimensions(),e=d.w,f=d.h,g=b.cropSettings.minSize?b.cropSettings.minSize[0]:0,h=b.cropSettings.minSize?b.cropSettings.minSize[1]:0,i=b.cropSettings.maxSize?b.cropSettings.maxSize[0]:0,j=b.cropSettings.maxSize?b.cropSettings.maxSize[1]:0,k=b.isCropped(d),l=Math.ceil(d.h),m=Math.ceil(d.w),n=[],o=(Math.ceil(this.width()),Math.ceil(this.height()),{validWidth:!0,validHeight:!0,validRatio:!0,minWidth:g,minHeight:h,maxWidth:i,maxHeight:j,width:d.w,height:d.h,x:d.x,x2:d.x2,y:d.y,y2:d.y2,ratio:c,ratioString:b.cropSettings.aspectRatioString});return g>0&&g>m&&(o.validWidth=!1,n.push(this.factory.parse(PhotoFrame.Lang.min_width,"min_width",g))),h>0&&h>l&&(o.validHeight=!1,n.push(this.factory.parse(PhotoFrame.Lang.min_height,"min_height",h))),i>0&&m>i&&(o.validWidth=!1,n.push(this.factory.parse(PhotoFrame.Lang.max_width,"max_width",i))),j>0&&l>j&&(o.validHeight=!1,n.push(this.factory.parse(PhotoFrame.Lang.max_height,"max_height",j))),!k&&c&&b.round(c,100)!=b.round(e/f,100)&&(o.validRatio=!1,n.push(this.factory.parse(PhotoFrame.Lang.required_ratio,"aspect_ratio",b.cropSettings.aspectRatioString))),o.errors=n,a?o:n}}),PhotoFrame.ProgressBar=PhotoFrame.Class.extend({progress:0,ui:{},$wrapper:!1,constructor:function(b,c,d){var e=this;if(e.progress=0,e.ui={},e.$wrapper=a(b),"object"==typeof c&&(d=c,c=0),"undefined"==typeof c)var c=0;if("undefined"==typeof d)var d={};var f={callbacks:{init:function(){},cancel:function(){},progress:function(){},hide:function(){},show:function(){},reset:function(){}},duration:333,classes:{progress:"photo-frame-progress-fill",cancel:"photo-frame-progress-cancel",wrapper:"photo-frame-progress-wrapper"}};e.ui={obj:e.$wrapper,parent:e.$wrapper.parent(),fill:e.$wrapper.find},e.base(f,d),e.ui.obj.data("init")||(e.ui.fill=a('<div class="'+e.classes.progress+'" />'),e.ui.cancel=a('<a href="#" class="'+e.classes.cancel+'"><span class="icon-cancel"></span></a>'),e.ui.obj.wrap('<div class="'+e.classes.wrapper+" "+e.classes.icons+'" />'),e.ui.cancel.insertBefore(e.ui.obj),e.ui.obj.append(e.ui.fill),e.ui.obj.data("init","true"),e.ui.wrapper=e.ui.obj.parent("."+e.classes.wrapper),e.ui.cancel.click(function(a){e.callbacks.cancel(e,a),e.hide(function(){e.reset(0)}),a.preventDefault()}),e.callbacks.init(e),e.set(e.progress)),a(window).resize(function(){e.center()})},reset:function(a){var b=this;b.set(0,function(){b.callbacks.reset(b),"function"==typeof a&&a()})},set:function(a,b){var c=this,d=c.ui.obj.outerWidth(),e=d&&!isNaN(d)&&d>0?d:c.ui.obj.width();c.progress=parseInt(a)>100?100:parseInt(a),c.progress=parseInt(e*(a/100)),c.ui.fill.css("width",c.progress),c.callbacks.progress(c,c.progress),setTimeout(function(){"function"==typeof b&&b(c)},c.duration)},get:function(){return this.progress},center:function(){this.ui.wrapper.position({of:this.ui.parent,my:"center",at:"center"})},show:function(a,b){var c=this;if("function"==typeof a&&(b=a,a=void 0),"undefined"==typeof a)var a=c.duration;c.center(),c.ui.wrapper.fadeIn(a,function(){c.callbacks.show(c),"function"==typeof b&&b(c)}),c.center()},hide:function(a,b){var c=this;if("function"==typeof a&&(b=a,a=void 0),"undefined"==typeof a)var a=c.duration;c.ui.wrapper.fadeOut(a,function(){c.callbacks.hide(c),"function"==typeof b&&b(c)})}}),PhotoFrame.Database=PhotoFrame.Class.extend({driver:"localStorage",fields:[],model:!1,name:!1,reset:!1,constructor:function(a){this.base(a),this.model=new localStorageDB("PhotoFrame",this.driver),this.reset&&this.clear(),this._firstRun()},clear:function(){this.model.dropTable(this.name),this.model.commit()},create:function(){this.model.createTable(this.name,this.fields),this.model.commit()},drop:function(){this.model.dropTable(this,name),this.model.commit()},exists:function(){return this.model.tableExists(this.name)},get:function(a){return this.model.query(this.name,a)},insert:function(a){this.model.insert(this.name,a),this.model.commit()},insertIfNew:function(a){0==this.model.query(this.name,a).length&&(this.model.insert(this.name,a),this.model.commit())},insertOrUpdate:function(a,b){this.model.insertOrUpdate(this.name,a,b),this.model.commit()},update:function(b,c){"object"!=typeof b&&(b={ID:b}),this.model.update(this.name,b,function(b){return a.extend(!0,{},b,c)}),this.model.commit()},remove:function(a){this.model.deleteRows(this.name,{ID:a}),this.model.commit()},_firstRun:function(){this.exists()||this.create()}}),PhotoFrame.Slider=PhotoFrame.BaseElement.extend({animate:!1,callbacks:{create:function(){},start:function(){},slide:function(){},stop:function(){}},disabled:!1,factory:!1,min:!1,max:!1,orientation:!1,parent:!1,range:!1,step:1,ui:{slider:!1,tooltip:!1},usePreferences:!1,value:!1,constructor:function(a,b,c){this.base(a,b,c),this.buildSlider()},buildSlider:function(){var b=this,c="photo-frame-slider-tooltip photo-frame-hidden";this.ui.slider=a('<div class="photo-frame-slider"></div>'),this.ui.tooltip=a('<div class="'+c+'"></div>'),this.parent.append(this.ui.slider),this.parent.append(this.ui.tooltip),this.ui.slider.slider({animate:this.animate,disabled:this.disabled,min:this.min,max:this.max,orientation:this.orientation,range:this.range,step:this.step,value:this.value,start:function(a,c){b.showTooltip(),b.positionTooltip(c),b.factory.trigger("sliderStart",b),b.callback(b.callbacks.start,a,c)},create:function(a,c){b.positionTooltip(c),b.factory.trigger("sliderCreate",b),b.callback(b.callbacks.create,a,c)},slide:function(a,c){b.positionTooltip(c),b.factory.trigger("sliderSlide",b),b.callback(b.callbacks.slide,a,c),b.setPreference()},stop:function(a,c){b.hideTooltip(),b.positionTooltip(c),b.factory.trigger("sliderStop",b),b.callback(b.callbacks.stop,a,c)}}),this.setValueFromPreferences()},positionTooltip:function(a){this.ui.tooltip.html(a.value),this.ui.tooltip.position({of:a.handle,my:"center top",at:"center bottom"});var b=parseInt(this.ui.tooltip.css("top").replace("px",""),10);this.ui.tooltip.css("top",b+10)},showTooltip:function(){this.ui.tooltip.removeClass("photo-frame-hidden")},hideTooltip:function(){this.ui.tooltip.addClass("photo-frame-hidden")},enable:function(){this.disabled=!1,this.ui.slider.slider("enable")},disable:function(){this.disabled=!0,this.ui.slider.slider("disable")},getSliderOption:function(a){return this.ui.slider.slider(a)},setSliderOption:function(a,b){this.ui.slider.slider(a,b)},setValue:function(a){this.setSliderOption("value",a)},getValue:function(){return this.getSliderOption("value")},isEnabled:function(){return this.getSliderOption("disabled")?!1:!0},isDisabled:function(){return this.getSliderOption("disabled")},setPreference:function(){this.usePreferences&&PhotoFrame.Model.Preferences.setPreference("sliderLastValue",this.getValue())},getPreference:function(){return this.usePreferences?PhotoFrame.Model.Preferences.getPreference("sliderLastValue"):!1},setValueFromPreferences:function(){this.usePreferences&&this.value===!1&&this.setValue(this.getPreference())}}),PhotoFrame.ColorPicker=PhotoFrame.BaseElement.extend({callbacks:{init:function(){},change:function(){},move:function(){},hide:function(){},show:function(){},beforeShow:function(){}},cancelText:!1,chooseText:!1,className:"photo-frame-color-picker",clickoutFiresChange:!1,color:!1,disabled:!1,flat:!1,fontWindowId:"fontWindowColorPicker",palette:[],preferredFormat:"hex",showAlpha:!1,showButtons:!1,showInitial:!1,showInput:!1,showPalette:!1,showSelectionPalette:!1,usePreferences:!1,constructor:function(a,b,c){this.base(a,b,c),this.buildColorPicker(),this.color||this.setColorFromPreferences()},buildColorPicker:function(){var a=this;this.parent.spectrum({cancelText:this.cancelText,chooseText:this.chooseText,className:this.className,clickoutFiresChange:this.clickoutFiresChange,color:this.color,disabled:this.disabled,flat:this.flat,palette:this.palette,preferredFormat:this.preferredFormat,showAlpha:this.showAlpha,showButtons:this.showButtons,showInitial:this.showInitial,showInput:this.showInput,showPalette:this.showPalette,showSelectionPalette:this.showSelectionPalette,change:function(b){a.setPreference(),a.callback(a.callbacks.change,b),a.factory.trigger("colorPickerChange",a,b)},move:function(b){a.callback(a.callbacks.move,b),a.factory.trigger("colorPickerMove",a,b)},hide:function(b){a.callback(a.callbacks.hide,b),a.factory.trigger("colorPickerHide",a,b)},show:function(b){a.callback(a.callbacks.show,b),a.factory.trigger("colorPickerShow",a,b)},beforeShow:function(b){a.callback(a.callbacks.beforeShow,b),a.factory.trigger("colorPickerBeforeShow",a,b)}}),this.callback(this.callbacks.init),this.factory.trigger("colorPickerInit")},get:function(){return this.getColor()},set:function(a){this.setColor(a)},getRgb:function(){return this.getColor().toRgb()},getRgbString:function(){return this.getColor().toRgbString()},getHsl:function(){return this.getColor().toHsl()},getHslString:function(){return this.getColor().toHslString()},getName:function(){return this.getColor().toName()},getPercentageRgb:function(){return this.getColor().toPercentageRgb()},getPercentageRgbString:function(){return this.getColor().toPercentageRgbString()},getHex:function(){return this.getColor().toHex()},getHexString:function(){return this.getColor().toHexString()},getColor:function(){return this.parent.spectrum("get")},getString:function(a){return this.getColor().toString(a)},setColor:function(a){this.parent.spectrum("set",a),this.setPreference()},enable:function(){this.parent.spectrum("enable"),this.factory.trigger("colorPickerEnable")},disable:function(){this.parent.spectrum("disable"),this.factory.trigger("colorPickerDiable")},destroy:function(){this.parent.spectrum("destroy"),this.factory.trigger("colorPickerDestroy")},show:function(){this.parent.spectrum("show"),this.factory.trigger("colorPickerShow")},hide:function(){this.parent.spectrum("hide"),this.factory.trigger("colorPickerHide")},toggle:function(){this.parent.spectrum("toggle"),this.factory.trigger("colorPickerToggle")},getPreference:function(){var a={rgb:PhotoFrame.Model.Preferences.getPreference("colorPickerLastColorRgb"),hex:PhotoFrame.Model.Preferences.getPreference("colorPickerLastColorHex")};return this.usePreferences||"array"!=typeof a||0!=a.length?a:!1},setPreference:function(){this.usePreferences&&(PhotoFrame.Model.Preferences.setPreference("colorPickerLastColorRgb",this.getRgbString()),PhotoFrame.Model.Preferences.setPreference("colorPickerLastColorHex",this.getHexString()))},setColorFromPreferences:function(){this.usePreferences&&this.setColor(this.getPreference().hex)}}),PhotoFrame.Model.Preferences=new PhotoFrame.Database({name:"photoFramePrefs",fields:["key","value"],getPreference:function(a){if("undefined"!=typeof a){var b=PhotoFrame.Model.Preferences.get({key:a});return b.length>0?b[0].value:!1}return PhotoFrame.Model.Preferences.get()},setPreference:function(a,b){if("object"==typeof a){var c=a;for(a in c)this.setPreference(a,c[a])}else PhotoFrame.Model.Preferences.insertOrUpdate({key:a},{key:a,value:b})}}),PhotoFrame.Model.WindowLocations=new PhotoFrame.Database({name:"windowLocations",fields:["title","x","y","visible"]}),PhotoFrame.WindowControls=PhotoFrame.Class.extend({visible:!1,getVisibility:function(){var a=PhotoFrame.Model.WindowLocations.get({title:this.title});return a.length>0&&a[0].visible?a[0].visible:!1},setVisibility:function(a){a=a?!0:!1,PhotoFrame.Model.WindowLocations.update({title:this.title},{visible:a}),this.visible=a},savePosition:function(){PhotoFrame.Model.WindowLocations.insertOrUpdate({title:this.title},{visible:this.getVisibility(),title:this.title,y:this.ui.window.css("top"),x:this.ui.window.css("left")})},bringToFront:function(){this.factory.zIndexCount++,this.ui.window.css("z-index",this.factory.zIndexCount)},hasPosition:function(){return this.getPosition()?!0:!1},getPosition:function(){var a=PhotoFrame.Model.WindowLocations.get({title:this.title});return 0==a.length?!1:a[0]},restorePosition:function(){var a=this.getPosition();this.setPosition(a.x,a.y)},setPosition:function(a,b){this.ui.window.css("left",a).css("top",b)}}),PhotoFrame.Window.implement(PhotoFrame.WindowControls),PhotoFrame.ButtonBar.implement(PhotoFrame.WindowControls)}(jQuery),jQuery.isVersion=function(a,b,c){if(a){var d=/pre/i,e=/[^\d]+/g,b=b||"==",c=c||jQuery.fn.jquery,f=a.replace(e,""),g=c.replace(e,""),h=f.length,i=g.length,j=d.test(a),k=d.test(c);switch(f=i>h?10*parseInt(f)*(i-h):parseInt(f),g=h>i?10*parseInt(g)*(h-i):parseInt(g),b){case"==":return!0==(f==g&&j==k);case">=":return!0==(f>=g&&(!j||j==k));case"<=":return!0==(g>=f&&(!k||k==j));case">":return!0===(f>g||f==g&&k);case"<":return!0===(g>f||f==g&&j)}}return!1},jQuery.fn.center=function(){var a=$(window);if(this.css("position","fixed"),!$.isVersion("1.7.0","<=")||null==a.outerHeight()||null==a.outerWidth()||isNaN(a.outerHeight())||isNaN(a.outerWidth()))var b=a.height(),c=a.width();else var b=a.outerHeight(),c=a.outerWidth();return this.css("top",b/2-this.height()/2+"px"),this.css("left",c/2-this.width()/2+"px"),this},String.prototype.ucfirst=function(){return this.substr(0,1).toUpperCase()+this.substr(1)},function(a,b,c){function d(a,b,c){for(var d=[],e=0;e<a.length;e++){var f=tinycolor(a[e]),g=f.toHsl().l<.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light";g+=tinycolor.equals(b,a[e])?" sp-thumb-active":"";var h=q?"background-color:"+f.toRgbString():"filter:"+f.toFilter();d.push('<span title="'+f.toRgbString()+'" data-color="'+f.toRgbString()+'" class="'+g+'"><span class="sp-thumb-inner" style="'+h+';" /></span>')}return"<div class='sp-cf "+c+"'>"+d.join("")+"</div>"}function e(){for(var a=0;a<o.length;a++)o[a]&&o[a].hide()}function f(a,c){var d=b.extend({},n,a);return d.callbacks={move:k(d.move,c),change:k(d.change,c),show:k(d.show,c),hide:k(d.hide,c),beforeShow:k(d.beforeShow,c)},d}function g(g,i){function k(){rb.toggleClass("sp-flat",R),rb.toggleClass("sp-input-disabled",!Q.showInput),rb.toggleClass("sp-alpha-enabled",Q.showAlpha),rb.toggleClass("sp-buttons-disabled",!Q.showButtons),rb.toggleClass("sp-palette-disabled",!Q.showPalette),rb.toggleClass("sp-palette-only",Q.showPaletteOnly),rb.toggleClass("sp-initial-disabled",!Q.showInitial),rb.addClass(Q.className),L()}function n(){function c(a){return a.data&&a.data.ignore?(E(b(this).data("color")),H()):(E(b(this).data("color")),K(!0),H(),C()),!1}if(p&&rb.find("*:not(input)").attr("unselectable","on"),k(),Fb&&pb.after(Gb).hide(),R)pb.after(rb).hide();else{var d="parent"===Q.appendTo?pb.parent():b(Q.appendTo);1!==d.length&&(d=b("body")),d.append(rb)}if(T&&a.localStorage){try{var e=a.localStorage[T].split(",#");e.length>1&&(delete a.localStorage[T],b.each(e,function(a,b){t(b)}))}catch(f){}try{kb=a.localStorage[T].split(";")}catch(f){}}Hb.bind("click.spectrum touchstart.spectrum",function(a){qb||A(),a.stopPropagation(),b(a.target).is("input")||a.preventDefault()}),(pb.is(":disabled")||Q.disabled===!0)&&P(),rb.click(j),zb.change(z),zb.bind("paste",function(){setTimeout(z,1)}),zb.keydown(function(a){13==a.keyCode&&z()}),Cb.text(Q.cancelText),Cb.bind("click.spectrum",function(a){a.stopPropagation(),a.preventDefault(),C("cancel")}),Db.text(Q.chooseText),Db.bind("click.spectrum",function(a){a.stopPropagation(),a.preventDefault(),G()&&(K(!0),C())}),l(xb,function(a,b,c){hb=a/bb,c.shiftKey&&(hb=Math.round(10*hb)/10),H()}),l(ub,function(a,b){eb=parseFloat(b/_),H()},x,y),l(sb,function(a,b,c){if(c.shiftKey){if(!nb){var d=fb*Y,e=Z-gb*Z,f=Math.abs(a-d)>Math.abs(b-e);nb=f?"x":"y"}}else nb=null;var g=!nb||"x"===nb,h=!nb||"y"===nb;g&&(fb=parseFloat(a/Y)),h&&(gb=parseFloat((Z-b)/Z)),H()},x,y),Jb?(E(Jb),I(),Mb=Lb||tinycolor(Jb).format,t(Jb)):I(),R&&B();var g=p?"mousedown.spectrum":"click.spectrum touchstart.spectrum";Ab.delegate(".sp-thumb-el",g,c),Bb.delegate(".sp-thumb-el:nth-child(1)",g,{ignore:!0},c)}function t(c){if(S){var d=tinycolor(c).toRgbString();if(-1===b.inArray(d,kb))for(kb.push(d);kb.length>lb;)kb.shift();if(T&&a.localStorage)try{a.localStorage[T]=kb.join(";")}catch(e){}}}function u(){var a,b=[],c=kb,d={};if(Q.showPalette){for(var e=0;e<jb.length;e++)for(var f=0;f<jb[e].length;f++)a=tinycolor(jb[e][f]).toRgbString(),d[a]=!0;for(e=0;e<c.length;e++)a=tinycolor(c[e]).toRgbString(),d.hasOwnProperty(a)||(b.push(c[e]),d[a]=!0)}return b.reverse().slice(0,Q.maxSelectionSize)}function v(){var a=F(),c=b.map(jb,function(b,c){return d(b,a,"sp-palette-row sp-palette-row-"+c)});kb&&c.push(d(u(),a,"sp-palette-row sp-palette-row-selection")),Ab.html(c.join(""))}function w(){if(Q.showInitial){var a=Kb,b=F();Bb.html(d([a,b],b,"sp-palette-row-initial"))}}function x(){(0>=Z||0>=Y||0>=_)&&L(),rb.addClass(mb),nb=null}function y(){rb.removeClass(mb)}function z(){var a=tinycolor(zb.val());a.ok?E(a):zb.addClass("sp-validation-error")}function A(){X?C():B()}function B(){var c=b.Event("beforeShow.spectrum");return X?(L(),void 0):(pb.trigger(c,[F()]),V.beforeShow(F())===!1||c.isDefaultPrevented()||(e(),X=!0,b(ob).bind("click.spectrum",C),b(a).bind("resize.spectrum",W),Gb.addClass("sp-active"),rb.removeClass("sp-hidden"),Q.showPalette&&v(),L(),I(),Kb=F(),w(),V.show(Kb),pb.trigger("show.spectrum",[Kb])),void 0)}function C(c){if((!c||"click"!=c.type||2!=c.button)&&X&&!R){X=!1,b(ob).unbind("click.spectrum",C),b(a).unbind("resize.spectrum",W),Gb.removeClass("sp-active"),rb.addClass("sp-hidden");var d=!tinycolor.equals(F(),Kb);d&&(Nb&&"cancel"!==c?K(!0):D()),V.hide(F()),pb.trigger("hide.spectrum",[F()])}}function D(){E(Kb,!0)}function E(a,b){if(!tinycolor.equals(a,F())){var c=tinycolor(a),d=c.toHsv();eb=d.h%360/360,fb=d.s,gb=d.v,hb=d.a,I(),c.ok&&!b&&(Mb=Lb||c.format)}}function F(a){return a=a||{},tinycolor.fromRatio({h:eb,s:fb,v:gb,a:Math.round(100*hb)/100},{format:a.format||Mb})}function G(){return!zb.hasClass("sp-validation-error")}function H(){I(),V.move(F()),pb.trigger("move.spectrum",[F()])}function I(){zb.removeClass("sp-validation-error"),J();var a=tinycolor.fromRatio({h:eb,s:1,v:1});sb.css("background-color",a.toHexString());var b=Mb;1>hb&&("hex"===b||"hex3"===b||"hex6"===b||"name"===b)&&(b="rgb");var c=F({format:b}),d=c.toHexString(),e=c.toRgbString();if(q||1===c.alpha?Ib.css("background-color",e):(Ib.css("background-color","transparent"),Ib.css("filter",c.toFilter())),Q.showAlpha){var f=c.toRgb();f.a=0;var g=tinycolor(f).toRgbString(),h="linear-gradient(left, "+g+", "+d+")";p?wb.css("filter",tinycolor(g).toFilter({gradientType:1},d)):(wb.css("background","-webkit-"+h),wb.css("background","-moz-"+h),wb.css("background","-ms-"+h),wb.css("background",h))
}Q.showInput&&zb.val(c.toString(b)),Q.showPalette&&v(),w()}function J(){var a=fb,b=gb,c=a*Y,d=Z-b*Z;c=Math.max(-$,Math.min(Y-$,c-$)),d=Math.max(-$,Math.min(Z-$,d-$)),tb.css({top:d,left:c});var e=hb*bb;yb.css({left:e-cb/2});var f=eb*_;vb.css({top:f-db})}function K(a){var b=F();Eb&&pb.val(b.toString(Mb)).change();var c=!tinycolor.equals(b,Kb);Kb=b,t(b),a&&c&&(V.change(b),pb.trigger("change.spectrum",[b]))}function L(){Y=sb.width(),Z=sb.height(),$=tb.height(),ab=ub.width(),_=ub.height(),db=vb.height(),bb=xb.width(),cb=yb.width(),R||(rb.css("position","absolute"),rb.offset(h(rb,Hb))),J()}function M(){pb.show(),Hb.unbind("click.spectrum touchstart.spectrum"),rb.remove(),Gb.remove(),o[Ob.id]=null}function N(a,d){return a===c?b.extend({},Q):d===c?Q[a]:(Q[a]=d,k(),void 0)}function O(){qb=!1,pb.attr("disabled",!1),Hb.removeClass("sp-disabled")}function P(){C(),qb=!0,pb.attr("disabled",!0),Hb.addClass("sp-disabled")}var Q=f(i,g),R=Q.flat,S=Q.showSelectionPalette,T=Q.localStorageKey,U=Q.theme,V=Q.callbacks,W=m(L,10),X=!1,Y=0,Z=0,$=0,_=0,ab=0,bb=0,cb=0,db=0,eb=0,fb=0,gb=0,hb=1,ib=Q.palette.slice(0),jb=b.isArray(ib[0])?ib:[ib],kb=Q.selectionPalette.slice(0),lb=Q.maxSelectionSize,mb="sp-dragging",nb=null,ob=g.ownerDocument,pb=(ob.body,b(g)),qb=!1,rb=b(s,ob).addClass(U),sb=rb.find(".sp-color"),tb=rb.find(".sp-dragger"),ub=rb.find(".sp-hue"),vb=rb.find(".sp-slider"),wb=rb.find(".sp-alpha-inner"),xb=rb.find(".sp-alpha"),yb=rb.find(".sp-alpha-handle"),zb=rb.find(".sp-input"),Ab=rb.find(".sp-palette"),Bb=rb.find(".sp-initial"),Cb=rb.find(".sp-cancel"),Db=rb.find(".sp-choose"),Eb=pb.is("input"),Fb=Eb&&!R,Gb=Fb?b(r).addClass(U).addClass(Q.className):b([]),Hb=Fb?Gb:pb,Ib=Gb.find(".sp-preview-inner"),Jb=Q.color||Eb&&pb.val(),Kb=!1,Lb=Q.preferredFormat,Mb=Lb,Nb=!Q.showButtons||Q.clickoutFiresChange;n();var Ob={show:B,hide:C,toggle:A,reflow:L,option:N,enable:O,disable:P,set:function(a){E(a),K()},get:F,destroy:M,container:rb};return Ob.id=o.push(Ob)-1,Ob}function h(a,c){var d=0,e=a.outerWidth(),f=a.outerHeight(),g=c.outerHeight(),h=a[0].ownerDocument,i=h.documentElement,j=i.clientWidth+b(h).scrollLeft(),k=i.clientHeight+b(h).scrollTop(),l=c.offset();return l.top+=g,l.left-=Math.min(l.left,l.left+e>j&&j>e?Math.abs(l.left+e-j):0),l.top-=Math.min(l.top,l.top+f>k&&k>f?Math.abs(f+g-d):d),l}function i(){}function j(a){a.stopPropagation()}function k(a,b){var c=Array.prototype.slice,d=c.call(arguments,2);return function(){return a.apply(b,d.concat(c.call(arguments)))}}function l(c,d,e,f){function g(a){a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),a.returnValue=!1}function h(a){if(l){if(p&&document.documentMode<9&&!a.button)return j();var b=a.originalEvent.touches,e=b?b[0].pageX:a.pageX,f=b?b[0].pageY:a.pageY,h=Math.max(0,Math.min(e-m.left,o)),i=Math.max(0,Math.min(f-m.top,n));q&&g(a),d.apply(c,[h,i,a])}}function i(a){{var d=a.which?3==a.which:2==a.button;a.originalEvent.touches}d||l||e.apply(c,arguments)!==!1&&(l=!0,n=b(c).height(),o=b(c).width(),m=b(c).offset(),b(k).bind(r),b(k.body).addClass("sp-dragging"),q||h(a),g(a))}function j(){l&&(b(k).unbind(r),b(k.body).removeClass("sp-dragging"),f.apply(c,arguments)),l=!1}d=d||function(){},e=e||function(){},f=f||function(){};var k=c.ownerDocument||document,l=!1,m={},n=0,o=0,q="ontouchstart"in a,r={};r.selectstart=g,r.dragstart=g,r["touchmove mousemove"]=h,r["touchend mouseup"]=j,b(c).bind("touchstart mousedown",i)}function m(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,a.apply(e,f)};c&&clearTimeout(d),(c||!d)&&(d=setTimeout(g,b))}}var n={beforeShow:i,move:i,change:i,show:i,hide:i,color:!1,flat:!1,showInput:!1,showButtons:!0,clickoutFiresChange:!1,showInitial:!1,showPalette:!1,showPaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",preferredFormat:!1,className:"",showAlpha:!1,theme:"sp-light",palette:["fff","000"],selectionPalette:[],disabled:!1},o=[],p=!!/msie/i.exec(a.navigator.userAgent),q=function(){function a(a,b){return!!~(""+a).indexOf(b)}var b=document.createElement("div"),c=b.style;return c.cssText="background-color:rgba(0,0,0,.5)",a(c.backgroundColor,"rgba")||a(c.backgroundColor,"hsla")}(),r=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'></div></div>","<div class='sp-dd'>&#9660;</div>","</div>"].join(""),s=function(){var a="";if(p)for(var b=1;6>=b;b++)a+="<div class='sp-"+b+"'></div>";return["<div class='sp-container sp-hidden'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",a,"</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf'>","<a class='sp-cancel' href='#'></a>","<button class='sp-choose'></button>","</div>","</div>","</div>"].join("")}(),t="spectrum.id";b.fn.spectrum=function(a){if("string"==typeof a){var c=this,d=Array.prototype.slice.call(arguments,1);return this.each(function(){var e=o[b(this).data(t)];if(e){var f=e[a];if(!f)throw new Error("Spectrum: no such method: '"+a+"'");"get"==a?c=e.get():"container"==a?c=e.container:"option"==a?c=e.option.apply(e,d):"destroy"==a?(e.destroy(),b(this).removeData(t)):f.apply(e,d)}}),c}return this.spectrum("destroy").each(function(){var c=g(this,a);b(this).data(t,c.id)})},b.fn.spectrum.load=!0,b.fn.spectrum.loadOpts={},b.fn.spectrum.draggable=l,b.fn.spectrum.defaults=n,b.spectrum={},b.spectrum.localization={},b.spectrum.palettes={},b.fn.spectrum.processNativeColorInputs=function(){var a=b("<input type='color' value='!' />")[0],c="color"===a.type&&"!"!=a.value;c||b("input[type=color]").spectrum({preferredFormat:"hex6"})},function(a){function b(a,d){if(a=a?a:"",d=d||{},"object"==typeof a&&a.hasOwnProperty("_tc_id"))return a;var f=c(a),h=f.r,j=f.g,l=f.b,m=f.a,n=w(100*m)/100,o=d.format||f.format;return 1>h&&(h=w(h)),1>j&&(j=w(j)),1>l&&(l=w(l)),{ok:f.ok,format:o,_tc_id:u++,alpha:m,toHsv:function(){var a=g(h,j,l);return{h:360*a.h,s:a.s,v:a.v,a:m}},toHsvString:function(){var a=g(h,j,l),b=w(360*a.h),c=w(100*a.s),d=w(100*a.v);return 1==m?"hsv("+b+", "+c+"%, "+d+"%)":"hsva("+b+", "+c+"%, "+d+"%, "+n+")"},toHsl:function(){var a=e(h,j,l);return{h:360*a.h,s:a.s,l:a.l,a:m}},toHslString:function(){var a=e(h,j,l),b=w(360*a.h),c=w(100*a.s),d=w(100*a.l);return 1==m?"hsl("+b+", "+c+"%, "+d+"%)":"hsla("+b+", "+c+"%, "+d+"%, "+n+")"},toHex:function(a){return i(h,j,l,a)},toHexString:function(a){return"#"+i(h,j,l,a)},toRgb:function(){return{r:w(h),g:w(j),b:w(l),a:m}},toRgbString:function(){return 1==m?"rgb("+w(h)+", "+w(j)+", "+w(l)+")":"rgba("+w(h)+", "+w(j)+", "+w(l)+", "+n+")"},toPercentageRgb:function(){return{r:w(100*k(h,255))+"%",g:w(100*k(j,255))+"%",b:w(100*k(l,255))+"%",a:m}},toPercentageRgbString:function(){return 1==m?"rgb("+w(100*k(h,255))+"%, "+w(100*k(j,255))+"%, "+w(100*k(l,255))+"%)":"rgba("+w(100*k(h,255))+"%, "+w(100*k(j,255))+"%, "+w(100*k(l,255))+"%, "+n+")"},toName:function(){return B[i(h,j,l,!0)]||!1},toFilter:function(a){var c=i(h,j,l),e=c,f=Math.round(255*parseFloat(m)).toString(16),g=f,k=d&&d.gradientType?"GradientType = 1, ":"";if(a){var n=b(a);e=n.toHex(),g=Math.round(255*parseFloat(n.alpha)).toString(16)}return"progid:DXImageTransform.Microsoft.gradient("+k+"startColorstr=#"+p(f)+c+",endColorstr=#"+p(g)+e+")"},toString:function(a){a=a||this.format;var b=!1;return"rgb"===a&&(b=this.toRgbString()),"prgb"===a&&(b=this.toPercentageRgbString()),("hex"===a||"hex6"===a)&&(b=this.toHexString()),"hex3"===a&&(b=this.toHexString(!0)),"name"===a&&(b=this.toName()),"hsl"===a&&(b=this.toHslString()),"hsv"===a&&(b=this.toHsvString()),b||this.toHexString()}}}function c(a){var b={r:0,g:0,b:0},c=1,e=!1,g=!1;return"string"==typeof a&&(a=r(a)),"object"==typeof a&&(a.hasOwnProperty("r")&&a.hasOwnProperty("g")&&a.hasOwnProperty("b")?(b=d(a.r,a.g,a.b),e=!0,g="%"===String(a.r).substr(-1)?"prgb":"rgb"):a.hasOwnProperty("h")&&a.hasOwnProperty("s")&&a.hasOwnProperty("v")?(a.s=q(a.s),a.v=q(a.v),b=h(a.h,a.s,a.v),e=!0,g="hsv"):a.hasOwnProperty("h")&&a.hasOwnProperty("s")&&a.hasOwnProperty("l")&&(a.s=q(a.s),a.l=q(a.l),b=f(a.h,a.s,a.l),e=!0,g="hsl"),a.hasOwnProperty("a")&&(c=a.a)),c=parseFloat(c),(isNaN(c)||0>c||c>1)&&(c=1),{ok:e,format:a.format||g,r:x(255,y(b.r,0)),g:x(255,y(b.g,0)),b:x(255,y(b.b,0)),a:c}}function d(a,b,c){return{r:255*k(a,255),g:255*k(b,255),b:255*k(c,255)}}function e(a,b,c){a=k(a,255),b=k(b,255),c=k(c,255);var d,e,f=y(a,b,c),g=x(a,b,c),h=(f+g)/2;if(f==g)d=e=0;else{var i=f-g;switch(e=h>.5?i/(2-f-g):i/(f+g),f){case a:d=(b-c)/i+(c>b?6:0);break;case b:d=(c-a)/i+2;break;case c:d=(a-b)/i+4}d/=6}return{h:d,s:e,l:h}}function f(a,b,c){function d(a,b,c){return 0>c&&(c+=1),c>1&&(c-=1),1/6>c?a+6*(b-a)*c:.5>c?b:2/3>c?a+(b-a)*(2/3-c)*6:a}var e,f,g;if(a=k(a,360),b=k(b,100),c=k(c,100),0===b)e=f=g=c;else{var h=.5>c?c*(1+b):c+b-c*b,i=2*c-h;e=d(i,h,a+1/3),f=d(i,h,a),g=d(i,h,a-1/3)}return{r:255*e,g:255*f,b:255*g}}function g(a,b,c){a=k(a,255),b=k(b,255),c=k(c,255);var d,e,f=y(a,b,c),g=x(a,b,c),h=f,i=f-g;if(e=0===f?0:i/f,f==g)d=0;else{switch(f){case a:d=(b-c)/i+(c>b?6:0);break;case b:d=(c-a)/i+2;break;case c:d=(a-b)/i+4}d/=6}return{h:d,s:e,v:h}}function h(a,b,c){a=6*k(a,360),b=k(b,100),c=k(c,100);var d=v.floor(a),e=a-d,f=c*(1-b),g=c*(1-e*b),h=c*(1-(1-e)*b),i=d%6,j=[c,g,f,f,h,c][i],l=[h,c,c,g,f,f][i],m=[f,f,h,c,c,g][i];return{r:255*j,g:255*l,b:255*m}}function i(a,b,c,d){var e=[p(w(a).toString(16)),p(w(b).toString(16)),p(w(c).toString(16))];return d&&e[0].charAt(0)==e[0].charAt(1)&&e[1].charAt(0)==e[1].charAt(1)&&e[2].charAt(0)==e[2].charAt(1)?e[0].charAt(0)+e[1].charAt(0)+e[2].charAt(0):e.join("")}function j(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[a[c]]=c);return b}function k(a,b){n(a)&&(a="100%");var c=o(a);return a=x(b,y(0,parseFloat(a))),c&&(a=parseInt(a*b,10)/100),v.abs(a-b)<1e-6?1:a%b/parseFloat(b)}function l(a){return x(1,y(0,a))}function m(a){return parseInt(a,16)}function n(a){return"string"==typeof a&&-1!=a.indexOf(".")&&1===parseFloat(a)}function o(a){return"string"==typeof a&&-1!=a.indexOf("%")}function p(a){return 1==a.length?"0"+a:""+a}function q(a){return 1>=a&&(a=100*a+"%"),a}function r(a){a=a.replace(s,"").replace(t,"").toLowerCase();var b=!1;if(A[a])a=A[a],b=!0;else if("transparent"==a)return{r:0,g:0,b:0,a:0};var c;return(c=C.rgb.exec(a))?{r:c[1],g:c[2],b:c[3]}:(c=C.rgba.exec(a))?{r:c[1],g:c[2],b:c[3],a:c[4]}:(c=C.hsl.exec(a))?{h:c[1],s:c[2],l:c[3]}:(c=C.hsla.exec(a))?{h:c[1],s:c[2],l:c[3],a:c[4]}:(c=C.hsv.exec(a))?{h:c[1],s:c[2],v:c[3]}:(c=C.hex6.exec(a))?{r:m(c[1]),g:m(c[2]),b:m(c[3]),format:b?"name":"hex"}:(c=C.hex3.exec(a))?{r:m(c[1]+""+c[1]),g:m(c[2]+""+c[2]),b:m(c[3]+""+c[3]),format:b?"name":"hex"}:!1}var s=/^[\s,#]+/,t=/\s+$/,u=0,v=Math,w=v.round,x=v.min,y=v.max,z=v.random;b.fromRatio=function(a,c){if("object"==typeof a){var d={};for(var e in a)a.hasOwnProperty(e)&&(d[e]="a"===e?a[e]:q(a[e]));a=d}return b(a,c)},b.equals=function(a,c){return a&&c?b(a).toRgbString()==b(c).toRgbString():!1},b.random=function(){return b.fromRatio({r:z(),g:z(),b:z()})},b.desaturate=function(a,c){var d=b(a).toHsl();return d.s-=(c||10)/100,d.s=l(d.s),b(d)},b.saturate=function(a,c){var d=b(a).toHsl();return d.s+=(c||10)/100,d.s=l(d.s),b(d)},b.greyscale=function(a){return b.desaturate(a,100)},b.lighten=function(a,c){var d=b(a).toHsl();return d.l+=(c||10)/100,d.l=l(d.l),b(d)},b.darken=function(a,c){var d=b(a).toHsl();return d.l-=(c||10)/100,d.l=l(d.l),b(d)},b.complement=function(a){var c=b(a).toHsl();return c.h=(c.h+180)%360,b(c)},b.triad=function(a){var c=b(a).toHsl(),d=c.h;return[b(a),b({h:(d+120)%360,s:c.s,l:c.l}),b({h:(d+240)%360,s:c.s,l:c.l})]},b.tetrad=function(a){var c=b(a).toHsl(),d=c.h;return[b(a),b({h:(d+90)%360,s:c.s,l:c.l}),b({h:(d+180)%360,s:c.s,l:c.l}),b({h:(d+270)%360,s:c.s,l:c.l})]},b.splitcomplement=function(a){var c=b(a).toHsl(),d=c.h;return[b(a),b({h:(d+72)%360,s:c.s,l:c.l}),b({h:(d+216)%360,s:c.s,l:c.l})]},b.analogous=function(a,c,d){c=c||6,d=d||30;var e=b(a).toHsl(),f=360/d,g=[b(a)];for(e.h=(e.h-(f*c>>1)+720)%360;--c;)e.h=(e.h+f)%360,g.push(b(e));return g},b.monochromatic=function(a,c){c=c||6;for(var d=b(a).toHsv(),e=d.h,f=d.s,g=d.v,h=[],i=1/c;c--;)h.push(b({h:e,s:f,v:g})),g=(g+i)%1;return h},b.readability=function(a,c){var d=b(a).toRgb(),e=b(c).toRgb(),f=(299*d.r+587*d.g+114*d.b)/1e3,g=(299*e.r+587*e.g+114*e.b)/1e3,h=Math.max(d.r,e.r)-Math.min(d.r,e.r)+Math.max(d.g,e.g)-Math.min(d.g,e.g)+Math.max(d.b,e.b)-Math.min(d.b,e.b);return{brightness:Math.abs(f-g),color:h}},b.readable=function(a,c){var d=b.readability(a,c);return d.brightness>125&&d.color>500},b.mostReadable=function(a,c){for(var d=null,e=0,f=!1,g=0;g<c.length;g++){var h=b.readability(a,c[g]),i=h.brightness>125&&h.color>500,j=3*(h.brightness/125)+h.color/500;(i&&!f||i&&f&&j>e||!i&&!f&&j>e)&&(f=i,e=j,d=b(c[g]))}return d};var A=b.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},B=b.hexNames=j(A),C=function(){var a="[-\\+]?\\d+%?",b="[-\\+]?\\d*\\.\\d+%?",c="(?:"+b+")|(?:"+a+")",d="[\\s|\\(]+("+c+")[,|\\s]+("+c+")[,|\\s]+("+c+")\\s*\\)?",e="[\\s|\\(]+("+c+")[,|\\s]+("+c+")[,|\\s]+("+c+")[,|\\s]+("+c+")\\s*\\)?";return{rgb:new RegExp("rgb"+d),rgba:new RegExp("rgba"+e),hsl:new RegExp("hsl"+d),hsla:new RegExp("hsla"+e),hsv:new RegExp("hsv"+d),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();a.tinycolor=b}(this),b(function(){b.fn.spectrum.load&&b.fn.spectrum.processNativeColorInputs()})}(window,jQuery);var PhotoFrame={};!function(a){PhotoFrame.Model={},PhotoFrame.instances=[],PhotoFrame.matrix=[],PhotoFrame.Buttons=[],PhotoFrame.Class=Base.extend({buildDate:"2013-09-05",version:"1.2.0",constructor:function(b,c){if("object"!=typeof b)var b={};if("object"!=typeof c)var c={};this.setOptions(a.extend(!0,{},b,c))},callback:function(a){if("function"==typeof a){for(var b=[],c=1;c<=arguments.length;c++)arguments[c]&&b.push(arguments[c]);a.apply(this,b)}},log:function(a){window.console&&console.log&&console.log(a)},getOption:function(a){return this[a]?this[a]:!1},getOptions:function(){return this},setOption:function(a,b){this[a]=b},setOptions:function(a){for(key in a)this.setOption(key,a[key])},removeIndex:function(a,b){for(var c=0;c<a.length;c++)if(a[c]==b){a.splice(c,1);break}return a},jsonEncode:function(a){return JSON.parse(a)},jsonDecode:function(a){return JSON.stringify(a)},isRetina:function(){return window.devicePixelRatio>1}}),PhotoFrame.BaseElement=PhotoFrame.Class.extend({callbacks:{},factory:!1,id:!1,parent:!1,ui:{},constructor:function(b,c,d){var e="object"==typeof d?d.callbacks:{};this.ui={},this.factory=b,this.parent=c,this.base(d),this.callbacks=a.extend(!0,{},this.callbacks,e)}}),PhotoFrame.Factory=PhotoFrame.Class.extend({buttons:[],buttonBar:!1,cancel:!1,callbacks:{},classes:{actionBar:"photo-frame-action-bar",activity:"photo-frame-activity",aspect:"aspect",barButton:"photo-frame-bar-button",browse:"photo-frame-browse",button:"photo-frame-button",cancel:"photo-frame-cancel",clearfix:"clearfix",close:"photo-frame-close",crop:"photo-frame-crop",cropPhoto:"photo-frame-crop-photo",editPhoto:"photo-frame-edit",deletePhoto:"photo-frame-delete",dimmer:"photo-frame-dimmer",dragging:"photo-frame-dragging",dropCover:"photo-frame-drop-cover",dropText:"photo-frame-drop-text",dropZone:"photo-frame-drop-zone",errors:"photo-frame-errors",form:"photo-frame-form",floatLeft:"photo-frame-float-left",floatRight:"photo-frame-float-right",helper:"photo-frame-helper",icons:"photo-frame-icons",invalid:"photo-frame-invalid",ie:"photo-frame-ie",indicator:"photo-frame-indicator",infoToggle:"photo-frame-toggle-info",instructions:"photo-frame-instructions",infoPanel:"photo-frame-info-panel",jcropTracker:"jcrop-tracker",jcropHolder:"jcrop-holder",message:"photo-frame-message",meta:"photo-frame-meta",metaToggle:"photo-frame-meta-toggle",metaClose:"photo-frame-close-meta",panel:"photo-frame-panel",photo:"photo-frame-photo",progress:"photo-frame-progress",preview:"photo-frame-preview",rendering:"photo-frame-rendering",renderBg:"photo-frame-render-bg",renderText:"photo-frame-render-text",save:"photo-frame-save",saving:"photo-frame-saving",size:"size",sortable:"photo-frame-sortable",sortablePlaceholder:"photo-frame-sortable-placeholder",toolbar:"photo-frame-toolbar",toolBarToggle:"photo-frame-toolbar-toggle",tools:"photo-frame-tools",upload:"photo-frame-upload",wrapper:"photo-frame-wrapper"},cropSettings:{},fileBrowserResponseInProgress:!1,forceCrop:!0,disableCrop:!1,events:{},icons:{cancel:"icon-cancel",editPhoto:"icon-edit",deletePhoto:"icon-trash",info:"icon-info",cog:"icon-cog",rotate:"icon-rotate",save:"icon-save",tools:"icon-tools",warningSign:"icon-warning-sign"},overflow:!1,photos:[],settings:{},ui:{},windows:[],$wrapper:!1,zIndexCount:1,constructor:function(b,c){var d=this,e=a.extend(!0,{},c.photos);d.events={},d.settings={},d.cropSettings={},d.windows=[],d.index=PhotoFrame.instances.length,d.callbacks=a.extend(!0,{browse:function(){},buildUploadUrl:function(){return!1},init:function(){},responseHandlerSettings:function(){return{}}},c.callbacks),PhotoFrame.instances.push(d),d.$wrapper=a(b),d.sortable(),d.base(c),d.ui={body:a("body"),browse:d.$wrapper.find("."+d.classes.browse),upload:d.$wrapper.find("."+d.classes.upload),form:a("#"+d.classes.upload),dimmer:a("."+d.classes.dimmer),activity:a("."+d.classes.activity),preview:d.$wrapper.find("."+d.classes.preview),helper:d.$wrapper.find("."+d.classes.helper)};var f=['<form id="'+d.classes.upload+'" class="'+d.classes.form+" "+d.classes.wrapper+" "+d.classes.icons+'" action="'+PhotoFrame.Actions.upload_photo+(d.IE()?"&ie=true":"")+"&index="+d.index+'" method="POST" enctype="multipart/form-data" id="'+d.classes.upload+"-"+d.index+'" '+(d.IE()?'target="photo-frame-iframe-'+d.index+'"':"")+">","<h3>"+PhotoFrame.Lang.select_file+"</h3>",'<input type="file" name="files[]" multiple>','<button type="submit" class="'+d.classes.button+'"><span class="icon-upload"></span>'+d.buttonText+"</button>","</form>"].join("");d.ui.form=a(f),d.ui.form.submit(function(){d.IE()&&(d.ui.form.hide(),d.showProgress(0,function(){d.startUpload()}))}),d.ui.body.append(d.ui.form),d.ui.window=a(window);var f=['<div class="'+d.classes.dimmer+" "+d.classes.icons+'">','<a href="#" class="'+d.classes.metaToggle+'"><span class="'+d.icons.info+'"></span></a>','<div class="'+d.classes.infoPanel+'">','<a href="#" class="'+d.classes.close+'"><span class="'+d.icons.cancel+'"></span></a>','<p class="'+d.classes.size+'">W: <span class="width"></span> H: <span class="height"></span></p>','<div class="coords">',"<p>",'<label><b>X</b>: <span class="x"></span></label>','<label><b>Y</b>: <span class="y"></span></label>',"</p>","<p>",'<label><b>X2</b>: <span class="x2"></span></label>','<label><b>Y2</b>: <span class="y2"></span></label>',"</p>","</div>",'<p class="'+d.classes.aspect+'"></p>',"</div>",'<div class="'+d.classes.activity+'">','<span class="'+d.classes.indicator+'"></span> <p>'+PhotoFrame.Lang.uploading+"</p>",'<a class="'+d.classes.button+" "+d.classes.cancel+'"><span class="'+d.icons.cancel+'"></span> Cancel</a>',"</div>",'<div class="'+d.classes.progress+'"></div>','<div class="'+d.classes.errors+'">',"<h3>"+PhotoFrame.Lang.errors+"</h3>","<ul></ul>",'<a class="'+d.classes.button+" "+d.classes.cancel+'"><span class="'+d.icons.cancel+'"></span> Close</a>',"</div>",'<div class="'+d.classes.crop+'">','<div class="'+d.classes.cropPhoto+'"></div>','<div class="'+d.classes.renderBg+'"><div class="'+d.classes.renderText+'">'+PhotoFrame.Lang.rendering+"</div></div>",'<div class="'+d.classes.meta+'">','<a href="#" class="'+d.classes.metaClose+" "+d.classes.floatRight+'"><span class="'+d.icons.cancel+'"></span></a>',"<h3>"+PhotoFrame.Lang.photo_details+"</h3>","<ul>","<li>",'<label for="title">'+PhotoFrame.Lang.title+"</label>",'<input type="text" name="title" value="" id="title" />',"</li>","<!-- <li>",'<label for="keywords">'+PhotoFrame.Lang.keywords+"</label>",'<input type="text" name="keywords" value="" id="keywords" />',"</li> -->","<li>",'<label for="title">'+PhotoFrame.Lang.description+"</label>",'<textarea name="description" id="description"></textarea>',"</li>","</ul>","</div>",'<div class="'+d.classes.toolbar+'">','<div class="'+d.classes.tools+'">','<a href="#" class="'+d.classes.toolBarToggle+'"><i class="'+d.icons.tools+'"></i></a>',"</div>",'<a href="#"  class="'+d.classes.barButton+" "+d.classes.cancel+" "+d.classes.floatLeft+'"><span class="'+d.icons.cancel+'"></span> '+PhotoFrame.Lang.cancel+"</a>",'<a href="#"  class="'+d.classes.barButton+" "+d.classes.save+" "+d.classes.floatRight+'"><span class="'+d.icons.save+'"></span> '+PhotoFrame.Lang.save+"</a>","</div>","</div>","</div>"].join("");d.ui.dimmer=a(f),d.ui.toolbar=d.ui.dimmer.find("."+d.classes.toolbar),d.ui.tools=d.ui.toolbar.find("."+d.classes.tools),d.ui.toolBarToggle=d.ui.toolbar.find("."+d.classes.toolBarToggle),d.ui.infoToggle=d.ui.toolbar.find("."+d.classes.infoToggle),d.ui.toolbar.hide(),d.ui.body.append(d.ui.dimmer),d.infoPanel&&(d.ui.info=d.ui.dimmer.find("."+d.classes.infoPanel),d.ui.info.draggable(),d.ui.info.find("."+d.classes.close).click(function(a){d.ui.info.fadeOut(),a.preventDefault()})),d.ui.progress=d.ui.dimmer.find("."+d.classes.progress),d.ui.save=d.ui.dimmer.find("."+d.classes.save),d.ui.cancel=d.ui.dimmer.find("."+d.classes.cancel),d.ui.errors=d.ui.dimmer.find("."+d.classes.errors),d.ui.errorCancel=d.ui.dimmer.find("."+d.classes.errors+" ."+d.classes.cancel),d.ui.crop=d.ui.dimmer.find("."+d.classes.crop),d.ui.cropPhoto=d.ui.dimmer.find("."+d.classes.cropPhoto),d.ui.meta=d.ui.dimmer.find("."+d.classes.meta),d.ui.metaToggle=d.ui.dimmer.find("."+d.classes.metaToggle),d.ui.metaClose=d.ui.dimmer.find("."+d.classes.metaClose),d.ui.metaTitle=d.ui.meta.find("#title"),d.ui.metaDescription=d.ui.meta.find("#description"),d.ui.metaKeywords=d.ui.meta.find("#keywords"),d.ui.dropZone=d.$wrapper.find("."+d.classes.dropZone),d.buttonBar=new PhotoFrame.ButtonBar(d,d.buttons,{title:PhotoFrame.Lang.tools}),d.buttonBar.ui.window.addClass("photo-frame-button-bar"),a(window).keyup(function(a){27==a.keyCode&&d.ui.cancel.click()}),d.progressBar=new PhotoFrame.ProgressBar(d.ui.progress,{callbacks:{cancel:function(){d.cancel=!0,d.jqXHR&&d.jqXHR.abort(),d.ui.dimmer.fadeOut(),d.resetProgress()}}}),d.ui.errorCancel.click(function(a){d.clearNotices(),d.ui.dimmer.fadeOut("fast"),d.hideMeta(),d.hideProgress(),a.preventDefault()}),d.IE()?(d.ui.iframe=a('<iframe name="photo-frame-iframe-'+d.index+'" id="photo-frame-iframe-'+d.index+'" src="" style="display:none;width:0;height:0"></iframe>'),d.ui.body.append(d.ui.iframe)):d.ui.form.fileupload({started:function(){d.showProgress(0)},progress:function(a,b){d.showProgress(.5*parseInt(b.loaded/b.total*100))},pasteZone:null,singleFileUploads:!1,dropZone:d.ui.dropZone,url:d.getUploadUrl(),add:function(a,b){d.maxPhotos>0&&d.maxPhotos<=d.getTotalPhotos()?d.showErrors([PhotoFrame.Lang.max_photos_error],{max_photos:d.maxPhotos,max_photos_name:1==d.maxPhotos?"photo":"photos"}):b.files.length>0&&(d.ui.dropZone.hide(),d.initialized=!1,d.showProgress(0),d.startUpload(b.files,function(){d.jqXHR=b.submit()}))},fail:function(){d.cancel||d.showErrors([PhotoFrame.Lang.unexpected_error]),d.cancel=!1},done:function(b,c){var e=[];if(("undefined"==typeof c.result[0]||"string"==typeof c.result)&&(e=[PhotoFrame.Lang.unexpected_error]),"object"==typeof c.result&&1==c.result.length)d.showProgress(75,function(){d._uploadResponseHandler(c.result[0])});else{var f=1;"undefined"!=typeof c.result[0].success?d.showProgress(100,function(){a.each(c.result,function(a,b){d._uploadResponseHandler(b,!0,!0,function(){f==c.result.length&&(d.hideProgress(),d.hideDimmer()),f++})})}):(d.hideProgress(),d.showErrors(e),d.log(c.result))}}}),d.photos=[];for(var g in e){var h=e[g];new PhotoFrame.Photo(d,h,{id:h.id,manipulations:h.manipulations,index:g,cropSettings:a.extend({},c.cropSettings,{setSelect:[h.x,h.y,h.x2,h.y2]}),$wrapper:d.$wrapper.find("#"+d.classes.photo+"-"+d.fieldId+"-"+g)})}a(window).resize(function(){"none"!=d.ui.crop.css("display")&&d.ui.crop.center(),"none"!=d.ui.meta.css("display")&&d.ui.meta.center(),d.ui.saving&&d.ui.saving.center(),"none"!=d.ui.errors.css("display")&&d.ui.errors.center()}),d.ui.metaToggle.click(function(a){d.toggleMeta(),a.preventDefault()}),d.ui.metaClose.click(function(a){d.hideMeta(),a.preventDefault()}),d.ui.browse.click(function(){d.callback(d.callbacks.browse)}),d.ui.toolBarToggle.click(function(a){d.toggleTools(),a.preventDefault()}),d.ui.infoToggle.click(function(a){d.toggleMeta(),a.preventDefault()}),d.$wrapper.bind("dragover",function(a){var b=d.$wrapper.find("."+d.classes.dropText),c=b.parent();(0==d.maxPhotos||d.maxPhotos>d.getTotalPhotos())&&(d.ui.dropZone.show(),b.position({of:c,my:"center",at:"center"}),d.$wrapper.addClass(d.classes.dragging)),a.preventDefault()}),d.$wrapper.find("."+d.classes.dropCover).bind("drop dragleave",function(b){a(b.target).hasClass(d.classes.dropTag)||d.$wrapper.removeClass(d.classes.dragging),b.preventDefault()}),d.ui.upload.click(function(a){d.isNewPhoto=!0,d.IE()?(d.ui.dimmer.show(),d.ui.crop.hide(),d.ui.instructions&&d.ui.instructions.hide(),d.ui.form.show().center()):(d.ui.form.css({position:"absolute",left:-1e3}).show(),d.ui.form.find("input").show().click()),a.preventDefault()}),d.bind("startCropBegin",function(){d.hideOverflow()}),d.bind("saveEnd",function(){d.resetOverflow()}),d.bind("cancel",function(){d.resetOverflow()}),d.callback(d.callbacks.init)},getSettings:function(){return this.settings},getSetting:function(a){var b=this.getSettings(),a="photo_frame_"+a;return b[a]?b[a]:void 0},getUploadUrl:function(){var a=PhotoFrame.Actions.upload_photo,b=this.callbacks.buildUploadUrl();return b?b:a},parse:function(b,c,d){if("object"!=typeof c){var e={};e[c]=d,c=e}return a.each(c,function(a,c){b=b.replace("{"+a+"}",c)}),b},showError:function(a,b){var c=this;a=this.parse(a,b),c.hideProgress(function(){c.ui.errors.find("ul").append("<li>"+a+"</li>"),c.ui.errors.show(),c.ui.errors.center(),c.ui.dimmer.fadeIn(),c.progressBar.reset()})},showErrors:function(b,c){var d=this;d.ui.errors.find("ul").html(""),d.ui.errors.hide(),d.ui.activity.hide(),d.ui.crop.hide(),d.ui.form.hide(),d.progressBar.hide(),a.each(b,function(a,b){d.showError(b,c)})},hideDimmer:function(a){this.buttonBar&&this.buttonBar.hide(!1),this.hideInstructions(),this.ui.dimmer.hide(a),this.ui.form.hide(),this.ui.errors.fadeOut(),this.progressBar.reset()},sortable:function(){this.sortable&&(this.ui.list=this.$wrapper.find("."+this.classes.sortable),this.ui.list.sortable({placeholder:this.classes.sortablePlaceholder}),this.ui.list.disableSelection())},clearNotices:function(a){for(var b in this.notices)this.notices[b].clear(a)},notify:function(b,c,d){function e(){var c=a('<div class="'+f.classes.panel+" "+f.classes.icons+'" />');a.each(b,function(b,d){d=a(['<div class="'+f.classes.message+'">','<p><span class="'+f.icons.warningSign+'"></span>'+d+"</p>",'<a href="#" class="'+f.classes.close+'"><span class="'+f.icons.cancel+'"></span></a>',"</div>"].join("")),h.push(d),c.append(d)}),a("body").append(c)}var f=this,g=a("."+f.classes.panel),h=[];c||(c=190),d||(d=300),1==g.length?g.fadeOut(function(){g.remove(),f.notify(b,c,d)}):e();var i=0,j=0;return a.each(h,function(b,e){setTimeout(function(){a(e).animate({right:50},d,function(){setTimeout(function(){a(e).animate({right:-a(e).width()-75},d)},5e3+j),j=c*(b+1)})},i),i=c*(b+1)}),a(".photo-frame-message .photo-frame-close").click(function(){a(this).parent().fadeOut("fast")}),b},getTotalPhotos:function(){var b=0;return a.each(this.photos,function(a,c){c&&b++}),b},hideOverflow:function(){this.overflow=a("body").css("overflow"),a("body").css("overflow","hidden")},resetOverflow:function(){a("body").css("overflow",this.overflow)},_assetResponseHandler:function(a,b,c){var d=this;if("function"==typeof b&&(c=b,b=100),"undefined"==typeof b||b===!1)var b=100;d.showProgress(b,function(){d._uploadResponseHandler(a,!0,!0,function(a){d.hideDimmer(),"function"==typeof c&&c(a)})})},_uploadResponseHandler:function(a,b,c,d){if("function"==typeof existingAssets&&(d=b,existingAssets=!1),"function"==typeof c&&(d=b,c=!1),this.response=a,this.ui.toolbar.hide(),this.response.success){b||this.$wrapper.append('<textarea name="'+this.fieldName+'[][uploaded]" style="display:none">{"field_id": "'+this.fieldId+'", "col_id": "'+this.colId+'", "row_id": "'+this.rowId+'", "path": "'+this.response.file_path+'", "original_path": "'+this.response.original_path+'", "file": "'+this.response.file_name+'"}</textarea>');var e={cropSettings:this.cropSettings,compression:this.compression,size:this.size,forceCrop:this.forceCrop,disableCrop:this.disableCrop,manipulations:{},index:this.photos.length},f=new PhotoFrame.Photo(this,a,e);c||!f.forceCrop||f.disableCrop?f._loadFromResponse(a,function(){f.factory.hideProgress(function(){f.factory.hideDimmer(),"function"==typeof d&&d()
})}):f.startCrop()}else this.showErrors(this.response.errors)},IE:function(){return this.$wrapper.children().hasClass(this.classes.ie)},hideInstructions:function(){this.ui.instructions&&(this.ui.instructions.hide(),this.ui.instructions.remove())},_fileBrowserResponseHandler:function(b,c,d){"function"==typeof c&&(d=c,c=!1);var e=this,f={fieldId:e.fieldId,varId:e.varId,colId:e.colId,siteId:e.siteId,file:b,assetId:c?c:!1,gridId:e.gridId?e.gridId:!1};f=a.extend({},f,this.callbacks.responseHandlerSettings()),this.fileBrowserResponseInProgress||(this.fileBrowserResponseInProgress=!0,a.get(PhotoFrame.Actions.photo_response,f,function(a){e.fileBrowserResponseInProgress=!1,"object"!=typeof a?(e.log(a),e.showErrors([PhotoFrame.Lang.unexpected_error])):"function"==typeof d&&d(a)}))},hideMeta:function(){this.ui.metaToggle.removeClass("active"),this.ui.meta.fadeOut("fast")},hideUpload:function(){this.ui.upload.hide(),this.ui.browse.hide(),this.ui.helper.hide()},hideProgress:function(a){this.progressBar.hide(a)},resetMeta:function(){this.ui.metaTitle.val(""),this.ui.metaKeywords.val(""),this.ui.metaDescription.val("")},hash:function(a,b){var c=c||a;s="",b=b?b:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var d=0;c>d;d++)s+=b.charAt(Math.floor(Math.random()*b.length));return s},resetProgress:function(){if("undefined"==typeof a)var a=!0;this.ui.crop.hide(),this.ui.activity.hide(),this.progressBar.reset()},showMeta:function(){this.ui.metaToggle.addClass("active"),this.ui.meta.fadeIn("fast"),this.ui.meta.center(),this.ui.metaTitle.focus()},showUpload:function(){this.ui.upload.show(),this.ui.browse.show(),this.ui.helper.show()},startUpload:function(a,b){var c=this;"function"==typeof a&&(b=a,a=[]),c.IE()?c.ui.form.hide():1==a.length&&(c.ui.errors.hide(),c.ui.crop.hide()),c.ui.crop.hide(),c.ui.dimmer.fadeIn(function(){"function"==typeof b&&b()})},showProgress:function(a,b){this.ui.dimmer.fadeIn(),this.ui.errors.hide(),this.progressBar.show(),this.progressBar.set(a,b),this.hideMeta(),this.hideInfo()},toggleMeta:function(){"none"==this.ui.meta.css("display")?this.showMeta():this.hideMeta()},toggleTools:function(){this.buttonBar&&(this.buttonBar.isVisible()?this.hideTools():this.showTools())},showTools:function(a){this.buttonBar&&this.buttonBar.show(a)},hideTools:function(a){this.buttonBar&&this.buttonBar.hide(a)},hideInfo:function(a){this.ui.info&&this.ui.info.hide(a)},showInfo:function(a){this.ui.info&&this.ui.info.fadeIn(a)},bind:function(a,b){this.events[a]||(this.events[a]=[]),"function"==typeof b&&this.events[a].push(b)},trigger:function(b){for(var c=arguments,d=[],e=1;e<=c.length;e++)"undefined"!=typeof c[e]&&d.push(c[e]);this.events[b]&&a.each(this.events[b],function(a,b){b.apply(this,d)})}}),PhotoFrame.ButtonBar=PhotoFrame.Class.extend({buttons:[],classes:{active:"photo-frame-active",wrapper:"photo-frame-toolbar-tools",list:"photo-frame-toolbar-tools-list",titleBar:"photo-frame-toolbar-tools-title"},factory:!1,title:!1,ui:{list:!1,titleBar:!1,window:!1},constructor:function(a,b,c){this.ui={},this.buttons=[],this.base(c),this.factory=a,this._buildButtonBar(),this.addButtons(b),this.savePosition(),0===this.buttons.length&&this.factory.ui.tools.hide()},addButton:function(b,c){var b=this.loadButton(b,c);if(b&&b.isActive()){var d=a("<li />").append(b.$obj);this.ui.list.append(d)}this.buttons.push(b)},addButtons:function(a,b){for(var c in a){var d=a[c];this.addButton(d,b)}},unclick:function(){},click:function(){},loadButton:function(b,c){if("object"!=typeof c&&(c={}),PhotoFrame.Buttons[b.ucfirst()]){var d=new(PhotoFrame.Buttons[b.ucfirst()])(this,a.extend(!0,{},{name:b},c));return d}this.log('The "'+b.ucfirst()+'" button does not exist.')},isVisible:function(){return"none"!=this.ui.window.css("display")?!0:!1},show:function(a,b){"undefined"==typeof a?a=!0:"function"==typeof a&&(b=a,a=!0),this.buttons.length>0&&(this.factory.ui.toolBarToggle.addClass(this.classes.active),this.ui.window.fadeIn(b),a&&this.setVisibility(!0),this.showWindows()),this.savePosition()},hide:function(a,b){var c=this;"undefined"==typeof a?a=!0:"function"==typeof a&&(b=a,a=!0);for(var d in this.factory.windows)this.factory.windows[d].close(!1);this.ui.list.find("."+this.classes.active).removeClass(this.classes.active),this.ui.window.fadeOut(function(){c.factory.ui.toolBarToggle.removeClass(c.factory.classes.active)}),a&&this.setVisibility(!1),this.savePosition()},showWindows:function(){for(var a in this.factory.windows){var b=this.factory.windows[a];b.visible&&b.open()}},hideWindows:function(){for(var a in this.factory.windows){var b=this.factory.windows[a];b.visible||b.close(!1)}},position:function(){if(this.hasPosition()){var a=this.getPosition();this.ui.window.css({left:a.x,top:a.y,position:"fixed"}),this.savePosition()}},_buildButtonBar:function(){var b=this;this.ui.window=a(['<div class="'+this.classes.wrapper+'">','<div class="'+this.classes.titleBar+'">'+this.title+"</div>",'<ul class="'+this.classes.list+'"></ul>',"</div>"].join("")).css("z-index",1),this.ui.titleBar=this.ui.window.find("."+this.classes.titleBar),this.ui.list=this.ui.window.find("."+this.classes.list),this.factory.ui.dimmer.append(this.ui.window),this.ui.window.draggable({handle:this.ui.titleBar,containment:"parent",scroll:!1,start:function(){b.bringToFront()},stop:function(){b.savePosition()}}),this.ui.titleBar.mousedown(function(){b.bringToFront()}),this.position()}}),PhotoFrame.Button=PhotoFrame.Class.extend({buttonBar:!1,icon:!1,name:!1,description:!1,$obj:!1,packageName:!1,renderAfterRemovingLayer:!0,window:!1,windowSettings:{css:"",title:!1},constructor:function(b,c,d){var e=this;"undefined"==typeof d&&(d=!0),this.ui={},this.buttonBar=b,this.base(c),this.$obj=a('<a href="#" title="'+this.description.replace('"',"")+'"></a>'),this.$obj.append("<i />").find("i").addClass("icon-"+(this.icon?this.icon:this.name.toLowerCase())),this.$obj.click(function(a){e.click(a),a.preventDefault()}),this.packageName||(this.packageName=this.name),d===!0&&this.buildWindow()},getPackageName:function(){return(this.packageName?this.packageName:this.name).toLowerCase()},showManipulation:function(){this.cropPhoto().showManipulation(this.getPackageName())},hideManipulation:function(){this.cropPhoto().hideManipulation(this.getPackageName())},addManipulation:function(a,b){this.cropPhoto().addManipulation(this.getPackageName(),a,b)},cropPhoto:function(){return this.buttonBar.factory.cropPhoto},updateJson:function(){this.cropPhoto().updateJson()},render:function(a){this.cropPhoto().render(a)},removeManipulation:function(){delete this.buttonBar.factory.cropPhoto.manipulations[this.getPackageName()],this.buttonBar.factory.trigger("removeManipulation",this)},bind:function(a,b){this.buttonBar.factory.bind(a,b)},buildWindow:function(b){"object"==typeof b&&(this.windowSettings=a.extend(!0,{},this.windowSettings,b)),this.window=new PhotoFrame.Window(this.buttonBar.factory,this.$obj,this.windowSettings)},click:function(){this.$obj.hasClass(this.buttonBar.classes.active)?(this.buttonBar.unclick(),this.$obj.removeClass(this.buttonBar.classes.active),this.window.close()):(this.buttonBar.click(),this.$obj.addClass(this.buttonBar.classes.active),this.window.open())},hideWindow:function(){this.$obj.removeClass(this.buttonBar.classes.active),this.window.close()},isActive:function(){return!0},showWindow:function(){this.$obj.addClass(this.buttonBar.classes.active),this.window.open(),this.window.position()},getVisibility:function(){return this.getManipulation()?this.getManipulation().visible:!0},getManipulation:function(){return this.cropPhoto()?this.cropPhoto().getManipulation(this.getPackageName()):!1},setManipulation:function(a){var b=this.getManipulation();b.visible=a},removeLayer:function(){this.reset()},startRendering:function(a){this.cropPhoto().startRendering(a)},stopRendering:function(a){this.cropPhoto().stopRendering(a)},startCrop:function(){var a=this.getManipulation();a&&(a.visible?this.enable():this.disable())},toggleLayer:function(a,b){a?this.enable():this.disable(),this.setManipulation(a),("undefined"==typeof b||b===!0)&&this.render()},getData:function(){return{}},getSettings:function(){return this.buttonBar.factory.getSettings()},getSetting:function(a){return this.buttonBar.factory.getSetting(a)},save:function(a,b){(a.length>0||b)&&this.addManipulation(this.getVisibility(),a),this.updateJson()},apply:function(){},enable:function(){},disable:function(){},reset:function(){},startCropCallback:function(){},startCropCallbackFailed:function(){}}),PhotoFrame.Window=PhotoFrame.Class.extend({buttons:[],css:"",callbacks:{drag:function(){},dragstart:function(){},dragend:function(){},close:function(){},open:function(){}},classes:{close:"photo-frame-tool-window-close",title:"photo-frame-tool-window-title",window:"photo-frame-tool-window",content:"photo-frame-tool-window-content",buttons:"photo-frame-tool-window-buttons",button:"photo-frame-tool-window-button",save:"photo-frame-tool-window-save",wrapper:"photo-frame-toolbar-tools"},duration:333,easeIn:"easeInElastic",easeOut:"easeOutElastic",factory:!1,icons:{close:"icon-cancel"},parent:!1,title:!1,ui:{close:!1,content:!1,title:!1,window:!1},width:!1,constructor:function(a,b,c){this.ui={},this.factory=a,this.parent=b,this.base(c),this.title||(this.title="New Window "+this.factory.windows.length),this.buildWindow(),this.visible=this.getVisibility(),a.windows.push(this)},bringToFront:function(){this.factory.zIndexCount++,this.ui.window.css("z-index",this.factory.zIndexCount)},buildButtons:function(){var b=this;a.each(this.buttons,function(c,d){var e=d.css?d.css:"",f=d.text?d.text:"",g=d.icon?'<i class="'+d.icon+'"></i>':"",h=a('<a href="#" class="'+e+" "+b.classes.button+'">'+g+f+"</a>");d.ui={button:h},"function"==typeof d.init&&d.init(d),"function"==typeof d.onclick&&h.click(function(a){return d.onclick(a,d),a.preventDefault(),!1}),b.ui.buttons.append(h)})},buildWindow:function(){var b=this,c=a(['<div class="'+this.classes.wrapper+" "+this.classes.window+'">','<a href="#" class="'+this.classes.close+'"><i class="'+this.icons.close+'"></i></a>','<div class="'+this.classes.title+'">'+(this.title?this.title.ucfirst():"N/A")+"</div>",'<div class="'+this.classes.content+'"></div>','<div class="'+this.classes.buttons+" "+this.factory.classes.clearfix+'"></div>',"</div>"].join(""));this.ui.window=c,this.ui.buttons=c.find("."+this.classes.buttons),this.ui.close=c.find("."+this.classes.close),this.ui.content=c.find("."+this.classes.content),this.ui.title=c.find("."+this.classes.title),this.ui.window.addClass(this.css),this.ui.window.draggable({handle:this.ui.title,containment:"parent",scroll:!1,drag:this.callbacks.drag,start:function(a){b.bringToFront(),b.callback(b.callbacks.dragstart,a)},stop:function(a){b.savePosition(),b.callback(b.callbacks.dragend,a)}}),this.width&&this.ui.window.width(this.width),this.ui.window.mousedown(function(){b.factory.trigger("windowMousedown",b),b.bringToFront()}),this.ui.close.click(function(a){b.close(),a.preventDefault()}),this.buildButtons(),this.factory.ui.dimmer.append(c)},close:function(a,b){var c=this;"undefined"==typeof a?a=!0:"function"==typeof a&&(b=a,a=!0),this.parent.removeClass(this.factory.buttonBar.classes.active),this.ui.window.fadeOut({duration:this.duration},function(){c.callback(c.callbacks.close),c.callback(b)}),a&&this.setVisibility(!1)},open:function(a,b){var c=this;this.factory.trigger("windowOpenBegin",this),"undefined"==typeof a?a=!0:"function"==typeof a&&(b=a,a=!0),this.parent.addClass(this.factory.buttonBar.classes.active),this.ui.window.fadeIn({duration:this.duration}).css("display","inline-block").css("position","fixed"),setTimeout(function(){c.callback(c.callbacks.open),c.callback(b),c.factory.trigger("windowOpenEnd",c)},this.duration),1!=this.ui.window.data("open")&&this.position(),this.bringToFront(),this.ui.window.data("open",1),this.setVisibility(!0),this.savePosition()},position:function(){var b=parseInt(this.ui.window.parent().index())+1,c=this.getPosition(),d=c?parseInt(c.x.replace("px","")):0;if(this.ui.window.position({of:this.parent,my:"left top",at:"right top",collision:"flip"}),d+this.ui.window.width()>a(window).width()&&(c.x=a(window).width()-this.ui.window.width()+"px"),this.hasPosition())this.ui.window.css({left:c.x,top:c.y}).position("collision","fit");else{var e=16;b%2==0&&this.shift("left",e),this.shift("left",e)}this.bringToFront(),this.savePosition()},shift:function(a,b){var c=parseInt(this.ui.window.css(a).replace("px",""));this.ui.window.css(a,c+b)},isOpen:function(){return"none"==this.ui.window.css("display")?!1:!0},toggle:function(){this.isOpen()?this.close():this.open()}}),PhotoFrame.Photo=PhotoFrame.Class.extend({cache:!1,cacheUrl:!1,compression:100,cropSettings:{},description:"",disableCrop:!1,edit:!1,factory:!1,forceCrop:!0,index:!1,initialized:!1,id:!1,jcrop:!1,keywords:"",manipulations:{},originalManipulations:{},originalPath:!1,originalUrl:!1,path:!1,rendering:!1,size:!1,title:"",ui:{actionBar:!1,edit:!1,del:!1,image:!1,photo:!1,rendering:!1,saving:!1},url:!1,useCache:!1,released:!1,$wrapper:!1,constructor:function(a,b,c){var d=this;this.ui={},this.$wrapper=!1,this.cache=a.hash(12),this.base(c),this.factory=a,this.title=b.title,this.description=b.description,this.keywords=b.keywords,this.response=b,this.originalPath=b.original_path,this.originalUrl=b.original_url,this.url=b.url,this.path=b.file_path,this.ui.rendering=this.factory.ui.crop.find("."+this.factory.classes.renderBg),this.ui.renderingTxt=this.factory.ui.crop.find("."+this.factory.classes.renderText),this.manipulations||(this.manipulations={}),this.index||(this.index=this.factory.getTotalPhotos()),this.$wrapper?this._loadFromObj(this.$wrapper):this._bindClickEvents(),a.photos.push(d)},_loadFromResponse:function(b,c){var d=this,e=a(["<li>",'<div class="'+d.factory.classes.photo+'" id="'+d.factory.classes.photo+"-"+d.factory.fieldId+"-"+d.index+'">','<div class="'+d.factory.classes.actionBar+'">',d.factory.disableCrop?"":'<a href="#'+d.index+'" class="'+d.factory.classes.editPhoto+'"><span class="'+d.factory.icons.editPhoto+'"></span></a>','<a href="#'+d.index+'" class="'+d.factory.classes.deletePhoto+'"><span class="'+d.factory.icons.deletePhoto+'"></span></a>',"</div>","</div>","</li>"].join(""));d.load(b.file_url,function(a){var f=e.find("."+d.factory.classes.photo);d.cachePath||(d.cachePath=b.directory.server_path+d.cache+"."+d.extension(b.file_name)),d._sendCropRequest(function(b){f.prepend(a).append(d._generateNewDataField(b.save_data)),d.factory.ui.preview.find("ul").append(e),d._loadFromObj(f,c)})})},_loadFromObj:function(b,c){var d=this;d.edit=d,d.ui.photo=a(b),d.ui.parent=d.ui.photo.parent(),d.ui.actionBar=d.ui.parent.find("."+d.factory.classes.actionBar),d.ui.edit=d.ui.actionBar.find("."+d.factory.classes.editPhoto),d.ui.del=d.ui.actionBar.find("."+d.factory.classes.deletePhoto),d.ui.field=d.ui.photo.find("textarea"),d._bindClickEvents(),"function"==typeof c&&c()},_bindClickEvents:function(){var a=this;a.ui.edit&&a.ui.edit.unbind("click").click(function(b){a.showProgress(0),a.startCrop(),b.preventDefault()}),a.ui.del&&a.ui.del.unbind("click").click(function(b){a.remove(),b.preventDefault()})},extension:function(a){return a.split(".").pop()},remove:function(){var a=this;a.ui.field.remove(),a.id!==!1&&a.factory.$wrapper.append('<input type="hidden" name="photo_frame_delete_photos['+a.factory.delId+'][]" value="'+a.id+'" />'),a.ui.parent.fadeOut(function(){a.ui.parent.remove(),a.factory.maxPhotos>0&&a.factory.maxPhotos>a.factory.getTotalPhotos()-1||0==a.factory.minPhotos&&0==a.factory.maxPhotos?a.factory.showUpload():a.factory.hideUpload(),a.factory.photos[a.index]=!1})},hideManipulation:function(a){var b=a.toLowerCase(),c=this.manipulations[b]?this.manipulations[b]:!1;this.manipulations[b]&&(this.manipulations[b].visible=!1),this.factory.trigger("hideManipulation",this,b,c)},showManipulation:function(a){var b=a.toLowerCase(),c=this.manipulations[b]?this.manipulations[b]:!1;this.manipulations[b]&&(this.manipulations[b].visible=!0),this.factory.trigger("showManipulation",this,b,c)},addManipulation:function(a,b,c){var d=a.toLowerCase(),e=this.manipulations[d]?this.manipulations[d]:!1;c&&(this.manipulations[d]={visible:b,data:c}),this.factory.trigger("addManipulation",this,d,e)},getManipulation:function(a){return a=a.toLowerCase(),this.manipulations[a]?this.manipulations[a]:!1},getManipulations:function(){return this.manipulations},showMeta:function(){this.factory.showMeta()},hideMeta:function(){this.factory.hideMeta()},hideInstructions:function(){this.factory.hideInstructions()},initJcrop:function(a){var b=this;if(b.factory.ui.toolbar.show(),b.initialized&&b.destroyJcrop(),b.cropSettings.onChange=function(){b.hideInstructions(),b.updateInfo(),this.released=!1,b.factory.trigger("jcropOnChange",this)},b.cropSettings.onRelease=function(){this.released=!0,b.factory.trigger("jcropOnRelease",this)},b.cropSettings.onSelect=function(){this.released=!1,b.factory.trigger("jcropOnSelect",this)},b.cropSettings.setSelect){var c=0;for(var d in b.cropSettings.setSelect)c+=b.cropSettings.setSelect[d];0==c&&delete b.cropSettings.setSelect}b.ui.cropPhoto.Jcrop(b.cropSettings,function(){b.jcrop=this,"function"==typeof a&&a(this)}),b.initialized=!0},destroyJcrop:function(){this.jcrop&&this.jcrop.destroy(),this.jcrop=!1,this.initialized=!1},releaseCrop:function(){this.jcrop.setSelect([0,0,0,0]),this.jcrop.release(),this.released=!0},hideProgress:function(){this.factory.hideProgress()},showProgress:function(){this.factory.showProgress()},clearNotices:function(a){this.factory.clearNotices(a)},getSaveData:function(){return this.ui.field?this.ui.field.val():!1},setSaveData:function(a){this.ui.field&&this.ui.field.val(a).html(a)},updateJson:function(){var a=this.jsonEncode(this.getSaveData());a.manipulations=this.getManipulations(),this.setSaveData(this.jsonDecode(a))},render:function(b){var c=this;!this.isRendering()&&c.ui.cropPhoto?(this.startRendering(),this.useCache=!0,a.post(PhotoFrame.Actions.render,{fieldId:this.factory.fieldId,colId:this.factory.colId,varId:this.factory.varId,gridId:this.factory.gridId,path:this.path,originalPath:this.originalPath,originalUrl:this.originalUrl,cachePath:this.cachePath,cacheUrl:this.cacheUrl,cache:this.cache,manipulations:c.getManipulations(),directory:this.factory.directory,preview:!0},function(a){c.cacheUrl=a.url,c.load(a.url,function(d){c.ui.cropPhoto.html(d),c.stopRendering(),c.callback(b,a),c.factory.trigger("render")})})):c.callback(b)},totalManipulations:function(){var a=0;for(var b in this.manipulations)a++;return a},needsRendered:function(){var a=this.totalManipulations();return!a||1==a&&this.manipulations.crop?!1:a>0?!0:void 0},needsRendering:function(){return this.needsRendered()},isRendering:function(){return this.rendering},startRendering:function(a){this.rendering=!0,this.factory.trigger("startRendering"),this.factory.ui.dimmer.addClass(this.factory.classes.rendering),this.callback(a)},stopRendering:function(a){this.rendering=!1,this.factory.trigger("stopRendering"),this.factory.ui.dimmer.removeClass(this.factory.classes.rendering),this.callback(a)},tellScaled:function(){return this.jcrop?this.jcrop.tellScaled():[0,0,0,0]},updateInfo:function(){var a=this;if(a.factory.ui.info){var b=a.cropDimensions(),c=b.a;a.factory.ui.info.fadeIn(),a.factory.ui.info.find(".size .width").html(Math.ceil(b.w)+"px"),a.factory.ui.info.find(".size .height").html(Math.ceil(b.h)+"px"),a.factory.ui.info.find(".aspect").html("("+c[0]+":"+c[1]+")"),a.factory.ui.info.find(".x").html(Math.ceil(b.x)+"px"),a.factory.ui.info.find(".x2").html(Math.ceil(b.x2)+"px"),a.factory.ui.info.find(".y").html(Math.ceil(b.y)+"px"),a.factory.ui.info.find(".y2").html(Math.ceil(b.y2)+"px");var d=a.validate(!0);a.factory.ui.info.find(".width").removeClass(a.factory.classes.invalid),a.factory.ui.info.find(".height").removeClass(a.factory.classes.invalid),a.factory.ui.info.find(".aspect").removeClass(a.factory.classes.invalid),d.validWidth||a.factory.ui.info.find(".width").addClass(a.factory.classes.invalid),d.validHeight||a.factory.ui.info.find(".height").addClass(a.factory.classes.invalid),d.validRatio||a.factory.ui.info.find(".aspect").addClass(a.factory.classes.invalid)}a.factory.ui.instructions&&"none"!=a.factory.ui.instructions.css("display")&&a.factory.initialized&&a.factory.ui.instructions.fadeOut()},load:function(a,b){"function"==typeof a&&(b=a,a=this.photoUrl()),window.loadImage(a,function(a){"function"==typeof b&&b(a)})},photoUrl:function(){return this.useCache?this.cacheUrl:this.originalUrl},startCrop:function(b){this.factory.cropPhoto=this;var c=this,d={fieldId:this.factory.fieldId?this.factory.fieldId:!1,varId:this.factory.varId?this.factory.varId:!1,colId:this.factory.colId?this.factory.colId:!1,gridId:this.factory.gridId?this.factory.gridId:!1,cache:this.cache,originalUrl:this.originalUrl,originalPath:this.originalPath,exifData:this.response.exif_string?this.response.exif_string:"",manipulations:this.manipulations,directory:this.factory.directory};c.originalManipulations=a.extend(!0,{},c.manipulations),c.factory.buttonBar&&a.each(c.factory.buttonBar.buttons,function(a,b){b.reset()}),c.factory.trigger("startCropBegin",c),c.factory.ui.dimmer.fadeIn("fast"),c.initialized||c.factory.ui.cropPhoto.remove(),c.factory.resetMeta(),a.post(PhotoFrame.Actions.start_crop,d,function(e){e.success?c.factory.showProgress(100,function(){c.useCache=!0,c.cacheUrl=e.cacheUrl,c.cachePath=e.cachePath,e.success?(a.each(c.factory.buttonBar.buttons,function(a,b){b.startCropCallback(c,d,e.data)}),c.factory.trigger("startCropCallback",c,d,e.data)):(a.each(c.factory.buttonBar.buttons,function(a,b){b.startCropCallbackFailed(c,d,e.data)}),c.factory.trigger("startCropCallbackFailed",c,d,e)),c.load(c.photoUrl(),function(d){if(c.factory.hideProgress(),c.ui.cropPhoto=a('<div class="'+c.factory.classes.cropPhoto+'"></div>'),c.factory.ui.cropPhoto=c.ui.cropPhoto,c.factory.trigger("cropPhotoLoaded",c,d),c.ui.instructions=a('<div class="" />').html(PhotoFrame.Lang.instructions),"true"!=c.factory.settings.photo_frame_hide_instructions&&(c.factory.instructions&&c.edit===!1?(c.factory.ui.instructions=a('<div class="'+c.factory.classes.instructions+'" />').html(c.factory.instructions),c.factory.ui.dimmer.append(c.factory.ui.instructions)):c.factory.ui.instructions&&c.factory.ui.instructions.hide()),c.ui.cropPhoto.html(d),c.factory.ui.crop.prepend(c.ui.cropPhoto),c.factory.ui.crop.center(),c.factory.ui.crop.show(),c.hideMeta(),c.factory.buttonBar&&c.factory.buttonBar.getVisibility()&&c.factory.showTools(),c.edit===!1&&c.size!==!1){var e=c.size.split("x");e[0]=parseInt(e[0]),e[1]=parseInt(e[1]);var f=c.ui.cropPhoto.width()/2-e[0]/2,g=f+e[0],h=c.ui.cropPhoto.height()/2-e[1]/2,i=h+e[1];c.cropSettings.setSelect=[f,h,g,i]}if(c.title&&c.factory.ui.metaTitle.val(c.title),c.keywords&&c.factory.ui.metaKeywords.val(c.keywords),c.description&&c.factory.ui.metaDescription.val(c.description),c.initJcrop(b),c.updateInfo(),a(window).resize(),c.factory.buttonBar)for(var f in c.factory.buttons)c.factory.buttonBar.buttons[f].startCrop(c);c.needsRendered()?c.render(function(){c.factory.trigger("startCropEnd",c)}):c.factory.trigger("startCropEnd",c)})}):e.errors?c.factory.showErrors(e.errors):(c.log(e),c.factory.showErrors([PhotoFrame.Lang.unexpected_error]))}),c.factory.ui.save.unbind("click").bind("click",function(a){if(c.factory.showMetaOnSave&&"none"==c.factory.ui.meta.css("display")){var b=c.validate();0==b.length?c.showMeta():c.factory.notify(b)}else c.hideMeta(),c.saveCrop();a.preventDefault()}),c.factory.ui.cancel.unbind("click").click(function(b){c.clearNotices(),c.hideMeta(),c.hideProgress(),c.manipulations=a.extend(!0,{},c.originalManipulations),c.factory.cancel=!0,c.render(),c.factory.hideDimmer(),c.factory.resetProgress(),c.factory.cropPhoto&&c.factory.cropPhoto.destroyJcrop(),c.ui.saving&&c.ui.saving.fadeOut(function(){a(this).remove()}),c.factory.trigger("cancel",c),b.preventDefault()})},save:function(a){var b=this,c=(new Date,b.edit);this.factory.trigger("saveBegin",this),c?b._updatePhoto(a):b._createPhoto(a),b.load(b.cropResponse.url,function(a){b.factory.maxPhotos>0&&b.factory.maxPhotos<=b.factory.getTotalPhotos()&&b.factory.hideUpload(),c||b.factory.ui.preview.find("ul").append(b.ui.parent),b.ui.photo.find("img").remove(),b.ui.photo.append(a),b.ui.saving&&b.ui.saving.remove(),b.hideProgress(),b.hideDimmer(),b.factory.trigger("saveEnd",b)})},hideDimmer:function(){this.factory.hideDimmer()},_createPhoto:function(b){var c=this,d=a(["<li>",'<div class="'+c.factory.classes.photo+'" id="'+c.factory.classes.photo+"-"+c.factory.fieldId+"-"+c.index+'">','<div class="'+c.factory.classes.actionBar+'">','<a href="#'+c.index+'" class="'+c.factory.classes.editPhoto+'"><span class="'+c.factory.icons.editPhoto+'"></span></a>','<a href="#'+c.index+'" class="'+c.factory.classes.deletePhoto+'"><span class="'+c.factory.icons.deletePhoto+'"></span></a>',"</div>","</div>","</li>"].join(""));c.edit=c,c.ui.parent=a(d),c.ui.photo=c.ui.parent.find("."+c.factory.classes.photo),c.ui.actionBar=c.ui.parent.find("."+c.factory.classes.actionBar),c.ui.edit=c.ui.actionBar.find("."+c.factory.classes.editPhoto),c.ui.del=c.ui.actionBar.find("."+c.factory.classes.deletePhoto),c.ui.field=c._generateNewDataField(b),c.ui.photo.append(c.ui.field),c._bindClickEvents()},_generateNewDataField:function(b){return a('<textarea name="'+this.factory.fieldName+'[][new]" id="'+this.factory.classes.editPhoto+"-"+this.factory.fieldId+"-"+this.index+'" style="display:none">'+b+"</textarea>")},_updatePhoto:function(a){this.ui.field.val(a).html(a)},saveCrop:function(){var b=this;this.factory.trigger("saveCropStart",b);var c=b.validate();c.length>0?b.factory.notify(c):(b.clearNotices(),b.ui.saving=a('<div class="'+b.factory.classes.saving+'"><span></span> '+PhotoFrame.Lang.saving+"</div>"),b.factory.ui.dimmer.append(b.ui.saving),b.factory.ui.dimmer.find("."+b.factory.classes.saving+" span").activity(),b.factory.ui.crop.fadeOut(),b.ui.info&&b.ui.info.fadeOut(),b.hideMeta(),b.ui.saving.center(),b.title=b.factory.ui.metaTitle.val(),b.description=b.factory.ui.metaDescription.val(),b.keywords=b.factory.ui.metaKeywords.val(),b._sendCropRequest(function(a){b.cropResponse=a,b.factory.cropPhoto=!1,b.destroyJcrop(),b.save(a.save_data),b.factory.trigger("saveCropStop",b,a)}))},_sendCropRequest:function(b,c){if("function"==typeof b&&(c=b,b=!1),!b)var b=this.response;var d=this,e={x:0,y:0,x2:0,y2:0,w:0,h:0},f=d.released?e:d.tellScaled();f.w&&f.h&&"true"!==this.factory.settings.photo_frame_disable_regular_crop?d.cropSettings.setSelect=[f.x,f.y,f.x2,f.y2]:(f=e,delete d.cropSettings.setSelect),a.post(PhotoFrame.Actions.crop_photo,{fieldId:d.factory.fieldId,varId:d.factory.varId,colId:d.factory.colId,gridId:d.factory.gridId,cache:d.cache,useCache:d.useCache,cacheUrl:d.cacheUrl?d.cacheUrl:b.file_url,cachePath:d.cachePath?d.cachePath:b.file_path,id:d.factory.directory.id,assetId:d.response.asset_id,index:d.factory.index,photo_id:d.id,image:b.file_path,name:b.file_name,manipulations:d.manipulations,directory:d.factory.directory,original:b.original_path,original_file:b.original_file,exifData:b.exif_string,url:b.url,edit:d.edit!==!1?!0:!1,height:f.h,width:f.w,scale:d.scale,rotate:d.rotate,resize:d.resize,resizeMax:d.resizeMax,x:f.x,x2:f.x2,y:f.y,y2:f.y2,title:d.title,description:d.description,keywords:d.keywords,compression:d.compression},function(a){"function"==typeof c&&c(a)})},isCropped:function(a){if(!a)var a=this.cropDimensions();if(!a&&this.jcrop.tellSelect)var a=this.jcrop.tellScalled();return 0==this.factory.ui.dimmer.find(".jcrop-tracker").width()?!1:"undefined"==typeof a||a.x||a.y||a.x2||a.y2?!0:!1},reduce:function(a,b){var c=function d(a,b){return 0==b?a:d(b,a%b)};return c=c(a,b),[a/c,b/c]},cropDimensions:function(a){var b={w:0,h:0,x:0,x2:0,y:0,y2:0};if(!a&&this.jcrop.tellSelect)var a=this.jcrop.tellSelect();else var a=b;var c={w:this.ui.cropPhoto.find("img").width(),h:this.ui.cropPhoto.find("img").height()};if(a.w=0==a.w?c.w:a.w,a.h=0==a.h?c.h:a.h,this.cropSettings.aspectRatio){var d=this.cropSettings.aspectRatioString.split(":");"undefined"==typeof d[0]&&(d[0]=0),"undefined"==typeof d[1]&&(d[1]=0),this.isCropped(a)||(d=[a.w,a.h]),d=this.reduce(d[0],d[1])}else var d=this.reduce(Math.ceil(a.w),Math.ceil(a.h));return this.isCropped(a)||(a=b,a.w=c.w,a.h=c.h,d=this.reduce(c.w,c.h)),a.a=d,a},round:function(a,b){if(!b)var b=100;return Math.round(a*b)/b},aspectRatio:function(a){for(var b=1,c=1,d=1,e=1e5;b!=a&&e-->0;)a>b?c+=1:(d+=1,c=parseInt(a*d,10)),b=c/d;return c+"/"+d},width:function(){return this.ui.cropPhoto?this.ui.cropPhoto.find("img").width():0},height:function(){return this.ui.cropPhoto?this.ui.cropPhoto.find("img").height():0},validate:function(a){var b=this;if(!a)var a=!1;var c=b.cropSettings.aspectRatio?b.cropSettings.aspectRatio:!1,d=b.cropDimensions(),e=d.w,f=d.h,g=b.cropSettings.minSize?b.cropSettings.minSize[0]:0,h=b.cropSettings.minSize?b.cropSettings.minSize[1]:0,i=b.cropSettings.maxSize?b.cropSettings.maxSize[0]:0,j=b.cropSettings.maxSize?b.cropSettings.maxSize[1]:0,k=b.isCropped(d),l=Math.ceil(d.h),m=Math.ceil(d.w),n=[],o=(Math.ceil(this.width()),Math.ceil(this.height()),{validWidth:!0,validHeight:!0,validRatio:!0,minWidth:g,minHeight:h,maxWidth:i,maxHeight:j,width:d.w,height:d.h,x:d.x,x2:d.x2,y:d.y,y2:d.y2,ratio:c,ratioString:b.cropSettings.aspectRatioString});return g>0&&g>m&&(o.validWidth=!1,n.push(this.factory.parse(PhotoFrame.Lang.min_width,"min_width",g))),h>0&&h>l&&(o.validHeight=!1,n.push(this.factory.parse(PhotoFrame.Lang.min_height,"min_height",h))),i>0&&m>i&&(o.validWidth=!1,n.push(this.factory.parse(PhotoFrame.Lang.max_width,"max_width",i))),j>0&&l>j&&(o.validHeight=!1,n.push(this.factory.parse(PhotoFrame.Lang.max_height,"max_height",j))),!k&&c&&b.round(c,100)!=b.round(e/f,100)&&(o.validRatio=!1,n.push(this.factory.parse(PhotoFrame.Lang.required_ratio,"aspect_ratio",b.cropSettings.aspectRatioString))),o.errors=n,a?o:n}}),PhotoFrame.ProgressBar=PhotoFrame.Class.extend({progress:0,ui:{},$wrapper:!1,constructor:function(b,c,d){var e=this;if(e.progress=0,e.ui={},e.$wrapper=a(b),"object"==typeof c&&(d=c,c=0),"undefined"==typeof c)var c=0;if("undefined"==typeof d)var d={};var f={callbacks:{init:function(){},cancel:function(){},progress:function(){},hide:function(){},show:function(){},reset:function(){}},duration:333,classes:{progress:"photo-frame-progress-fill",cancel:"photo-frame-progress-cancel",wrapper:"photo-frame-progress-wrapper"}};e.ui={obj:e.$wrapper,parent:e.$wrapper.parent(),fill:e.$wrapper.find},e.base(f,d),e.ui.obj.data("init")||(e.ui.fill=a('<div class="'+e.classes.progress+'" />'),e.ui.cancel=a('<a href="#" class="'+e.classes.cancel+'"><span class="icon-cancel"></span></a>'),e.ui.obj.wrap('<div class="'+e.classes.wrapper+" "+e.classes.icons+'" />'),e.ui.cancel.insertBefore(e.ui.obj),e.ui.obj.append(e.ui.fill),e.ui.obj.data("init","true"),e.ui.wrapper=e.ui.obj.parent("."+e.classes.wrapper),e.ui.cancel.click(function(a){e.callbacks.cancel(e,a),e.hide(function(){e.reset(0)}),a.preventDefault()}),e.callbacks.init(e),e.set(e.progress)),a(window).resize(function(){e.center()})},reset:function(a){var b=this;b.set(0,function(){b.callbacks.reset(b),"function"==typeof a&&a()})},set:function(a,b){var c=this,d=c.ui.obj.outerWidth(),e=d&&!isNaN(d)&&d>0?d:c.ui.obj.width();c.progress=parseInt(a)>100?100:parseInt(a),c.progress=parseInt(e*(a/100)),c.ui.fill.css("width",c.progress),c.callbacks.progress(c,c.progress),setTimeout(function(){"function"==typeof b&&b(c)},c.duration)},get:function(){return this.progress},center:function(){this.ui.wrapper.position({of:this.ui.parent,my:"center",at:"center"})},show:function(a,b){var c=this;if("function"==typeof a&&(b=a,a=void 0),"undefined"==typeof a)var a=c.duration;c.center(),c.ui.wrapper.fadeIn(a,function(){c.callbacks.show(c),"function"==typeof b&&b(c)}),c.center()},hide:function(a,b){var c=this;if("function"==typeof a&&(b=a,a=void 0),"undefined"==typeof a)var a=c.duration;
c.ui.wrapper.fadeOut(a,function(){c.callbacks.hide(c),"function"==typeof b&&b(c)})}}),PhotoFrame.Database=PhotoFrame.Class.extend({driver:"localStorage",fields:[],model:!1,name:!1,reset:!1,constructor:function(a){this.base(a),this.model=new localStorageDB("PhotoFrame",this.driver),this.reset&&this.clear(),this._firstRun()},clear:function(){this.model.dropTable(this.name),this.model.commit()},create:function(){this.model.createTable(this.name,this.fields),this.model.commit()},drop:function(){this.model.dropTable(this,name),this.model.commit()},exists:function(){return this.model.tableExists(this.name)},get:function(a){return this.model.query(this.name,a)},insert:function(a){this.model.insert(this.name,a),this.model.commit()},insertIfNew:function(a){0==this.model.query(this.name,a).length&&(this.model.insert(this.name,a),this.model.commit())},insertOrUpdate:function(a,b){this.model.insertOrUpdate(this.name,a,b),this.model.commit()},update:function(b,c){"object"!=typeof b&&(b={ID:b}),this.model.update(this.name,b,function(b){return a.extend(!0,{},b,c)}),this.model.commit()},remove:function(a){this.model.deleteRows(this.name,{ID:a}),this.model.commit()},_firstRun:function(){this.exists()||this.create()}}),PhotoFrame.Slider=PhotoFrame.BaseElement.extend({animate:!1,callbacks:{create:function(){},start:function(){},slide:function(){},stop:function(){}},disabled:!1,factory:!1,min:!1,max:!1,orientation:!1,parent:!1,range:!1,step:1,ui:{slider:!1,tooltip:!1},usePreferences:!1,value:!1,constructor:function(a,b,c){this.base(a,b,c),this.buildSlider()},buildSlider:function(){var b=this,c="photo-frame-slider-tooltip photo-frame-hidden";this.ui.slider=a('<div class="photo-frame-slider"></div>'),this.ui.tooltip=a('<div class="'+c+'"></div>'),this.parent.append(this.ui.slider),this.parent.append(this.ui.tooltip),this.ui.slider.slider({animate:this.animate,disabled:this.disabled,min:this.min,max:this.max,orientation:this.orientation,range:this.range,step:this.step,value:this.value,start:function(a,c){b.showTooltip(),b.positionTooltip(c),b.factory.trigger("sliderStart",b),b.callback(b.callbacks.start,a,c)},create:function(a,c){b.positionTooltip(c),b.factory.trigger("sliderCreate",b),b.callback(b.callbacks.create,a,c)},slide:function(a,c){b.positionTooltip(c),b.factory.trigger("sliderSlide",b),b.callback(b.callbacks.slide,a,c),b.setPreference()},stop:function(a,c){b.hideTooltip(),b.positionTooltip(c),b.factory.trigger("sliderStop",b),b.callback(b.callbacks.stop,a,c)}}),this.setValueFromPreferences()},positionTooltip:function(a){this.ui.tooltip.html(a.value),this.ui.tooltip.position({of:a.handle,my:"center top",at:"center bottom"});var b=parseInt(this.ui.tooltip.css("top").replace("px",""),10);this.ui.tooltip.css("top",b+10)},showTooltip:function(){this.ui.tooltip.removeClass("photo-frame-hidden")},hideTooltip:function(){this.ui.tooltip.addClass("photo-frame-hidden")},enable:function(){this.disabled=!1,this.ui.slider.slider("enable")},disable:function(){this.disabled=!0,this.ui.slider.slider("disable")},getSliderOption:function(a){return this.ui.slider.slider(a)},setSliderOption:function(a,b){this.ui.slider.slider(a,b)},setValue:function(a){this.setSliderOption("value",a)},getValue:function(){return this.getSliderOption("value")},isEnabled:function(){return this.getSliderOption("disabled")?!1:!0},isDisabled:function(){return this.getSliderOption("disabled")},setPreference:function(){this.usePreferences&&PhotoFrame.Model.Preferences.setPreference("sliderLastValue",this.getValue())},getPreference:function(){return this.usePreferences?PhotoFrame.Model.Preferences.getPreference("sliderLastValue"):!1},setValueFromPreferences:function(){this.usePreferences&&this.value===!1&&this.setValue(this.getPreference())}}),PhotoFrame.ColorPicker=PhotoFrame.BaseElement.extend({callbacks:{init:function(){},change:function(){},move:function(){},hide:function(){},show:function(){},beforeShow:function(){}},cancelText:!1,chooseText:!1,className:"photo-frame-color-picker",clickoutFiresChange:!1,color:!1,disabled:!1,flat:!1,fontWindowId:"fontWindowColorPicker",palette:[],preferredFormat:"hex",showAlpha:!1,showButtons:!1,showInitial:!1,showInput:!1,showPalette:!1,showSelectionPalette:!1,usePreferences:!1,constructor:function(a,b,c){this.base(a,b,c),this.buildColorPicker(),this.color||this.setColorFromPreferences()},buildColorPicker:function(){var a=this;this.parent.spectrum({cancelText:this.cancelText,chooseText:this.chooseText,className:this.className,clickoutFiresChange:this.clickoutFiresChange,color:this.color,disabled:this.disabled,flat:this.flat,palette:this.palette,preferredFormat:this.preferredFormat,showAlpha:this.showAlpha,showButtons:this.showButtons,showInitial:this.showInitial,showInput:this.showInput,showPalette:this.showPalette,showSelectionPalette:this.showSelectionPalette,change:function(b){a.setPreference(),a.callback(a.callbacks.change,b),a.factory.trigger("colorPickerChange",a,b)},move:function(b){a.callback(a.callbacks.move,b),a.factory.trigger("colorPickerMove",a,b)},hide:function(b){a.callback(a.callbacks.hide,b),a.factory.trigger("colorPickerHide",a,b)},show:function(b){a.callback(a.callbacks.show,b),a.factory.trigger("colorPickerShow",a,b)},beforeShow:function(b){a.callback(a.callbacks.beforeShow,b),a.factory.trigger("colorPickerBeforeShow",a,b)}}),this.callback(this.callbacks.init),this.factory.trigger("colorPickerInit")},get:function(){return this.getColor()},set:function(a){this.setColor(a)},getRgb:function(){return this.getColor().toRgb()},getRgbString:function(){return this.getColor().toRgbString()},getHsl:function(){return this.getColor().toHsl()},getHslString:function(){return this.getColor().toHslString()},getName:function(){return this.getColor().toName()},getPercentageRgb:function(){return this.getColor().toPercentageRgb()},getPercentageRgbString:function(){return this.getColor().toPercentageRgbString()},getHex:function(){return this.getColor().toHex()},getHexString:function(){return this.getColor().toHexString()},getColor:function(){return this.parent.spectrum("get")},getString:function(a){return this.getColor().toString(a)},setColor:function(a){this.parent.spectrum("set",a),this.setPreference()},enable:function(){this.parent.spectrum("enable"),this.factory.trigger("colorPickerEnable")},disable:function(){this.parent.spectrum("disable"),this.factory.trigger("colorPickerDiable")},destroy:function(){this.parent.spectrum("destroy"),this.factory.trigger("colorPickerDestroy")},show:function(){this.parent.spectrum("show"),this.factory.trigger("colorPickerShow")},hide:function(){this.parent.spectrum("hide"),this.factory.trigger("colorPickerHide")},toggle:function(){this.parent.spectrum("toggle"),this.factory.trigger("colorPickerToggle")},getPreference:function(){var a={rgb:PhotoFrame.Model.Preferences.getPreference("colorPickerLastColorRgb"),hex:PhotoFrame.Model.Preferences.getPreference("colorPickerLastColorHex")};return this.usePreferences||"array"!=typeof a||0!=a.length?a:!1},setPreference:function(){this.usePreferences&&(PhotoFrame.Model.Preferences.setPreference("colorPickerLastColorRgb",this.getRgbString()),PhotoFrame.Model.Preferences.setPreference("colorPickerLastColorHex",this.getHexString()))},setColorFromPreferences:function(){this.usePreferences&&this.setColor(this.getPreference().hex)}}),PhotoFrame.Model.Preferences=new PhotoFrame.Database({name:"photoFramePrefs",fields:["key","value"],getPreference:function(a){if("undefined"!=typeof a){var b=PhotoFrame.Model.Preferences.get({key:a});return b.length>0?b[0].value:!1}return PhotoFrame.Model.Preferences.get()},setPreference:function(a,b){if("object"==typeof a){var c=a;for(a in c)this.setPreference(a,c[a])}else PhotoFrame.Model.Preferences.insertOrUpdate({key:a},{key:a,value:b})}}),PhotoFrame.Model.WindowLocations=new PhotoFrame.Database({name:"windowLocations",fields:["title","x","y","visible"]}),PhotoFrame.WindowControls=PhotoFrame.Class.extend({visible:!1,getVisibility:function(){var a=PhotoFrame.Model.WindowLocations.get({title:this.title});return a.length>0&&a[0].visible?a[0].visible:!1},setVisibility:function(a){a=a?!0:!1,PhotoFrame.Model.WindowLocations.update({title:this.title},{visible:a}),this.visible=a},savePosition:function(){PhotoFrame.Model.WindowLocations.insertOrUpdate({title:this.title},{visible:this.getVisibility(),title:this.title,y:this.ui.window.css("top"),x:this.ui.window.css("left")})},bringToFront:function(){this.factory.zIndexCount++,this.ui.window.css("z-index",this.factory.zIndexCount)},hasPosition:function(){return this.getPosition()?!0:!1},getPosition:function(){var a=PhotoFrame.Model.WindowLocations.get({title:this.title});return 0==a.length?!1:a[0]},restorePosition:function(){var a=this.getPosition();this.setPosition(a.x,a.y)},setPosition:function(a,b){this.ui.window.css("left",a).css("top",b)}}),PhotoFrame.Window.implement(PhotoFrame.WindowControls),PhotoFrame.ButtonBar.implement(PhotoFrame.WindowControls)}(jQuery),jQuery.isVersion=function(a,b,c){if(a){var d=/pre/i,e=/[^\d]+/g,b=b||"==",c=c||jQuery.fn.jquery,f=a.replace(e,""),g=c.replace(e,""),h=f.length,i=g.length,j=d.test(a),k=d.test(c);switch(f=i>h?10*parseInt(f)*(i-h):parseInt(f),g=h>i?10*parseInt(g)*(h-i):parseInt(g),b){case"==":return!0==(f==g&&j==k);case">=":return!0==(f>=g&&(!j||j==k));case"<=":return!0==(g>=f&&(!k||k==j));case">":return!0===(f>g||f==g&&k);case"<":return!0===(g>f||f==g&&j)}}return!1},jQuery.fn.center=function(){var a=$(window);if(this.css("position","fixed"),!$.isVersion("1.7.0","<=")||null==a.outerHeight()||null==a.outerWidth()||isNaN(a.outerHeight())||isNaN(a.outerWidth()))var b=a.height(),c=a.width();else var b=a.outerHeight(),c=a.outerWidth();return this.css("top",b/2-this.height()/2+"px"),this.css("left",c/2-this.width()/2+"px"),this},String.prototype.ucfirst=function(){return this.substr(0,1).toUpperCase()+this.substr(1)},function(a,b,c){function d(a,b,c){for(var d=[],e=0;e<a.length;e++){var f=tinycolor(a[e]),g=f.toHsl().l<.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light";g+=tinycolor.equals(b,a[e])?" sp-thumb-active":"";var h=q?"background-color:"+f.toRgbString():"filter:"+f.toFilter();d.push('<span title="'+f.toRgbString()+'" data-color="'+f.toRgbString()+'" class="'+g+'"><span class="sp-thumb-inner" style="'+h+';" /></span>')}return"<div class='sp-cf "+c+"'>"+d.join("")+"</div>"}function e(){for(var a=0;a<o.length;a++)o[a]&&o[a].hide()}function f(a,c){var d=b.extend({},n,a);return d.callbacks={move:k(d.move,c),change:k(d.change,c),show:k(d.show,c),hide:k(d.hide,c),beforeShow:k(d.beforeShow,c)},d}function g(g,i){function k(){rb.toggleClass("sp-flat",R),rb.toggleClass("sp-input-disabled",!Q.showInput),rb.toggleClass("sp-alpha-enabled",Q.showAlpha),rb.toggleClass("sp-buttons-disabled",!Q.showButtons),rb.toggleClass("sp-palette-disabled",!Q.showPalette),rb.toggleClass("sp-palette-only",Q.showPaletteOnly),rb.toggleClass("sp-initial-disabled",!Q.showInitial),rb.addClass(Q.className),L()}function n(){function c(a){return a.data&&a.data.ignore?(E(b(this).data("color")),H()):(E(b(this).data("color")),K(!0),H(),C()),!1}if(p&&rb.find("*:not(input)").attr("unselectable","on"),k(),Fb&&pb.after(Gb).hide(),R)pb.after(rb).hide();else{var d="parent"===Q.appendTo?pb.parent():b(Q.appendTo);1!==d.length&&(d=b("body")),d.append(rb)}if(T&&a.localStorage){try{var e=a.localStorage[T].split(",#");e.length>1&&(delete a.localStorage[T],b.each(e,function(a,b){t(b)}))}catch(f){}try{kb=a.localStorage[T].split(";")}catch(f){}}Hb.bind("click.spectrum touchstart.spectrum",function(a){qb||A(),a.stopPropagation(),b(a.target).is("input")||a.preventDefault()}),(pb.is(":disabled")||Q.disabled===!0)&&P(),rb.click(j),zb.change(z),zb.bind("paste",function(){setTimeout(z,1)}),zb.keydown(function(a){13==a.keyCode&&z()}),Cb.text(Q.cancelText),Cb.bind("click.spectrum",function(a){a.stopPropagation(),a.preventDefault(),C("cancel")}),Db.text(Q.chooseText),Db.bind("click.spectrum",function(a){a.stopPropagation(),a.preventDefault(),G()&&(K(!0),C())}),l(xb,function(a,b,c){hb=a/bb,c.shiftKey&&(hb=Math.round(10*hb)/10),H()}),l(ub,function(a,b){eb=parseFloat(b/_),H()},x,y),l(sb,function(a,b,c){if(c.shiftKey){if(!nb){var d=fb*Y,e=Z-gb*Z,f=Math.abs(a-d)>Math.abs(b-e);nb=f?"x":"y"}}else nb=null;var g=!nb||"x"===nb,h=!nb||"y"===nb;g&&(fb=parseFloat(a/Y)),h&&(gb=parseFloat((Z-b)/Z)),H()},x,y),Jb?(E(Jb),I(),Mb=Lb||tinycolor(Jb).format,t(Jb)):I(),R&&B();var g=p?"mousedown.spectrum":"click.spectrum touchstart.spectrum";Ab.delegate(".sp-thumb-el",g,c),Bb.delegate(".sp-thumb-el:nth-child(1)",g,{ignore:!0},c)}function t(c){if(S){var d=tinycolor(c).toRgbString();if(-1===b.inArray(d,kb))for(kb.push(d);kb.length>lb;)kb.shift();if(T&&a.localStorage)try{a.localStorage[T]=kb.join(";")}catch(e){}}}function u(){var a,b=[],c=kb,d={};if(Q.showPalette){for(var e=0;e<jb.length;e++)for(var f=0;f<jb[e].length;f++)a=tinycolor(jb[e][f]).toRgbString(),d[a]=!0;for(e=0;e<c.length;e++)a=tinycolor(c[e]).toRgbString(),d.hasOwnProperty(a)||(b.push(c[e]),d[a]=!0)}return b.reverse().slice(0,Q.maxSelectionSize)}function v(){var a=F(),c=b.map(jb,function(b,c){return d(b,a,"sp-palette-row sp-palette-row-"+c)});kb&&c.push(d(u(),a,"sp-palette-row sp-palette-row-selection")),Ab.html(c.join(""))}function w(){if(Q.showInitial){var a=Kb,b=F();Bb.html(d([a,b],b,"sp-palette-row-initial"))}}function x(){(0>=Z||0>=Y||0>=_)&&L(),rb.addClass(mb),nb=null}function y(){rb.removeClass(mb)}function z(){var a=tinycolor(zb.val());a.ok?E(a):zb.addClass("sp-validation-error")}function A(){X?C():B()}function B(){var c=b.Event("beforeShow.spectrum");return X?(L(),void 0):(pb.trigger(c,[F()]),V.beforeShow(F())===!1||c.isDefaultPrevented()||(e(),X=!0,b(ob).bind("click.spectrum",C),b(a).bind("resize.spectrum",W),Gb.addClass("sp-active"),rb.removeClass("sp-hidden"),Q.showPalette&&v(),L(),I(),Kb=F(),w(),V.show(Kb),pb.trigger("show.spectrum",[Kb])),void 0)}function C(c){if((!c||"click"!=c.type||2!=c.button)&&X&&!R){X=!1,b(ob).unbind("click.spectrum",C),b(a).unbind("resize.spectrum",W),Gb.removeClass("sp-active"),rb.addClass("sp-hidden");var d=!tinycolor.equals(F(),Kb);d&&(Nb&&"cancel"!==c?K(!0):D()),V.hide(F()),pb.trigger("hide.spectrum",[F()])}}function D(){E(Kb,!0)}function E(a,b){if(!tinycolor.equals(a,F())){var c=tinycolor(a),d=c.toHsv();eb=d.h%360/360,fb=d.s,gb=d.v,hb=d.a,I(),c.ok&&!b&&(Mb=Lb||c.format)}}function F(a){return a=a||{},tinycolor.fromRatio({h:eb,s:fb,v:gb,a:Math.round(100*hb)/100},{format:a.format||Mb})}function G(){return!zb.hasClass("sp-validation-error")}function H(){I(),V.move(F()),pb.trigger("move.spectrum",[F()])}function I(){zb.removeClass("sp-validation-error"),J();var a=tinycolor.fromRatio({h:eb,s:1,v:1});sb.css("background-color",a.toHexString());var b=Mb;1>hb&&("hex"===b||"hex3"===b||"hex6"===b||"name"===b)&&(b="rgb");var c=F({format:b}),d=c.toHexString(),e=c.toRgbString();if(q||1===c.alpha?Ib.css("background-color",e):(Ib.css("background-color","transparent"),Ib.css("filter",c.toFilter())),Q.showAlpha){var f=c.toRgb();f.a=0;var g=tinycolor(f).toRgbString(),h="linear-gradient(left, "+g+", "+d+")";p?wb.css("filter",tinycolor(g).toFilter({gradientType:1},d)):(wb.css("background","-webkit-"+h),wb.css("background","-moz-"+h),wb.css("background","-ms-"+h),wb.css("background",h))}Q.showInput&&zb.val(c.toString(b)),Q.showPalette&&v(),w()}function J(){var a=fb,b=gb,c=a*Y,d=Z-b*Z;c=Math.max(-$,Math.min(Y-$,c-$)),d=Math.max(-$,Math.min(Z-$,d-$)),tb.css({top:d,left:c});var e=hb*bb;yb.css({left:e-cb/2});var f=eb*_;vb.css({top:f-db})}function K(a){var b=F();Eb&&pb.val(b.toString(Mb)).change();var c=!tinycolor.equals(b,Kb);Kb=b,t(b),a&&c&&(V.change(b),pb.trigger("change.spectrum",[b]))}function L(){Y=sb.width(),Z=sb.height(),$=tb.height(),ab=ub.width(),_=ub.height(),db=vb.height(),bb=xb.width(),cb=yb.width(),R||(rb.css("position","absolute"),rb.offset(h(rb,Hb))),J()}function M(){pb.show(),Hb.unbind("click.spectrum touchstart.spectrum"),rb.remove(),Gb.remove(),o[Ob.id]=null}function N(a,d){return a===c?b.extend({},Q):d===c?Q[a]:(Q[a]=d,k(),void 0)}function O(){qb=!1,pb.attr("disabled",!1),Hb.removeClass("sp-disabled")}function P(){C(),qb=!0,pb.attr("disabled",!0),Hb.addClass("sp-disabled")}var Q=f(i,g),R=Q.flat,S=Q.showSelectionPalette,T=Q.localStorageKey,U=Q.theme,V=Q.callbacks,W=m(L,10),X=!1,Y=0,Z=0,$=0,_=0,ab=0,bb=0,cb=0,db=0,eb=0,fb=0,gb=0,hb=1,ib=Q.palette.slice(0),jb=b.isArray(ib[0])?ib:[ib],kb=Q.selectionPalette.slice(0),lb=Q.maxSelectionSize,mb="sp-dragging",nb=null,ob=g.ownerDocument,pb=(ob.body,b(g)),qb=!1,rb=b(s,ob).addClass(U),sb=rb.find(".sp-color"),tb=rb.find(".sp-dragger"),ub=rb.find(".sp-hue"),vb=rb.find(".sp-slider"),wb=rb.find(".sp-alpha-inner"),xb=rb.find(".sp-alpha"),yb=rb.find(".sp-alpha-handle"),zb=rb.find(".sp-input"),Ab=rb.find(".sp-palette"),Bb=rb.find(".sp-initial"),Cb=rb.find(".sp-cancel"),Db=rb.find(".sp-choose"),Eb=pb.is("input"),Fb=Eb&&!R,Gb=Fb?b(r).addClass(U).addClass(Q.className):b([]),Hb=Fb?Gb:pb,Ib=Gb.find(".sp-preview-inner"),Jb=Q.color||Eb&&pb.val(),Kb=!1,Lb=Q.preferredFormat,Mb=Lb,Nb=!Q.showButtons||Q.clickoutFiresChange;n();var Ob={show:B,hide:C,toggle:A,reflow:L,option:N,enable:O,disable:P,set:function(a){E(a),K()},get:F,destroy:M,container:rb};return Ob.id=o.push(Ob)-1,Ob}function h(a,c){var d=0,e=a.outerWidth(),f=a.outerHeight(),g=c.outerHeight(),h=a[0].ownerDocument,i=h.documentElement,j=i.clientWidth+b(h).scrollLeft(),k=i.clientHeight+b(h).scrollTop(),l=c.offset();return l.top+=g,l.left-=Math.min(l.left,l.left+e>j&&j>e?Math.abs(l.left+e-j):0),l.top-=Math.min(l.top,l.top+f>k&&k>f?Math.abs(f+g-d):d),l}function i(){}function j(a){a.stopPropagation()}function k(a,b){var c=Array.prototype.slice,d=c.call(arguments,2);return function(){return a.apply(b,d.concat(c.call(arguments)))}}function l(c,d,e,f){function g(a){a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),a.returnValue=!1}function h(a){if(l){if(p&&document.documentMode<9&&!a.button)return j();var b=a.originalEvent.touches,e=b?b[0].pageX:a.pageX,f=b?b[0].pageY:a.pageY,h=Math.max(0,Math.min(e-m.left,o)),i=Math.max(0,Math.min(f-m.top,n));q&&g(a),d.apply(c,[h,i,a])}}function i(a){{var d=a.which?3==a.which:2==a.button;a.originalEvent.touches}d||l||e.apply(c,arguments)!==!1&&(l=!0,n=b(c).height(),o=b(c).width(),m=b(c).offset(),b(k).bind(r),b(k.body).addClass("sp-dragging"),q||h(a),g(a))}function j(){l&&(b(k).unbind(r),b(k.body).removeClass("sp-dragging"),f.apply(c,arguments)),l=!1}d=d||function(){},e=e||function(){},f=f||function(){};var k=c.ownerDocument||document,l=!1,m={},n=0,o=0,q="ontouchstart"in a,r={};r.selectstart=g,r.dragstart=g,r["touchmove mousemove"]=h,r["touchend mouseup"]=j,b(c).bind("touchstart mousedown",i)}function m(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,a.apply(e,f)};c&&clearTimeout(d),(c||!d)&&(d=setTimeout(g,b))}}var n={beforeShow:i,move:i,change:i,show:i,hide:i,color:!1,flat:!1,showInput:!1,showButtons:!0,clickoutFiresChange:!1,showInitial:!1,showPalette:!1,showPaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",preferredFormat:!1,className:"",showAlpha:!1,theme:"sp-light",palette:["fff","000"],selectionPalette:[],disabled:!1},o=[],p=!!/msie/i.exec(a.navigator.userAgent),q=function(){function a(a,b){return!!~(""+a).indexOf(b)}var b=document.createElement("div"),c=b.style;return c.cssText="background-color:rgba(0,0,0,.5)",a(c.backgroundColor,"rgba")||a(c.backgroundColor,"hsla")}(),r=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'></div></div>","<div class='sp-dd'>&#9660;</div>","</div>"].join(""),s=function(){var a="";if(p)for(var b=1;6>=b;b++)a+="<div class='sp-"+b+"'></div>";return["<div class='sp-container sp-hidden'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",a,"</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf'>","<a class='sp-cancel' href='#'></a>","<button class='sp-choose'></button>","</div>","</div>","</div>"].join("")}(),t="spectrum.id";b.fn.spectrum=function(a){if("string"==typeof a){var c=this,d=Array.prototype.slice.call(arguments,1);return this.each(function(){var e=o[b(this).data(t)];if(e){var f=e[a];if(!f)throw new Error("Spectrum: no such method: '"+a+"'");"get"==a?c=e.get():"container"==a?c=e.container:"option"==a?c=e.option.apply(e,d):"destroy"==a?(e.destroy(),b(this).removeData(t)):f.apply(e,d)}}),c}return this.spectrum("destroy").each(function(){var c=g(this,a);b(this).data(t,c.id)})},b.fn.spectrum.load=!0,b.fn.spectrum.loadOpts={},b.fn.spectrum.draggable=l,b.fn.spectrum.defaults=n,b.spectrum={},b.spectrum.localization={},b.spectrum.palettes={},b.fn.spectrum.processNativeColorInputs=function(){var a=b("<input type='color' value='!' />")[0],c="color"===a.type&&"!"!=a.value;c||b("input[type=color]").spectrum({preferredFormat:"hex6"})},function(a){function b(a,d){if(a=a?a:"",d=d||{},"object"==typeof a&&a.hasOwnProperty("_tc_id"))return a;var f=c(a),h=f.r,j=f.g,l=f.b,m=f.a,n=w(100*m)/100,o=d.format||f.format;return 1>h&&(h=w(h)),1>j&&(j=w(j)),1>l&&(l=w(l)),{ok:f.ok,format:o,_tc_id:u++,alpha:m,toHsv:function(){var a=g(h,j,l);return{h:360*a.h,s:a.s,v:a.v,a:m}},toHsvString:function(){var a=g(h,j,l),b=w(360*a.h),c=w(100*a.s),d=w(100*a.v);return 1==m?"hsv("+b+", "+c+"%, "+d+"%)":"hsva("+b+", "+c+"%, "+d+"%, "+n+")"},toHsl:function(){var a=e(h,j,l);return{h:360*a.h,s:a.s,l:a.l,a:m}},toHslString:function(){var a=e(h,j,l),b=w(360*a.h),c=w(100*a.s),d=w(100*a.l);return 1==m?"hsl("+b+", "+c+"%, "+d+"%)":"hsla("+b+", "+c+"%, "+d+"%, "+n+")"},toHex:function(a){return i(h,j,l,a)},toHexString:function(a){return"#"+i(h,j,l,a)},toRgb:function(){return{r:w(h),g:w(j),b:w(l),a:m}},toRgbString:function(){return 1==m?"rgb("+w(h)+", "+w(j)+", "+w(l)+")":"rgba("+w(h)+", "+w(j)+", "+w(l)+", "+n+")"},toPercentageRgb:function(){return{r:w(100*k(h,255))+"%",g:w(100*k(j,255))+"%",b:w(100*k(l,255))+"%",a:m}},toPercentageRgbString:function(){return 1==m?"rgb("+w(100*k(h,255))+"%, "+w(100*k(j,255))+"%, "+w(100*k(l,255))+"%)":"rgba("+w(100*k(h,255))+"%, "+w(100*k(j,255))+"%, "+w(100*k(l,255))+"%, "+n+")"},toName:function(){return B[i(h,j,l,!0)]||!1},toFilter:function(a){var c=i(h,j,l),e=c,f=Math.round(255*parseFloat(m)).toString(16),g=f,k=d&&d.gradientType?"GradientType = 1, ":"";if(a){var n=b(a);e=n.toHex(),g=Math.round(255*parseFloat(n.alpha)).toString(16)}return"progid:DXImageTransform.Microsoft.gradient("+k+"startColorstr=#"+p(f)+c+",endColorstr=#"+p(g)+e+")"},toString:function(a){a=a||this.format;var b=!1;return"rgb"===a&&(b=this.toRgbString()),"prgb"===a&&(b=this.toPercentageRgbString()),("hex"===a||"hex6"===a)&&(b=this.toHexString()),"hex3"===a&&(b=this.toHexString(!0)),"name"===a&&(b=this.toName()),"hsl"===a&&(b=this.toHslString()),"hsv"===a&&(b=this.toHsvString()),b||this.toHexString()}}}function c(a){var b={r:0,g:0,b:0},c=1,e=!1,g=!1;return"string"==typeof a&&(a=r(a)),"object"==typeof a&&(a.hasOwnProperty("r")&&a.hasOwnProperty("g")&&a.hasOwnProperty("b")?(b=d(a.r,a.g,a.b),e=!0,g="%"===String(a.r).substr(-1)?"prgb":"rgb"):a.hasOwnProperty("h")&&a.hasOwnProperty("s")&&a.hasOwnProperty("v")?(a.s=q(a.s),a.v=q(a.v),b=h(a.h,a.s,a.v),e=!0,g="hsv"):a.hasOwnProperty("h")&&a.hasOwnProperty("s")&&a.hasOwnProperty("l")&&(a.s=q(a.s),a.l=q(a.l),b=f(a.h,a.s,a.l),e=!0,g="hsl"),a.hasOwnProperty("a")&&(c=a.a)),c=parseFloat(c),(isNaN(c)||0>c||c>1)&&(c=1),{ok:e,format:a.format||g,r:x(255,y(b.r,0)),g:x(255,y(b.g,0)),b:x(255,y(b.b,0)),a:c}}function d(a,b,c){return{r:255*k(a,255),g:255*k(b,255),b:255*k(c,255)}}function e(a,b,c){a=k(a,255),b=k(b,255),c=k(c,255);var d,e,f=y(a,b,c),g=x(a,b,c),h=(f+g)/2;if(f==g)d=e=0;else{var i=f-g;switch(e=h>.5?i/(2-f-g):i/(f+g),f){case a:d=(b-c)/i+(c>b?6:0);break;case b:d=(c-a)/i+2;break;case c:d=(a-b)/i+4}d/=6}return{h:d,s:e,l:h}}function f(a,b,c){function d(a,b,c){return 0>c&&(c+=1),c>1&&(c-=1),1/6>c?a+6*(b-a)*c:.5>c?b:2/3>c?a+(b-a)*(2/3-c)*6:a}var e,f,g;if(a=k(a,360),b=k(b,100),c=k(c,100),0===b)e=f=g=c;else{var h=.5>c?c*(1+b):c+b-c*b,i=2*c-h;e=d(i,h,a+1/3),f=d(i,h,a),g=d(i,h,a-1/3)}return{r:255*e,g:255*f,b:255*g}}function g(a,b,c){a=k(a,255),b=k(b,255),c=k(c,255);var d,e,f=y(a,b,c),g=x(a,b,c),h=f,i=f-g;if(e=0===f?0:i/f,f==g)d=0;else{switch(f){case a:d=(b-c)/i+(c>b?6:0);break;case b:d=(c-a)/i+2;break;case c:d=(a-b)/i+4}d/=6}return{h:d,s:e,v:h}}function h(a,b,c){a=6*k(a,360),b=k(b,100),c=k(c,100);var d=v.floor(a),e=a-d,f=c*(1-b),g=c*(1-e*b),h=c*(1-(1-e)*b),i=d%6,j=[c,g,f,f,h,c][i],l=[h,c,c,g,f,f][i],m=[f,f,h,c,c,g][i];return{r:255*j,g:255*l,b:255*m}}function i(a,b,c,d){var e=[p(w(a).toString(16)),p(w(b).toString(16)),p(w(c).toString(16))];return d&&e[0].charAt(0)==e[0].charAt(1)&&e[1].charAt(0)==e[1].charAt(1)&&e[2].charAt(0)==e[2].charAt(1)?e[0].charAt(0)+e[1].charAt(0)+e[2].charAt(0):e.join("")}function j(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[a[c]]=c);return b}function k(a,b){n(a)&&(a="100%");var c=o(a);return a=x(b,y(0,parseFloat(a))),c&&(a=parseInt(a*b,10)/100),v.abs(a-b)<1e-6?1:a%b/parseFloat(b)}function l(a){return x(1,y(0,a))}function m(a){return parseInt(a,16)}function n(a){return"string"==typeof a&&-1!=a.indexOf(".")&&1===parseFloat(a)}function o(a){return"string"==typeof a&&-1!=a.indexOf("%")}function p(a){return 1==a.length?"0"+a:""+a}function q(a){return 1>=a&&(a=100*a+"%"),a}function r(a){a=a.replace(s,"").replace(t,"").toLowerCase();var b=!1;if(A[a])a=A[a],b=!0;else if("transparent"==a)return{r:0,g:0,b:0,a:0};var c;return(c=C.rgb.exec(a))?{r:c[1],g:c[2],b:c[3]}:(c=C.rgba.exec(a))?{r:c[1],g:c[2],b:c[3],a:c[4]}:(c=C.hsl.exec(a))?{h:c[1],s:c[2],l:c[3]}:(c=C.hsla.exec(a))?{h:c[1],s:c[2],l:c[3],a:c[4]}:(c=C.hsv.exec(a))?{h:c[1],s:c[2],v:c[3]}:(c=C.hex6.exec(a))?{r:m(c[1]),g:m(c[2]),b:m(c[3]),format:b?"name":"hex"}:(c=C.hex3.exec(a))?{r:m(c[1]+""+c[1]),g:m(c[2]+""+c[2]),b:m(c[3]+""+c[3]),format:b?"name":"hex"}:!1}var s=/^[\s,#]+/,t=/\s+$/,u=0,v=Math,w=v.round,x=v.min,y=v.max,z=v.random;b.fromRatio=function(a,c){if("object"==typeof a){var d={};for(var e in a)a.hasOwnProperty(e)&&(d[e]="a"===e?a[e]:q(a[e]));a=d}return b(a,c)},b.equals=function(a,c){return a&&c?b(a).toRgbString()==b(c).toRgbString():!1},b.random=function(){return b.fromRatio({r:z(),g:z(),b:z()})},b.desaturate=function(a,c){var d=b(a).toHsl();return d.s-=(c||10)/100,d.s=l(d.s),b(d)},b.saturate=function(a,c){var d=b(a).toHsl();return d.s+=(c||10)/100,d.s=l(d.s),b(d)},b.greyscale=function(a){return b.desaturate(a,100)},b.lighten=function(a,c){var d=b(a).toHsl();return d.l+=(c||10)/100,d.l=l(d.l),b(d)},b.darken=function(a,c){var d=b(a).toHsl();return d.l-=(c||10)/100,d.l=l(d.l),b(d)},b.complement=function(a){var c=b(a).toHsl();return c.h=(c.h+180)%360,b(c)},b.triad=function(a){var c=b(a).toHsl(),d=c.h;return[b(a),b({h:(d+120)%360,s:c.s,l:c.l}),b({h:(d+240)%360,s:c.s,l:c.l})]},b.tetrad=function(a){var c=b(a).toHsl(),d=c.h;return[b(a),b({h:(d+90)%360,s:c.s,l:c.l}),b({h:(d+180)%360,s:c.s,l:c.l}),b({h:(d+270)%360,s:c.s,l:c.l})]},b.splitcomplement=function(a){var c=b(a).toHsl(),d=c.h;return[b(a),b({h:(d+72)%360,s:c.s,l:c.l}),b({h:(d+216)%360,s:c.s,l:c.l})]},b.analogous=function(a,c,d){c=c||6,d=d||30;var e=b(a).toHsl(),f=360/d,g=[b(a)];for(e.h=(e.h-(f*c>>1)+720)%360;--c;)e.h=(e.h+f)%360,g.push(b(e));return g},b.monochromatic=function(a,c){c=c||6;for(var d=b(a).toHsv(),e=d.h,f=d.s,g=d.v,h=[],i=1/c;c--;)h.push(b({h:e,s:f,v:g})),g=(g+i)%1;return h},b.readability=function(a,c){var d=b(a).toRgb(),e=b(c).toRgb(),f=(299*d.r+587*d.g+114*d.b)/1e3,g=(299*e.r+587*e.g+114*e.b)/1e3,h=Math.max(d.r,e.r)-Math.min(d.r,e.r)+Math.max(d.g,e.g)-Math.min(d.g,e.g)+Math.max(d.b,e.b)-Math.min(d.b,e.b);return{brightness:Math.abs(f-g),color:h}},b.readable=function(a,c){var d=b.readability(a,c);return d.brightness>125&&d.color>500},b.mostReadable=function(a,c){for(var d=null,e=0,f=!1,g=0;g<c.length;g++){var h=b.readability(a,c[g]),i=h.brightness>125&&h.color>500,j=3*(h.brightness/125)+h.color/500;(i&&!f||i&&f&&j>e||!i&&!f&&j>e)&&(f=i,e=j,d=b(c[g]))}return d};var A=b.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},B=b.hexNames=j(A),C=function(){var a="[-\\+]?\\d+%?",b="[-\\+]?\\d*\\.\\d+%?",c="(?:"+b+")|(?:"+a+")",d="[\\s|\\(]+("+c+")[,|\\s]+("+c+")[,|\\s]+("+c+")\\s*\\)?",e="[\\s|\\(]+("+c+")[,|\\s]+("+c+")[,|\\s]+("+c+")[,|\\s]+("+c+")\\s*\\)?";return{rgb:new RegExp("rgb"+d),rgba:new RegExp("rgba"+e),hsl:new RegExp("hsl"+d),hsla:new RegExp("hsla"+e),hsv:new RegExp("hsv"+d),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();a.tinycolor=b}(this),b(function(){b.fn.spectrum.load&&b.fn.spectrum.processNativeColorInputs()})}(window,jQuery);